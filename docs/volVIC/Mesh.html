<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.4"/>
    <title>volVIC.Mesh API documentation</title>
            <link rel="icon" href="../logo.png"/>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../volVIC.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;volVIC</a>

            <img src="../logo.png" class="logo" alt="project logo"/>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="function" href="#in_notebook">in_notebook</a>
            </li>
            <li>
                    <a class="class" href="#Mesh">Mesh</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Mesh.__init__">Mesh</a>
                        </li>
                        <li>
                                <a class="variable" href="#Mesh.connectivity">connectivity</a>
                        </li>
                        <li>
                                <a class="variable" href="#Mesh.splines">splines</a>
                        </li>
                        <li>
                                <a class="variable" href="#Mesh.unique_ctrl_pts">unique_ctrl_pts</a>
                        </li>
                        <li>
                                <a class="variable" href="#Mesh.ref_inds">ref_inds</a>
                        </li>
                        <li>
                                <a class="function" href="#Mesh.show">show</a>
                        </li>
                        <li>
                                <a class="function" href="#Mesh.save">save</a>
                        </li>
                        <li>
                                <a class="function" href="#Mesh.load">load</a>
                        </li>
                        <li>
                                <a class="function" href="#Mesh.separated_to_unique">separated_to_unique</a>
                        </li>
                        <li>
                                <a class="function" href="#Mesh.unique_to_separated">unique_to_separated</a>
                        </li>
                        <li>
                                <a class="function" href="#Mesh.get_separated_ctrl_pts">get_separated_ctrl_pts</a>
                        </li>
                        <li>
                                <a class="function" href="#Mesh.set_separated_ctrl_pts">set_separated_ctrl_pts</a>
                        </li>
                        <li>
                                <a class="function" href="#Mesh.assemble_grads">assemble_grads</a>
                        </li>
                        <li>
                                <a class="function" href="#Mesh.assemble_hessians">assemble_hessians</a>
                        </li>
                        <li>
                                <a class="function" href="#Mesh.extract_border">extract_border</a>
                        </li>
                        <li>
                                <a class="function" href="#Mesh.subset">subset</a>
                        </li>
                        <li>
                                <a class="function" href="#Mesh.propagate_field">propagate_field</a>
                        </li>
                        <li>
                                <a class="function" href="#Mesh.propagate_field_from_submesh">propagate_field_from_submesh</a>
                        </li>
                        <li>
                                <a class="function" href="#Mesh.get_orientation_field">get_orientation_field</a>
                        </li>
                        <li>
                                <a class="function" href="#Mesh.correct_orientation">correct_orientation</a>
                        </li>
                        <li>
                                <a class="function" href="#Mesh.plot_orientation">plot_orientation</a>
                        </li>
                        <li>
                                <a class="function" href="#Mesh.plot">plot</a>
                        </li>
                        <li>
                                <a class="function" href="#Mesh.plot_in_image">plot_in_image</a>
                        </li>
                        <li>
                                <a class="function" href="#Mesh.ICP_rigid_body_transform">ICP_rigid_body_transform</a>
                        </li>
                        <li>
                                <a class="function" href="#Mesh.distance_to_meshio">distance_to_meshio</a>
                        </li>
                        <li>
                                <a class="function" href="#Mesh.save_paraview">save_paraview</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#MeshLattice">MeshLattice</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#MeshLattice.__init__">MeshLattice</a>
                        </li>
                        <li>
                                <a class="variable" href="#MeshLattice.l">l</a>
                        </li>
                        <li>
                                <a class="variable" href="#MeshLattice.m">m</a>
                        </li>
                        <li>
                                <a class="variable" href="#MeshLattice.n">n</a>
                        </li>
                        <li>
                                <a class="function" href="#MeshLattice.from_mesh">from_mesh</a>
                        </li>
                        <li>
                                <a class="function" href="#MeshLattice.get_mesh_cell_one">get_mesh_cell_one</a>
                        </li>
                        <li>
                                <a class="function" href="#MeshLattice.get_nb_patchs_cell">get_nb_patchs_cell</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../volVIC.html">volVIC</a><wbr>.Mesh    </h1>

                
                        <input id="mod-Mesh-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-Mesh-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="c1"># %%</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">Union</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">scipy.sparse</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sps</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">pyvista</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pv</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">meshio</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">io</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">pickle</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">bsplyne</span><span class="w"> </span><span class="kn">import</span> <span class="n">BSpline</span><span class="p">,</span> <span class="n">MultiPatchBSplineConnectivity</span><span class="p">,</span> <span class="n">parallel_blocks</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">treeIDW</span><span class="w"> </span><span class="kn">import</span> <span class="n">treeIDW</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">volVIC.image_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">find_fg_bg</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">volVIC.marching_cubes</span><span class="w"> </span><span class="kn">import</span> <span class="n">marching_cubes</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="k">def</span><span class="w"> </span><span class="nf">in_notebook</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">IPython</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_ipython</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a>        <span class="n">shell</span> <span class="o">=</span> <span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a>        <span class="k">if</span> <span class="n">shell</span> <span class="o">==</span> <span class="s2">&quot;ZMQInteractiveShell&quot;</span><span class="p">:</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a>            <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># Jupyter notebook ou lab</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a>        <span class="k">elif</span> <span class="n">shell</span> <span class="o">==</span> <span class="s2">&quot;TerminalInteractiveShell&quot;</span><span class="p">:</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a>            <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># IPython en terminal</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a>            <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># autre type inconnu</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a>    <span class="k">except</span> <span class="p">(</span><span class="ne">NameError</span><span class="p">,</span> <span class="ne">ImportError</span><span class="p">):</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a>        <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># En script Python standard</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Mesh</span><span class="p">:</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a><span class="sd">    Represents a multi-patch B-spline mesh.</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a><span class="sd">    This class manages a multi-patch B-spline mesh, including control points,</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a><span class="sd">    connectivity, evaluation, field propagation, and visualization. It supports</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a><span class="sd">    both 2D and 3D meshes.</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="sd">    Attributes</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a><span class="sd">    ----------</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a><span class="sd">    connectivity : MultiPatchBSplineConnectivity</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a><span class="sd">        Multi-patch connectivity structure.</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a><span class="sd">    splines : list[BSpline]</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a><span class="sd">        List of B-spline objects for each patch.</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a><span class="sd">    unique_ctrl_pts : np.ndarray</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a><span class="sd">        Array of unique control points for the entire mesh.</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a><span class="sd">    ref_inds : np.ndarray</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a><span class="sd">        Reference indices used for linking to submeshes.</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a>    <span class="n">connectivity</span><span class="p">:</span> <span class="n">MultiPatchBSplineConnectivity</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a>    <span class="n">splines</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">BSpline</span><span class="p">]</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a>    <span class="n">unique_ctrl_pts</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a>    <span class="n">ref_inds</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">]</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a>        <span class="n">splines</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">BSpline</span><span class="p">],</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a>        <span class="n">ctrl_pts</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]],</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a>        <span class="n">connectivity</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">MultiPatchBSplineConnectivity</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a>        <span class="n">ref_inds</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a>    <span class="p">):</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a><span class="sd">        Initialize a multi-patch B-spline mesh.</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a><span class="sd">        This constructor sets up a multi-patch mesh with B-spline patches,</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a><span class="sd">        control points, and optional connectivity and reference indices. The mesh</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a><span class="sd">        can be initialized either with separated control points per patch or with</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a><span class="sd">        a packed array of unique control points. If connectivity is not provided,</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a><span class="sd">        it is inferred automatically from separated control points.</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a><span class="sd">        Parameters</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a><span class="sd">        ----------</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a><span class="sd">        splines : list[BSpline]</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a><span class="sd">            List of `BSpline` objects for each patch.</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a><span class="sd">        ctrl_pts : list[np.ndarray] or np.ndarray</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a><span class="sd">            Control points of the mesh.</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a><span class="sd">            - If a list of arrays is provided, each array corresponds to a patch</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a><span class="sd">            (shape: `(dim_phys, n1, ..., nd)`).</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a><span class="sd">            - If a single array is provided, it should contain either the unique</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a><span class="sd">            control points or the full concatenated points for all patches.</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a><span class="sd">        connectivity : MultiPatchBSplineConnectivity, optional</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a><span class="sd">            Multi-patch connectivity object. If `None`, it is automatically inferred</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a><span class="sd">            from separated control points.</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a><span class="sd">        ref_inds : np.ndarray, optional</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a><span class="sd">            Reference indices mapping control points to submeshes or external data.</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a><span class="sd">            If `None`, defaults to `np.arange(nb_unique_nodes)`.</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a><span class="sd">        Notes</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a><span class="sd">        -----</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a><span class="sd">        - The mesh stores control points in a &quot;unique&quot; packed format (`self.unique_ctrl_pts`)</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a><span class="sd">        internally, regardless of input format.</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a><span class="sd">        - If `ctrl_pts` is a single array but does not match the number of unique nodes,</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a><span class="sd">        it is automatically packed using the provided or inferred connectivity.</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a>        <span class="k">if</span> <span class="n">connectivity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ctrl_pts</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a>                    <span class="s2">&quot;Can only infer connectivity from separated control points list.&quot;</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a>                <span class="p">)</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">=</span> <span class="n">MultiPatchBSplineConnectivity</span><span class="o">.</span><span class="n">from_separated_ctrlPts</span><span class="p">(</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a>                <span class="n">ctrl_pts</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a>            <span class="p">)</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">=</span> <span class="n">connectivity</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">splines</span> <span class="o">=</span> <span class="n">splines</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ctrl_pts</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>  <span class="c1"># unique or unpacked state</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a>            <span class="k">if</span> <span class="n">ctrl_pts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_unique_nodes</span><span class="p">:</span>  <span class="c1"># unique state</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">unique_ctrl_pts</span> <span class="o">=</span> <span class="n">ctrl_pts</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">unique_ctrl_pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">ctrl_pts</span><span class="p">)</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_separated_ctrl_pts</span><span class="p">(</span><span class="n">ctrl_pts</span><span class="p">)</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a>        <span class="k">if</span> <span class="n">ref_inds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ref_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_unique_nodes</span><span class="p">)</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ref_inds</span> <span class="o">=</span> <span class="n">ref_inds</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_repr_png_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a><span class="sd">        IPython/Jupyter display hook for the mesh.</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a><span class="sd">        Shows a screenshot of the last plot if available when</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a><span class="sd">        the object is displayed in a notebook.</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a><span class="sd">        Display the mesh or the last plot screenshot.</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a><span class="sd">        - If a screenshot from the last `PyVista` plot exists, it is displayed</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a><span class="sd">        via `Matplotlib`.</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a><span class="sd">        - Otherwise, prints a simple textual representation of the mesh.</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_screenshot&quot;</span><span class="p">):</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a>            <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_screenshot</span><span class="p">)</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Screenshot of last plot&quot;</span><span class="p">)</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a>            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a><span class="sd">        Serialize and save the mesh object to a file using pickle.</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a><span class="sd">        Parameters</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a><span class="sd">        ----------</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a><span class="sd">        filename : str</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a><span class="sd">            Path to the file where the mesh will be saved.</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a>            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Mesh&quot;</span><span class="p">:</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a><span class="sd">        Load a mesh object previously saved with :meth:`save`.</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a><span class="sd">        Parameters</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a><span class="sd">        ----------</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a><span class="sd">        filename : str</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a><span class="sd">            Path to the file containing the pickled mesh.</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a><span class="sd">        Returns</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a><span class="sd">        -------</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a><span class="sd">        Mesh</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a><span class="sd">            The loaded mesh object.</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a>            <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">separated_to_unique</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a><span class="sd">        Convert a field given per patch to the unique/global control points representation.</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a><span class="sd">        Parameters</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a><span class="sd">        ----------</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a><span class="sd">        field : list[np.ndarray]</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a><span class="sd">            Field separated per patch.</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a><span class="sd">        method : optional</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a><span class="sd">            Agglomeration method passed to :meth:`MultiPatchBSplineConnectivity.agglomerate`.</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a><span class="sd">        Returns</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a><span class="sd">        -------</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a><span class="sd">        np.ndarray</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a><span class="sd">            Field in the unique/global representation.</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a>        <span class="k">if</span> <span class="n">method</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">agglomerate</span><span class="p">(</span><span class="n">field</span><span class="p">))</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">agglomerate</span><span class="p">(</span><span class="n">field</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a>            <span class="p">)</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">unique_to_separated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a><span class="sd">        Convert a field in the unique/global representation to a per-patch separated form.</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a><span class="sd">        Parameters</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a><span class="sd">        ----------</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a><span class="sd">        field : np.ndarray</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a><span class="sd">            Field in unique/global representation.</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a><span class="sd">        Returns</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a><span class="sd">        -------</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a><span class="sd">        list[np.ndarray]</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a><span class="sd">            Field separated per patch.</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">separate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">field</span><span class="p">))</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_separated_ctrl_pts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]]:</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a><span class="sd">        Return the control points as a list of arrays, one per patch.</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a><span class="sd">        Returns</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a><span class="sd">        -------</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a><span class="sd">        list[np.ndarray]</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a><span class="sd">            Control points separated per patch.</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_to_separated</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unique_ctrl_pts</span><span class="p">)</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_separated_ctrl_pts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">separated_ctrl_pts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]]):</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a><span class="sd">        Set the mesh control points from a list of arrays (one per patch).</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a><span class="sd">        Parameters</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a><span class="sd">        ----------</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a><span class="sd">        separated_ctrl_pts : list[np.ndarray]</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a><span class="sd">            Control points separated per patch.</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">unique_ctrl_pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">separated_to_unique</span><span class="p">(</span><span class="n">separated_ctrl_pts</span><span class="p">)</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a>        <span class="n">XI</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="o">...</span><span class="p">]],</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a>        <span class="n">k</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]]],</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a><span class="sd">        Evaluate the mesh (B-spline patches) at given parametric points.</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a><span class="sd">        This method evaluates each B-spline patch of the mesh at the provided</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a><span class="sd">        isoparametric coordinates `XI`. The evaluation can be performed on either</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a><span class="sd">        the current control points of the mesh or a provided field.</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a><span class="sd">        Internally, this method calls :meth:`BSpline.__call__` for each patch.</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a><span class="sd">        Parameters</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a><span class="sd">        ----------</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a><span class="sd">        XI : iterable of tuple of np.ndarray</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a><span class="sd">            Isoparametric coordinates for evaluation, provided per patch.</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a><span class="sd">        k : int or iterable of int/tuple, optional</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a><span class="sd">            Degree of derivative to compute at each evaluation point. Can be a single</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a><span class="sd">            integer applied to all patches or an iterable specifying values per patch.</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a><span class="sd">            Default is 0 (function value).</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a><span class="sd">        data : np.ndarray or iterable of np.ndarray, optional</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a><span class="sd">            Field values to use for evaluation. If `None` (default), uses the current</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a><span class="sd">            control points. Can be a single array in unique/global representation</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a><span class="sd">            or a list of arrays per patch.</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a><span class="sd">        Returns</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a><span class="sd">        -------</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a><span class="sd">        list</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a><span class="sd">            List of evaluation results, one per patch, in the order of `XI`.</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>            <span class="n">k</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_patchs</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_patchs</span><span class="p">:</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>                    <span class="sa">f</span><span class="s2">&quot;Expected </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_patchs</span><span class="si">}</span><span class="s2"> entries in &#39;k&#39;, got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a>                <span class="p">)</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a>                <span class="sa">f</span><span class="s2">&quot;&#39;k&#39; must be an int or an iterable of ints/tuples, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a>            <span class="p">)</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a>        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_separated_ctrl_pts</span><span class="p">()</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_to_separated</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)):</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_patchs</span><span class="p">:</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a>                    <span class="sa">f</span><span class="s2">&quot;Expected </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_patchs</span><span class="si">}</span><span class="s2"> data arrays, got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a>                <span class="p">)</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a>                <span class="s2">&quot;&#39;data&#39; must be None, a NumPy array, or an iterable of NumPy arrays.&quot;</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a>                <span class="sa">f</span><span class="s2">&quot; Got object of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>            <span class="p">)</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a>        <span class="n">all_args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">XI</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="n">parallel_blocks</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">,</span> <span class="n">all_args</span><span class="p">,</span> <span class="n">pbar_title</span><span class="o">=</span><span class="s2">&quot;Evaluate mesh&quot;</span><span class="p">)</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a>        <span class="k">return</span> <span class="n">results</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">assemble_grads</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">terms</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">field_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a><span class="sd">        Assemble patch-wise gradient vectors into a global gradient vector.</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a><span class="sd">        Each entry in `terms` corresponds to a gradient vector computed on a single</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a><span class="sd">        patch. This method uses the mesh connectivity to map patch-local indices</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a><span class="sd">        to global unique node indices and sums contributions from overlapping nodes.</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a><span class="sd">        Important: Assumes that the degrees of freedom are arranged per field,</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a><span class="sd">        i.e., `[x_0, ..., x_n, y_0, ..., y_n, z_0, ..., z_n]`. It does not</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a><span class="sd">        work if the DOFs are interleaved as `[x_0, y_0, z_0, x_1, y_1, z_1, ...]`.</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a><span class="sd">        Parameters</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a><span class="sd">        ----------</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a><span class="sd">        terms : list of np.ndarray</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a><span class="sd">            Gradient vectors for each patch, typically computed from patch-local</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a><span class="sd">            operations.</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a><span class="sd">        field_size : int</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a><span class="sd">            Number of degrees of freedom per mesh node (e.g., 3 for 3D displacements).</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a><span class="sd">        Returns</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a><span class="sd">        -------</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a><span class="sd">        np.ndarray</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a><span class="sd">            Global gradient vector of size `field_size * nb_unique_nodes`.</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a><span class="sd">        Notes</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a><span class="sd">        -----</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a><span class="sd">        - Uses :meth:`MultiPatchBSplineConnectivity.unique_field_indices` to map</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a><span class="sd">        patch-local degrees of freedom to global indices.</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a>        <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_unique_nodes</span> <span class="o">*</span> <span class="n">field_size</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a>        <span class="n">total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">terms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>        <span class="n">separated_inds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">unique_field_indices</span><span class="p">(</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>            <span class="p">(</span><span class="n">field_size</span><span class="p">,),</span> <span class="n">representation</span><span class="o">=</span><span class="s2">&quot;separated&quot;</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>        <span class="p">)</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a>        <span class="k">for</span> <span class="n">patch</span><span class="p">,</span> <span class="n">term</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">terms</span><span class="p">):</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>            <span class="n">inds</span> <span class="o">=</span> <span class="n">separated_inds</span><span class="p">[</span><span class="n">patch</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">total</span><span class="p">,</span> <span class="n">inds</span><span class="p">,</span> <span class="n">term</span><span class="p">)</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>        <span class="k">return</span> <span class="n">total</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">assemble_hessians</span><span class="p">(</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">terms</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">sps</span><span class="o">.</span><span class="n">spmatrix</span><span class="p">],</span> <span class="n">field_size</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sps</span><span class="o">.</span><span class="n">spmatrix</span><span class="p">:</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a><span class="sd">        Assemble patch-wise Hessian matrices into a global sparse Hessian.</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a><span class="sd">        Each matrix in `terms` corresponds to the Hessian on a single patch. This</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a><span class="sd">        method maps the local patch indices to global unique node indices using the</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a><span class="sd">        mesh connectivity and constructs a global COO sparse matrix by summing</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a><span class="sd">        overlapping contributions.</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a><span class="sd">        Important: Assumes that the degrees of freedom are arranged per field,</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a><span class="sd">        i.e., `[x_0, ..., x_n, y_0, ..., y_n, z_0, ..., z_n]`. It does not</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a><span class="sd">        work if the DOFs are interleaved as `[x_0, y_0, z_0, x_1, y_1, z_1, ...]`.</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a><span class="sd">        Parameters</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a><span class="sd">        ----------</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a><span class="sd">        terms : list of scipy.sparse.spmatrix</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a><span class="sd">            Hessian matrices for each patch, typically in CSR or CSC format.</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a><span class="sd">        field_size : int</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a><span class="sd">            Number of degrees of freedom per mesh node (e.g., 3 for 3D displacements).</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a><span class="sd">        Returns</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a><span class="sd">        -------</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a><span class="sd">        scipy.sparse.spmatrix</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a><span class="sd">            Global sparse Hessian matrix of size `(field_size * nb_unique_nodes, field_size * nb_unique_nodes)`.</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a><span class="sd">        Notes</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a><span class="sd">        -----</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a><span class="sd">        - Uses :meth:`MultiPatchBSplineConnectivity.unique_field_indices` to map</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a><span class="sd">        patch-local degrees of freedom to global indices.</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a><span class="sd">        - The returned matrix is in COO format, suitable for further assembly or</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a><span class="sd">        conversion to CSR/CSC.</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a>        <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a>        <span class="n">cols</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a>        <span class="n">separated_inds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">unique_field_indices</span><span class="p">(</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a>            <span class="p">(</span><span class="n">field_size</span><span class="p">,),</span> <span class="n">representation</span><span class="o">=</span><span class="s2">&quot;separated&quot;</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>        <span class="p">)</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>        <span class="k">for</span> <span class="n">patch</span><span class="p">,</span> <span class="n">mat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">terms</span><span class="p">):</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a>            <span class="n">inds</span> <span class="o">=</span> <span class="n">separated_inds</span><span class="p">[</span><span class="n">patch</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a>            <span class="n">mat</span> <span class="o">=</span> <span class="n">mat</span><span class="o">.</span><span class="n">tocoo</span><span class="p">()</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>            <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="n">mat</span><span class="o">.</span><span class="n">row</span><span class="p">])</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a>            <span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="n">mat</span><span class="o">.</span><span class="n">col</span><span class="p">])</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a>            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mat</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a>        <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_unique_nodes</span> <span class="o">*</span> <span class="n">field_size</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a>        <span class="k">return</span> <span class="n">sps</span><span class="o">.</span><span class="n">coo_matrix</span><span class="p">(</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>            <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">rows</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">cols</span><span class="p">))),</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>        <span class="p">)</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">extract_border</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Mesh&quot;</span><span class="p">:</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a><span class="sd">        Extract the exterior boundary mesh from a multi-patch B-spline mesh.</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a><span class="sd">        This method identifies the nodes and patches lying on the exterior of the</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a><span class="sd">        mesh and constructs a new `Mesh` object representing only these boundary</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a><span class="sd">        elements. The reference indices are also updated to correspond to the</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a><span class="sd">        subset of unique nodes retained.</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a><span class="sd">        Returns</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a><span class="sd">        -------</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a><span class="sd">        Mesh</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a><span class="sd">            A new `Mesh` instance representing the exterior boundaries of the mesh.</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a><span class="sd">        Notes</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a><span class="sd">        -----</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a><span class="sd">        - The `ref_inds` of the returned mesh correspond to the indices of the</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a><span class="sd">        original mesh&#39;s unique nodes included in the boundary.</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a><span class="sd">        - The global layout of degrees of freedom remains the same as the parent</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a><span class="sd">        mesh.</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>        <span class="n">border_connectivity</span><span class="p">,</span> <span class="n">border_splines</span><span class="p">,</span> <span class="n">full_to_border</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">extract_exterior_borders</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">)</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>        <span class="p">)</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a>        <span class="n">border_ctrl_pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_ctrl_pts</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">full_to_border</span><span class="p">]</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>        <span class="n">border_ref_inds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_inds</span><span class="p">[</span><span class="n">full_to_border</span><span class="p">]</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>        <span class="k">return</span> <span class="n">Mesh</span><span class="p">(</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a>            <span class="nb">list</span><span class="p">(</span><span class="n">border_splines</span><span class="p">),</span> <span class="n">border_ctrl_pts</span><span class="p">,</span> <span class="n">border_connectivity</span><span class="p">,</span> <span class="n">border_ref_inds</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a>        <span class="p">)</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">subset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patchs_to_keep</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;Mesh&quot;</span><span class="p">:</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a><span class="sd">        Create a submesh containing only the specified patches.</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a><span class="sd">        The method constructs a new `Mesh` object consisting of the patches</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a><span class="sd">        indexed by `patchs_to_keep`. The unique control points and reference</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a><span class="sd">        indices are reduced accordingly to match the retained patches.</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a><span class="sd">        Parameters</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a><span class="sd">        ----------</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a><span class="sd">        patchs_to_keep : np.ndarray of int</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a><span class="sd">            Array of patch indices to retain in the submesh.</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a><span class="sd">        Returns</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a><span class="sd">        -------</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a><span class="sd">        Mesh</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a><span class="sd">            A new `Mesh` instance containing only the specified patches and the</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a><span class="sd">            associated control points.</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a><span class="sd">        Notes</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a><span class="sd">        -----</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a><span class="sd">        - The `ref_inds` of the returned submesh correspond to the subset of the</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a><span class="sd">        original mesh&#39;s reference indices included in the retained patches.</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a><span class="sd">        - The global layout of degrees of freedom is preserved.</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a><span class="sd">        - Useful for operations on a specific region or cell of a larger multipatch</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a><span class="sd">        mesh.</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>        <span class="n">splines</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_patchs</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>        <span class="n">splines</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a>        <span class="n">subset_connectivity</span><span class="p">,</span> <span class="n">subset_splines</span><span class="p">,</span> <span class="n">full_to_subset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>            <span class="n">splines</span><span class="p">,</span> <span class="n">patchs_to_keep</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>        <span class="p">)</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>        <span class="n">subset_ctrl_pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_ctrl_pts</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">full_to_subset</span><span class="p">]</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>        <span class="n">subset_ref_inds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_inds</span><span class="p">[</span><span class="n">full_to_subset</span><span class="p">]</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>        <span class="k">return</span> <span class="n">Mesh</span><span class="p">(</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>            <span class="nb">list</span><span class="p">(</span><span class="n">subset_splines</span><span class="p">),</span> <span class="n">subset_ctrl_pts</span><span class="p">,</span> <span class="n">subset_connectivity</span><span class="p">,</span> <span class="n">subset_ref_inds</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>        <span class="p">)</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">propagate_field</span><span class="p">(</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>        <span class="n">field_values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>        <span class="n">indices</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">],</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>        <span class="n">disable_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]:</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a><span class="sd">        Propagate a field defined on a subset of nodes to the entire mesh using IDW.</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a><span class="sd">        This method uses inverse distance weighting (IDW) interpolation to estimate</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a><span class="sd">        the values of a field at unknown nodes from known nodes. The known nodes are</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a><span class="sd">        specified by `indices` and the field values at those nodes are provided</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a><span class="sd">        through `field_values`.</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a><span class="sd">        Parameters</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a><span class="sd">        ----------</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a><span class="sd">        field_values : np.ndarray of float</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a><span class="sd">            Field values at known nodes, shape `(dof, n_known)` or `(n_known,)`.</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a><span class="sd">            Must be of `float` type for IDW interpolation.</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a><span class="sd">        indices : np.ndarray of int</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a><span class="sd">            Indices of the known nodes in `self.unique_ctrl_pts`.</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a><span class="sd">        disable_parallel : bool, optional</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a><span class="sd">            If `True`, disables parallel computation in the IDW interpolation. Default is `False`.</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a><span class="sd">        Returns</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a><span class="sd">        -------</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a><span class="sd">        np.ndarray of float</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a><span class="sd">            Field values propagated to all nodes of the mesh, same dtype as input.</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a><span class="sd">        Notes</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a><span class="sd">        -----</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a><span class="sd">        - `self.unique_ctrl_pts` must be float type for IDW to work correctly.</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a><span class="sd">        - Interpolation is performed only for nodes not in `indices`; known node values are preserved.</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>        <span class="n">shape</span> <span class="o">=</span> <span class="n">field_values</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>        <span class="n">field_values</span> <span class="o">=</span> <span class="n">field_values</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">shape</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>        <span class="n">unknown_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_unique_nodes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;bool&quot;</span><span class="p">)</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>        <span class="n">unknown_mask</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>        <span class="n">known_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_ctrl_pts</span><span class="p">[:,</span> <span class="n">indices</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>        <span class="n">unknown_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_ctrl_pts</span><span class="p">[:,</span> <span class="n">unknown_mask</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>        <span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>            <span class="p">(</span><span class="n">field_values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_unique_nodes</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>        <span class="p">)</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>        <span class="n">field</span><span class="p">[:,</span> <span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">field_values</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a>        <span class="n">field</span><span class="p">[:,</span> <span class="n">unknown_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">treeIDW</span><span class="p">(</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a>            <span class="n">known_points</span><span class="p">,</span> <span class="n">field_values</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">unknown_points</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="ow">not</span> <span class="n">disable_parallel</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>        <span class="k">return</span> <span class="n">field</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">*</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">propagate_field_from_submesh</span><span class="p">(</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>        <span class="n">submesh</span><span class="p">:</span> <span class="s2">&quot;Mesh&quot;</span><span class="p">,</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>        <span class="n">field_values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>        <span class="n">disable_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]:</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a><span class="sd">        Propagate a field from a submesh to the full mesh using IDW interpolation.</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a><span class="sd">        This method first identifies the nodes in the submesh that correspond to the</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a><span class="sd">        full mesh, then propagates the field to all nodes of the full mesh using</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a><span class="sd">        inverse distance weighting (IDW). The values at known nodes are preserved.</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a><span class="sd">        Parameters</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a><span class="sd">        ----------</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a><span class="sd">        submesh : Mesh</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a><span class="sd">            Submesh containing the nodes where the field is defined.</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a><span class="sd">        field_values : np.ndarray of float</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a><span class="sd">            Field values defined on the submesh nodes. Must be of `float` type for IDW.</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a><span class="sd">        disable_parallel : bool, optional</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a><span class="sd">            If `True`, disables parallel computation in the IDW interpolation. Default is `False`.</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a><span class="sd">        Returns</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a><span class="sd">        -------</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a><span class="sd">        np.ndarray of float</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a><span class="sd">            Field values propagated to all nodes of the full mesh.</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a><span class="sd">        Notes</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a><span class="sd">        -----</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a><span class="sd">        - Both `field_values` and `self.unique_ctrl_pts` must be of float type.</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a><span class="sd">        - Interpolation is done only for nodes not in the submesh; known node values are preserved.</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a>        <span class="n">shape</span> <span class="o">=</span> <span class="n">field_values</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a>        <span class="n">field_values</span> <span class="o">=</span> <span class="n">field_values</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">shape</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">idx_mesh</span><span class="p">,</span> <span class="n">idx_submesh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ref_inds</span><span class="p">,</span> <span class="n">submesh</span><span class="o">.</span><span class="n">ref_inds</span><span class="p">,</span> <span class="n">return_indices</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a>        <span class="p">)</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a>        <span class="n">field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">propagate_field</span><span class="p">(</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a>            <span class="n">field_values</span><span class="p">[:,</span> <span class="n">idx_submesh</span><span class="p">],</span> <span class="n">idx_mesh</span><span class="p">,</span> <span class="n">disable_parallel</span><span class="o">=</span><span class="n">disable_parallel</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a>        <span class="p">)</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a>        <span class="k">return</span> <span class="n">field</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">*</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_orientation_field</span><span class="p">(</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a>        <span class="n">n_eval_per_elem</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a>        <span class="n">XI_list</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a>        <span class="n">disable_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]]:</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a><span class="sd">        Compute the orientation field of a 3D multipatch B-spline mesh.</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a><span class="sd">        The orientation field is calculated as the scalar triple product of the</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a><span class="sd">        local tangent vectors of each element. It indicates the local handedness</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a><span class="sd">        of the mesh elements (positive for right-handed orientation, negative for left-handed).</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a><span class="sd">        Parameters</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a><span class="sd">        ----------</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a><span class="sd">        n_eval_per_elem : int, optional</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a><span class="sd">            Number of evaluation points per element along each parametric direction.</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a><span class="sd">            Default is `5`.</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a><span class="sd">        XI_list : iterable of tuple of np.ndarray, optional</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a><span class="sd">            Predefined parametric coordinates for each patch. If `None`, a regular grid</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a><span class="sd">            is generated using `n_eval_per_elem`.</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a><span class="sd">        verbose : bool, optional</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a><span class="sd">            If `True`, prints progress messages. Default is `True`.</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a><span class="sd">        disable_parallel : bool, optional</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a><span class="sd">            If `True`, disables parallel computation. Default is `False`.</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a><span class="sd">        Returns</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a><span class="sd">        -------</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a><span class="sd">        list of np.ndarray of float</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a><span class="sd">            A `list` (one entry per patch) containing the orientation scalar field</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a><span class="sd">            for at each evaluation point.</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a><span class="sd">        Notes</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a><span class="sd">        -----</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a><span class="sd">        - Only implemented for 3D meshes (`self.connectivity.npa == 3`).</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a><span class="sd">        - Uses parallel evaluation via `parallel_blocks`.</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a>        <span class="k">assert</span> <span class="p">(</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">npa</span> <span class="o">==</span> <span class="mi">3</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a>        <span class="p">),</span> <span class="s2">&quot;Orientation field is only implemented for 3D meshes.&quot;</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">fct_elem</span><span class="p">(</span><span class="n">spline</span><span class="p">,</span> <span class="n">ctrl_pts</span><span class="p">,</span> <span class="n">XI</span><span class="p">):</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a>            <span class="n">ds_dxi</span><span class="p">,</span> <span class="n">ds_deta</span><span class="p">,</span> <span class="n">ds_dzeta</span> <span class="o">=</span> <span class="n">spline</span><span class="p">(</span><span class="n">ctrl_pts</span><span class="p">,</span> <span class="n">XI</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a>            <span class="n">cross_prod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">ds_dxi</span><span class="p">,</span> <span class="n">ds_deta</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a>            <span class="n">mixt_prod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cross_prod</span> <span class="o">*</span> <span class="n">ds_dzeta</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a>            <span class="k">return</span> <span class="n">mixt_prod</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a>        <span class="k">if</span> <span class="n">XI_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a>            <span class="n">XI_list</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>                <span class="n">s</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">n_eval_per_elem</span><span class="o">=</span><span class="n">n_eval_per_elem</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a>            <span class="p">]</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_separated_ctrl_pts</span><span class="p">(),</span> <span class="n">XI_list</span><span class="p">))</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>        <span class="n">orientation_field</span> <span class="o">=</span> <span class="n">parallel_blocks</span><span class="p">(</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>            <span class="n">fct_elem</span><span class="p">,</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>            <span class="n">args</span><span class="p">,</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>            <span class="n">pbar_title</span><span class="o">=</span><span class="s2">&quot;Computing orientation field&quot;</span><span class="p">,</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>            <span class="n">disable_parallel</span><span class="o">=</span><span class="n">disable_parallel</span><span class="p">,</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>        <span class="p">)</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>        <span class="k">return</span> <span class="n">orientation_field</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">correct_orientation</span><span class="p">(</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a>        <span class="n">separated_fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>        <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>        <span class="n">disable_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>    <span class="p">):</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a><span class="sd">        Ensure consistent orientation of all patches in a 3D multipatch B-spline mesh.</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a><span class="sd">        This method detects and corrects inverted patch orientations by evaluating</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a><span class="sd">        the integrated orientation field over each patch. Patches with a negative</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a><span class="sd">        signed orientation are flipped along the specified parametric axis.</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a><span class="sd">        The orientation of each patch is assessed by integrating the scalar triple</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a><span class="sd">        product of the parametric tangent vectors using Gauss-Legendre quadrature.</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a><span class="sd">        A negative integral indicates an inverted (left-handed) parametrization.</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a><span class="sd">        Parameters</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a><span class="sd">        ----------</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a><span class="sd">        separated_fields : list, optional</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a><span class="sd">            List of fields defined in separated (per-patch) representation that must</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a><span class="sd">            be flipped consistently with the control points. Each entry is modified</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a><span class="sd">            before returning it. Default is an empty list.</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a><span class="sd">        axis : int, optional</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a><span class="sd">            Parametric axis along which inverted patches are flipped</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a><span class="sd">            (`0 -&gt; xi`, `1 -&gt; eta`, `2 -&gt; zeta`). Default is `2`.</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a><span class="sd">        verbose : bool, optional</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a><span class="sd">            If `True`, prints diagnostic information, including the number of flipped</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a><span class="sd">            patches. Default is `True`.</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a><span class="sd">        disable_parallel : bool, optional</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a><span class="sd">            If `True`, disables parallel computation. Default is `False`.</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a><span class="sd">        Returns</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a><span class="sd">        -------</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a><span class="sd">        list</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a><span class="sd">            Flipped version, consistently with the control points, of `separated_fields`.</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a><span class="sd">        Notes</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a><span class="sd">        -----</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a><span class="sd">        - Only applicable to 3D meshes (`self.connectivity.npa == 3`).</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a><span class="sd">        - Patch orientation is determined by integrating the orientation field</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a><span class="sd">          returned by :meth:`get_orientation_field`.</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a><span class="sd">        - Flipping a patch involves:</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a><span class="sd">            * Reversing the knot vector of the selected parametric axis.</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a><span class="sd">            * Reversing the corresponding axis of the separated control points.</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a><span class="sd">            * Reversing the same axis for all fields listed in `separated_fields`.</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a><span class="sd">        - The mesh connectivity (`unique_nodes_inds`) and `unique_ctrl_pts` are</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a><span class="sd">          modified to reflect the updated orientation.</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a><span class="sd">        - This operation modifies the mesh in place.</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a>        <span class="n">nb_gauss</span> <span class="o">=</span> <span class="p">[[(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">getDegrees</span><span class="p">()]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">]</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a>        <span class="n">XI_dXI_list</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a>            <span class="n">s</span><span class="o">.</span><span class="n">gauss_legendre_for_integration</span><span class="p">(</span><span class="n">n_eval_per_elem</span><span class="o">=</span><span class="n">ng</span><span class="p">)</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a>            <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">ng</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">,</span> <span class="n">nb_gauss</span><span class="p">)</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>        <span class="p">]</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>        <span class="n">XI_list</span><span class="p">,</span> <span class="n">dXI_list</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">XI_dXI_list</span><span class="p">)</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a>        <span class="n">orientation_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_orientation_field</span><span class="p">(</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a>            <span class="n">XI_list</span><span class="o">=</span><span class="n">XI_list</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">disable_parallel</span><span class="o">=</span><span class="n">disable_parallel</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a>        <span class="p">)</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a>        <span class="n">patchs_orientation</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a>        <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">dxi</span><span class="p">,</span> <span class="n">deta</span><span class="p">,</span> <span class="n">dzeta</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">orientation_field</span><span class="p">,</span> <span class="n">dXI_list</span><span class="p">):</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a>            <span class="n">dXI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">dxi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">deta</span><span class="p">,</span> <span class="n">dzeta</span><span class="p">))</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a>            <span class="n">patchs_orientation</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="o">@</span> <span class="n">dXI</span><span class="p">)</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a>        <span class="n">patchs_to_flip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">patchs_orientation</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a>                <span class="sa">f</span><span class="s2">&quot;Flipping </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">patchs_to_flip</span><span class="p">)</span><span class="si">}</span><span class="s2"> out of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_patchs</span><span class="si">}</span><span class="s2"> patchs.&quot;</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a>            <span class="p">)</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a>        <span class="n">separated_ctrl_pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_separated_ctrl_pts</span><span class="p">()</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>        <span class="n">inds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">unique_field_indices</span><span class="p">(())</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>        <span class="n">flip</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>            <span class="p">[</span><span class="o">...</span><span class="p">]</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>            <span class="o">+</span> <span class="p">[</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a>                <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="n">axis</span> <span class="k">else</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">npa</span><span class="p">)</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>            <span class="p">]</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a>        <span class="p">)</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">patchs_to_flip</span><span class="p">:</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a>            <span class="n">axis_basis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">bases</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>            <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">axis_basis</span><span class="o">.</span><span class="n">span</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>            <span class="n">axis_basis</span><span class="o">.</span><span class="n">knot</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="n">axis_basis</span><span class="o">.</span><span class="n">knot</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>            <span class="n">separated_ctrl_pts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">separated_ctrl_pts</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">flip</span><span class="p">]</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a>            <span class="n">inds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">inds</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">flip</span><span class="p">]</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>            <span class="k">for</span> <span class="n">separated_field</span> <span class="ow">in</span> <span class="n">separated_fields</span><span class="p">:</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>                <span class="n">separated_field</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">separated_field</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">flip</span><span class="p">]</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">unique_nodes_inds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">agglomerate</span><span class="p">(</span><span class="n">inds</span><span class="p">)</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">unique_ctrl_pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">separated_to_unique</span><span class="p">(</span><span class="n">separated_ctrl_pts</span><span class="p">)</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a>        <span class="k">return</span> <span class="n">separated_fields</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_orientation</span><span class="p">(</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>        <span class="n">n_eval_per_elem</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a>        <span class="n">XI_list</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>        <span class="n">disable_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">:</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a><span class="sd">        Visualize the orientation (handedness) of the mesh elements.</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a><span class="sd">        This method computes the orientation field of the mesh and visualizes it</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a><span class="sd">        as a boolean field indicating whether each evaluation point corresponds</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a><span class="sd">        to a right-handed (`True`) or left-handed (`False`) parametrization.</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a><span class="sd">        Internally, the orientation field is evaluated using</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a><span class="sd">        :meth:`get_orientation_field`, then thresholded as</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a><span class="sd">        `orientation &gt; 0` and reshaped to comply with plotting requirements.</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a><span class="sd">        Parameters</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a><span class="sd">        ----------</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a><span class="sd">        n_eval_per_elem : int or iterable of int, optional</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a><span class="sd">            Number of evaluation points per element along each parametric direction.</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a><span class="sd">            If an iterable is provided, it must match the parametric dimension.</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a><span class="sd">            Default is `5`.</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a><span class="sd">        XI_list : iterable of tuple of ndarray, optional</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a><span class="sd">            Parametric coordinates at which the orientation field is evaluated,</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a><span class="sd">            one entry per patch. If `None` (default), a uniform sampling is used</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a><span class="sd">            for each patch.</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a><span class="sd">        verbose : bool, optional</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a><span class="sd">            If `True`, displays progress information. Default is `True`.</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a><span class="sd">        disable_parallel : bool, optional</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a><span class="sd">            If `True`, disables parallel computation. Default is `False`.</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a><span class="sd">        **kwargs : dict, optional</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a><span class="sd">            Additional keyword arguments forwarded to :meth:`Mesh.plot`, such as</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a><span class="sd">            `cmap`, `scalar_bar_args`, `show_scalar_bar`, etc.</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a><span class="sd">        Returns</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a><span class="sd">        -------</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a><span class="sd">        pv.Plotter</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a><span class="sd">            The PyVista plotter object used for visualization.</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a><span class="sd">        Notes</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a><span class="sd">        -----</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a><span class="sd">        - The orientation field is visualized as a boolean scalar field, where</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a><span class="sd">          `True` indicates a right-handed parametrization and `False` a</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a><span class="sd">          left-handed one.</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a><span class="sd">        - The default colormap uses red for left-handed and green for right-handed</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a><span class="sd">          orientations.</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a><span class="sd">        - This method is intended as a diagnostic tool, typically used before or</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a><span class="sd">          after calling :meth:`correct_orientation`.</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a>        <span class="n">separated_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_orientation_field</span><span class="p">(</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a>            <span class="n">n_eval_per_elem</span><span class="o">=</span><span class="n">n_eval_per_elem</span><span class="p">,</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a>            <span class="n">XI_list</span><span class="o">=</span><span class="n">XI_list</span><span class="p">,</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a>            <span class="n">disable_parallel</span><span class="o">=</span><span class="n">disable_parallel</span><span class="p">,</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a>            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a>        <span class="p">)</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>        <span class="n">separated_field</span> <span class="o">=</span> <span class="p">[</span><span class="n">field</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">separated_field</span><span class="p">]</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;cmap&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;#ff0000&quot;</span><span class="p">,</span> <span class="s2">&quot;#00ff00&quot;</span><span class="p">])</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;show_scalar_bar&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;annotations&quot;</span><span class="p">,</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;False&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;True&quot;</span><span class="p">})</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>        <span class="n">scalar_bar_args</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;scalar_bar_args&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>        <span class="n">scalar_bar_args</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;Is Right Handed&quot;</span><span class="p">)</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>        <span class="n">scalar_bar_args</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;n_labels&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;scalar_bar_args&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scalar_bar_args</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a>            <span class="n">n_eval_per_elem</span><span class="o">=</span><span class="n">n_eval_per_elem</span><span class="p">,</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>            <span class="n">XI_list</span><span class="o">=</span><span class="n">XI_list</span><span class="p">,</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>            <span class="n">separated_field</span><span class="o">=</span><span class="n">separated_field</span><span class="p">,</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>            <span class="n">disable_parallel</span><span class="o">=</span><span class="n">disable_parallel</span><span class="p">,</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>        <span class="p">)</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot</span><span class="p">(</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>        <span class="n">n_eval_per_elem</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>        <span class="n">XI_list</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>        <span class="n">unique_field</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>        <span class="n">separated_field</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">callable</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>        <span class="n">interior_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>        <span class="n">plt_ctrl_mesh</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>        <span class="n">disable_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>        <span class="n">pv_plotter</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a>        <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>        <span class="n">elem_sep_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a>        <span class="n">ctrl_poly_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>        <span class="o">**</span><span class="n">pv_add_mesh_kwargs</span><span class="p">,</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>    <span class="p">):</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a><span class="sd">        Visualize the B-spline multipatch mesh using `PyVista`.</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a><span class="sd">        This method evaluates the mesh geometry and optional scalar fields at</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a><span class="sd">        parametric sampling points and renders them using `PyVista`. Fields can be</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a><span class="sd">        provided either in a unique (global) or separated (per-patch) representation.</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a><span class="sd">        Parameters</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a><span class="sd">        ----------</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a><span class="sd">        n_eval_per_elem : int or iterable of int, optional</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a><span class="sd">            Number of evaluation points per element along each parametric direction.</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a><span class="sd">            If an iterable is provided, it must match the parametric dimension.</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a><span class="sd">            Default is `10`.</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a><span class="sd">        XI_list : iterable of tuple of np.ndarray, optional</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a><span class="sd">            Explicit parametric coordinates for evaluation, provided per patch.</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a><span class="sd">            If `None`, a regular grid based on `n_eval_per_elem` is used.</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a><span class="sd">        unique_field : np.ndarray, optional</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a><span class="sd">            Field defined on the unique control points of the mesh. Mutually exclusive</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a><span class="sd">            with `separated_field`.</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a><span class="sd">        separated_field : list of np.ndarray or list of callable, optional</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a><span class="sd">            Field defined per patch, either as arrays evaluated on parametric grids</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a><span class="sd">            or as callables evaluated at runtime. Mutually exclusive with `unique_field`.</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a><span class="sd">        interior_only : bool, optional</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a><span class="sd">            If `True`, only interior elements are displayed. Default is `True`.</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a><span class="sd">        plt_ctrl_mesh : bool, optional</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a><span class="sd">            If `True`, overlays the control polygon mesh (only if `interior_only=False`).</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a><span class="sd">            Default is `False`.</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a><span class="sd">        verbose : bool, optional</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a><span class="sd">            If `True`, prints progress messages. Default is `True`.</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a><span class="sd">        disable_parallel : bool, optional</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a><span class="sd">            If `True`, disables parallel computation. Default is `False`.</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a><span class="sd">        pv_plotter : pv.Plotter or None, optional</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a><span class="sd">            Existing `PyVista` plotter to use. If `None`, a new one is created.</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a><span class="sd">        show : bool, optional</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a><span class="sd">            If `True`, renders the scene immediately. Default is `True`.</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a><span class="sd">        elem_sep_color : str, optional</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a><span class="sd">            Color used for element separators. Default is `&#39;black&#39;`.</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a><span class="sd">        ctrl_poly_color : str, optional</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a><span class="sd">            Color used for the control polygon mesh. Default is `&#39;green&#39;`.</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a><span class="sd">        **pv_add_mesh_kwargs : dict, optional</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a><span class="sd">            Additional keyword arguments forwarded to `pv.Plotter.add_mesh`</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a><span class="sd">            (e.g. `cmap`, `clim`, `scalar_bar_args`, etc.).</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a><span class="sd">        Returns</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a><span class="sd">        -------</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a><span class="sd">        pv.Plotter</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a><span class="sd">            The `PyVista` plotter used for rendering.</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a><span class="sd">        Notes</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a><span class="sd">        -----</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a><span class="sd">        - Exactly one of `unique_field` or `separated_field` may be provided.</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a><span class="sd">        - Fields passed as NumPy arrays for plotting must have the same number of</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a><span class="sd">          dimensions (`ndim`) as the control points array. Scalar fields must therefore</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a><span class="sd">          include a leading dimension of size 1.</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a><span class="sd">        - Fields are evaluated on-the-fly at visualization points, not at control points.</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a><span class="sd">        - If executed in a Jupyter notebook, a screenshot of the last plot is stored</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a><span class="sd">          for display via `_repr_png_`.</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a>        <span class="k">if</span> <span class="n">unique_field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a>            <span class="n">unique_fields</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>                <span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="p">(</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a>                    <span class="n">unique_field</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a>                    <span class="k">if</span> <span class="n">unique_field</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a>                    <span class="k">else</span> <span class="n">unique_field</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>                <span class="p">)</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a>            <span class="p">}</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a>            <span class="n">separated_fields</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>        <span class="k">elif</span> <span class="n">separated_field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>            <span class="n">unique_fields</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">separated_field</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Callable</span><span class="p">):</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>                <span class="n">separated_fields</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>                    <span class="p">{</span><span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">field</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)[</span><span class="kc">None</span><span class="p">]}</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">separated_field</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>                <span class="p">]</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>                <span class="n">separated_fields</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="n">field</span><span class="p">[</span><span class="kc">None</span><span class="p">]}</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">separated_field</span><span class="p">]</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>            <span class="n">unique_fields</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a>            <span class="n">separated_fields</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>        <span class="k">if</span> <span class="n">pv_plotter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>            <span class="n">pv_plotter</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">()</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>        <span class="p">(</span><span class="n">elem_int_mesh</span><span class="p">,)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">make_elements_interior_meshes</span><span class="p">(</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">,</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_separated_ctrl_pts</span><span class="p">(),</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a>            <span class="n">n_step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a>            <span class="n">n_eval_per_elem</span><span class="o">=</span><span class="n">n_eval_per_elem</span><span class="p">,</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>            <span class="n">unique_fields</span><span class="o">=</span><span class="n">unique_fields</span><span class="p">,</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>            <span class="n">separated_fields</span><span class="o">=</span><span class="n">separated_fields</span><span class="p">,</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>            <span class="n">XI_list</span><span class="o">=</span><span class="n">XI_list</span><span class="p">,</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>            <span class="n">disable_parallel</span><span class="o">=</span><span class="n">disable_parallel</span><span class="p">,</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a>        <span class="p">)</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>        <span class="n">pv_plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">elem_int_mesh</span><span class="p">,</span> <span class="o">**</span><span class="n">pv_add_mesh_kwargs</span><span class="p">)</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">interior_only</span><span class="p">:</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a>            <span class="p">(</span><span class="n">elem_sep_mesh</span><span class="p">,)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">make_elem_separator_meshes</span><span class="p">(</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">,</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">get_separated_ctrl_pts</span><span class="p">(),</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>                <span class="n">n_step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a>                <span class="n">n_eval_per_elem</span><span class="o">=</span><span class="n">n_eval_per_elem</span><span class="p">,</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>                <span class="n">XI_list</span><span class="o">=</span><span class="n">XI_list</span><span class="p">,</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a>                <span class="n">disable_parallel</span><span class="o">=</span><span class="n">disable_parallel</span><span class="p">,</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>                <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a>            <span class="p">)</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>            <span class="k">if</span> <span class="s2">&quot;label&quot;</span> <span class="ow">in</span> <span class="n">pv_add_mesh_kwargs</span><span class="p">:</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a>                <span class="k">del</span> <span class="n">pv_add_mesh_kwargs</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a>            <span class="n">pv_add_mesh_kwargs</span><span class="p">[</span><span class="s2">&quot;style&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;wireframe&quot;</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a>            <span class="n">pv_add_mesh_kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elem_sep_color</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a>            <span class="n">pv_plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">elem_sep_mesh</span><span class="p">,</span> <span class="o">**</span><span class="n">pv_add_mesh_kwargs</span><span class="p">)</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>            <span class="k">if</span> <span class="n">plt_ctrl_mesh</span><span class="p">:</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a>                <span class="p">(</span><span class="n">ctrl_poly_mesh</span><span class="p">,)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">make_control_poly_meshes</span><span class="p">(</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">,</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">get_separated_ctrl_pts</span><span class="p">(),</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a>                    <span class="n">n_step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a>                    <span class="n">n_eval_per_elem</span><span class="o">=</span><span class="n">n_eval_per_elem</span><span class="p">,</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a>                    <span class="n">XI_list</span><span class="o">=</span><span class="n">XI_list</span><span class="p">,</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a>                    <span class="n">disable_parallel</span><span class="o">=</span><span class="n">disable_parallel</span><span class="p">,</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a>                    <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a>                <span class="p">)</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a>                <span class="n">pv_add_mesh_kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ctrl_poly_color</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a>                <span class="n">pv_plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">ctrl_poly_mesh</span><span class="p">,</span> <span class="o">**</span><span class="n">pv_add_mesh_kwargs</span><span class="p">)</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a>        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a>            <span class="n">pv_plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a>            <span class="k">if</span> <span class="n">in_notebook</span><span class="p">():</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_screenshot</span> <span class="o">=</span> <span class="n">pv_plotter</span><span class="o">.</span><span class="n">screenshot</span><span class="p">(</span><span class="n">return_img</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a>        <span class="k">return</span> <span class="n">pv_plotter</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_in_image</span><span class="p">(</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a>        <span class="n">image</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a>        <span class="n">threshold</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a>        <span class="n">threshold_method</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;otsu&quot;</span><span class="p">,</span> <span class="s2">&quot;interp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;otsu&quot;</span><span class="p">,</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;marching cubes&quot;</span><span class="p">,</span> <span class="s2">&quot;voxels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;marching cubes&quot;</span><span class="p">,</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a>        <span class="n">n_eval_per_elem</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a>        <span class="n">XI_list</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>        <span class="n">interior_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a>        <span class="n">plt_ctrl_mesh</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a>        <span class="n">disable_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>        <span class="n">pv_plotter</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>        <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>        <span class="n">image_show_edges</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>        <span class="n">image_line_width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a>        <span class="n">image_opacity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.85</span><span class="p">,</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>        <span class="n">image_edge_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>        <span class="n">image_interior_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a>        <span class="o">**</span><span class="n">pv_add_mesh_kwargs</span><span class="p">,</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a>    <span class="p">):</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a><span class="sd">        Visualize the mesh together with an image-derived surface.</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a><span class="sd">        This method overlays the B-spline mesh visualization with a surface extracted</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a><span class="sd">        from a volumetric image, using either marching cubes or voxel thresholding.</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a><span class="sd">        It is typically used to assess geometric alignment between the mesh and image</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a><span class="sd">        features.</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a><span class="sd">        Parameters</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a><span class="sd">        ----------</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a><span class="sd">        image : np.ndarray</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a><span class="sd">            Input volumetric image of shape (n1, n2, n3).</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a><span class="sd">        threshold : float or None, optional</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a><span class="sd">            Threshold value used to extract the image surface. If `None`, it is</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a><span class="sd">            automatically estimated using `threshold_method`.</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a><span class="sd">        threshold_method : {&quot;otsu&quot;, &quot;interp&quot;}, optional</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a><span class="sd">            Method used to estimate the threshold when `threshold` is `None`.</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a><span class="sd">            Default is `&quot;otsu&quot;`.</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a><span class="sd">        mode : {&quot;marching cubes&quot;, &quot;voxels&quot;}, optional</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a><span class="sd">            Method used to extract the image surface. If `&quot;marching cubes&quot;`,</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a><span class="sd">            the image must be of dtype `uint16`. Default is `&quot;marching cubes&quot;`.</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a><span class="sd">        n_eval_per_elem : int or iterable of int, optional</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a><span class="sd">            Number of evaluation points per element along each parametric direction.</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a><span class="sd">            Default is `10`.</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a><span class="sd">        XI_list : iterable of tuple of np.ndarray, optional</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a><span class="sd">            Explicit parametric coordinates for mesh evaluation.</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a><span class="sd">        interior_only : bool, optional</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a><span class="sd">            If `True`, only interior elements of the mesh are displayed. Default is `True`.</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a><span class="sd">        plt_ctrl_mesh : bool, optional</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a><span class="sd">            If `True`, overlays the control polygon mesh. Default is `False`.</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a><span class="sd">        verbose : bool, optional</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a><span class="sd">            If `True`, prints progress messages. Default is `True`.</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a><span class="sd">        disable_parallel : bool, optional</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a><span class="sd">            If `True`, disables parallel computation. Default is `False`.</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a><span class="sd">        pv_plotter : pv.Plotter or None, optional</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a><span class="sd">            Existing PyVista plotter to use. If `None`, a new one is created.</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a><span class="sd">        show : bool, optional</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a><span class="sd">            If `True`, renders the scene immediately. Default is `True`.</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a><span class="sd">        image_show_edges : bool, optional</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a><span class="sd">            Whether to display edges of the image-derived surface. Default is `False`.</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a><span class="sd">        image_line_width : float, optional</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a><span class="sd">            Line width used when displaying image edges. Default is `0.05`.</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a><span class="sd">        image_opacity : float, optional</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a><span class="sd">            Opacity of the image-derived surface. Default is `0.85`.</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a><span class="sd">        image_edge_color : str, optional</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a><span class="sd">            Color of image surface edges. Default is `&#39;black&#39;`.</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a><span class="sd">        image_interior_color : str, optional</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a><span class="sd">            Color of the image-derived surface interior. Default is `&#39;white&#39;`.</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a><span class="sd">        **pv_add_mesh_kwargs : dict, optional</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a><span class="sd">            Additional keyword arguments forwarded to :meth:`plot`.</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a><span class="sd">        Returns</span>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a><span class="sd">        -------</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a><span class="sd">        pv.Plotter</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a><span class="sd">            The PyVista plotter used for visualization.</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a><span class="sd">        Notes</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a><span class="sd">        -----</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a><span class="sd">        - The mesh is rendered first, then the image-derived surface is overlaid.</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a><span class="sd">        - This method does not modify the mesh or image data.</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>        <span class="k">if</span> <span class="n">threshold</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>            <span class="n">fg</span><span class="p">,</span> <span class="n">bg</span> <span class="o">=</span> <span class="n">find_fg_bg</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">threshold_method</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a>            <span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">fg</span> <span class="o">+</span> <span class="n">bg</span><span class="p">)</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;marching cubes&quot;</span><span class="p">:</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a>            <span class="n">image_mesh</span> <span class="o">=</span> <span class="n">marching_cubes</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">threshold</span><span class="p">)</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a>        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;voxels&quot;</span><span class="p">:</span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a>            <span class="n">image_mesh</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">image</span><span class="p">)</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unrecognized mode &#39;</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a>        <span class="n">pv_plotter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a>            <span class="n">n_eval_per_elem</span><span class="o">=</span><span class="n">n_eval_per_elem</span><span class="p">,</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a>            <span class="n">XI_list</span><span class="o">=</span><span class="n">XI_list</span><span class="p">,</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a>            <span class="n">interior_only</span><span class="o">=</span><span class="n">interior_only</span><span class="p">,</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a>            <span class="n">plt_ctrl_mesh</span><span class="o">=</span><span class="n">plt_ctrl_mesh</span><span class="p">,</span>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a>            <span class="n">pv_plotter</span><span class="o">=</span><span class="n">pv_plotter</span><span class="p">,</span>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a>            <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a>            <span class="n">disable_parallel</span><span class="o">=</span><span class="n">disable_parallel</span><span class="p">,</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a>            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a>            <span class="o">**</span><span class="n">pv_add_mesh_kwargs</span><span class="p">,</span>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a>        <span class="p">)</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a>        <span class="n">pv_plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a>            <span class="n">image_mesh</span><span class="p">,</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a>            <span class="n">show_edges</span><span class="o">=</span><span class="n">image_show_edges</span><span class="p">,</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a>            <span class="n">edge_color</span><span class="o">=</span><span class="n">image_edge_color</span><span class="p">,</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a>            <span class="n">line_width</span><span class="o">=</span><span class="n">image_line_width</span><span class="p">,</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a>            <span class="n">opacity</span><span class="o">=</span><span class="n">image_opacity</span><span class="p">,</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a>            <span class="n">color</span><span class="o">=</span><span class="n">image_interior_color</span><span class="p">,</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a>            <span class="n">specular</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>        <span class="p">)</span>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a>        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a>            <span class="n">pv_plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a>        <span class="k">return</span> <span class="n">pv_plotter</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ICP_rigid_body_transform</span><span class="p">(</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>        <span class="n">tgt_meshio</span><span class="p">:</span> <span class="n">io</span><span class="o">.</span><span class="n">Mesh</span><span class="p">,</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a>        <span class="n">n_eval_per_elem</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a>        <span class="n">XI_list</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a>        <span class="n">plot_after</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a>        <span class="n">disable_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="nb">float</span><span class="p">]:</span>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a><span class="sd">        Compute and apply a rigid body transformation aligning the mesh to a target mesh.</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a><span class="sd">        This method computes the rigid body transformation (rotation and translation)</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a><span class="sd">        that best aligns the current mesh to a target mesh using an Iterative Closest</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a><span class="sd">        Point (ICP) algorithm. The transformation is then directly applied to the</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a><span class="sd">        control points of the mesh.</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a><span class="sd">        Parameters</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a><span class="sd">        ----------</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a><span class="sd">        tgt_meshio : io.Mesh</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a><span class="sd">            Target mesh used as reference for the alignment.</span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a><span class="sd">        n_eval_per_elem : int or iterable of int, optional</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a><span class="sd">            Number of evaluation points per element for each parametric dimension.</span>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a><span class="sd">            If an integer is provided, the same value is used for all dimensions.</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a><span class="sd">            If an iterable is provided, each value corresponds to one parametric</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a><span class="sd">            direction. Default is `5`.</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a><span class="sd">        XI_list : iterable of tuple of ndarray, optional</span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a><span class="sd">            Parametric coordinates at which the geometry is evaluated to generate</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a><span class="sd">            the source surface mesh. If provided, this overrides `n_eval_per_elem`.</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a><span class="sd">        plot_after : bool, optional</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a><span class="sd">            If `True`, displays a visualization of the aligned source mesh and</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a><span class="sd">            the target mesh after the ICP procedure. Default is `True`.</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a><span class="sd">        disable_parallel : bool, optional</span>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a><span class="sd">            If `True`, disables parallel evaluation. Default is `False`.</span>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a><span class="sd">        Returns</span>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a><span class="sd">        -------</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a><span class="sd">        Rmat : np.ndarray of float, shape (3, 3)</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a><span class="sd">            Rotation matrix of the rigid body transformation.</span>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a><span class="sd">        tvec : np.ndarray of float, shape (3,)</span>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a><span class="sd">            Translation vector of the rigid body transformation.</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a><span class="sd">        max_dist : float</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a><span class="sd">            Maximum absolute distance between the aligned source mesh and the</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a><span class="sd">            target mesh after transformation.</span>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a><span class="sd">        Notes</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a><span class="sd">        -----</span>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a><span class="sd">        - For 3D meshes, the ICP is performed on the extracted boundary surface.</span>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a><span class="sd">        - The transformation is applied as `Rmat @ x + tvec`.</span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a><span class="sd">        - This method modifies the mesh in place by updating `self.unique_ctrl_pts`.</span>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a>        <span class="c1"># Create source and target PolyData</span>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">npa</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a>            <span class="n">border_mesh</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">npa</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a>            <span class="n">border_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_border</span><span class="p">()</span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a>                <span class="sa">f</span><span class="s2">&quot;Making finding ICP rigid body transform not implemented for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">npa</span><span class="si">}</span><span class="s2">-D shapes.&quot;</span>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a>            <span class="p">)</span>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a>        <span class="n">src_meshio</span> <span class="o">=</span> <span class="n">border_mesh</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">make_elements_interior_meshes</span><span class="p">(</span>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a>            <span class="n">border_mesh</span><span class="o">.</span><span class="n">splines</span><span class="p">,</span>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a>            <span class="n">border_mesh</span><span class="o">.</span><span class="n">get_separated_ctrl_pts</span><span class="p">(),</span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a>            <span class="n">n_eval_per_elem</span><span class="o">=</span><span class="n">n_eval_per_elem</span><span class="p">,</span>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a>            <span class="n">XI_list</span><span class="o">=</span><span class="n">XI_list</span><span class="p">,</span>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a>            <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a>            <span class="n">disable_parallel</span><span class="o">=</span><span class="n">disable_parallel</span><span class="p">,</span>
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a>        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a>        <span class="n">src</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">from_meshio</span><span class="p">(</span><span class="n">src_meshio</span><span class="p">)</span>
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a>        <span class="n">tgt</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">from_meshio</span><span class="p">(</span><span class="n">tgt_meshio</span><span class="p">)</span>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a>        <span class="c1"># Perform ICP alignment</span>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a>        <span class="n">aligned</span><span class="p">,</span> <span class="n">matrix</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">align</span><span class="p">(</span>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a>            <span class="n">tgt</span><span class="p">,</span>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a>            <span class="n">max_landmarks</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a>            <span class="n">max_mean_distance</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a>            <span class="n">max_iterations</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a>            <span class="n">start_by_matching_centroids</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a>            <span class="n">return_matrix</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a>        <span class="p">)</span>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a>        <span class="c1"># Decompose transformation matrix</span>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a>        <span class="n">Rmat</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a>        <span class="n">tvec</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a>        <span class="c1"># Apply transformation to self</span>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">unique_ctrl_pts</span> <span class="o">=</span> <span class="n">Rmat</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_ctrl_pts</span> <span class="o">+</span> <span class="n">tvec</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a>        <span class="k">if</span> <span class="n">plot_after</span><span class="p">:</span>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a>            <span class="n">plotter</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">()</span>
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a>            <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a>                <span class="n">aligned</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Aligned surface mesh&quot;</span>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a>            <span class="p">)</span>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a>            <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">tgt</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;STL Marching Cubes&quot;</span><span class="p">)</span>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a>            <span class="n">plotter</span><span class="o">.</span><span class="n">add_legend</span><span class="p">()</span>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a>            <span class="n">plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a>        <span class="c1"># Compute max distance between aligned and target meshes</span>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a>        <span class="n">aligned</span><span class="o">.</span><span class="n">compute_implicit_distance</span><span class="p">(</span><span class="n">tgt</span><span class="o">.</span><span class="n">extract_surface</span><span class="p">(),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a>        <span class="n">dist_array</span> <span class="o">=</span> <span class="n">aligned</span><span class="p">[</span><span class="s2">&quot;implicit_distance&quot;</span><span class="p">]</span>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a>        <span class="n">max_dist</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dist_array</span><span class="p">)))</span>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a>
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a>        <span class="k">return</span> <span class="n">Rmat</span><span class="p">,</span> <span class="n">tvec</span><span class="p">,</span> <span class="n">max_dist</span>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">distance_to_meshio</span><span class="p">(</span>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a>        <span class="n">tgt_meshio</span><span class="p">:</span> <span class="n">io</span><span class="o">.</span><span class="n">Mesh</span><span class="p">,</span>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a>        <span class="n">n_eval_per_elem</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a>        <span class="n">XI_list</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">io</span><span class="o">.</span><span class="n">Mesh</span><span class="p">:</span>
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a><span class="sd">        Compute the signed distance field to a target mesh.</span>
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a>
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a><span class="sd">        This method evaluates the geometry of the mesh (or its boundary in 3D)</span>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a><span class="sd">        and computes the implicit distance to the surface of a target mesh.</span>
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a><span class="sd">        The resulting distance field is returned as a `MeshIO` mesh.</span>
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a>
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a><span class="sd">        Parameters</span>
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a><span class="sd">        ----------</span>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a><span class="sd">        tgt_meshio : io.Mesh</span>
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a><span class="sd">            Target mesh defining the reference surface.</span>
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a><span class="sd">        n_eval_per_elem : int or iterable of int, optional</span>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a><span class="sd">            Number of evaluation points per element for each parametric dimension.</span>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a><span class="sd">            Default is `5`.</span>
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a><span class="sd">        XI_list : iterable of tuple of ndarray, optional</span>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a><span class="sd">            Parametric coordinates at which the geometry is evaluated.</span>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a><span class="sd">            If provided, this overrides `n_eval_per_elem`.</span>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a>
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a><span class="sd">        Returns</span>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a><span class="sd">        -------</span>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a><span class="sd">        io.Mesh</span>
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a><span class="sd">            `MeshIO` mesh containing the evaluated geometry and the associated</span>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a><span class="sd">            implicit distance field.</span>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">npa</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a>            <span class="n">border_mesh</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">npa</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a>            <span class="n">border_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_border</span><span class="p">()</span>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a>                <span class="sa">f</span><span class="s2">&quot;Distance field not implemented for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">npa</span><span class="si">}</span><span class="s2">-D shapes.&quot;</span>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a>            <span class="p">)</span>
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a>        <span class="n">src_meshio</span> <span class="o">=</span> <span class="n">border_mesh</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">make_elements_interior_meshes</span><span class="p">(</span>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a>            <span class="n">border_mesh</span><span class="o">.</span><span class="n">splines</span><span class="p">,</span>
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a>            <span class="n">border_mesh</span><span class="o">.</span><span class="n">get_separated_ctrl_pts</span><span class="p">(),</span>
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a>            <span class="n">n_eval_per_elem</span><span class="o">=</span><span class="n">n_eval_per_elem</span><span class="p">,</span>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a>            <span class="n">XI_list</span><span class="o">=</span><span class="n">XI_list</span><span class="p">,</span>
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a>            <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a>        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a>        <span class="n">src</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">from_meshio</span><span class="p">(</span><span class="n">src_meshio</span><span class="p">)</span>
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a>        <span class="n">tgt</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">from_meshio</span><span class="p">(</span><span class="n">tgt_meshio</span><span class="p">)</span>
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a>        <span class="n">src</span><span class="o">.</span><span class="n">compute_implicit_distance</span><span class="p">(</span><span class="n">tgt</span><span class="o">.</span><span class="n">extract_surface</span><span class="p">(),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a>        <span class="k">return</span> <span class="n">pv</span><span class="o">.</span><span class="n">to_meshio</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a>
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_paraview</span><span class="p">(</span>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a>        <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a>        <span class="n">n_step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a>        <span class="n">n_eval_per_elem</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a>        <span class="n">unique_fields</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a>        <span class="n">separated_fields</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a>        <span class="n">XI_list</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a>        <span class="n">groups</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a>        <span class="n">make_pvd</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a>        <span class="n">fields_on_interior_only</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;auto&quot;</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a>        <span class="n">disable_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a>    <span class="p">):</span>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a><span class="sd">        Save the mesh geometry and associated fields as ParaView-compatible files.</span>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a>
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a><span class="sd">        This method is a convenience wrapper around</span>
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a><span class="sd">        `MultiPatchBSplineConnectivity.save_paraview`.</span>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a><span class="sd">        It evaluates the multipatch B-spline geometry represented by the current</span>
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a><span class="sd">        mesh and exports several VTU files suitable for visualization in ParaView,</span>
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a><span class="sd">        with an optional PVD file for grouping time steps and mesh components.</span>
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a>
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a><span class="sd">        The following visualization meshes are generated:</span>
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a><span class="sd">        - Interior mesh representing the evaluated B-spline geometry</span>
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a><span class="sd">        - Element borders mesh showing the patch discretization</span>
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a><span class="sd">        - Control points mesh showing the control structure</span>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a><span class="sd">        Parameters</span>
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a><span class="sd">        ----------</span>
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a><span class="sd">        path : str</span>
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a><span class="sd">            Directory where the ParaView files will be written.</span>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a><span class="sd">        name : str</span>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a><span class="sd">            Base name used for all output files.</span>
</span><span id="L-1238"><a href="#L-1238"><span class="linenos">1238</span></a><span class="sd">        n_step : int, optional</span>
</span><span id="L-1239"><a href="#L-1239"><span class="linenos">1239</span></a><span class="sd">            Number of time steps to export. Default is `1`.</span>
</span><span id="L-1240"><a href="#L-1240"><span class="linenos">1240</span></a><span class="sd">        n_eval_per_elem : int or iterable of int, optional</span>
</span><span id="L-1241"><a href="#L-1241"><span class="linenos">1241</span></a><span class="sd">            Number of evaluation points per element for each parametric dimension.</span>
</span><span id="L-1242"><a href="#L-1242"><span class="linenos">1242</span></a><span class="sd">            If an integer is provided, the same value is used for all dimensions.</span>
</span><span id="L-1243"><a href="#L-1243"><span class="linenos">1243</span></a><span class="sd">            If an iterable is provided, each value corresponds to one parametric</span>
</span><span id="L-1244"><a href="#L-1244"><span class="linenos">1244</span></a><span class="sd">            direction. Default is `10`.</span>
</span><span id="L-1245"><a href="#L-1245"><span class="linenos">1245</span></a><span class="sd">        unique_fields : dict, optional</span>
</span><span id="L-1246"><a href="#L-1246"><span class="linenos">1246</span></a><span class="sd">            Fields defined on unique control points to be exported.</span>
</span><span id="L-1247"><a href="#L-1247"><span class="linenos">1247</span></a><span class="sd">            Keys are field names and values are numpy arrays.</span>
</span><span id="L-1248"><a href="#L-1248"><span class="linenos">1248</span></a><span class="sd">            Callables are not supported here. Default is an empty dictionary.</span>
</span><span id="L-1249"><a href="#L-1249"><span class="linenos">1249</span></a><span class="sd">        separated_fields : list of dict, optional</span>
</span><span id="L-1250"><a href="#L-1250"><span class="linenos">1250</span></a><span class="sd">            Fields defined in separated (per-patch) representation.</span>
</span><span id="L-1251"><a href="#L-1251"><span class="linenos">1251</span></a><span class="sd">            Each list entry corresponds to one patch and contains a dictionary</span>
</span><span id="L-1252"><a href="#L-1252"><span class="linenos">1252</span></a><span class="sd">            mapping field names to field values. See</span>
</span><span id="L-1253"><a href="#L-1253"><span class="linenos">1253</span></a><span class="sd">            `MultiPatchBSplineConnectivity.save_paraview` for supported</span>
</span><span id="L-1254"><a href="#L-1254"><span class="linenos">1254</span></a><span class="sd">            formats.</span>
</span><span id="L-1255"><a href="#L-1255"><span class="linenos">1255</span></a><span class="sd">        XI_list : iterable of tuple of ndarray, optional</span>
</span><span id="L-1256"><a href="#L-1256"><span class="linenos">1256</span></a><span class="sd">            Parametric coordinates at which the geometry and fields are evaluated.</span>
</span><span id="L-1257"><a href="#L-1257"><span class="linenos">1257</span></a><span class="sd">            If provided, this overrides `n_eval_per_elem`.</span>
</span><span id="L-1258"><a href="#L-1258"><span class="linenos">1258</span></a><span class="sd">        groups : dict, optional</span>
</span><span id="L-1259"><a href="#L-1259"><span class="linenos">1259</span></a><span class="sd">            Dictionary describing ParaView file groups for PVD organization.</span>
</span><span id="L-1260"><a href="#L-1260"><span class="linenos">1260</span></a><span class="sd">            If `None`, groups are created automatically.</span>
</span><span id="L-1261"><a href="#L-1261"><span class="linenos">1261</span></a><span class="sd">        make_pvd : bool, optional</span>
</span><span id="L-1262"><a href="#L-1262"><span class="linenos">1262</span></a><span class="sd">            If `True`, generates a PVD file grouping all VTU files.</span>
</span><span id="L-1263"><a href="#L-1263"><span class="linenos">1263</span></a><span class="sd">            Default is `True`.</span>
</span><span id="L-1264"><a href="#L-1264"><span class="linenos">1264</span></a><span class="sd">        verbose : bool, optional</span>
</span><span id="L-1265"><a href="#L-1265"><span class="linenos">1265</span></a><span class="sd">            If `True`, prints progress information. Default is `True`.</span>
</span><span id="L-1266"><a href="#L-1266"><span class="linenos">1266</span></a><span class="sd">        fields_on_interior_only : bool, &quot;auto&quot;, or list of str, optional</span>
</span><span id="L-1267"><a href="#L-1267"><span class="linenos">1267</span></a><span class="sd">            Controls on which meshes fields are written:</span>
</span><span id="L-1268"><a href="#L-1268"><span class="linenos">1268</span></a><span class="sd">            - `True`: interior mesh only</span>
</span><span id="L-1269"><a href="#L-1269"><span class="linenos">1269</span></a><span class="sd">            - `False`: all meshes</span>
</span><span id="L-1270"><a href="#L-1270"><span class="linenos">1270</span></a><span class="sd">            - `&quot;auto&quot;`: displacement-like fields are written on all meshes,</span>
</span><span id="L-1271"><a href="#L-1271"><span class="linenos">1271</span></a><span class="sd">              others only on the interior mesh</span>
</span><span id="L-1272"><a href="#L-1272"><span class="linenos">1272</span></a><span class="sd">            - list of str: names of fields to include on all meshes</span>
</span><span id="L-1273"><a href="#L-1273"><span class="linenos">1273</span></a><span class="sd">              Default is `&quot;auto&quot;`.</span>
</span><span id="L-1274"><a href="#L-1274"><span class="linenos">1274</span></a><span class="sd">        disable_parallel : bool, optional</span>
</span><span id="L-1275"><a href="#L-1275"><span class="linenos">1275</span></a><span class="sd">            If `True`, disables parallel evaluation. Default is `False`.</span>
</span><span id="L-1276"><a href="#L-1276"><span class="linenos">1276</span></a>
</span><span id="L-1277"><a href="#L-1277"><span class="linenos">1277</span></a><span class="sd">        Returns</span>
</span><span id="L-1278"><a href="#L-1278"><span class="linenos">1278</span></a><span class="sd">        -------</span>
</span><span id="L-1279"><a href="#L-1279"><span class="linenos">1279</span></a><span class="sd">        dict[str, dict[str, Union[str, int]]]</span>
</span><span id="L-1280"><a href="#L-1280"><span class="linenos">1280</span></a><span class="sd">            Updated groups dictionary describing the generated ParaView files.</span>
</span><span id="L-1281"><a href="#L-1281"><span class="linenos">1281</span></a>
</span><span id="L-1282"><a href="#L-1282"><span class="linenos">1282</span></a><span class="sd">        Notes</span>
</span><span id="L-1283"><a href="#L-1283"><span class="linenos">1283</span></a><span class="sd">        -----</span>
</span><span id="L-1284"><a href="#L-1284"><span class="linenos">1284</span></a><span class="sd">        - This method don&#39;t modifies the internal state; it only performs evaluation and</span>
</span><span id="L-1285"><a href="#L-1285"><span class="linenos">1285</span></a><span class="sd">          export.</span>
</span><span id="L-1286"><a href="#L-1286"><span class="linenos">1286</span></a><span class="sd">        - Geometry and fields are evaluated using the current control points and splines.</span>
</span><span id="L-1287"><a href="#L-1287"><span class="linenos">1287</span></a><span class="sd">        - For full details on supported field formats and file organization, see</span>
</span><span id="L-1288"><a href="#L-1288"><span class="linenos">1288</span></a><span class="sd">          `MultiPatchBSplineConnectivity.save_paraview`.</span>
</span><span id="L-1289"><a href="#L-1289"><span class="linenos">1289</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1290"><a href="#L-1290"><span class="linenos">1290</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">save_paraview</span><span class="p">(</span>
</span><span id="L-1291"><a href="#L-1291"><span class="linenos">1291</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">,</span>
</span><span id="L-1292"><a href="#L-1292"><span class="linenos">1292</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_separated_ctrl_pts</span><span class="p">(),</span>
</span><span id="L-1293"><a href="#L-1293"><span class="linenos">1293</span></a>            <span class="n">path</span><span class="p">,</span>
</span><span id="L-1294"><a href="#L-1294"><span class="linenos">1294</span></a>            <span class="n">name</span><span class="p">,</span>
</span><span id="L-1295"><a href="#L-1295"><span class="linenos">1295</span></a>            <span class="n">n_step</span><span class="p">,</span>
</span><span id="L-1296"><a href="#L-1296"><span class="linenos">1296</span></a>            <span class="n">n_eval_per_elem</span><span class="p">,</span>
</span><span id="L-1297"><a href="#L-1297"><span class="linenos">1297</span></a>            <span class="n">unique_fields</span><span class="p">,</span>
</span><span id="L-1298"><a href="#L-1298"><span class="linenos">1298</span></a>            <span class="n">separated_fields</span><span class="p">,</span>
</span><span id="L-1299"><a href="#L-1299"><span class="linenos">1299</span></a>            <span class="n">XI_list</span><span class="p">,</span>
</span><span id="L-1300"><a href="#L-1300"><span class="linenos">1300</span></a>            <span class="n">groups</span><span class="p">,</span>
</span><span id="L-1301"><a href="#L-1301"><span class="linenos">1301</span></a>            <span class="n">make_pvd</span><span class="p">,</span>
</span><span id="L-1302"><a href="#L-1302"><span class="linenos">1302</span></a>            <span class="n">verbose</span><span class="p">,</span>
</span><span id="L-1303"><a href="#L-1303"><span class="linenos">1303</span></a>            <span class="n">fields_on_interior_only</span><span class="p">,</span>
</span><span id="L-1304"><a href="#L-1304"><span class="linenos">1304</span></a>            <span class="n">disable_parallel</span><span class="p">,</span>
</span><span id="L-1305"><a href="#L-1305"><span class="linenos">1305</span></a>        <span class="p">)</span>
</span><span id="L-1306"><a href="#L-1306"><span class="linenos">1306</span></a>
</span><span id="L-1307"><a href="#L-1307"><span class="linenos">1307</span></a>
</span><span id="L-1308"><a href="#L-1308"><span class="linenos">1308</span></a><span class="c1"># %%</span>
</span><span id="L-1309"><a href="#L-1309"><span class="linenos">1309</span></a>
</span><span id="L-1310"><a href="#L-1310"><span class="linenos">1310</span></a>
</span><span id="L-1311"><a href="#L-1311"><span class="linenos">1311</span></a><span class="k">class</span><span class="w"> </span><span class="nc">MeshLattice</span><span class="p">(</span><span class="n">Mesh</span><span class="p">):</span>
</span><span id="L-1312"><a href="#L-1312"><span class="linenos">1312</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1313"><a href="#L-1313"><span class="linenos">1313</span></a><span class="sd">    Structured lattice mesh with an explicit reference B-spline cell.</span>
</span><span id="L-1314"><a href="#L-1314"><span class="linenos">1314</span></a>
</span><span id="L-1315"><a href="#L-1315"><span class="linenos">1315</span></a><span class="sd">    This class represents a *fully instantiated* multipatch B-spline mesh that</span>
</span><span id="L-1316"><a href="#L-1316"><span class="linenos">1316</span></a><span class="sd">    exhibits a regular lattice structure obtained by repeating a reference cell</span>
</span><span id="L-1317"><a href="#L-1317"><span class="linenos">1317</span></a><span class="sd">    along three directions. The lattice structure is described by the repetition</span>
</span><span id="L-1318"><a href="#L-1318"><span class="linenos">1318</span></a><span class="sd">    counts `(l, m, n)`.</span>
</span><span id="L-1319"><a href="#L-1319"><span class="linenos">1319</span></a>
</span><span id="L-1320"><a href="#L-1320"><span class="linenos">1320</span></a><span class="sd">    The control points and connectivity describe the *entire lattice geometry*,</span>
</span><span id="L-1321"><a href="#L-1321"><span class="linenos">1321</span></a><span class="sd">    exactly as in a standard :class:`Mesh`. In contrast, the `BSpline` instances</span>
</span><span id="L-1322"><a href="#L-1322"><span class="linenos">1322</span></a><span class="sd">    correspond to a single reference cell and are reused for all lattice cells.</span>
</span><span id="L-1323"><a href="#L-1323"><span class="linenos">1323</span></a>
</span><span id="L-1324"><a href="#L-1324"><span class="linenos">1324</span></a><span class="sd">    `MeshLattice` therefore behaves as a standard :class:`Mesh`, while additionally</span>
</span><span id="L-1325"><a href="#L-1325"><span class="linenos">1325</span></a><span class="sd">    storing lattice metadata and providing utilities to extract or operate on the</span>
</span><span id="L-1326"><a href="#L-1326"><span class="linenos">1326</span></a><span class="sd">    reference cell only.</span>
</span><span id="L-1327"><a href="#L-1327"><span class="linenos">1327</span></a>
</span><span id="L-1328"><a href="#L-1328"><span class="linenos">1328</span></a><span class="sd">    This is a utility class, notably used to allow</span>
</span><span id="L-1329"><a href="#L-1329"><span class="linenos">1329</span></a><span class="sd">    :func:`VirtualImageCorrelationEnergyElem.make_image_energies` and</span>
</span><span id="L-1330"><a href="#L-1330"><span class="linenos">1330</span></a><span class="sd">    :func:`membrane_stiffness.make_membrane_stifness` to assemble</span>
</span><span id="L-1331"><a href="#L-1331"><span class="linenos">1331</span></a><span class="sd">    operators on a single cell while exploiting lattice periodicity at the algebraic</span>
</span><span id="L-1332"><a href="#L-1332"><span class="linenos">1332</span></a><span class="sd">    level.</span>
</span><span id="L-1333"><a href="#L-1333"><span class="linenos">1333</span></a>
</span><span id="L-1334"><a href="#L-1334"><span class="linenos">1334</span></a><span class="sd">    Attributes</span>
</span><span id="L-1335"><a href="#L-1335"><span class="linenos">1335</span></a><span class="sd">    ----------</span>
</span><span id="L-1336"><a href="#L-1336"><span class="linenos">1336</span></a><span class="sd">    l : int</span>
</span><span id="L-1337"><a href="#L-1337"><span class="linenos">1337</span></a><span class="sd">        Number of repetitions of the reference cell along the first lattice</span>
</span><span id="L-1338"><a href="#L-1338"><span class="linenos">1338</span></a><span class="sd">        direction.</span>
</span><span id="L-1339"><a href="#L-1339"><span class="linenos">1339</span></a><span class="sd">    m : int</span>
</span><span id="L-1340"><a href="#L-1340"><span class="linenos">1340</span></a><span class="sd">        Number of repetitions of the reference cell along the second lattice</span>
</span><span id="L-1341"><a href="#L-1341"><span class="linenos">1341</span></a><span class="sd">        direction.</span>
</span><span id="L-1342"><a href="#L-1342"><span class="linenos">1342</span></a><span class="sd">    n : int</span>
</span><span id="L-1343"><a href="#L-1343"><span class="linenos">1343</span></a><span class="sd">        Number of repetitions of the reference cell along the third lattice</span>
</span><span id="L-1344"><a href="#L-1344"><span class="linenos">1344</span></a><span class="sd">        direction.</span>
</span><span id="L-1345"><a href="#L-1345"><span class="linenos">1345</span></a>
</span><span id="L-1346"><a href="#L-1346"><span class="linenos">1346</span></a><span class="sd">    Notes</span>
</span><span id="L-1347"><a href="#L-1347"><span class="linenos">1347</span></a><span class="sd">    -----</span>
</span><span id="L-1348"><a href="#L-1348"><span class="linenos">1348</span></a><span class="sd">    - The lattice geometry is assumed to be fully defined at construction time.</span>
</span><span id="L-1349"><a href="#L-1349"><span class="linenos">1349</span></a><span class="sd">    - No geometric replication is performed internally.</span>
</span><span id="L-1350"><a href="#L-1350"><span class="linenos">1350</span></a><span class="sd">    - All lattice cells share identical B-spline definitions.</span>
</span><span id="L-1351"><a href="#L-1351"><span class="linenos">1351</span></a><span class="sd">    - The total number of patches is `l * m * n * nb_patchs_cell`.</span>
</span><span id="L-1352"><a href="#L-1352"><span class="linenos">1352</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1353"><a href="#L-1353"><span class="linenos">1353</span></a>
</span><span id="L-1354"><a href="#L-1354"><span class="linenos">1354</span></a>    <span class="n">l</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="L-1355"><a href="#L-1355"><span class="linenos">1355</span></a>    <span class="n">m</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="L-1356"><a href="#L-1356"><span class="linenos">1356</span></a>    <span class="n">n</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="L-1357"><a href="#L-1357"><span class="linenos">1357</span></a>
</span><span id="L-1358"><a href="#L-1358"><span class="linenos">1358</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-1359"><a href="#L-1359"><span class="linenos">1359</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-1360"><a href="#L-1360"><span class="linenos">1360</span></a>        <span class="n">l</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-1361"><a href="#L-1361"><span class="linenos">1361</span></a>        <span class="n">m</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-1362"><a href="#L-1362"><span class="linenos">1362</span></a>        <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-1363"><a href="#L-1363"><span class="linenos">1363</span></a>        <span class="n">splines_cell</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">BSpline</span><span class="p">],</span>
</span><span id="L-1364"><a href="#L-1364"><span class="linenos">1364</span></a>        <span class="n">ctrl_pts</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]],</span>
</span><span id="L-1365"><a href="#L-1365"><span class="linenos">1365</span></a>        <span class="n">connectivity</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">MultiPatchBSplineConnectivity</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1366"><a href="#L-1366"><span class="linenos">1366</span></a>        <span class="n">ref_inds</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1367"><a href="#L-1367"><span class="linenos">1367</span></a>    <span class="p">):</span>
</span><span id="L-1368"><a href="#L-1368"><span class="linenos">1368</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1369"><a href="#L-1369"><span class="linenos">1369</span></a><span class="sd">        Initialize a lattice mesh from a reference B-spline cell.</span>
</span><span id="L-1370"><a href="#L-1370"><span class="linenos">1370</span></a><span class="sd">        See :meth:`Mesh.__init__` for more details.</span>
</span><span id="L-1371"><a href="#L-1371"><span class="linenos">1371</span></a>
</span><span id="L-1372"><a href="#L-1372"><span class="linenos">1372</span></a><span class="sd">        Parameters</span>
</span><span id="L-1373"><a href="#L-1373"><span class="linenos">1373</span></a><span class="sd">        ----------</span>
</span><span id="L-1374"><a href="#L-1374"><span class="linenos">1374</span></a><span class="sd">        l : int</span>
</span><span id="L-1375"><a href="#L-1375"><span class="linenos">1375</span></a><span class="sd">            Number of repetitions along the first lattice direction.</span>
</span><span id="L-1376"><a href="#L-1376"><span class="linenos">1376</span></a><span class="sd">        m : int</span>
</span><span id="L-1377"><a href="#L-1377"><span class="linenos">1377</span></a><span class="sd">            Number of repetitions along the second lattice direction.</span>
</span><span id="L-1378"><a href="#L-1378"><span class="linenos">1378</span></a><span class="sd">        n : int</span>
</span><span id="L-1379"><a href="#L-1379"><span class="linenos">1379</span></a><span class="sd">            Number of repetitions along the third lattice direction.</span>
</span><span id="L-1380"><a href="#L-1380"><span class="linenos">1380</span></a><span class="sd">        splines_cell : list of BSpline</span>
</span><span id="L-1381"><a href="#L-1381"><span class="linenos">1381</span></a><span class="sd">            B-spline patches defining a single reference cell.</span>
</span><span id="L-1382"><a href="#L-1382"><span class="linenos">1382</span></a><span class="sd">        ctrl_pts : list of np.ndarray or np.ndarray</span>
</span><span id="L-1383"><a href="#L-1383"><span class="linenos">1383</span></a><span class="sd">            Control points of the full lattice structure, in separated or unique</span>
</span><span id="L-1384"><a href="#L-1384"><span class="linenos">1384</span></a><span class="sd">            representation.</span>
</span><span id="L-1385"><a href="#L-1385"><span class="linenos">1385</span></a><span class="sd">        connectivity : MultiPatchBSplineConnectivity or None, optional</span>
</span><span id="L-1386"><a href="#L-1386"><span class="linenos">1386</span></a><span class="sd">            Connectivity describing the multipatch topology of the full lattice</span>
</span><span id="L-1387"><a href="#L-1387"><span class="linenos">1387</span></a><span class="sd">            structure. If `None` (default), it is inferred automatically.</span>
</span><span id="L-1388"><a href="#L-1388"><span class="linenos">1388</span></a><span class="sd">        ref_inds : np.ndarray of int or None, optional</span>
</span><span id="L-1389"><a href="#L-1389"><span class="linenos">1389</span></a><span class="sd">            Optional reference indices associated with the control points.</span>
</span><span id="L-1390"><a href="#L-1390"><span class="linenos">1390</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1391"><a href="#L-1391"><span class="linenos">1391</span></a>        <span class="n">splines</span> <span class="o">=</span> <span class="n">splines_cell</span> <span class="o">*</span> <span class="p">(</span><span class="n">l</span> <span class="o">*</span> <span class="n">m</span> <span class="o">*</span> <span class="n">n</span><span class="p">)</span>
</span><span id="L-1392"><a href="#L-1392"><span class="linenos">1392</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-1393"><a href="#L-1393"><span class="linenos">1393</span></a>            <span class="n">splines</span><span class="p">,</span> <span class="n">ctrl_pts</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="n">connectivity</span><span class="p">,</span> <span class="n">ref_inds</span><span class="o">=</span><span class="n">ref_inds</span>
</span><span id="L-1394"><a href="#L-1394"><span class="linenos">1394</span></a>        <span class="p">)</span>
</span><span id="L-1395"><a href="#L-1395"><span class="linenos">1395</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">l</span> <span class="o">=</span> <span class="n">l</span>
</span><span id="L-1396"><a href="#L-1396"><span class="linenos">1396</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">m</span>
</span><span id="L-1397"><a href="#L-1397"><span class="linenos">1397</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>
</span><span id="L-1398"><a href="#L-1398"><span class="linenos">1398</span></a>
</span><span id="L-1399"><a href="#L-1399"><span class="linenos">1399</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-1400"><a href="#L-1400"><span class="linenos">1400</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_mesh</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">mesh</span><span class="p">:</span> <span class="n">Mesh</span><span class="p">,</span> <span class="n">l</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MeshLattice&quot;</span><span class="p">:</span>
</span><span id="L-1401"><a href="#L-1401"><span class="linenos">1401</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1402"><a href="#L-1402"><span class="linenos">1402</span></a><span class="sd">        Construct a lattice mesh from an existing mesh.</span>
</span><span id="L-1403"><a href="#L-1403"><span class="linenos">1403</span></a>
</span><span id="L-1404"><a href="#L-1404"><span class="linenos">1404</span></a><span class="sd">        This method interprets the input `mesh` as a lattice composed of</span>
</span><span id="L-1405"><a href="#L-1405"><span class="linenos">1405</span></a><span class="sd">        `l * m * n` identical cells and reconstructs a :class:`MeshLattice`</span>
</span><span id="L-1406"><a href="#L-1406"><span class="linenos">1406</span></a><span class="sd">        instance using the corresponding reference cell splines.</span>
</span><span id="L-1407"><a href="#L-1407"><span class="linenos">1407</span></a>
</span><span id="L-1408"><a href="#L-1408"><span class="linenos">1408</span></a><span class="sd">        Parameters</span>
</span><span id="L-1409"><a href="#L-1409"><span class="linenos">1409</span></a><span class="sd">        ----------</span>
</span><span id="L-1410"><a href="#L-1410"><span class="linenos">1410</span></a><span class="sd">        mesh : Mesh</span>
</span><span id="L-1411"><a href="#L-1411"><span class="linenos">1411</span></a><span class="sd">            Existing mesh representing a lattice geometry.</span>
</span><span id="L-1412"><a href="#L-1412"><span class="linenos">1412</span></a><span class="sd">        l : int</span>
</span><span id="L-1413"><a href="#L-1413"><span class="linenos">1413</span></a><span class="sd">            Number of repetitions along the first lattice direction.</span>
</span><span id="L-1414"><a href="#L-1414"><span class="linenos">1414</span></a><span class="sd">        m : int</span>
</span><span id="L-1415"><a href="#L-1415"><span class="linenos">1415</span></a><span class="sd">            Number of repetitions along the second lattice direction.</span>
</span><span id="L-1416"><a href="#L-1416"><span class="linenos">1416</span></a><span class="sd">        n : int</span>
</span><span id="L-1417"><a href="#L-1417"><span class="linenos">1417</span></a><span class="sd">            Number of repetitions along the third lattice direction.</span>
</span><span id="L-1418"><a href="#L-1418"><span class="linenos">1418</span></a>
</span><span id="L-1419"><a href="#L-1419"><span class="linenos">1419</span></a><span class="sd">        Returns</span>
</span><span id="L-1420"><a href="#L-1420"><span class="linenos">1420</span></a><span class="sd">        -------</span>
</span><span id="L-1421"><a href="#L-1421"><span class="linenos">1421</span></a><span class="sd">        MeshLattice</span>
</span><span id="L-1422"><a href="#L-1422"><span class="linenos">1422</span></a><span class="sd">            A lattice mesh sharing the control points, connectivity and</span>
</span><span id="L-1423"><a href="#L-1423"><span class="linenos">1423</span></a><span class="sd">            reference indices of `mesh`.</span>
</span><span id="L-1424"><a href="#L-1424"><span class="linenos">1424</span></a>
</span><span id="L-1425"><a href="#L-1425"><span class="linenos">1425</span></a><span class="sd">        Notes</span>
</span><span id="L-1426"><a href="#L-1426"><span class="linenos">1426</span></a><span class="sd">        -----</span>
</span><span id="L-1427"><a href="#L-1427"><span class="linenos">1427</span></a><span class="sd">        - The reference cell is inferred from the first</span>
</span><span id="L-1428"><a href="#L-1428"><span class="linenos">1428</span></a><span class="sd">          `mesh.connectivity.nb_patchs // (l * m * n)` patches.</span>
</span><span id="L-1429"><a href="#L-1429"><span class="linenos">1429</span></a><span class="sd">        - No geometry or connectivity modification is performed; the operation</span>
</span><span id="L-1430"><a href="#L-1430"><span class="linenos">1430</span></a><span class="sd">          is purely structural.</span>
</span><span id="L-1431"><a href="#L-1431"><span class="linenos">1431</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1432"><a href="#L-1432"><span class="linenos">1432</span></a>        <span class="n">splines_cell</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">splines</span><span class="p">[:</span> <span class="n">mesh</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_patchs</span> <span class="o">//</span> <span class="p">(</span><span class="n">l</span> <span class="o">*</span> <span class="n">m</span> <span class="o">*</span> <span class="n">n</span><span class="p">)]</span>
</span><span id="L-1433"><a href="#L-1433"><span class="linenos">1433</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
</span><span id="L-1434"><a href="#L-1434"><span class="linenos">1434</span></a>            <span class="n">l</span><span class="p">,</span>
</span><span id="L-1435"><a href="#L-1435"><span class="linenos">1435</span></a>            <span class="n">m</span><span class="p">,</span>
</span><span id="L-1436"><a href="#L-1436"><span class="linenos">1436</span></a>            <span class="n">n</span><span class="p">,</span>
</span><span id="L-1437"><a href="#L-1437"><span class="linenos">1437</span></a>            <span class="n">splines_cell</span><span class="p">,</span>
</span><span id="L-1438"><a href="#L-1438"><span class="linenos">1438</span></a>            <span class="n">mesh</span><span class="o">.</span><span class="n">unique_ctrl_pts</span><span class="p">,</span>
</span><span id="L-1439"><a href="#L-1439"><span class="linenos">1439</span></a>            <span class="n">mesh</span><span class="o">.</span><span class="n">connectivity</span><span class="p">,</span>
</span><span id="L-1440"><a href="#L-1440"><span class="linenos">1440</span></a>            <span class="n">mesh</span><span class="o">.</span><span class="n">ref_inds</span><span class="p">,</span>
</span><span id="L-1441"><a href="#L-1441"><span class="linenos">1441</span></a>        <span class="p">)</span>
</span><span id="L-1442"><a href="#L-1442"><span class="linenos">1442</span></a>
</span><span id="L-1443"><a href="#L-1443"><span class="linenos">1443</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_mesh_cell_one</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mesh</span><span class="p">:</span>
</span><span id="L-1444"><a href="#L-1444"><span class="linenos">1444</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1445"><a href="#L-1445"><span class="linenos">1445</span></a><span class="sd">        Extract the reference cell mesh corresponding to a single lattice cell.</span>
</span><span id="L-1446"><a href="#L-1446"><span class="linenos">1446</span></a>
</span><span id="L-1447"><a href="#L-1447"><span class="linenos">1447</span></a><span class="sd">        This method returns a :class:`Mesh` representing one reference cell of</span>
</span><span id="L-1448"><a href="#L-1448"><span class="linenos">1448</span></a><span class="sd">        the lattice, including:</span>
</span><span id="L-1449"><a href="#L-1449"><span class="linenos">1449</span></a><span class="sd">        - the corresponding subset of splines,</span>
</span><span id="L-1450"><a href="#L-1450"><span class="linenos">1450</span></a><span class="sd">        - the associated control points,</span>
</span><span id="L-1451"><a href="#L-1451"><span class="linenos">1451</span></a><span class="sd">        - a reduced connectivity.</span>
</span><span id="L-1452"><a href="#L-1452"><span class="linenos">1452</span></a>
</span><span id="L-1453"><a href="#L-1453"><span class="linenos">1453</span></a><span class="sd">        Returns</span>
</span><span id="L-1454"><a href="#L-1454"><span class="linenos">1454</span></a><span class="sd">        -------</span>
</span><span id="L-1455"><a href="#L-1455"><span class="linenos">1455</span></a><span class="sd">        Mesh</span>
</span><span id="L-1456"><a href="#L-1456"><span class="linenos">1456</span></a><span class="sd">            Mesh corresponding to a single lattice cell.</span>
</span><span id="L-1457"><a href="#L-1457"><span class="linenos">1457</span></a>
</span><span id="L-1458"><a href="#L-1458"><span class="linenos">1458</span></a><span class="sd">        Notes</span>
</span><span id="L-1459"><a href="#L-1459"><span class="linenos">1459</span></a><span class="sd">        -----</span>
</span><span id="L-1460"><a href="#L-1460"><span class="linenos">1460</span></a><span class="sd">        - The returned mesh is independent from the lattice structure but</span>
</span><span id="L-1461"><a href="#L-1461"><span class="linenos">1461</span></a><span class="sd">          shares the same control point values.</span>
</span><span id="L-1462"><a href="#L-1462"><span class="linenos">1462</span></a><span class="sd">        - This is typically used for analysis or visualization of the unit cell.</span>
</span><span id="L-1463"><a href="#L-1463"><span class="linenos">1463</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1464"><a href="#L-1464"><span class="linenos">1464</span></a>        <span class="n">splines</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_patchs</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
</span><span id="L-1465"><a href="#L-1465"><span class="linenos">1465</span></a>        <span class="n">splines</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span>
</span><span id="L-1466"><a href="#L-1466"><span class="linenos">1466</span></a>        <span class="n">nb_patchs_cell</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">)</span> <span class="o">//</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
</span><span id="L-1467"><a href="#L-1467"><span class="linenos">1467</span></a>        <span class="n">connectivity_cell</span><span class="p">,</span> <span class="n">splines_cell</span><span class="p">,</span> <span class="n">full_to_cell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span>
</span><span id="L-1468"><a href="#L-1468"><span class="linenos">1468</span></a>            <span class="n">splines</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nb_patchs_cell</span><span class="p">)</span>
</span><span id="L-1469"><a href="#L-1469"><span class="linenos">1469</span></a>        <span class="p">)</span>
</span><span id="L-1470"><a href="#L-1470"><span class="linenos">1470</span></a>        <span class="n">mesh_cell</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">(</span>
</span><span id="L-1471"><a href="#L-1471"><span class="linenos">1471</span></a>            <span class="nb">list</span><span class="p">(</span><span class="n">splines_cell</span><span class="p">),</span>
</span><span id="L-1472"><a href="#L-1472"><span class="linenos">1472</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">unique_ctrl_pts</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">full_to_cell</span><span class="p">],</span>
</span><span id="L-1473"><a href="#L-1473"><span class="linenos">1473</span></a>            <span class="n">connectivity</span><span class="o">=</span><span class="n">connectivity_cell</span><span class="p">,</span>
</span><span id="L-1474"><a href="#L-1474"><span class="linenos">1474</span></a>            <span class="n">ref_inds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_inds</span><span class="p">[</span><span class="n">full_to_cell</span><span class="p">],</span>
</span><span id="L-1475"><a href="#L-1475"><span class="linenos">1475</span></a>        <span class="p">)</span>
</span><span id="L-1476"><a href="#L-1476"><span class="linenos">1476</span></a>        <span class="k">return</span> <span class="n">mesh_cell</span>
</span><span id="L-1477"><a href="#L-1477"><span class="linenos">1477</span></a>
</span><span id="L-1478"><a href="#L-1478"><span class="linenos">1478</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_nb_patchs_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-1479"><a href="#L-1479"><span class="linenos">1479</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1480"><a href="#L-1480"><span class="linenos">1480</span></a><span class="sd">        Return the number of patches in a single lattice cell.</span>
</span><span id="L-1481"><a href="#L-1481"><span class="linenos">1481</span></a>
</span><span id="L-1482"><a href="#L-1482"><span class="linenos">1482</span></a><span class="sd">        Returns</span>
</span><span id="L-1483"><a href="#L-1483"><span class="linenos">1483</span></a><span class="sd">        -------</span>
</span><span id="L-1484"><a href="#L-1484"><span class="linenos">1484</span></a><span class="sd">        int</span>
</span><span id="L-1485"><a href="#L-1485"><span class="linenos">1485</span></a><span class="sd">            Number of B-spline patches defining the reference cell.</span>
</span><span id="L-1486"><a href="#L-1486"><span class="linenos">1486</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1487"><a href="#L-1487"><span class="linenos">1487</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_patchs</span> <span class="o">//</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
</span></pre></div>


            </section>
                <section id="in_notebook">
                            <input id="in_notebook-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">in_notebook</span><span class="signature pdoc-code condensed">(<span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="in_notebook-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#in_notebook"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="in_notebook-16"><a href="#in_notebook-16"><span class="linenos">16</span></a><span class="k">def</span><span class="w"> </span><span class="nf">in_notebook</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="in_notebook-17"><a href="#in_notebook-17"><span class="linenos">17</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="in_notebook-18"><a href="#in_notebook-18"><span class="linenos">18</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">IPython</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_ipython</span>
</span><span id="in_notebook-19"><a href="#in_notebook-19"><span class="linenos">19</span></a>
</span><span id="in_notebook-20"><a href="#in_notebook-20"><span class="linenos">20</span></a>        <span class="n">shell</span> <span class="o">=</span> <span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="in_notebook-21"><a href="#in_notebook-21"><span class="linenos">21</span></a>        <span class="k">if</span> <span class="n">shell</span> <span class="o">==</span> <span class="s2">&quot;ZMQInteractiveShell&quot;</span><span class="p">:</span>
</span><span id="in_notebook-22"><a href="#in_notebook-22"><span class="linenos">22</span></a>            <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># Jupyter notebook ou lab</span>
</span><span id="in_notebook-23"><a href="#in_notebook-23"><span class="linenos">23</span></a>        <span class="k">elif</span> <span class="n">shell</span> <span class="o">==</span> <span class="s2">&quot;TerminalInteractiveShell&quot;</span><span class="p">:</span>
</span><span id="in_notebook-24"><a href="#in_notebook-24"><span class="linenos">24</span></a>            <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># IPython en terminal</span>
</span><span id="in_notebook-25"><a href="#in_notebook-25"><span class="linenos">25</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="in_notebook-26"><a href="#in_notebook-26"><span class="linenos">26</span></a>            <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># autre type inconnu</span>
</span><span id="in_notebook-27"><a href="#in_notebook-27"><span class="linenos">27</span></a>    <span class="k">except</span> <span class="p">(</span><span class="ne">NameError</span><span class="p">,</span> <span class="ne">ImportError</span><span class="p">):</span>
</span><span id="in_notebook-28"><a href="#in_notebook-28"><span class="linenos">28</span></a>        <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># En script Python standard</span>
</span></pre></div>


    

                </section>
                <section id="Mesh">
                            <input id="Mesh-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Mesh</span>:

                <label class="view-source-button" for="Mesh-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Mesh"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Mesh-31"><a href="#Mesh-31"><span class="linenos">  31</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Mesh</span><span class="p">:</span>
</span><span id="Mesh-32"><a href="#Mesh-32"><span class="linenos">  32</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh-33"><a href="#Mesh-33"><span class="linenos">  33</span></a><span class="sd">    Represents a multi-patch B-spline mesh.</span>
</span><span id="Mesh-34"><a href="#Mesh-34"><span class="linenos">  34</span></a>
</span><span id="Mesh-35"><a href="#Mesh-35"><span class="linenos">  35</span></a><span class="sd">    This class manages a multi-patch B-spline mesh, including control points,</span>
</span><span id="Mesh-36"><a href="#Mesh-36"><span class="linenos">  36</span></a><span class="sd">    connectivity, evaluation, field propagation, and visualization. It supports</span>
</span><span id="Mesh-37"><a href="#Mesh-37"><span class="linenos">  37</span></a><span class="sd">    both 2D and 3D meshes.</span>
</span><span id="Mesh-38"><a href="#Mesh-38"><span class="linenos">  38</span></a>
</span><span id="Mesh-39"><a href="#Mesh-39"><span class="linenos">  39</span></a><span class="sd">    Attributes</span>
</span><span id="Mesh-40"><a href="#Mesh-40"><span class="linenos">  40</span></a><span class="sd">    ----------</span>
</span><span id="Mesh-41"><a href="#Mesh-41"><span class="linenos">  41</span></a><span class="sd">    connectivity : MultiPatchBSplineConnectivity</span>
</span><span id="Mesh-42"><a href="#Mesh-42"><span class="linenos">  42</span></a><span class="sd">        Multi-patch connectivity structure.</span>
</span><span id="Mesh-43"><a href="#Mesh-43"><span class="linenos">  43</span></a><span class="sd">    splines : list[BSpline]</span>
</span><span id="Mesh-44"><a href="#Mesh-44"><span class="linenos">  44</span></a><span class="sd">        List of B-spline objects for each patch.</span>
</span><span id="Mesh-45"><a href="#Mesh-45"><span class="linenos">  45</span></a><span class="sd">    unique_ctrl_pts : np.ndarray</span>
</span><span id="Mesh-46"><a href="#Mesh-46"><span class="linenos">  46</span></a><span class="sd">        Array of unique control points for the entire mesh.</span>
</span><span id="Mesh-47"><a href="#Mesh-47"><span class="linenos">  47</span></a><span class="sd">    ref_inds : np.ndarray</span>
</span><span id="Mesh-48"><a href="#Mesh-48"><span class="linenos">  48</span></a><span class="sd">        Reference indices used for linking to submeshes.</span>
</span><span id="Mesh-49"><a href="#Mesh-49"><span class="linenos">  49</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Mesh-50"><a href="#Mesh-50"><span class="linenos">  50</span></a>
</span><span id="Mesh-51"><a href="#Mesh-51"><span class="linenos">  51</span></a>    <span class="n">connectivity</span><span class="p">:</span> <span class="n">MultiPatchBSplineConnectivity</span>
</span><span id="Mesh-52"><a href="#Mesh-52"><span class="linenos">  52</span></a>    <span class="n">splines</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">BSpline</span><span class="p">]</span>
</span><span id="Mesh-53"><a href="#Mesh-53"><span class="linenos">  53</span></a>    <span class="n">unique_ctrl_pts</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>
</span><span id="Mesh-54"><a href="#Mesh-54"><span class="linenos">  54</span></a>    <span class="n">ref_inds</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">]</span>
</span><span id="Mesh-55"><a href="#Mesh-55"><span class="linenos">  55</span></a>
</span><span id="Mesh-56"><a href="#Mesh-56"><span class="linenos">  56</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="Mesh-57"><a href="#Mesh-57"><span class="linenos">  57</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Mesh-58"><a href="#Mesh-58"><span class="linenos">  58</span></a>        <span class="n">splines</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">BSpline</span><span class="p">],</span>
</span><span id="Mesh-59"><a href="#Mesh-59"><span class="linenos">  59</span></a>        <span class="n">ctrl_pts</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]],</span>
</span><span id="Mesh-60"><a href="#Mesh-60"><span class="linenos">  60</span></a>        <span class="n">connectivity</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">MultiPatchBSplineConnectivity</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Mesh-61"><a href="#Mesh-61"><span class="linenos">  61</span></a>        <span class="n">ref_inds</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Mesh-62"><a href="#Mesh-62"><span class="linenos">  62</span></a>    <span class="p">):</span>
</span><span id="Mesh-63"><a href="#Mesh-63"><span class="linenos">  63</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh-64"><a href="#Mesh-64"><span class="linenos">  64</span></a><span class="sd">        Initialize a multi-patch B-spline mesh.</span>
</span><span id="Mesh-65"><a href="#Mesh-65"><span class="linenos">  65</span></a>
</span><span id="Mesh-66"><a href="#Mesh-66"><span class="linenos">  66</span></a><span class="sd">        This constructor sets up a multi-patch mesh with B-spline patches,</span>
</span><span id="Mesh-67"><a href="#Mesh-67"><span class="linenos">  67</span></a><span class="sd">        control points, and optional connectivity and reference indices. The mesh</span>
</span><span id="Mesh-68"><a href="#Mesh-68"><span class="linenos">  68</span></a><span class="sd">        can be initialized either with separated control points per patch or with</span>
</span><span id="Mesh-69"><a href="#Mesh-69"><span class="linenos">  69</span></a><span class="sd">        a packed array of unique control points. If connectivity is not provided,</span>
</span><span id="Mesh-70"><a href="#Mesh-70"><span class="linenos">  70</span></a><span class="sd">        it is inferred automatically from separated control points.</span>
</span><span id="Mesh-71"><a href="#Mesh-71"><span class="linenos">  71</span></a>
</span><span id="Mesh-72"><a href="#Mesh-72"><span class="linenos">  72</span></a><span class="sd">        Parameters</span>
</span><span id="Mesh-73"><a href="#Mesh-73"><span class="linenos">  73</span></a><span class="sd">        ----------</span>
</span><span id="Mesh-74"><a href="#Mesh-74"><span class="linenos">  74</span></a><span class="sd">        splines : list[BSpline]</span>
</span><span id="Mesh-75"><a href="#Mesh-75"><span class="linenos">  75</span></a><span class="sd">            List of `BSpline` objects for each patch.</span>
</span><span id="Mesh-76"><a href="#Mesh-76"><span class="linenos">  76</span></a>
</span><span id="Mesh-77"><a href="#Mesh-77"><span class="linenos">  77</span></a><span class="sd">        ctrl_pts : list[np.ndarray] or np.ndarray</span>
</span><span id="Mesh-78"><a href="#Mesh-78"><span class="linenos">  78</span></a><span class="sd">            Control points of the mesh.</span>
</span><span id="Mesh-79"><a href="#Mesh-79"><span class="linenos">  79</span></a><span class="sd">            - If a list of arrays is provided, each array corresponds to a patch</span>
</span><span id="Mesh-80"><a href="#Mesh-80"><span class="linenos">  80</span></a><span class="sd">            (shape: `(dim_phys, n1, ..., nd)`).</span>
</span><span id="Mesh-81"><a href="#Mesh-81"><span class="linenos">  81</span></a><span class="sd">            - If a single array is provided, it should contain either the unique</span>
</span><span id="Mesh-82"><a href="#Mesh-82"><span class="linenos">  82</span></a><span class="sd">            control points or the full concatenated points for all patches.</span>
</span><span id="Mesh-83"><a href="#Mesh-83"><span class="linenos">  83</span></a>
</span><span id="Mesh-84"><a href="#Mesh-84"><span class="linenos">  84</span></a><span class="sd">        connectivity : MultiPatchBSplineConnectivity, optional</span>
</span><span id="Mesh-85"><a href="#Mesh-85"><span class="linenos">  85</span></a><span class="sd">            Multi-patch connectivity object. If `None`, it is automatically inferred</span>
</span><span id="Mesh-86"><a href="#Mesh-86"><span class="linenos">  86</span></a><span class="sd">            from separated control points.</span>
</span><span id="Mesh-87"><a href="#Mesh-87"><span class="linenos">  87</span></a>
</span><span id="Mesh-88"><a href="#Mesh-88"><span class="linenos">  88</span></a><span class="sd">        ref_inds : np.ndarray, optional</span>
</span><span id="Mesh-89"><a href="#Mesh-89"><span class="linenos">  89</span></a><span class="sd">            Reference indices mapping control points to submeshes or external data.</span>
</span><span id="Mesh-90"><a href="#Mesh-90"><span class="linenos">  90</span></a><span class="sd">            If `None`, defaults to `np.arange(nb_unique_nodes)`.</span>
</span><span id="Mesh-91"><a href="#Mesh-91"><span class="linenos">  91</span></a>
</span><span id="Mesh-92"><a href="#Mesh-92"><span class="linenos">  92</span></a><span class="sd">        Notes</span>
</span><span id="Mesh-93"><a href="#Mesh-93"><span class="linenos">  93</span></a><span class="sd">        -----</span>
</span><span id="Mesh-94"><a href="#Mesh-94"><span class="linenos">  94</span></a><span class="sd">        - The mesh stores control points in a &quot;unique&quot; packed format (`self.unique_ctrl_pts`)</span>
</span><span id="Mesh-95"><a href="#Mesh-95"><span class="linenos">  95</span></a><span class="sd">        internally, regardless of input format.</span>
</span><span id="Mesh-96"><a href="#Mesh-96"><span class="linenos">  96</span></a><span class="sd">        - If `ctrl_pts` is a single array but does not match the number of unique nodes,</span>
</span><span id="Mesh-97"><a href="#Mesh-97"><span class="linenos">  97</span></a><span class="sd">        it is automatically packed using the provided or inferred connectivity.</span>
</span><span id="Mesh-98"><a href="#Mesh-98"><span class="linenos">  98</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh-99"><a href="#Mesh-99"><span class="linenos">  99</span></a>        <span class="k">if</span> <span class="n">connectivity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Mesh-100"><a href="#Mesh-100"><span class="linenos"> 100</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ctrl_pts</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="Mesh-101"><a href="#Mesh-101"><span class="linenos"> 101</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="Mesh-102"><a href="#Mesh-102"><span class="linenos"> 102</span></a>                    <span class="s2">&quot;Can only infer connectivity from separated control points list.&quot;</span>
</span><span id="Mesh-103"><a href="#Mesh-103"><span class="linenos"> 103</span></a>                <span class="p">)</span>
</span><span id="Mesh-104"><a href="#Mesh-104"><span class="linenos"> 104</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">=</span> <span class="n">MultiPatchBSplineConnectivity</span><span class="o">.</span><span class="n">from_separated_ctrlPts</span><span class="p">(</span>
</span><span id="Mesh-105"><a href="#Mesh-105"><span class="linenos"> 105</span></a>                <span class="n">ctrl_pts</span>
</span><span id="Mesh-106"><a href="#Mesh-106"><span class="linenos"> 106</span></a>            <span class="p">)</span>
</span><span id="Mesh-107"><a href="#Mesh-107"><span class="linenos"> 107</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Mesh-108"><a href="#Mesh-108"><span class="linenos"> 108</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">=</span> <span class="n">connectivity</span>
</span><span id="Mesh-109"><a href="#Mesh-109"><span class="linenos"> 109</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">splines</span> <span class="o">=</span> <span class="n">splines</span>
</span><span id="Mesh-110"><a href="#Mesh-110"><span class="linenos"> 110</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ctrl_pts</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>  <span class="c1"># unique or unpacked state</span>
</span><span id="Mesh-111"><a href="#Mesh-111"><span class="linenos"> 111</span></a>            <span class="k">if</span> <span class="n">ctrl_pts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_unique_nodes</span><span class="p">:</span>  <span class="c1"># unique state</span>
</span><span id="Mesh-112"><a href="#Mesh-112"><span class="linenos"> 112</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">unique_ctrl_pts</span> <span class="o">=</span> <span class="n">ctrl_pts</span>
</span><span id="Mesh-113"><a href="#Mesh-113"><span class="linenos"> 113</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Mesh-114"><a href="#Mesh-114"><span class="linenos"> 114</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">unique_ctrl_pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">ctrl_pts</span><span class="p">)</span>
</span><span id="Mesh-115"><a href="#Mesh-115"><span class="linenos"> 115</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Mesh-116"><a href="#Mesh-116"><span class="linenos"> 116</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_separated_ctrl_pts</span><span class="p">(</span><span class="n">ctrl_pts</span><span class="p">)</span>
</span><span id="Mesh-117"><a href="#Mesh-117"><span class="linenos"> 117</span></a>        <span class="k">if</span> <span class="n">ref_inds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Mesh-118"><a href="#Mesh-118"><span class="linenos"> 118</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ref_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_unique_nodes</span><span class="p">)</span>
</span><span id="Mesh-119"><a href="#Mesh-119"><span class="linenos"> 119</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Mesh-120"><a href="#Mesh-120"><span class="linenos"> 120</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ref_inds</span> <span class="o">=</span> <span class="n">ref_inds</span>
</span><span id="Mesh-121"><a href="#Mesh-121"><span class="linenos"> 121</span></a>
</span><span id="Mesh-122"><a href="#Mesh-122"><span class="linenos"> 122</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_repr_png_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Mesh-123"><a href="#Mesh-123"><span class="linenos"> 123</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh-124"><a href="#Mesh-124"><span class="linenos"> 124</span></a><span class="sd">        IPython/Jupyter display hook for the mesh.</span>
</span><span id="Mesh-125"><a href="#Mesh-125"><span class="linenos"> 125</span></a>
</span><span id="Mesh-126"><a href="#Mesh-126"><span class="linenos"> 126</span></a><span class="sd">        Shows a screenshot of the last plot if available when</span>
</span><span id="Mesh-127"><a href="#Mesh-127"><span class="linenos"> 127</span></a><span class="sd">        the object is displayed in a notebook.</span>
</span><span id="Mesh-128"><a href="#Mesh-128"><span class="linenos"> 128</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh-129"><a href="#Mesh-129"><span class="linenos"> 129</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="Mesh-130"><a href="#Mesh-130"><span class="linenos"> 130</span></a>
</span><span id="Mesh-131"><a href="#Mesh-131"><span class="linenos"> 131</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Mesh-132"><a href="#Mesh-132"><span class="linenos"> 132</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh-133"><a href="#Mesh-133"><span class="linenos"> 133</span></a><span class="sd">        Display the mesh or the last plot screenshot.</span>
</span><span id="Mesh-134"><a href="#Mesh-134"><span class="linenos"> 134</span></a>
</span><span id="Mesh-135"><a href="#Mesh-135"><span class="linenos"> 135</span></a><span class="sd">        - If a screenshot from the last `PyVista` plot exists, it is displayed</span>
</span><span id="Mesh-136"><a href="#Mesh-136"><span class="linenos"> 136</span></a><span class="sd">        via `Matplotlib`.</span>
</span><span id="Mesh-137"><a href="#Mesh-137"><span class="linenos"> 137</span></a><span class="sd">        - Otherwise, prints a simple textual representation of the mesh.</span>
</span><span id="Mesh-138"><a href="#Mesh-138"><span class="linenos"> 138</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh-139"><a href="#Mesh-139"><span class="linenos"> 139</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_screenshot&quot;</span><span class="p">):</span>
</span><span id="Mesh-140"><a href="#Mesh-140"><span class="linenos"> 140</span></a>            <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</span><span id="Mesh-141"><a href="#Mesh-141"><span class="linenos"> 141</span></a>
</span><span id="Mesh-142"><a href="#Mesh-142"><span class="linenos"> 142</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_screenshot</span><span class="p">)</span>
</span><span id="Mesh-143"><a href="#Mesh-143"><span class="linenos"> 143</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
</span><span id="Mesh-144"><a href="#Mesh-144"><span class="linenos"> 144</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Screenshot of last plot&quot;</span><span class="p">)</span>
</span><span id="Mesh-145"><a href="#Mesh-145"><span class="linenos"> 145</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="Mesh-146"><a href="#Mesh-146"><span class="linenos"> 146</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Mesh-147"><a href="#Mesh-147"><span class="linenos"> 147</span></a>            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Mesh-148"><a href="#Mesh-148"><span class="linenos"> 148</span></a>
</span><span id="Mesh-149"><a href="#Mesh-149"><span class="linenos"> 149</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Mesh-150"><a href="#Mesh-150"><span class="linenos"> 150</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh-151"><a href="#Mesh-151"><span class="linenos"> 151</span></a><span class="sd">        Serialize and save the mesh object to a file using pickle.</span>
</span><span id="Mesh-152"><a href="#Mesh-152"><span class="linenos"> 152</span></a>
</span><span id="Mesh-153"><a href="#Mesh-153"><span class="linenos"> 153</span></a><span class="sd">        Parameters</span>
</span><span id="Mesh-154"><a href="#Mesh-154"><span class="linenos"> 154</span></a><span class="sd">        ----------</span>
</span><span id="Mesh-155"><a href="#Mesh-155"><span class="linenos"> 155</span></a><span class="sd">        filename : str</span>
</span><span id="Mesh-156"><a href="#Mesh-156"><span class="linenos"> 156</span></a><span class="sd">            Path to the file where the mesh will be saved.</span>
</span><span id="Mesh-157"><a href="#Mesh-157"><span class="linenos"> 157</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh-158"><a href="#Mesh-158"><span class="linenos"> 158</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Mesh-159"><a href="#Mesh-159"><span class="linenos"> 159</span></a>            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="Mesh-160"><a href="#Mesh-160"><span class="linenos"> 160</span></a>
</span><span id="Mesh-161"><a href="#Mesh-161"><span class="linenos"> 161</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Mesh-162"><a href="#Mesh-162"><span class="linenos"> 162</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Mesh&quot;</span><span class="p">:</span>
</span><span id="Mesh-163"><a href="#Mesh-163"><span class="linenos"> 163</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh-164"><a href="#Mesh-164"><span class="linenos"> 164</span></a><span class="sd">        Load a mesh object previously saved with :meth:`save`.</span>
</span><span id="Mesh-165"><a href="#Mesh-165"><span class="linenos"> 165</span></a>
</span><span id="Mesh-166"><a href="#Mesh-166"><span class="linenos"> 166</span></a><span class="sd">        Parameters</span>
</span><span id="Mesh-167"><a href="#Mesh-167"><span class="linenos"> 167</span></a><span class="sd">        ----------</span>
</span><span id="Mesh-168"><a href="#Mesh-168"><span class="linenos"> 168</span></a><span class="sd">        filename : str</span>
</span><span id="Mesh-169"><a href="#Mesh-169"><span class="linenos"> 169</span></a><span class="sd">            Path to the file containing the pickled mesh.</span>
</span><span id="Mesh-170"><a href="#Mesh-170"><span class="linenos"> 170</span></a>
</span><span id="Mesh-171"><a href="#Mesh-171"><span class="linenos"> 171</span></a><span class="sd">        Returns</span>
</span><span id="Mesh-172"><a href="#Mesh-172"><span class="linenos"> 172</span></a><span class="sd">        -------</span>
</span><span id="Mesh-173"><a href="#Mesh-173"><span class="linenos"> 173</span></a><span class="sd">        Mesh</span>
</span><span id="Mesh-174"><a href="#Mesh-174"><span class="linenos"> 174</span></a><span class="sd">            The loaded mesh object.</span>
</span><span id="Mesh-175"><a href="#Mesh-175"><span class="linenos"> 175</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh-176"><a href="#Mesh-176"><span class="linenos"> 176</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Mesh-177"><a href="#Mesh-177"><span class="linenos"> 177</span></a>            <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="Mesh-178"><a href="#Mesh-178"><span class="linenos"> 178</span></a>
</span><span id="Mesh-179"><a href="#Mesh-179"><span class="linenos"> 179</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">separated_to_unique</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Mesh-180"><a href="#Mesh-180"><span class="linenos"> 180</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh-181"><a href="#Mesh-181"><span class="linenos"> 181</span></a><span class="sd">        Convert a field given per patch to the unique/global control points representation.</span>
</span><span id="Mesh-182"><a href="#Mesh-182"><span class="linenos"> 182</span></a>
</span><span id="Mesh-183"><a href="#Mesh-183"><span class="linenos"> 183</span></a><span class="sd">        Parameters</span>
</span><span id="Mesh-184"><a href="#Mesh-184"><span class="linenos"> 184</span></a><span class="sd">        ----------</span>
</span><span id="Mesh-185"><a href="#Mesh-185"><span class="linenos"> 185</span></a><span class="sd">        field : list[np.ndarray]</span>
</span><span id="Mesh-186"><a href="#Mesh-186"><span class="linenos"> 186</span></a><span class="sd">            Field separated per patch.</span>
</span><span id="Mesh-187"><a href="#Mesh-187"><span class="linenos"> 187</span></a><span class="sd">        method : optional</span>
</span><span id="Mesh-188"><a href="#Mesh-188"><span class="linenos"> 188</span></a><span class="sd">            Agglomeration method passed to :meth:`MultiPatchBSplineConnectivity.agglomerate`.</span>
</span><span id="Mesh-189"><a href="#Mesh-189"><span class="linenos"> 189</span></a>
</span><span id="Mesh-190"><a href="#Mesh-190"><span class="linenos"> 190</span></a><span class="sd">        Returns</span>
</span><span id="Mesh-191"><a href="#Mesh-191"><span class="linenos"> 191</span></a><span class="sd">        -------</span>
</span><span id="Mesh-192"><a href="#Mesh-192"><span class="linenos"> 192</span></a><span class="sd">        np.ndarray</span>
</span><span id="Mesh-193"><a href="#Mesh-193"><span class="linenos"> 193</span></a><span class="sd">            Field in the unique/global representation.</span>
</span><span id="Mesh-194"><a href="#Mesh-194"><span class="linenos"> 194</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh-195"><a href="#Mesh-195"><span class="linenos"> 195</span></a>        <span class="k">if</span> <span class="n">method</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Mesh-196"><a href="#Mesh-196"><span class="linenos"> 196</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">agglomerate</span><span class="p">(</span><span class="n">field</span><span class="p">))</span>
</span><span id="Mesh-197"><a href="#Mesh-197"><span class="linenos"> 197</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Mesh-198"><a href="#Mesh-198"><span class="linenos"> 198</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span>
</span><span id="Mesh-199"><a href="#Mesh-199"><span class="linenos"> 199</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">agglomerate</span><span class="p">(</span><span class="n">field</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span>
</span><span id="Mesh-200"><a href="#Mesh-200"><span class="linenos"> 200</span></a>            <span class="p">)</span>
</span><span id="Mesh-201"><a href="#Mesh-201"><span class="linenos"> 201</span></a>
</span><span id="Mesh-202"><a href="#Mesh-202"><span class="linenos"> 202</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">unique_to_separated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
</span><span id="Mesh-203"><a href="#Mesh-203"><span class="linenos"> 203</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh-204"><a href="#Mesh-204"><span class="linenos"> 204</span></a><span class="sd">        Convert a field in the unique/global representation to a per-patch separated form.</span>
</span><span id="Mesh-205"><a href="#Mesh-205"><span class="linenos"> 205</span></a>
</span><span id="Mesh-206"><a href="#Mesh-206"><span class="linenos"> 206</span></a><span class="sd">        Parameters</span>
</span><span id="Mesh-207"><a href="#Mesh-207"><span class="linenos"> 207</span></a><span class="sd">        ----------</span>
</span><span id="Mesh-208"><a href="#Mesh-208"><span class="linenos"> 208</span></a><span class="sd">        field : np.ndarray</span>
</span><span id="Mesh-209"><a href="#Mesh-209"><span class="linenos"> 209</span></a><span class="sd">            Field in unique/global representation.</span>
</span><span id="Mesh-210"><a href="#Mesh-210"><span class="linenos"> 210</span></a>
</span><span id="Mesh-211"><a href="#Mesh-211"><span class="linenos"> 211</span></a><span class="sd">        Returns</span>
</span><span id="Mesh-212"><a href="#Mesh-212"><span class="linenos"> 212</span></a><span class="sd">        -------</span>
</span><span id="Mesh-213"><a href="#Mesh-213"><span class="linenos"> 213</span></a><span class="sd">        list[np.ndarray]</span>
</span><span id="Mesh-214"><a href="#Mesh-214"><span class="linenos"> 214</span></a><span class="sd">            Field separated per patch.</span>
</span><span id="Mesh-215"><a href="#Mesh-215"><span class="linenos"> 215</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh-216"><a href="#Mesh-216"><span class="linenos"> 216</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">separate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">field</span><span class="p">))</span>
</span><span id="Mesh-217"><a href="#Mesh-217"><span class="linenos"> 217</span></a>
</span><span id="Mesh-218"><a href="#Mesh-218"><span class="linenos"> 218</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_separated_ctrl_pts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]]:</span>
</span><span id="Mesh-219"><a href="#Mesh-219"><span class="linenos"> 219</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh-220"><a href="#Mesh-220"><span class="linenos"> 220</span></a><span class="sd">        Return the control points as a list of arrays, one per patch.</span>
</span><span id="Mesh-221"><a href="#Mesh-221"><span class="linenos"> 221</span></a>
</span><span id="Mesh-222"><a href="#Mesh-222"><span class="linenos"> 222</span></a><span class="sd">        Returns</span>
</span><span id="Mesh-223"><a href="#Mesh-223"><span class="linenos"> 223</span></a><span class="sd">        -------</span>
</span><span id="Mesh-224"><a href="#Mesh-224"><span class="linenos"> 224</span></a><span class="sd">        list[np.ndarray]</span>
</span><span id="Mesh-225"><a href="#Mesh-225"><span class="linenos"> 225</span></a><span class="sd">            Control points separated per patch.</span>
</span><span id="Mesh-226"><a href="#Mesh-226"><span class="linenos"> 226</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh-227"><a href="#Mesh-227"><span class="linenos"> 227</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_to_separated</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unique_ctrl_pts</span><span class="p">)</span>
</span><span id="Mesh-228"><a href="#Mesh-228"><span class="linenos"> 228</span></a>
</span><span id="Mesh-229"><a href="#Mesh-229"><span class="linenos"> 229</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_separated_ctrl_pts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">separated_ctrl_pts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]]):</span>
</span><span id="Mesh-230"><a href="#Mesh-230"><span class="linenos"> 230</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh-231"><a href="#Mesh-231"><span class="linenos"> 231</span></a><span class="sd">        Set the mesh control points from a list of arrays (one per patch).</span>
</span><span id="Mesh-232"><a href="#Mesh-232"><span class="linenos"> 232</span></a>
</span><span id="Mesh-233"><a href="#Mesh-233"><span class="linenos"> 233</span></a><span class="sd">        Parameters</span>
</span><span id="Mesh-234"><a href="#Mesh-234"><span class="linenos"> 234</span></a><span class="sd">        ----------</span>
</span><span id="Mesh-235"><a href="#Mesh-235"><span class="linenos"> 235</span></a><span class="sd">        separated_ctrl_pts : list[np.ndarray]</span>
</span><span id="Mesh-236"><a href="#Mesh-236"><span class="linenos"> 236</span></a><span class="sd">            Control points separated per patch.</span>
</span><span id="Mesh-237"><a href="#Mesh-237"><span class="linenos"> 237</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh-238"><a href="#Mesh-238"><span class="linenos"> 238</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">unique_ctrl_pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">separated_to_unique</span><span class="p">(</span><span class="n">separated_ctrl_pts</span><span class="p">)</span>
</span><span id="Mesh-239"><a href="#Mesh-239"><span class="linenos"> 239</span></a>
</span><span id="Mesh-240"><a href="#Mesh-240"><span class="linenos"> 240</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span>
</span><span id="Mesh-241"><a href="#Mesh-241"><span class="linenos"> 241</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Mesh-242"><a href="#Mesh-242"><span class="linenos"> 242</span></a>        <span class="n">XI</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="o">...</span><span class="p">]],</span>
</span><span id="Mesh-243"><a href="#Mesh-243"><span class="linenos"> 243</span></a>        <span class="n">k</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]]],</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Mesh-244"><a href="#Mesh-244"><span class="linenos"> 244</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Mesh-245"><a href="#Mesh-245"><span class="linenos"> 245</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="Mesh-246"><a href="#Mesh-246"><span class="linenos"> 246</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh-247"><a href="#Mesh-247"><span class="linenos"> 247</span></a><span class="sd">        Evaluate the mesh (B-spline patches) at given parametric points.</span>
</span><span id="Mesh-248"><a href="#Mesh-248"><span class="linenos"> 248</span></a>
</span><span id="Mesh-249"><a href="#Mesh-249"><span class="linenos"> 249</span></a><span class="sd">        This method evaluates each B-spline patch of the mesh at the provided</span>
</span><span id="Mesh-250"><a href="#Mesh-250"><span class="linenos"> 250</span></a><span class="sd">        isoparametric coordinates `XI`. The evaluation can be performed on either</span>
</span><span id="Mesh-251"><a href="#Mesh-251"><span class="linenos"> 251</span></a><span class="sd">        the current control points of the mesh or a provided field.</span>
</span><span id="Mesh-252"><a href="#Mesh-252"><span class="linenos"> 252</span></a>
</span><span id="Mesh-253"><a href="#Mesh-253"><span class="linenos"> 253</span></a><span class="sd">        Internally, this method calls :meth:`BSpline.__call__` for each patch.</span>
</span><span id="Mesh-254"><a href="#Mesh-254"><span class="linenos"> 254</span></a>
</span><span id="Mesh-255"><a href="#Mesh-255"><span class="linenos"> 255</span></a><span class="sd">        Parameters</span>
</span><span id="Mesh-256"><a href="#Mesh-256"><span class="linenos"> 256</span></a><span class="sd">        ----------</span>
</span><span id="Mesh-257"><a href="#Mesh-257"><span class="linenos"> 257</span></a><span class="sd">        XI : iterable of tuple of np.ndarray</span>
</span><span id="Mesh-258"><a href="#Mesh-258"><span class="linenos"> 258</span></a><span class="sd">            Isoparametric coordinates for evaluation, provided per patch.</span>
</span><span id="Mesh-259"><a href="#Mesh-259"><span class="linenos"> 259</span></a><span class="sd">        k : int or iterable of int/tuple, optional</span>
</span><span id="Mesh-260"><a href="#Mesh-260"><span class="linenos"> 260</span></a><span class="sd">            Degree of derivative to compute at each evaluation point. Can be a single</span>
</span><span id="Mesh-261"><a href="#Mesh-261"><span class="linenos"> 261</span></a><span class="sd">            integer applied to all patches or an iterable specifying values per patch.</span>
</span><span id="Mesh-262"><a href="#Mesh-262"><span class="linenos"> 262</span></a><span class="sd">            Default is 0 (function value).</span>
</span><span id="Mesh-263"><a href="#Mesh-263"><span class="linenos"> 263</span></a><span class="sd">        data : np.ndarray or iterable of np.ndarray, optional</span>
</span><span id="Mesh-264"><a href="#Mesh-264"><span class="linenos"> 264</span></a><span class="sd">            Field values to use for evaluation. If `None` (default), uses the current</span>
</span><span id="Mesh-265"><a href="#Mesh-265"><span class="linenos"> 265</span></a><span class="sd">            control points. Can be a single array in unique/global representation</span>
</span><span id="Mesh-266"><a href="#Mesh-266"><span class="linenos"> 266</span></a><span class="sd">            or a list of arrays per patch.</span>
</span><span id="Mesh-267"><a href="#Mesh-267"><span class="linenos"> 267</span></a>
</span><span id="Mesh-268"><a href="#Mesh-268"><span class="linenos"> 268</span></a><span class="sd">        Returns</span>
</span><span id="Mesh-269"><a href="#Mesh-269"><span class="linenos"> 269</span></a><span class="sd">        -------</span>
</span><span id="Mesh-270"><a href="#Mesh-270"><span class="linenos"> 270</span></a><span class="sd">        list</span>
</span><span id="Mesh-271"><a href="#Mesh-271"><span class="linenos"> 271</span></a><span class="sd">            List of evaluation results, one per patch, in the order of `XI`.</span>
</span><span id="Mesh-272"><a href="#Mesh-272"><span class="linenos"> 272</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh-273"><a href="#Mesh-273"><span class="linenos"> 273</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Mesh-274"><a href="#Mesh-274"><span class="linenos"> 274</span></a>            <span class="n">k</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_patchs</span>
</span><span id="Mesh-275"><a href="#Mesh-275"><span class="linenos"> 275</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
</span><span id="Mesh-276"><a href="#Mesh-276"><span class="linenos"> 276</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_patchs</span><span class="p">:</span>
</span><span id="Mesh-277"><a href="#Mesh-277"><span class="linenos"> 277</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Mesh-278"><a href="#Mesh-278"><span class="linenos"> 278</span></a>                    <span class="sa">f</span><span class="s2">&quot;Expected </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_patchs</span><span class="si">}</span><span class="s2"> entries in &#39;k&#39;, got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="Mesh-279"><a href="#Mesh-279"><span class="linenos"> 279</span></a>                <span class="p">)</span>
</span><span id="Mesh-280"><a href="#Mesh-280"><span class="linenos"> 280</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Mesh-281"><a href="#Mesh-281"><span class="linenos"> 281</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="Mesh-282"><a href="#Mesh-282"><span class="linenos"> 282</span></a>                <span class="sa">f</span><span class="s2">&quot;&#39;k&#39; must be an int or an iterable of ints/tuples, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="Mesh-283"><a href="#Mesh-283"><span class="linenos"> 283</span></a>            <span class="p">)</span>
</span><span id="Mesh-284"><a href="#Mesh-284"><span class="linenos"> 284</span></a>        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Mesh-285"><a href="#Mesh-285"><span class="linenos"> 285</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_separated_ctrl_pts</span><span class="p">()</span>
</span><span id="Mesh-286"><a href="#Mesh-286"><span class="linenos"> 286</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="Mesh-287"><a href="#Mesh-287"><span class="linenos"> 287</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_to_separated</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="Mesh-288"><a href="#Mesh-288"><span class="linenos"> 288</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)):</span>
</span><span id="Mesh-289"><a href="#Mesh-289"><span class="linenos"> 289</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_patchs</span><span class="p">:</span>
</span><span id="Mesh-290"><a href="#Mesh-290"><span class="linenos"> 290</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Mesh-291"><a href="#Mesh-291"><span class="linenos"> 291</span></a>                    <span class="sa">f</span><span class="s2">&quot;Expected </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_patchs</span><span class="si">}</span><span class="s2"> data arrays, got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="Mesh-292"><a href="#Mesh-292"><span class="linenos"> 292</span></a>                <span class="p">)</span>
</span><span id="Mesh-293"><a href="#Mesh-293"><span class="linenos"> 293</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Mesh-294"><a href="#Mesh-294"><span class="linenos"> 294</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="Mesh-295"><a href="#Mesh-295"><span class="linenos"> 295</span></a>                <span class="s2">&quot;&#39;data&#39; must be None, a NumPy array, or an iterable of NumPy arrays.&quot;</span>
</span><span id="Mesh-296"><a href="#Mesh-296"><span class="linenos"> 296</span></a>                <span class="sa">f</span><span class="s2">&quot; Got object of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="Mesh-297"><a href="#Mesh-297"><span class="linenos"> 297</span></a>            <span class="p">)</span>
</span><span id="Mesh-298"><a href="#Mesh-298"><span class="linenos"> 298</span></a>        <span class="n">all_args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">XI</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span><span id="Mesh-299"><a href="#Mesh-299"><span class="linenos"> 299</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="n">parallel_blocks</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">,</span> <span class="n">all_args</span><span class="p">,</span> <span class="n">pbar_title</span><span class="o">=</span><span class="s2">&quot;Evaluate mesh&quot;</span><span class="p">)</span>
</span><span id="Mesh-300"><a href="#Mesh-300"><span class="linenos"> 300</span></a>        <span class="k">return</span> <span class="n">results</span>
</span><span id="Mesh-301"><a href="#Mesh-301"><span class="linenos"> 301</span></a>
</span><span id="Mesh-302"><a href="#Mesh-302"><span class="linenos"> 302</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">assemble_grads</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">terms</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">field_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="Mesh-303"><a href="#Mesh-303"><span class="linenos"> 303</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh-304"><a href="#Mesh-304"><span class="linenos"> 304</span></a><span class="sd">        Assemble patch-wise gradient vectors into a global gradient vector.</span>
</span><span id="Mesh-305"><a href="#Mesh-305"><span class="linenos"> 305</span></a>
</span><span id="Mesh-306"><a href="#Mesh-306"><span class="linenos"> 306</span></a><span class="sd">        Each entry in `terms` corresponds to a gradient vector computed on a single</span>
</span><span id="Mesh-307"><a href="#Mesh-307"><span class="linenos"> 307</span></a><span class="sd">        patch. This method uses the mesh connectivity to map patch-local indices</span>
</span><span id="Mesh-308"><a href="#Mesh-308"><span class="linenos"> 308</span></a><span class="sd">        to global unique node indices and sums contributions from overlapping nodes.</span>
</span><span id="Mesh-309"><a href="#Mesh-309"><span class="linenos"> 309</span></a>
</span><span id="Mesh-310"><a href="#Mesh-310"><span class="linenos"> 310</span></a><span class="sd">        Important: Assumes that the degrees of freedom are arranged per field,</span>
</span><span id="Mesh-311"><a href="#Mesh-311"><span class="linenos"> 311</span></a><span class="sd">        i.e., `[x_0, ..., x_n, y_0, ..., y_n, z_0, ..., z_n]`. It does not</span>
</span><span id="Mesh-312"><a href="#Mesh-312"><span class="linenos"> 312</span></a><span class="sd">        work if the DOFs are interleaved as `[x_0, y_0, z_0, x_1, y_1, z_1, ...]`.</span>
</span><span id="Mesh-313"><a href="#Mesh-313"><span class="linenos"> 313</span></a>
</span><span id="Mesh-314"><a href="#Mesh-314"><span class="linenos"> 314</span></a><span class="sd">        Parameters</span>
</span><span id="Mesh-315"><a href="#Mesh-315"><span class="linenos"> 315</span></a><span class="sd">        ----------</span>
</span><span id="Mesh-316"><a href="#Mesh-316"><span class="linenos"> 316</span></a><span class="sd">        terms : list of np.ndarray</span>
</span><span id="Mesh-317"><a href="#Mesh-317"><span class="linenos"> 317</span></a><span class="sd">            Gradient vectors for each patch, typically computed from patch-local</span>
</span><span id="Mesh-318"><a href="#Mesh-318"><span class="linenos"> 318</span></a><span class="sd">            operations.</span>
</span><span id="Mesh-319"><a href="#Mesh-319"><span class="linenos"> 319</span></a><span class="sd">        field_size : int</span>
</span><span id="Mesh-320"><a href="#Mesh-320"><span class="linenos"> 320</span></a><span class="sd">            Number of degrees of freedom per mesh node (e.g., 3 for 3D displacements).</span>
</span><span id="Mesh-321"><a href="#Mesh-321"><span class="linenos"> 321</span></a>
</span><span id="Mesh-322"><a href="#Mesh-322"><span class="linenos"> 322</span></a><span class="sd">        Returns</span>
</span><span id="Mesh-323"><a href="#Mesh-323"><span class="linenos"> 323</span></a><span class="sd">        -------</span>
</span><span id="Mesh-324"><a href="#Mesh-324"><span class="linenos"> 324</span></a><span class="sd">        np.ndarray</span>
</span><span id="Mesh-325"><a href="#Mesh-325"><span class="linenos"> 325</span></a><span class="sd">            Global gradient vector of size `field_size * nb_unique_nodes`.</span>
</span><span id="Mesh-326"><a href="#Mesh-326"><span class="linenos"> 326</span></a>
</span><span id="Mesh-327"><a href="#Mesh-327"><span class="linenos"> 327</span></a><span class="sd">        Notes</span>
</span><span id="Mesh-328"><a href="#Mesh-328"><span class="linenos"> 328</span></a><span class="sd">        -----</span>
</span><span id="Mesh-329"><a href="#Mesh-329"><span class="linenos"> 329</span></a><span class="sd">        - Uses :meth:`MultiPatchBSplineConnectivity.unique_field_indices` to map</span>
</span><span id="Mesh-330"><a href="#Mesh-330"><span class="linenos"> 330</span></a><span class="sd">        patch-local degrees of freedom to global indices.</span>
</span><span id="Mesh-331"><a href="#Mesh-331"><span class="linenos"> 331</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh-332"><a href="#Mesh-332"><span class="linenos"> 332</span></a>        <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_unique_nodes</span> <span class="o">*</span> <span class="n">field_size</span>
</span><span id="Mesh-333"><a href="#Mesh-333"><span class="linenos"> 333</span></a>        <span class="n">total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">terms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="Mesh-334"><a href="#Mesh-334"><span class="linenos"> 334</span></a>        <span class="n">separated_inds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">unique_field_indices</span><span class="p">(</span>
</span><span id="Mesh-335"><a href="#Mesh-335"><span class="linenos"> 335</span></a>            <span class="p">(</span><span class="n">field_size</span><span class="p">,),</span> <span class="n">representation</span><span class="o">=</span><span class="s2">&quot;separated&quot;</span>
</span><span id="Mesh-336"><a href="#Mesh-336"><span class="linenos"> 336</span></a>        <span class="p">)</span>
</span><span id="Mesh-337"><a href="#Mesh-337"><span class="linenos"> 337</span></a>        <span class="k">for</span> <span class="n">patch</span><span class="p">,</span> <span class="n">term</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">terms</span><span class="p">):</span>
</span><span id="Mesh-338"><a href="#Mesh-338"><span class="linenos"> 338</span></a>            <span class="n">inds</span> <span class="o">=</span> <span class="n">separated_inds</span><span class="p">[</span><span class="n">patch</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</span><span id="Mesh-339"><a href="#Mesh-339"><span class="linenos"> 339</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">total</span><span class="p">,</span> <span class="n">inds</span><span class="p">,</span> <span class="n">term</span><span class="p">)</span>
</span><span id="Mesh-340"><a href="#Mesh-340"><span class="linenos"> 340</span></a>        <span class="k">return</span> <span class="n">total</span>
</span><span id="Mesh-341"><a href="#Mesh-341"><span class="linenos"> 341</span></a>
</span><span id="Mesh-342"><a href="#Mesh-342"><span class="linenos"> 342</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">assemble_hessians</span><span class="p">(</span>
</span><span id="Mesh-343"><a href="#Mesh-343"><span class="linenos"> 343</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">terms</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">sps</span><span class="o">.</span><span class="n">spmatrix</span><span class="p">],</span> <span class="n">field_size</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="Mesh-344"><a href="#Mesh-344"><span class="linenos"> 344</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sps</span><span class="o">.</span><span class="n">spmatrix</span><span class="p">:</span>
</span><span id="Mesh-345"><a href="#Mesh-345"><span class="linenos"> 345</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh-346"><a href="#Mesh-346"><span class="linenos"> 346</span></a><span class="sd">        Assemble patch-wise Hessian matrices into a global sparse Hessian.</span>
</span><span id="Mesh-347"><a href="#Mesh-347"><span class="linenos"> 347</span></a>
</span><span id="Mesh-348"><a href="#Mesh-348"><span class="linenos"> 348</span></a><span class="sd">        Each matrix in `terms` corresponds to the Hessian on a single patch. This</span>
</span><span id="Mesh-349"><a href="#Mesh-349"><span class="linenos"> 349</span></a><span class="sd">        method maps the local patch indices to global unique node indices using the</span>
</span><span id="Mesh-350"><a href="#Mesh-350"><span class="linenos"> 350</span></a><span class="sd">        mesh connectivity and constructs a global COO sparse matrix by summing</span>
</span><span id="Mesh-351"><a href="#Mesh-351"><span class="linenos"> 351</span></a><span class="sd">        overlapping contributions.</span>
</span><span id="Mesh-352"><a href="#Mesh-352"><span class="linenos"> 352</span></a>
</span><span id="Mesh-353"><a href="#Mesh-353"><span class="linenos"> 353</span></a><span class="sd">        Important: Assumes that the degrees of freedom are arranged per field,</span>
</span><span id="Mesh-354"><a href="#Mesh-354"><span class="linenos"> 354</span></a><span class="sd">        i.e., `[x_0, ..., x_n, y_0, ..., y_n, z_0, ..., z_n]`. It does not</span>
</span><span id="Mesh-355"><a href="#Mesh-355"><span class="linenos"> 355</span></a><span class="sd">        work if the DOFs are interleaved as `[x_0, y_0, z_0, x_1, y_1, z_1, ...]`.</span>
</span><span id="Mesh-356"><a href="#Mesh-356"><span class="linenos"> 356</span></a>
</span><span id="Mesh-357"><a href="#Mesh-357"><span class="linenos"> 357</span></a><span class="sd">        Parameters</span>
</span><span id="Mesh-358"><a href="#Mesh-358"><span class="linenos"> 358</span></a><span class="sd">        ----------</span>
</span><span id="Mesh-359"><a href="#Mesh-359"><span class="linenos"> 359</span></a><span class="sd">        terms : list of scipy.sparse.spmatrix</span>
</span><span id="Mesh-360"><a href="#Mesh-360"><span class="linenos"> 360</span></a><span class="sd">            Hessian matrices for each patch, typically in CSR or CSC format.</span>
</span><span id="Mesh-361"><a href="#Mesh-361"><span class="linenos"> 361</span></a><span class="sd">        field_size : int</span>
</span><span id="Mesh-362"><a href="#Mesh-362"><span class="linenos"> 362</span></a><span class="sd">            Number of degrees of freedom per mesh node (e.g., 3 for 3D displacements).</span>
</span><span id="Mesh-363"><a href="#Mesh-363"><span class="linenos"> 363</span></a>
</span><span id="Mesh-364"><a href="#Mesh-364"><span class="linenos"> 364</span></a><span class="sd">        Returns</span>
</span><span id="Mesh-365"><a href="#Mesh-365"><span class="linenos"> 365</span></a><span class="sd">        -------</span>
</span><span id="Mesh-366"><a href="#Mesh-366"><span class="linenos"> 366</span></a><span class="sd">        scipy.sparse.spmatrix</span>
</span><span id="Mesh-367"><a href="#Mesh-367"><span class="linenos"> 367</span></a><span class="sd">            Global sparse Hessian matrix of size `(field_size * nb_unique_nodes, field_size * nb_unique_nodes)`.</span>
</span><span id="Mesh-368"><a href="#Mesh-368"><span class="linenos"> 368</span></a>
</span><span id="Mesh-369"><a href="#Mesh-369"><span class="linenos"> 369</span></a><span class="sd">        Notes</span>
</span><span id="Mesh-370"><a href="#Mesh-370"><span class="linenos"> 370</span></a><span class="sd">        -----</span>
</span><span id="Mesh-371"><a href="#Mesh-371"><span class="linenos"> 371</span></a><span class="sd">        - Uses :meth:`MultiPatchBSplineConnectivity.unique_field_indices` to map</span>
</span><span id="Mesh-372"><a href="#Mesh-372"><span class="linenos"> 372</span></a><span class="sd">        patch-local degrees of freedom to global indices.</span>
</span><span id="Mesh-373"><a href="#Mesh-373"><span class="linenos"> 373</span></a><span class="sd">        - The returned matrix is in COO format, suitable for further assembly or</span>
</span><span id="Mesh-374"><a href="#Mesh-374"><span class="linenos"> 374</span></a><span class="sd">        conversion to CSR/CSC.</span>
</span><span id="Mesh-375"><a href="#Mesh-375"><span class="linenos"> 375</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh-376"><a href="#Mesh-376"><span class="linenos"> 376</span></a>        <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Mesh-377"><a href="#Mesh-377"><span class="linenos"> 377</span></a>        <span class="n">cols</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Mesh-378"><a href="#Mesh-378"><span class="linenos"> 378</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Mesh-379"><a href="#Mesh-379"><span class="linenos"> 379</span></a>        <span class="n">separated_inds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">unique_field_indices</span><span class="p">(</span>
</span><span id="Mesh-380"><a href="#Mesh-380"><span class="linenos"> 380</span></a>            <span class="p">(</span><span class="n">field_size</span><span class="p">,),</span> <span class="n">representation</span><span class="o">=</span><span class="s2">&quot;separated&quot;</span>
</span><span id="Mesh-381"><a href="#Mesh-381"><span class="linenos"> 381</span></a>        <span class="p">)</span>
</span><span id="Mesh-382"><a href="#Mesh-382"><span class="linenos"> 382</span></a>        <span class="k">for</span> <span class="n">patch</span><span class="p">,</span> <span class="n">mat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">terms</span><span class="p">):</span>
</span><span id="Mesh-383"><a href="#Mesh-383"><span class="linenos"> 383</span></a>            <span class="n">inds</span> <span class="o">=</span> <span class="n">separated_inds</span><span class="p">[</span><span class="n">patch</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</span><span id="Mesh-384"><a href="#Mesh-384"><span class="linenos"> 384</span></a>            <span class="n">mat</span> <span class="o">=</span> <span class="n">mat</span><span class="o">.</span><span class="n">tocoo</span><span class="p">()</span>
</span><span id="Mesh-385"><a href="#Mesh-385"><span class="linenos"> 385</span></a>            <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="n">mat</span><span class="o">.</span><span class="n">row</span><span class="p">])</span>
</span><span id="Mesh-386"><a href="#Mesh-386"><span class="linenos"> 386</span></a>            <span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="n">mat</span><span class="o">.</span><span class="n">col</span><span class="p">])</span>
</span><span id="Mesh-387"><a href="#Mesh-387"><span class="linenos"> 387</span></a>            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mat</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span id="Mesh-388"><a href="#Mesh-388"><span class="linenos"> 388</span></a>        <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_unique_nodes</span> <span class="o">*</span> <span class="n">field_size</span>
</span><span id="Mesh-389"><a href="#Mesh-389"><span class="linenos"> 389</span></a>        <span class="k">return</span> <span class="n">sps</span><span class="o">.</span><span class="n">coo_matrix</span><span class="p">(</span>
</span><span id="Mesh-390"><a href="#Mesh-390"><span class="linenos"> 390</span></a>            <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">rows</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">cols</span><span class="p">))),</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
</span><span id="Mesh-391"><a href="#Mesh-391"><span class="linenos"> 391</span></a>        <span class="p">)</span>
</span><span id="Mesh-392"><a href="#Mesh-392"><span class="linenos"> 392</span></a>
</span><span id="Mesh-393"><a href="#Mesh-393"><span class="linenos"> 393</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">extract_border</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Mesh&quot;</span><span class="p">:</span>
</span><span id="Mesh-394"><a href="#Mesh-394"><span class="linenos"> 394</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh-395"><a href="#Mesh-395"><span class="linenos"> 395</span></a><span class="sd">        Extract the exterior boundary mesh from a multi-patch B-spline mesh.</span>
</span><span id="Mesh-396"><a href="#Mesh-396"><span class="linenos"> 396</span></a>
</span><span id="Mesh-397"><a href="#Mesh-397"><span class="linenos"> 397</span></a><span class="sd">        This method identifies the nodes and patches lying on the exterior of the</span>
</span><span id="Mesh-398"><a href="#Mesh-398"><span class="linenos"> 398</span></a><span class="sd">        mesh and constructs a new `Mesh` object representing only these boundary</span>
</span><span id="Mesh-399"><a href="#Mesh-399"><span class="linenos"> 399</span></a><span class="sd">        elements. The reference indices are also updated to correspond to the</span>
</span><span id="Mesh-400"><a href="#Mesh-400"><span class="linenos"> 400</span></a><span class="sd">        subset of unique nodes retained.</span>
</span><span id="Mesh-401"><a href="#Mesh-401"><span class="linenos"> 401</span></a>
</span><span id="Mesh-402"><a href="#Mesh-402"><span class="linenos"> 402</span></a><span class="sd">        Returns</span>
</span><span id="Mesh-403"><a href="#Mesh-403"><span class="linenos"> 403</span></a><span class="sd">        -------</span>
</span><span id="Mesh-404"><a href="#Mesh-404"><span class="linenos"> 404</span></a><span class="sd">        Mesh</span>
</span><span id="Mesh-405"><a href="#Mesh-405"><span class="linenos"> 405</span></a><span class="sd">            A new `Mesh` instance representing the exterior boundaries of the mesh.</span>
</span><span id="Mesh-406"><a href="#Mesh-406"><span class="linenos"> 406</span></a>
</span><span id="Mesh-407"><a href="#Mesh-407"><span class="linenos"> 407</span></a><span class="sd">        Notes</span>
</span><span id="Mesh-408"><a href="#Mesh-408"><span class="linenos"> 408</span></a><span class="sd">        -----</span>
</span><span id="Mesh-409"><a href="#Mesh-409"><span class="linenos"> 409</span></a><span class="sd">        - The `ref_inds` of the returned mesh correspond to the indices of the</span>
</span><span id="Mesh-410"><a href="#Mesh-410"><span class="linenos"> 410</span></a><span class="sd">        original mesh&#39;s unique nodes included in the boundary.</span>
</span><span id="Mesh-411"><a href="#Mesh-411"><span class="linenos"> 411</span></a><span class="sd">        - The global layout of degrees of freedom remains the same as the parent</span>
</span><span id="Mesh-412"><a href="#Mesh-412"><span class="linenos"> 412</span></a><span class="sd">        mesh.</span>
</span><span id="Mesh-413"><a href="#Mesh-413"><span class="linenos"> 413</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh-414"><a href="#Mesh-414"><span class="linenos"> 414</span></a>        <span class="n">border_connectivity</span><span class="p">,</span> <span class="n">border_splines</span><span class="p">,</span> <span class="n">full_to_border</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Mesh-415"><a href="#Mesh-415"><span class="linenos"> 415</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">extract_exterior_borders</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">)</span>
</span><span id="Mesh-416"><a href="#Mesh-416"><span class="linenos"> 416</span></a>        <span class="p">)</span>
</span><span id="Mesh-417"><a href="#Mesh-417"><span class="linenos"> 417</span></a>        <span class="n">border_ctrl_pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_ctrl_pts</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">full_to_border</span><span class="p">]</span>
</span><span id="Mesh-418"><a href="#Mesh-418"><span class="linenos"> 418</span></a>        <span class="n">border_ref_inds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_inds</span><span class="p">[</span><span class="n">full_to_border</span><span class="p">]</span>
</span><span id="Mesh-419"><a href="#Mesh-419"><span class="linenos"> 419</span></a>        <span class="k">return</span> <span class="n">Mesh</span><span class="p">(</span>
</span><span id="Mesh-420"><a href="#Mesh-420"><span class="linenos"> 420</span></a>            <span class="nb">list</span><span class="p">(</span><span class="n">border_splines</span><span class="p">),</span> <span class="n">border_ctrl_pts</span><span class="p">,</span> <span class="n">border_connectivity</span><span class="p">,</span> <span class="n">border_ref_inds</span>
</span><span id="Mesh-421"><a href="#Mesh-421"><span class="linenos"> 421</span></a>        <span class="p">)</span>
</span><span id="Mesh-422"><a href="#Mesh-422"><span class="linenos"> 422</span></a>
</span><span id="Mesh-423"><a href="#Mesh-423"><span class="linenos"> 423</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">subset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patchs_to_keep</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;Mesh&quot;</span><span class="p">:</span>
</span><span id="Mesh-424"><a href="#Mesh-424"><span class="linenos"> 424</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh-425"><a href="#Mesh-425"><span class="linenos"> 425</span></a><span class="sd">        Create a submesh containing only the specified patches.</span>
</span><span id="Mesh-426"><a href="#Mesh-426"><span class="linenos"> 426</span></a>
</span><span id="Mesh-427"><a href="#Mesh-427"><span class="linenos"> 427</span></a><span class="sd">        The method constructs a new `Mesh` object consisting of the patches</span>
</span><span id="Mesh-428"><a href="#Mesh-428"><span class="linenos"> 428</span></a><span class="sd">        indexed by `patchs_to_keep`. The unique control points and reference</span>
</span><span id="Mesh-429"><a href="#Mesh-429"><span class="linenos"> 429</span></a><span class="sd">        indices are reduced accordingly to match the retained patches.</span>
</span><span id="Mesh-430"><a href="#Mesh-430"><span class="linenos"> 430</span></a>
</span><span id="Mesh-431"><a href="#Mesh-431"><span class="linenos"> 431</span></a><span class="sd">        Parameters</span>
</span><span id="Mesh-432"><a href="#Mesh-432"><span class="linenos"> 432</span></a><span class="sd">        ----------</span>
</span><span id="Mesh-433"><a href="#Mesh-433"><span class="linenos"> 433</span></a><span class="sd">        patchs_to_keep : np.ndarray of int</span>
</span><span id="Mesh-434"><a href="#Mesh-434"><span class="linenos"> 434</span></a><span class="sd">            Array of patch indices to retain in the submesh.</span>
</span><span id="Mesh-435"><a href="#Mesh-435"><span class="linenos"> 435</span></a>
</span><span id="Mesh-436"><a href="#Mesh-436"><span class="linenos"> 436</span></a><span class="sd">        Returns</span>
</span><span id="Mesh-437"><a href="#Mesh-437"><span class="linenos"> 437</span></a><span class="sd">        -------</span>
</span><span id="Mesh-438"><a href="#Mesh-438"><span class="linenos"> 438</span></a><span class="sd">        Mesh</span>
</span><span id="Mesh-439"><a href="#Mesh-439"><span class="linenos"> 439</span></a><span class="sd">            A new `Mesh` instance containing only the specified patches and the</span>
</span><span id="Mesh-440"><a href="#Mesh-440"><span class="linenos"> 440</span></a><span class="sd">            associated control points.</span>
</span><span id="Mesh-441"><a href="#Mesh-441"><span class="linenos"> 441</span></a>
</span><span id="Mesh-442"><a href="#Mesh-442"><span class="linenos"> 442</span></a><span class="sd">        Notes</span>
</span><span id="Mesh-443"><a href="#Mesh-443"><span class="linenos"> 443</span></a><span class="sd">        -----</span>
</span><span id="Mesh-444"><a href="#Mesh-444"><span class="linenos"> 444</span></a><span class="sd">        - The `ref_inds` of the returned submesh correspond to the subset of the</span>
</span><span id="Mesh-445"><a href="#Mesh-445"><span class="linenos"> 445</span></a><span class="sd">        original mesh&#39;s reference indices included in the retained patches.</span>
</span><span id="Mesh-446"><a href="#Mesh-446"><span class="linenos"> 446</span></a><span class="sd">        - The global layout of degrees of freedom is preserved.</span>
</span><span id="Mesh-447"><a href="#Mesh-447"><span class="linenos"> 447</span></a><span class="sd">        - Useful for operations on a specific region or cell of a larger multipatch</span>
</span><span id="Mesh-448"><a href="#Mesh-448"><span class="linenos"> 448</span></a><span class="sd">        mesh.</span>
</span><span id="Mesh-449"><a href="#Mesh-449"><span class="linenos"> 449</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh-450"><a href="#Mesh-450"><span class="linenos"> 450</span></a>        <span class="n">splines</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_patchs</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
</span><span id="Mesh-451"><a href="#Mesh-451"><span class="linenos"> 451</span></a>        <span class="n">splines</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span>
</span><span id="Mesh-452"><a href="#Mesh-452"><span class="linenos"> 452</span></a>        <span class="n">subset_connectivity</span><span class="p">,</span> <span class="n">subset_splines</span><span class="p">,</span> <span class="n">full_to_subset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span>
</span><span id="Mesh-453"><a href="#Mesh-453"><span class="linenos"> 453</span></a>            <span class="n">splines</span><span class="p">,</span> <span class="n">patchs_to_keep</span>
</span><span id="Mesh-454"><a href="#Mesh-454"><span class="linenos"> 454</span></a>        <span class="p">)</span>
</span><span id="Mesh-455"><a href="#Mesh-455"><span class="linenos"> 455</span></a>        <span class="n">subset_ctrl_pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_ctrl_pts</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">full_to_subset</span><span class="p">]</span>
</span><span id="Mesh-456"><a href="#Mesh-456"><span class="linenos"> 456</span></a>        <span class="n">subset_ref_inds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_inds</span><span class="p">[</span><span class="n">full_to_subset</span><span class="p">]</span>
</span><span id="Mesh-457"><a href="#Mesh-457"><span class="linenos"> 457</span></a>        <span class="k">return</span> <span class="n">Mesh</span><span class="p">(</span>
</span><span id="Mesh-458"><a href="#Mesh-458"><span class="linenos"> 458</span></a>            <span class="nb">list</span><span class="p">(</span><span class="n">subset_splines</span><span class="p">),</span> <span class="n">subset_ctrl_pts</span><span class="p">,</span> <span class="n">subset_connectivity</span><span class="p">,</span> <span class="n">subset_ref_inds</span>
</span><span id="Mesh-459"><a href="#Mesh-459"><span class="linenos"> 459</span></a>        <span class="p">)</span>
</span><span id="Mesh-460"><a href="#Mesh-460"><span class="linenos"> 460</span></a>
</span><span id="Mesh-461"><a href="#Mesh-461"><span class="linenos"> 461</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">propagate_field</span><span class="p">(</span>
</span><span id="Mesh-462"><a href="#Mesh-462"><span class="linenos"> 462</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Mesh-463"><a href="#Mesh-463"><span class="linenos"> 463</span></a>        <span class="n">field_values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span>
</span><span id="Mesh-464"><a href="#Mesh-464"><span class="linenos"> 464</span></a>        <span class="n">indices</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">],</span>
</span><span id="Mesh-465"><a href="#Mesh-465"><span class="linenos"> 465</span></a>        <span class="n">disable_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Mesh-466"><a href="#Mesh-466"><span class="linenos"> 466</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]:</span>
</span><span id="Mesh-467"><a href="#Mesh-467"><span class="linenos"> 467</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh-468"><a href="#Mesh-468"><span class="linenos"> 468</span></a><span class="sd">        Propagate a field defined on a subset of nodes to the entire mesh using IDW.</span>
</span><span id="Mesh-469"><a href="#Mesh-469"><span class="linenos"> 469</span></a>
</span><span id="Mesh-470"><a href="#Mesh-470"><span class="linenos"> 470</span></a><span class="sd">        This method uses inverse distance weighting (IDW) interpolation to estimate</span>
</span><span id="Mesh-471"><a href="#Mesh-471"><span class="linenos"> 471</span></a><span class="sd">        the values of a field at unknown nodes from known nodes. The known nodes are</span>
</span><span id="Mesh-472"><a href="#Mesh-472"><span class="linenos"> 472</span></a><span class="sd">        specified by `indices` and the field values at those nodes are provided</span>
</span><span id="Mesh-473"><a href="#Mesh-473"><span class="linenos"> 473</span></a><span class="sd">        through `field_values`.</span>
</span><span id="Mesh-474"><a href="#Mesh-474"><span class="linenos"> 474</span></a>
</span><span id="Mesh-475"><a href="#Mesh-475"><span class="linenos"> 475</span></a><span class="sd">        Parameters</span>
</span><span id="Mesh-476"><a href="#Mesh-476"><span class="linenos"> 476</span></a><span class="sd">        ----------</span>
</span><span id="Mesh-477"><a href="#Mesh-477"><span class="linenos"> 477</span></a><span class="sd">        field_values : np.ndarray of float</span>
</span><span id="Mesh-478"><a href="#Mesh-478"><span class="linenos"> 478</span></a><span class="sd">            Field values at known nodes, shape `(dof, n_known)` or `(n_known,)`.</span>
</span><span id="Mesh-479"><a href="#Mesh-479"><span class="linenos"> 479</span></a><span class="sd">            Must be of `float` type for IDW interpolation.</span>
</span><span id="Mesh-480"><a href="#Mesh-480"><span class="linenos"> 480</span></a><span class="sd">        indices : np.ndarray of int</span>
</span><span id="Mesh-481"><a href="#Mesh-481"><span class="linenos"> 481</span></a><span class="sd">            Indices of the known nodes in `self.unique_ctrl_pts`.</span>
</span><span id="Mesh-482"><a href="#Mesh-482"><span class="linenos"> 482</span></a><span class="sd">        disable_parallel : bool, optional</span>
</span><span id="Mesh-483"><a href="#Mesh-483"><span class="linenos"> 483</span></a><span class="sd">            If `True`, disables parallel computation in the IDW interpolation. Default is `False`.</span>
</span><span id="Mesh-484"><a href="#Mesh-484"><span class="linenos"> 484</span></a>
</span><span id="Mesh-485"><a href="#Mesh-485"><span class="linenos"> 485</span></a><span class="sd">        Returns</span>
</span><span id="Mesh-486"><a href="#Mesh-486"><span class="linenos"> 486</span></a><span class="sd">        -------</span>
</span><span id="Mesh-487"><a href="#Mesh-487"><span class="linenos"> 487</span></a><span class="sd">        np.ndarray of float</span>
</span><span id="Mesh-488"><a href="#Mesh-488"><span class="linenos"> 488</span></a><span class="sd">            Field values propagated to all nodes of the mesh, same dtype as input.</span>
</span><span id="Mesh-489"><a href="#Mesh-489"><span class="linenos"> 489</span></a>
</span><span id="Mesh-490"><a href="#Mesh-490"><span class="linenos"> 490</span></a><span class="sd">        Notes</span>
</span><span id="Mesh-491"><a href="#Mesh-491"><span class="linenos"> 491</span></a><span class="sd">        -----</span>
</span><span id="Mesh-492"><a href="#Mesh-492"><span class="linenos"> 492</span></a><span class="sd">        - `self.unique_ctrl_pts` must be float type for IDW to work correctly.</span>
</span><span id="Mesh-493"><a href="#Mesh-493"><span class="linenos"> 493</span></a><span class="sd">        - Interpolation is performed only for nodes not in `indices`; known node values are preserved.</span>
</span><span id="Mesh-494"><a href="#Mesh-494"><span class="linenos"> 494</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh-495"><a href="#Mesh-495"><span class="linenos"> 495</span></a>        <span class="n">shape</span> <span class="o">=</span> <span class="n">field_values</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Mesh-496"><a href="#Mesh-496"><span class="linenos"> 496</span></a>        <span class="n">field_values</span> <span class="o">=</span> <span class="n">field_values</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">shape</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="Mesh-497"><a href="#Mesh-497"><span class="linenos"> 497</span></a>        <span class="n">unknown_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_unique_nodes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;bool&quot;</span><span class="p">)</span>
</span><span id="Mesh-498"><a href="#Mesh-498"><span class="linenos"> 498</span></a>        <span class="n">unknown_mask</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Mesh-499"><a href="#Mesh-499"><span class="linenos"> 499</span></a>        <span class="n">known_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_ctrl_pts</span><span class="p">[:,</span> <span class="n">indices</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
</span><span id="Mesh-500"><a href="#Mesh-500"><span class="linenos"> 500</span></a>        <span class="n">unknown_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_ctrl_pts</span><span class="p">[:,</span> <span class="n">unknown_mask</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
</span><span id="Mesh-501"><a href="#Mesh-501"><span class="linenos"> 501</span></a>        <span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span>
</span><span id="Mesh-502"><a href="#Mesh-502"><span class="linenos"> 502</span></a>            <span class="p">(</span><span class="n">field_values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_unique_nodes</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span>
</span><span id="Mesh-503"><a href="#Mesh-503"><span class="linenos"> 503</span></a>        <span class="p">)</span>
</span><span id="Mesh-504"><a href="#Mesh-504"><span class="linenos"> 504</span></a>        <span class="n">field</span><span class="p">[:,</span> <span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">field_values</span>
</span><span id="Mesh-505"><a href="#Mesh-505"><span class="linenos"> 505</span></a>        <span class="n">field</span><span class="p">[:,</span> <span class="n">unknown_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">treeIDW</span><span class="p">(</span>
</span><span id="Mesh-506"><a href="#Mesh-506"><span class="linenos"> 506</span></a>            <span class="n">known_points</span><span class="p">,</span> <span class="n">field_values</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">unknown_points</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="ow">not</span> <span class="n">disable_parallel</span>
</span><span id="Mesh-507"><a href="#Mesh-507"><span class="linenos"> 507</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span id="Mesh-508"><a href="#Mesh-508"><span class="linenos"> 508</span></a>        <span class="k">return</span> <span class="n">field</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">*</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="Mesh-509"><a href="#Mesh-509"><span class="linenos"> 509</span></a>
</span><span id="Mesh-510"><a href="#Mesh-510"><span class="linenos"> 510</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">propagate_field_from_submesh</span><span class="p">(</span>
</span><span id="Mesh-511"><a href="#Mesh-511"><span class="linenos"> 511</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Mesh-512"><a href="#Mesh-512"><span class="linenos"> 512</span></a>        <span class="n">submesh</span><span class="p">:</span> <span class="s2">&quot;Mesh&quot;</span><span class="p">,</span>
</span><span id="Mesh-513"><a href="#Mesh-513"><span class="linenos"> 513</span></a>        <span class="n">field_values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span>
</span><span id="Mesh-514"><a href="#Mesh-514"><span class="linenos"> 514</span></a>        <span class="n">disable_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Mesh-515"><a href="#Mesh-515"><span class="linenos"> 515</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]:</span>
</span><span id="Mesh-516"><a href="#Mesh-516"><span class="linenos"> 516</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh-517"><a href="#Mesh-517"><span class="linenos"> 517</span></a><span class="sd">        Propagate a field from a submesh to the full mesh using IDW interpolation.</span>
</span><span id="Mesh-518"><a href="#Mesh-518"><span class="linenos"> 518</span></a>
</span><span id="Mesh-519"><a href="#Mesh-519"><span class="linenos"> 519</span></a><span class="sd">        This method first identifies the nodes in the submesh that correspond to the</span>
</span><span id="Mesh-520"><a href="#Mesh-520"><span class="linenos"> 520</span></a><span class="sd">        full mesh, then propagates the field to all nodes of the full mesh using</span>
</span><span id="Mesh-521"><a href="#Mesh-521"><span class="linenos"> 521</span></a><span class="sd">        inverse distance weighting (IDW). The values at known nodes are preserved.</span>
</span><span id="Mesh-522"><a href="#Mesh-522"><span class="linenos"> 522</span></a>
</span><span id="Mesh-523"><a href="#Mesh-523"><span class="linenos"> 523</span></a><span class="sd">        Parameters</span>
</span><span id="Mesh-524"><a href="#Mesh-524"><span class="linenos"> 524</span></a><span class="sd">        ----------</span>
</span><span id="Mesh-525"><a href="#Mesh-525"><span class="linenos"> 525</span></a><span class="sd">        submesh : Mesh</span>
</span><span id="Mesh-526"><a href="#Mesh-526"><span class="linenos"> 526</span></a><span class="sd">            Submesh containing the nodes where the field is defined.</span>
</span><span id="Mesh-527"><a href="#Mesh-527"><span class="linenos"> 527</span></a><span class="sd">        field_values : np.ndarray of float</span>
</span><span id="Mesh-528"><a href="#Mesh-528"><span class="linenos"> 528</span></a><span class="sd">            Field values defined on the submesh nodes. Must be of `float` type for IDW.</span>
</span><span id="Mesh-529"><a href="#Mesh-529"><span class="linenos"> 529</span></a><span class="sd">        disable_parallel : bool, optional</span>
</span><span id="Mesh-530"><a href="#Mesh-530"><span class="linenos"> 530</span></a><span class="sd">            If `True`, disables parallel computation in the IDW interpolation. Default is `False`.</span>
</span><span id="Mesh-531"><a href="#Mesh-531"><span class="linenos"> 531</span></a>
</span><span id="Mesh-532"><a href="#Mesh-532"><span class="linenos"> 532</span></a><span class="sd">        Returns</span>
</span><span id="Mesh-533"><a href="#Mesh-533"><span class="linenos"> 533</span></a><span class="sd">        -------</span>
</span><span id="Mesh-534"><a href="#Mesh-534"><span class="linenos"> 534</span></a><span class="sd">        np.ndarray of float</span>
</span><span id="Mesh-535"><a href="#Mesh-535"><span class="linenos"> 535</span></a><span class="sd">            Field values propagated to all nodes of the full mesh.</span>
</span><span id="Mesh-536"><a href="#Mesh-536"><span class="linenos"> 536</span></a>
</span><span id="Mesh-537"><a href="#Mesh-537"><span class="linenos"> 537</span></a><span class="sd">        Notes</span>
</span><span id="Mesh-538"><a href="#Mesh-538"><span class="linenos"> 538</span></a><span class="sd">        -----</span>
</span><span id="Mesh-539"><a href="#Mesh-539"><span class="linenos"> 539</span></a><span class="sd">        - Both `field_values` and `self.unique_ctrl_pts` must be of float type.</span>
</span><span id="Mesh-540"><a href="#Mesh-540"><span class="linenos"> 540</span></a><span class="sd">        - Interpolation is done only for nodes not in the submesh; known node values are preserved.</span>
</span><span id="Mesh-541"><a href="#Mesh-541"><span class="linenos"> 541</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh-542"><a href="#Mesh-542"><span class="linenos"> 542</span></a>        <span class="n">shape</span> <span class="o">=</span> <span class="n">field_values</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Mesh-543"><a href="#Mesh-543"><span class="linenos"> 543</span></a>        <span class="n">field_values</span> <span class="o">=</span> <span class="n">field_values</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">shape</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="Mesh-544"><a href="#Mesh-544"><span class="linenos"> 544</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">idx_mesh</span><span class="p">,</span> <span class="n">idx_submesh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span>
</span><span id="Mesh-545"><a href="#Mesh-545"><span class="linenos"> 545</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ref_inds</span><span class="p">,</span> <span class="n">submesh</span><span class="o">.</span><span class="n">ref_inds</span><span class="p">,</span> <span class="n">return_indices</span><span class="o">=</span><span class="kc">True</span>
</span><span id="Mesh-546"><a href="#Mesh-546"><span class="linenos"> 546</span></a>        <span class="p">)</span>
</span><span id="Mesh-547"><a href="#Mesh-547"><span class="linenos"> 547</span></a>        <span class="n">field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">propagate_field</span><span class="p">(</span>
</span><span id="Mesh-548"><a href="#Mesh-548"><span class="linenos"> 548</span></a>            <span class="n">field_values</span><span class="p">[:,</span> <span class="n">idx_submesh</span><span class="p">],</span> <span class="n">idx_mesh</span><span class="p">,</span> <span class="n">disable_parallel</span><span class="o">=</span><span class="n">disable_parallel</span>
</span><span id="Mesh-549"><a href="#Mesh-549"><span class="linenos"> 549</span></a>        <span class="p">)</span>
</span><span id="Mesh-550"><a href="#Mesh-550"><span class="linenos"> 550</span></a>        <span class="k">return</span> <span class="n">field</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">*</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="Mesh-551"><a href="#Mesh-551"><span class="linenos"> 551</span></a>
</span><span id="Mesh-552"><a href="#Mesh-552"><span class="linenos"> 552</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_orientation_field</span><span class="p">(</span>
</span><span id="Mesh-553"><a href="#Mesh-553"><span class="linenos"> 553</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Mesh-554"><a href="#Mesh-554"><span class="linenos"> 554</span></a>        <span class="n">n_eval_per_elem</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="Mesh-555"><a href="#Mesh-555"><span class="linenos"> 555</span></a>        <span class="n">XI_list</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Mesh-556"><a href="#Mesh-556"><span class="linenos"> 556</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Mesh-557"><a href="#Mesh-557"><span class="linenos"> 557</span></a>        <span class="n">disable_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Mesh-558"><a href="#Mesh-558"><span class="linenos"> 558</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]]:</span>
</span><span id="Mesh-559"><a href="#Mesh-559"><span class="linenos"> 559</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh-560"><a href="#Mesh-560"><span class="linenos"> 560</span></a><span class="sd">        Compute the orientation field of a 3D multipatch B-spline mesh.</span>
</span><span id="Mesh-561"><a href="#Mesh-561"><span class="linenos"> 561</span></a>
</span><span id="Mesh-562"><a href="#Mesh-562"><span class="linenos"> 562</span></a><span class="sd">        The orientation field is calculated as the scalar triple product of the</span>
</span><span id="Mesh-563"><a href="#Mesh-563"><span class="linenos"> 563</span></a><span class="sd">        local tangent vectors of each element. It indicates the local handedness</span>
</span><span id="Mesh-564"><a href="#Mesh-564"><span class="linenos"> 564</span></a><span class="sd">        of the mesh elements (positive for right-handed orientation, negative for left-handed).</span>
</span><span id="Mesh-565"><a href="#Mesh-565"><span class="linenos"> 565</span></a>
</span><span id="Mesh-566"><a href="#Mesh-566"><span class="linenos"> 566</span></a><span class="sd">        Parameters</span>
</span><span id="Mesh-567"><a href="#Mesh-567"><span class="linenos"> 567</span></a><span class="sd">        ----------</span>
</span><span id="Mesh-568"><a href="#Mesh-568"><span class="linenos"> 568</span></a><span class="sd">        n_eval_per_elem : int, optional</span>
</span><span id="Mesh-569"><a href="#Mesh-569"><span class="linenos"> 569</span></a><span class="sd">            Number of evaluation points per element along each parametric direction.</span>
</span><span id="Mesh-570"><a href="#Mesh-570"><span class="linenos"> 570</span></a><span class="sd">            Default is `5`.</span>
</span><span id="Mesh-571"><a href="#Mesh-571"><span class="linenos"> 571</span></a><span class="sd">        XI_list : iterable of tuple of np.ndarray, optional</span>
</span><span id="Mesh-572"><a href="#Mesh-572"><span class="linenos"> 572</span></a><span class="sd">            Predefined parametric coordinates for each patch. If `None`, a regular grid</span>
</span><span id="Mesh-573"><a href="#Mesh-573"><span class="linenos"> 573</span></a><span class="sd">            is generated using `n_eval_per_elem`.</span>
</span><span id="Mesh-574"><a href="#Mesh-574"><span class="linenos"> 574</span></a><span class="sd">        verbose : bool, optional</span>
</span><span id="Mesh-575"><a href="#Mesh-575"><span class="linenos"> 575</span></a><span class="sd">            If `True`, prints progress messages. Default is `True`.</span>
</span><span id="Mesh-576"><a href="#Mesh-576"><span class="linenos"> 576</span></a><span class="sd">        disable_parallel : bool, optional</span>
</span><span id="Mesh-577"><a href="#Mesh-577"><span class="linenos"> 577</span></a><span class="sd">            If `True`, disables parallel computation. Default is `False`.</span>
</span><span id="Mesh-578"><a href="#Mesh-578"><span class="linenos"> 578</span></a>
</span><span id="Mesh-579"><a href="#Mesh-579"><span class="linenos"> 579</span></a><span class="sd">        Returns</span>
</span><span id="Mesh-580"><a href="#Mesh-580"><span class="linenos"> 580</span></a><span class="sd">        -------</span>
</span><span id="Mesh-581"><a href="#Mesh-581"><span class="linenos"> 581</span></a><span class="sd">        list of np.ndarray of float</span>
</span><span id="Mesh-582"><a href="#Mesh-582"><span class="linenos"> 582</span></a><span class="sd">            A `list` (one entry per patch) containing the orientation scalar field</span>
</span><span id="Mesh-583"><a href="#Mesh-583"><span class="linenos"> 583</span></a><span class="sd">            for at each evaluation point.</span>
</span><span id="Mesh-584"><a href="#Mesh-584"><span class="linenos"> 584</span></a>
</span><span id="Mesh-585"><a href="#Mesh-585"><span class="linenos"> 585</span></a><span class="sd">        Notes</span>
</span><span id="Mesh-586"><a href="#Mesh-586"><span class="linenos"> 586</span></a><span class="sd">        -----</span>
</span><span id="Mesh-587"><a href="#Mesh-587"><span class="linenos"> 587</span></a><span class="sd">        - Only implemented for 3D meshes (`self.connectivity.npa == 3`).</span>
</span><span id="Mesh-588"><a href="#Mesh-588"><span class="linenos"> 588</span></a><span class="sd">        - Uses parallel evaluation via `parallel_blocks`.</span>
</span><span id="Mesh-589"><a href="#Mesh-589"><span class="linenos"> 589</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh-590"><a href="#Mesh-590"><span class="linenos"> 590</span></a>
</span><span id="Mesh-591"><a href="#Mesh-591"><span class="linenos"> 591</span></a>        <span class="k">assert</span> <span class="p">(</span>
</span><span id="Mesh-592"><a href="#Mesh-592"><span class="linenos"> 592</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">npa</span> <span class="o">==</span> <span class="mi">3</span>
</span><span id="Mesh-593"><a href="#Mesh-593"><span class="linenos"> 593</span></a>        <span class="p">),</span> <span class="s2">&quot;Orientation field is only implemented for 3D meshes.&quot;</span>
</span><span id="Mesh-594"><a href="#Mesh-594"><span class="linenos"> 594</span></a>
</span><span id="Mesh-595"><a href="#Mesh-595"><span class="linenos"> 595</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">fct_elem</span><span class="p">(</span><span class="n">spline</span><span class="p">,</span> <span class="n">ctrl_pts</span><span class="p">,</span> <span class="n">XI</span><span class="p">):</span>
</span><span id="Mesh-596"><a href="#Mesh-596"><span class="linenos"> 596</span></a>            <span class="n">ds_dxi</span><span class="p">,</span> <span class="n">ds_deta</span><span class="p">,</span> <span class="n">ds_dzeta</span> <span class="o">=</span> <span class="n">spline</span><span class="p">(</span><span class="n">ctrl_pts</span><span class="p">,</span> <span class="n">XI</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Mesh-597"><a href="#Mesh-597"><span class="linenos"> 597</span></a>            <span class="n">cross_prod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">ds_dxi</span><span class="p">,</span> <span class="n">ds_deta</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Mesh-598"><a href="#Mesh-598"><span class="linenos"> 598</span></a>            <span class="n">mixt_prod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cross_prod</span> <span class="o">*</span> <span class="n">ds_dzeta</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Mesh-599"><a href="#Mesh-599"><span class="linenos"> 599</span></a>            <span class="k">return</span> <span class="n">mixt_prod</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="Mesh-600"><a href="#Mesh-600"><span class="linenos"> 600</span></a>
</span><span id="Mesh-601"><a href="#Mesh-601"><span class="linenos"> 601</span></a>        <span class="k">if</span> <span class="n">XI_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Mesh-602"><a href="#Mesh-602"><span class="linenos"> 602</span></a>            <span class="n">XI_list</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Mesh-603"><a href="#Mesh-603"><span class="linenos"> 603</span></a>                <span class="n">s</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">n_eval_per_elem</span><span class="o">=</span><span class="n">n_eval_per_elem</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span>
</span><span id="Mesh-604"><a href="#Mesh-604"><span class="linenos"> 604</span></a>            <span class="p">]</span>
</span><span id="Mesh-605"><a href="#Mesh-605"><span class="linenos"> 605</span></a>
</span><span id="Mesh-606"><a href="#Mesh-606"><span class="linenos"> 606</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_separated_ctrl_pts</span><span class="p">(),</span> <span class="n">XI_list</span><span class="p">))</span>
</span><span id="Mesh-607"><a href="#Mesh-607"><span class="linenos"> 607</span></a>
</span><span id="Mesh-608"><a href="#Mesh-608"><span class="linenos"> 608</span></a>        <span class="n">orientation_field</span> <span class="o">=</span> <span class="n">parallel_blocks</span><span class="p">(</span>
</span><span id="Mesh-609"><a href="#Mesh-609"><span class="linenos"> 609</span></a>            <span class="n">fct_elem</span><span class="p">,</span>
</span><span id="Mesh-610"><a href="#Mesh-610"><span class="linenos"> 610</span></a>            <span class="n">args</span><span class="p">,</span>
</span><span id="Mesh-611"><a href="#Mesh-611"><span class="linenos"> 611</span></a>            <span class="n">pbar_title</span><span class="o">=</span><span class="s2">&quot;Computing orientation field&quot;</span><span class="p">,</span>
</span><span id="Mesh-612"><a href="#Mesh-612"><span class="linenos"> 612</span></a>            <span class="n">disable_parallel</span><span class="o">=</span><span class="n">disable_parallel</span><span class="p">,</span>
</span><span id="Mesh-613"><a href="#Mesh-613"><span class="linenos"> 613</span></a>            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
</span><span id="Mesh-614"><a href="#Mesh-614"><span class="linenos"> 614</span></a>        <span class="p">)</span>
</span><span id="Mesh-615"><a href="#Mesh-615"><span class="linenos"> 615</span></a>
</span><span id="Mesh-616"><a href="#Mesh-616"><span class="linenos"> 616</span></a>        <span class="k">return</span> <span class="n">orientation_field</span>
</span><span id="Mesh-617"><a href="#Mesh-617"><span class="linenos"> 617</span></a>
</span><span id="Mesh-618"><a href="#Mesh-618"><span class="linenos"> 618</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">correct_orientation</span><span class="p">(</span>
</span><span id="Mesh-619"><a href="#Mesh-619"><span class="linenos"> 619</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Mesh-620"><a href="#Mesh-620"><span class="linenos"> 620</span></a>        <span class="n">separated_fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="Mesh-621"><a href="#Mesh-621"><span class="linenos"> 621</span></a>        <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="Mesh-622"><a href="#Mesh-622"><span class="linenos"> 622</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Mesh-623"><a href="#Mesh-623"><span class="linenos"> 623</span></a>        <span class="n">disable_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Mesh-624"><a href="#Mesh-624"><span class="linenos"> 624</span></a>    <span class="p">):</span>
</span><span id="Mesh-625"><a href="#Mesh-625"><span class="linenos"> 625</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh-626"><a href="#Mesh-626"><span class="linenos"> 626</span></a><span class="sd">        Ensure consistent orientation of all patches in a 3D multipatch B-spline mesh.</span>
</span><span id="Mesh-627"><a href="#Mesh-627"><span class="linenos"> 627</span></a>
</span><span id="Mesh-628"><a href="#Mesh-628"><span class="linenos"> 628</span></a><span class="sd">        This method detects and corrects inverted patch orientations by evaluating</span>
</span><span id="Mesh-629"><a href="#Mesh-629"><span class="linenos"> 629</span></a><span class="sd">        the integrated orientation field over each patch. Patches with a negative</span>
</span><span id="Mesh-630"><a href="#Mesh-630"><span class="linenos"> 630</span></a><span class="sd">        signed orientation are flipped along the specified parametric axis.</span>
</span><span id="Mesh-631"><a href="#Mesh-631"><span class="linenos"> 631</span></a>
</span><span id="Mesh-632"><a href="#Mesh-632"><span class="linenos"> 632</span></a><span class="sd">        The orientation of each patch is assessed by integrating the scalar triple</span>
</span><span id="Mesh-633"><a href="#Mesh-633"><span class="linenos"> 633</span></a><span class="sd">        product of the parametric tangent vectors using Gauss-Legendre quadrature.</span>
</span><span id="Mesh-634"><a href="#Mesh-634"><span class="linenos"> 634</span></a><span class="sd">        A negative integral indicates an inverted (left-handed) parametrization.</span>
</span><span id="Mesh-635"><a href="#Mesh-635"><span class="linenos"> 635</span></a>
</span><span id="Mesh-636"><a href="#Mesh-636"><span class="linenos"> 636</span></a><span class="sd">        Parameters</span>
</span><span id="Mesh-637"><a href="#Mesh-637"><span class="linenos"> 637</span></a><span class="sd">        ----------</span>
</span><span id="Mesh-638"><a href="#Mesh-638"><span class="linenos"> 638</span></a><span class="sd">        separated_fields : list, optional</span>
</span><span id="Mesh-639"><a href="#Mesh-639"><span class="linenos"> 639</span></a><span class="sd">            List of fields defined in separated (per-patch) representation that must</span>
</span><span id="Mesh-640"><a href="#Mesh-640"><span class="linenos"> 640</span></a><span class="sd">            be flipped consistently with the control points. Each entry is modified</span>
</span><span id="Mesh-641"><a href="#Mesh-641"><span class="linenos"> 641</span></a><span class="sd">            before returning it. Default is an empty list.</span>
</span><span id="Mesh-642"><a href="#Mesh-642"><span class="linenos"> 642</span></a><span class="sd">        axis : int, optional</span>
</span><span id="Mesh-643"><a href="#Mesh-643"><span class="linenos"> 643</span></a><span class="sd">            Parametric axis along which inverted patches are flipped</span>
</span><span id="Mesh-644"><a href="#Mesh-644"><span class="linenos"> 644</span></a><span class="sd">            (`0 -&gt; xi`, `1 -&gt; eta`, `2 -&gt; zeta`). Default is `2`.</span>
</span><span id="Mesh-645"><a href="#Mesh-645"><span class="linenos"> 645</span></a><span class="sd">        verbose : bool, optional</span>
</span><span id="Mesh-646"><a href="#Mesh-646"><span class="linenos"> 646</span></a><span class="sd">            If `True`, prints diagnostic information, including the number of flipped</span>
</span><span id="Mesh-647"><a href="#Mesh-647"><span class="linenos"> 647</span></a><span class="sd">            patches. Default is `True`.</span>
</span><span id="Mesh-648"><a href="#Mesh-648"><span class="linenos"> 648</span></a><span class="sd">        disable_parallel : bool, optional</span>
</span><span id="Mesh-649"><a href="#Mesh-649"><span class="linenos"> 649</span></a><span class="sd">            If `True`, disables parallel computation. Default is `False`.</span>
</span><span id="Mesh-650"><a href="#Mesh-650"><span class="linenos"> 650</span></a>
</span><span id="Mesh-651"><a href="#Mesh-651"><span class="linenos"> 651</span></a><span class="sd">        Returns</span>
</span><span id="Mesh-652"><a href="#Mesh-652"><span class="linenos"> 652</span></a><span class="sd">        -------</span>
</span><span id="Mesh-653"><a href="#Mesh-653"><span class="linenos"> 653</span></a><span class="sd">        list</span>
</span><span id="Mesh-654"><a href="#Mesh-654"><span class="linenos"> 654</span></a><span class="sd">            Flipped version, consistently with the control points, of `separated_fields`.</span>
</span><span id="Mesh-655"><a href="#Mesh-655"><span class="linenos"> 655</span></a>
</span><span id="Mesh-656"><a href="#Mesh-656"><span class="linenos"> 656</span></a><span class="sd">        Notes</span>
</span><span id="Mesh-657"><a href="#Mesh-657"><span class="linenos"> 657</span></a><span class="sd">        -----</span>
</span><span id="Mesh-658"><a href="#Mesh-658"><span class="linenos"> 658</span></a><span class="sd">        - Only applicable to 3D meshes (`self.connectivity.npa == 3`).</span>
</span><span id="Mesh-659"><a href="#Mesh-659"><span class="linenos"> 659</span></a><span class="sd">        - Patch orientation is determined by integrating the orientation field</span>
</span><span id="Mesh-660"><a href="#Mesh-660"><span class="linenos"> 660</span></a><span class="sd">          returned by :meth:`get_orientation_field`.</span>
</span><span id="Mesh-661"><a href="#Mesh-661"><span class="linenos"> 661</span></a><span class="sd">        - Flipping a patch involves:</span>
</span><span id="Mesh-662"><a href="#Mesh-662"><span class="linenos"> 662</span></a><span class="sd">            * Reversing the knot vector of the selected parametric axis.</span>
</span><span id="Mesh-663"><a href="#Mesh-663"><span class="linenos"> 663</span></a><span class="sd">            * Reversing the corresponding axis of the separated control points.</span>
</span><span id="Mesh-664"><a href="#Mesh-664"><span class="linenos"> 664</span></a><span class="sd">            * Reversing the same axis for all fields listed in `separated_fields`.</span>
</span><span id="Mesh-665"><a href="#Mesh-665"><span class="linenos"> 665</span></a><span class="sd">        - The mesh connectivity (`unique_nodes_inds`) and `unique_ctrl_pts` are</span>
</span><span id="Mesh-666"><a href="#Mesh-666"><span class="linenos"> 666</span></a><span class="sd">          modified to reflect the updated orientation.</span>
</span><span id="Mesh-667"><a href="#Mesh-667"><span class="linenos"> 667</span></a><span class="sd">        - This operation modifies the mesh in place.</span>
</span><span id="Mesh-668"><a href="#Mesh-668"><span class="linenos"> 668</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh-669"><a href="#Mesh-669"><span class="linenos"> 669</span></a>        <span class="n">nb_gauss</span> <span class="o">=</span> <span class="p">[[(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">getDegrees</span><span class="p">()]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">]</span>
</span><span id="Mesh-670"><a href="#Mesh-670"><span class="linenos"> 670</span></a>        <span class="n">XI_dXI_list</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Mesh-671"><a href="#Mesh-671"><span class="linenos"> 671</span></a>            <span class="n">s</span><span class="o">.</span><span class="n">gauss_legendre_for_integration</span><span class="p">(</span><span class="n">n_eval_per_elem</span><span class="o">=</span><span class="n">ng</span><span class="p">)</span>
</span><span id="Mesh-672"><a href="#Mesh-672"><span class="linenos"> 672</span></a>            <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">ng</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">,</span> <span class="n">nb_gauss</span><span class="p">)</span>
</span><span id="Mesh-673"><a href="#Mesh-673"><span class="linenos"> 673</span></a>        <span class="p">]</span>
</span><span id="Mesh-674"><a href="#Mesh-674"><span class="linenos"> 674</span></a>        <span class="n">XI_list</span><span class="p">,</span> <span class="n">dXI_list</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">XI_dXI_list</span><span class="p">)</span>
</span><span id="Mesh-675"><a href="#Mesh-675"><span class="linenos"> 675</span></a>        <span class="n">orientation_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_orientation_field</span><span class="p">(</span>
</span><span id="Mesh-676"><a href="#Mesh-676"><span class="linenos"> 676</span></a>            <span class="n">XI_list</span><span class="o">=</span><span class="n">XI_list</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">disable_parallel</span><span class="o">=</span><span class="n">disable_parallel</span>
</span><span id="Mesh-677"><a href="#Mesh-677"><span class="linenos"> 677</span></a>        <span class="p">)</span>
</span><span id="Mesh-678"><a href="#Mesh-678"><span class="linenos"> 678</span></a>        <span class="n">patchs_orientation</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Mesh-679"><a href="#Mesh-679"><span class="linenos"> 679</span></a>        <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">dxi</span><span class="p">,</span> <span class="n">deta</span><span class="p">,</span> <span class="n">dzeta</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">orientation_field</span><span class="p">,</span> <span class="n">dXI_list</span><span class="p">):</span>
</span><span id="Mesh-680"><a href="#Mesh-680"><span class="linenos"> 680</span></a>            <span class="n">dXI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">dxi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">deta</span><span class="p">,</span> <span class="n">dzeta</span><span class="p">))</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</span><span id="Mesh-681"><a href="#Mesh-681"><span class="linenos"> 681</span></a>            <span class="n">patchs_orientation</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="o">@</span> <span class="n">dXI</span><span class="p">)</span>
</span><span id="Mesh-682"><a href="#Mesh-682"><span class="linenos"> 682</span></a>        <span class="n">patchs_to_flip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">patchs_orientation</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Mesh-683"><a href="#Mesh-683"><span class="linenos"> 683</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Mesh-684"><a href="#Mesh-684"><span class="linenos"> 684</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Mesh-685"><a href="#Mesh-685"><span class="linenos"> 685</span></a>                <span class="sa">f</span><span class="s2">&quot;Flipping </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">patchs_to_flip</span><span class="p">)</span><span class="si">}</span><span class="s2"> out of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_patchs</span><span class="si">}</span><span class="s2"> patchs.&quot;</span>
</span><span id="Mesh-686"><a href="#Mesh-686"><span class="linenos"> 686</span></a>            <span class="p">)</span>
</span><span id="Mesh-687"><a href="#Mesh-687"><span class="linenos"> 687</span></a>        <span class="n">separated_ctrl_pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_separated_ctrl_pts</span><span class="p">()</span>
</span><span id="Mesh-688"><a href="#Mesh-688"><span class="linenos"> 688</span></a>        <span class="n">inds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">unique_field_indices</span><span class="p">(())</span>
</span><span id="Mesh-689"><a href="#Mesh-689"><span class="linenos"> 689</span></a>        <span class="n">flip</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="Mesh-690"><a href="#Mesh-690"><span class="linenos"> 690</span></a>            <span class="p">[</span><span class="o">...</span><span class="p">]</span>
</span><span id="Mesh-691"><a href="#Mesh-691"><span class="linenos"> 691</span></a>            <span class="o">+</span> <span class="p">[</span>
</span><span id="Mesh-692"><a href="#Mesh-692"><span class="linenos"> 692</span></a>                <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="n">axis</span> <span class="k">else</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Mesh-693"><a href="#Mesh-693"><span class="linenos"> 693</span></a>                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">npa</span><span class="p">)</span>
</span><span id="Mesh-694"><a href="#Mesh-694"><span class="linenos"> 694</span></a>            <span class="p">]</span>
</span><span id="Mesh-695"><a href="#Mesh-695"><span class="linenos"> 695</span></a>        <span class="p">)</span>
</span><span id="Mesh-696"><a href="#Mesh-696"><span class="linenos"> 696</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">patchs_to_flip</span><span class="p">:</span>
</span><span id="Mesh-697"><a href="#Mesh-697"><span class="linenos"> 697</span></a>            <span class="n">axis_basis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">bases</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span>
</span><span id="Mesh-698"><a href="#Mesh-698"><span class="linenos"> 698</span></a>            <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">axis_basis</span><span class="o">.</span><span class="n">span</span>
</span><span id="Mesh-699"><a href="#Mesh-699"><span class="linenos"> 699</span></a>            <span class="n">axis_basis</span><span class="o">.</span><span class="n">knot</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="n">axis_basis</span><span class="o">.</span><span class="n">knot</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Mesh-700"><a href="#Mesh-700"><span class="linenos"> 700</span></a>            <span class="n">separated_ctrl_pts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">separated_ctrl_pts</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">flip</span><span class="p">]</span>
</span><span id="Mesh-701"><a href="#Mesh-701"><span class="linenos"> 701</span></a>            <span class="n">inds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">inds</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">flip</span><span class="p">]</span>
</span><span id="Mesh-702"><a href="#Mesh-702"><span class="linenos"> 702</span></a>            <span class="k">for</span> <span class="n">separated_field</span> <span class="ow">in</span> <span class="n">separated_fields</span><span class="p">:</span>
</span><span id="Mesh-703"><a href="#Mesh-703"><span class="linenos"> 703</span></a>                <span class="n">separated_field</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">separated_field</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">flip</span><span class="p">]</span>
</span><span id="Mesh-704"><a href="#Mesh-704"><span class="linenos"> 704</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">unique_nodes_inds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">agglomerate</span><span class="p">(</span><span class="n">inds</span><span class="p">)</span>
</span><span id="Mesh-705"><a href="#Mesh-705"><span class="linenos"> 705</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">unique_ctrl_pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">separated_to_unique</span><span class="p">(</span><span class="n">separated_ctrl_pts</span><span class="p">)</span>
</span><span id="Mesh-706"><a href="#Mesh-706"><span class="linenos"> 706</span></a>
</span><span id="Mesh-707"><a href="#Mesh-707"><span class="linenos"> 707</span></a>        <span class="k">return</span> <span class="n">separated_fields</span>
</span><span id="Mesh-708"><a href="#Mesh-708"><span class="linenos"> 708</span></a>
</span><span id="Mesh-709"><a href="#Mesh-709"><span class="linenos"> 709</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_orientation</span><span class="p">(</span>
</span><span id="Mesh-710"><a href="#Mesh-710"><span class="linenos"> 710</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Mesh-711"><a href="#Mesh-711"><span class="linenos"> 711</span></a>        <span class="n">n_eval_per_elem</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="Mesh-712"><a href="#Mesh-712"><span class="linenos"> 712</span></a>        <span class="n">XI_list</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Mesh-713"><a href="#Mesh-713"><span class="linenos"> 713</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Mesh-714"><a href="#Mesh-714"><span class="linenos"> 714</span></a>        <span class="n">disable_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Mesh-715"><a href="#Mesh-715"><span class="linenos"> 715</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="Mesh-716"><a href="#Mesh-716"><span class="linenos"> 716</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">:</span>
</span><span id="Mesh-717"><a href="#Mesh-717"><span class="linenos"> 717</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh-718"><a href="#Mesh-718"><span class="linenos"> 718</span></a><span class="sd">        Visualize the orientation (handedness) of the mesh elements.</span>
</span><span id="Mesh-719"><a href="#Mesh-719"><span class="linenos"> 719</span></a>
</span><span id="Mesh-720"><a href="#Mesh-720"><span class="linenos"> 720</span></a><span class="sd">        This method computes the orientation field of the mesh and visualizes it</span>
</span><span id="Mesh-721"><a href="#Mesh-721"><span class="linenos"> 721</span></a><span class="sd">        as a boolean field indicating whether each evaluation point corresponds</span>
</span><span id="Mesh-722"><a href="#Mesh-722"><span class="linenos"> 722</span></a><span class="sd">        to a right-handed (`True`) or left-handed (`False`) parametrization.</span>
</span><span id="Mesh-723"><a href="#Mesh-723"><span class="linenos"> 723</span></a>
</span><span id="Mesh-724"><a href="#Mesh-724"><span class="linenos"> 724</span></a><span class="sd">        Internally, the orientation field is evaluated using</span>
</span><span id="Mesh-725"><a href="#Mesh-725"><span class="linenos"> 725</span></a><span class="sd">        :meth:`get_orientation_field`, then thresholded as</span>
</span><span id="Mesh-726"><a href="#Mesh-726"><span class="linenos"> 726</span></a><span class="sd">        `orientation &gt; 0` and reshaped to comply with plotting requirements.</span>
</span><span id="Mesh-727"><a href="#Mesh-727"><span class="linenos"> 727</span></a>
</span><span id="Mesh-728"><a href="#Mesh-728"><span class="linenos"> 728</span></a><span class="sd">        Parameters</span>
</span><span id="Mesh-729"><a href="#Mesh-729"><span class="linenos"> 729</span></a><span class="sd">        ----------</span>
</span><span id="Mesh-730"><a href="#Mesh-730"><span class="linenos"> 730</span></a><span class="sd">        n_eval_per_elem : int or iterable of int, optional</span>
</span><span id="Mesh-731"><a href="#Mesh-731"><span class="linenos"> 731</span></a><span class="sd">            Number of evaluation points per element along each parametric direction.</span>
</span><span id="Mesh-732"><a href="#Mesh-732"><span class="linenos"> 732</span></a><span class="sd">            If an iterable is provided, it must match the parametric dimension.</span>
</span><span id="Mesh-733"><a href="#Mesh-733"><span class="linenos"> 733</span></a><span class="sd">            Default is `5`.</span>
</span><span id="Mesh-734"><a href="#Mesh-734"><span class="linenos"> 734</span></a><span class="sd">        XI_list : iterable of tuple of ndarray, optional</span>
</span><span id="Mesh-735"><a href="#Mesh-735"><span class="linenos"> 735</span></a><span class="sd">            Parametric coordinates at which the orientation field is evaluated,</span>
</span><span id="Mesh-736"><a href="#Mesh-736"><span class="linenos"> 736</span></a><span class="sd">            one entry per patch. If `None` (default), a uniform sampling is used</span>
</span><span id="Mesh-737"><a href="#Mesh-737"><span class="linenos"> 737</span></a><span class="sd">            for each patch.</span>
</span><span id="Mesh-738"><a href="#Mesh-738"><span class="linenos"> 738</span></a><span class="sd">        verbose : bool, optional</span>
</span><span id="Mesh-739"><a href="#Mesh-739"><span class="linenos"> 739</span></a><span class="sd">            If `True`, displays progress information. Default is `True`.</span>
</span><span id="Mesh-740"><a href="#Mesh-740"><span class="linenos"> 740</span></a><span class="sd">        disable_parallel : bool, optional</span>
</span><span id="Mesh-741"><a href="#Mesh-741"><span class="linenos"> 741</span></a><span class="sd">            If `True`, disables parallel computation. Default is `False`.</span>
</span><span id="Mesh-742"><a href="#Mesh-742"><span class="linenos"> 742</span></a><span class="sd">        **kwargs : dict, optional</span>
</span><span id="Mesh-743"><a href="#Mesh-743"><span class="linenos"> 743</span></a><span class="sd">            Additional keyword arguments forwarded to :meth:`Mesh.plot`, such as</span>
</span><span id="Mesh-744"><a href="#Mesh-744"><span class="linenos"> 744</span></a><span class="sd">            `cmap`, `scalar_bar_args`, `show_scalar_bar`, etc.</span>
</span><span id="Mesh-745"><a href="#Mesh-745"><span class="linenos"> 745</span></a>
</span><span id="Mesh-746"><a href="#Mesh-746"><span class="linenos"> 746</span></a><span class="sd">        Returns</span>
</span><span id="Mesh-747"><a href="#Mesh-747"><span class="linenos"> 747</span></a><span class="sd">        -------</span>
</span><span id="Mesh-748"><a href="#Mesh-748"><span class="linenos"> 748</span></a><span class="sd">        pv.Plotter</span>
</span><span id="Mesh-749"><a href="#Mesh-749"><span class="linenos"> 749</span></a><span class="sd">            The PyVista plotter object used for visualization.</span>
</span><span id="Mesh-750"><a href="#Mesh-750"><span class="linenos"> 750</span></a>
</span><span id="Mesh-751"><a href="#Mesh-751"><span class="linenos"> 751</span></a><span class="sd">        Notes</span>
</span><span id="Mesh-752"><a href="#Mesh-752"><span class="linenos"> 752</span></a><span class="sd">        -----</span>
</span><span id="Mesh-753"><a href="#Mesh-753"><span class="linenos"> 753</span></a><span class="sd">        - The orientation field is visualized as a boolean scalar field, where</span>
</span><span id="Mesh-754"><a href="#Mesh-754"><span class="linenos"> 754</span></a><span class="sd">          `True` indicates a right-handed parametrization and `False` a</span>
</span><span id="Mesh-755"><a href="#Mesh-755"><span class="linenos"> 755</span></a><span class="sd">          left-handed one.</span>
</span><span id="Mesh-756"><a href="#Mesh-756"><span class="linenos"> 756</span></a><span class="sd">        - The default colormap uses red for left-handed and green for right-handed</span>
</span><span id="Mesh-757"><a href="#Mesh-757"><span class="linenos"> 757</span></a><span class="sd">          orientations.</span>
</span><span id="Mesh-758"><a href="#Mesh-758"><span class="linenos"> 758</span></a><span class="sd">        - This method is intended as a diagnostic tool, typically used before or</span>
</span><span id="Mesh-759"><a href="#Mesh-759"><span class="linenos"> 759</span></a><span class="sd">          after calling :meth:`correct_orientation`.</span>
</span><span id="Mesh-760"><a href="#Mesh-760"><span class="linenos"> 760</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh-761"><a href="#Mesh-761"><span class="linenos"> 761</span></a>        <span class="n">separated_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_orientation_field</span><span class="p">(</span>
</span><span id="Mesh-762"><a href="#Mesh-762"><span class="linenos"> 762</span></a>            <span class="n">n_eval_per_elem</span><span class="o">=</span><span class="n">n_eval_per_elem</span><span class="p">,</span>
</span><span id="Mesh-763"><a href="#Mesh-763"><span class="linenos"> 763</span></a>            <span class="n">XI_list</span><span class="o">=</span><span class="n">XI_list</span><span class="p">,</span>
</span><span id="Mesh-764"><a href="#Mesh-764"><span class="linenos"> 764</span></a>            <span class="n">disable_parallel</span><span class="o">=</span><span class="n">disable_parallel</span><span class="p">,</span>
</span><span id="Mesh-765"><a href="#Mesh-765"><span class="linenos"> 765</span></a>            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
</span><span id="Mesh-766"><a href="#Mesh-766"><span class="linenos"> 766</span></a>        <span class="p">)</span>
</span><span id="Mesh-767"><a href="#Mesh-767"><span class="linenos"> 767</span></a>        <span class="n">separated_field</span> <span class="o">=</span> <span class="p">[</span><span class="n">field</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">separated_field</span><span class="p">]</span>
</span><span id="Mesh-768"><a href="#Mesh-768"><span class="linenos"> 768</span></a>
</span><span id="Mesh-769"><a href="#Mesh-769"><span class="linenos"> 769</span></a>        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;cmap&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;#ff0000&quot;</span><span class="p">,</span> <span class="s2">&quot;#00ff00&quot;</span><span class="p">])</span>
</span><span id="Mesh-770"><a href="#Mesh-770"><span class="linenos"> 770</span></a>        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;show_scalar_bar&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="Mesh-771"><a href="#Mesh-771"><span class="linenos"> 771</span></a>        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;annotations&quot;</span><span class="p">,</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;False&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;True&quot;</span><span class="p">})</span>
</span><span id="Mesh-772"><a href="#Mesh-772"><span class="linenos"> 772</span></a>        <span class="n">scalar_bar_args</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;scalar_bar_args&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="Mesh-773"><a href="#Mesh-773"><span class="linenos"> 773</span></a>        <span class="n">scalar_bar_args</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;Is Right Handed&quot;</span><span class="p">)</span>
</span><span id="Mesh-774"><a href="#Mesh-774"><span class="linenos"> 774</span></a>        <span class="n">scalar_bar_args</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;n_labels&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Mesh-775"><a href="#Mesh-775"><span class="linenos"> 775</span></a>        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;scalar_bar_args&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scalar_bar_args</span>
</span><span id="Mesh-776"><a href="#Mesh-776"><span class="linenos"> 776</span></a>
</span><span id="Mesh-777"><a href="#Mesh-777"><span class="linenos"> 777</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="Mesh-778"><a href="#Mesh-778"><span class="linenos"> 778</span></a>            <span class="n">n_eval_per_elem</span><span class="o">=</span><span class="n">n_eval_per_elem</span><span class="p">,</span>
</span><span id="Mesh-779"><a href="#Mesh-779"><span class="linenos"> 779</span></a>            <span class="n">XI_list</span><span class="o">=</span><span class="n">XI_list</span><span class="p">,</span>
</span><span id="Mesh-780"><a href="#Mesh-780"><span class="linenos"> 780</span></a>            <span class="n">separated_field</span><span class="o">=</span><span class="n">separated_field</span><span class="p">,</span>
</span><span id="Mesh-781"><a href="#Mesh-781"><span class="linenos"> 781</span></a>            <span class="n">disable_parallel</span><span class="o">=</span><span class="n">disable_parallel</span><span class="p">,</span>
</span><span id="Mesh-782"><a href="#Mesh-782"><span class="linenos"> 782</span></a>            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
</span><span id="Mesh-783"><a href="#Mesh-783"><span class="linenos"> 783</span></a>            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="Mesh-784"><a href="#Mesh-784"><span class="linenos"> 784</span></a>        <span class="p">)</span>
</span><span id="Mesh-785"><a href="#Mesh-785"><span class="linenos"> 785</span></a>
</span><span id="Mesh-786"><a href="#Mesh-786"><span class="linenos"> 786</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot</span><span class="p">(</span>
</span><span id="Mesh-787"><a href="#Mesh-787"><span class="linenos"> 787</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Mesh-788"><a href="#Mesh-788"><span class="linenos"> 788</span></a>        <span class="n">n_eval_per_elem</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="Mesh-789"><a href="#Mesh-789"><span class="linenos"> 789</span></a>        <span class="n">XI_list</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Mesh-790"><a href="#Mesh-790"><span class="linenos"> 790</span></a>        <span class="n">unique_field</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Mesh-791"><a href="#Mesh-791"><span class="linenos"> 791</span></a>        <span class="n">separated_field</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">callable</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Mesh-792"><a href="#Mesh-792"><span class="linenos"> 792</span></a>        <span class="n">interior_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Mesh-793"><a href="#Mesh-793"><span class="linenos"> 793</span></a>        <span class="n">plt_ctrl_mesh</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Mesh-794"><a href="#Mesh-794"><span class="linenos"> 794</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Mesh-795"><a href="#Mesh-795"><span class="linenos"> 795</span></a>        <span class="n">disable_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Mesh-796"><a href="#Mesh-796"><span class="linenos"> 796</span></a>        <span class="n">pv_plotter</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Mesh-797"><a href="#Mesh-797"><span class="linenos"> 797</span></a>        <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Mesh-798"><a href="#Mesh-798"><span class="linenos"> 798</span></a>        <span class="n">elem_sep_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span id="Mesh-799"><a href="#Mesh-799"><span class="linenos"> 799</span></a>        <span class="n">ctrl_poly_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span>
</span><span id="Mesh-800"><a href="#Mesh-800"><span class="linenos"> 800</span></a>        <span class="o">**</span><span class="n">pv_add_mesh_kwargs</span><span class="p">,</span>
</span><span id="Mesh-801"><a href="#Mesh-801"><span class="linenos"> 801</span></a>    <span class="p">):</span>
</span><span id="Mesh-802"><a href="#Mesh-802"><span class="linenos"> 802</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh-803"><a href="#Mesh-803"><span class="linenos"> 803</span></a><span class="sd">        Visualize the B-spline multipatch mesh using `PyVista`.</span>
</span><span id="Mesh-804"><a href="#Mesh-804"><span class="linenos"> 804</span></a>
</span><span id="Mesh-805"><a href="#Mesh-805"><span class="linenos"> 805</span></a><span class="sd">        This method evaluates the mesh geometry and optional scalar fields at</span>
</span><span id="Mesh-806"><a href="#Mesh-806"><span class="linenos"> 806</span></a><span class="sd">        parametric sampling points and renders them using `PyVista`. Fields can be</span>
</span><span id="Mesh-807"><a href="#Mesh-807"><span class="linenos"> 807</span></a><span class="sd">        provided either in a unique (global) or separated (per-patch) representation.</span>
</span><span id="Mesh-808"><a href="#Mesh-808"><span class="linenos"> 808</span></a>
</span><span id="Mesh-809"><a href="#Mesh-809"><span class="linenos"> 809</span></a><span class="sd">        Parameters</span>
</span><span id="Mesh-810"><a href="#Mesh-810"><span class="linenos"> 810</span></a><span class="sd">        ----------</span>
</span><span id="Mesh-811"><a href="#Mesh-811"><span class="linenos"> 811</span></a><span class="sd">        n_eval_per_elem : int or iterable of int, optional</span>
</span><span id="Mesh-812"><a href="#Mesh-812"><span class="linenos"> 812</span></a><span class="sd">            Number of evaluation points per element along each parametric direction.</span>
</span><span id="Mesh-813"><a href="#Mesh-813"><span class="linenos"> 813</span></a><span class="sd">            If an iterable is provided, it must match the parametric dimension.</span>
</span><span id="Mesh-814"><a href="#Mesh-814"><span class="linenos"> 814</span></a><span class="sd">            Default is `10`.</span>
</span><span id="Mesh-815"><a href="#Mesh-815"><span class="linenos"> 815</span></a><span class="sd">        XI_list : iterable of tuple of np.ndarray, optional</span>
</span><span id="Mesh-816"><a href="#Mesh-816"><span class="linenos"> 816</span></a><span class="sd">            Explicit parametric coordinates for evaluation, provided per patch.</span>
</span><span id="Mesh-817"><a href="#Mesh-817"><span class="linenos"> 817</span></a><span class="sd">            If `None`, a regular grid based on `n_eval_per_elem` is used.</span>
</span><span id="Mesh-818"><a href="#Mesh-818"><span class="linenos"> 818</span></a><span class="sd">        unique_field : np.ndarray, optional</span>
</span><span id="Mesh-819"><a href="#Mesh-819"><span class="linenos"> 819</span></a><span class="sd">            Field defined on the unique control points of the mesh. Mutually exclusive</span>
</span><span id="Mesh-820"><a href="#Mesh-820"><span class="linenos"> 820</span></a><span class="sd">            with `separated_field`.</span>
</span><span id="Mesh-821"><a href="#Mesh-821"><span class="linenos"> 821</span></a><span class="sd">        separated_field : list of np.ndarray or list of callable, optional</span>
</span><span id="Mesh-822"><a href="#Mesh-822"><span class="linenos"> 822</span></a><span class="sd">            Field defined per patch, either as arrays evaluated on parametric grids</span>
</span><span id="Mesh-823"><a href="#Mesh-823"><span class="linenos"> 823</span></a><span class="sd">            or as callables evaluated at runtime. Mutually exclusive with `unique_field`.</span>
</span><span id="Mesh-824"><a href="#Mesh-824"><span class="linenos"> 824</span></a><span class="sd">        interior_only : bool, optional</span>
</span><span id="Mesh-825"><a href="#Mesh-825"><span class="linenos"> 825</span></a><span class="sd">            If `True`, only interior elements are displayed. Default is `True`.</span>
</span><span id="Mesh-826"><a href="#Mesh-826"><span class="linenos"> 826</span></a><span class="sd">        plt_ctrl_mesh : bool, optional</span>
</span><span id="Mesh-827"><a href="#Mesh-827"><span class="linenos"> 827</span></a><span class="sd">            If `True`, overlays the control polygon mesh (only if `interior_only=False`).</span>
</span><span id="Mesh-828"><a href="#Mesh-828"><span class="linenos"> 828</span></a><span class="sd">            Default is `False`.</span>
</span><span id="Mesh-829"><a href="#Mesh-829"><span class="linenos"> 829</span></a><span class="sd">        verbose : bool, optional</span>
</span><span id="Mesh-830"><a href="#Mesh-830"><span class="linenos"> 830</span></a><span class="sd">            If `True`, prints progress messages. Default is `True`.</span>
</span><span id="Mesh-831"><a href="#Mesh-831"><span class="linenos"> 831</span></a><span class="sd">        disable_parallel : bool, optional</span>
</span><span id="Mesh-832"><a href="#Mesh-832"><span class="linenos"> 832</span></a><span class="sd">            If `True`, disables parallel computation. Default is `False`.</span>
</span><span id="Mesh-833"><a href="#Mesh-833"><span class="linenos"> 833</span></a><span class="sd">        pv_plotter : pv.Plotter or None, optional</span>
</span><span id="Mesh-834"><a href="#Mesh-834"><span class="linenos"> 834</span></a><span class="sd">            Existing `PyVista` plotter to use. If `None`, a new one is created.</span>
</span><span id="Mesh-835"><a href="#Mesh-835"><span class="linenos"> 835</span></a><span class="sd">        show : bool, optional</span>
</span><span id="Mesh-836"><a href="#Mesh-836"><span class="linenos"> 836</span></a><span class="sd">            If `True`, renders the scene immediately. Default is `True`.</span>
</span><span id="Mesh-837"><a href="#Mesh-837"><span class="linenos"> 837</span></a><span class="sd">        elem_sep_color : str, optional</span>
</span><span id="Mesh-838"><a href="#Mesh-838"><span class="linenos"> 838</span></a><span class="sd">            Color used for element separators. Default is `&#39;black&#39;`.</span>
</span><span id="Mesh-839"><a href="#Mesh-839"><span class="linenos"> 839</span></a><span class="sd">        ctrl_poly_color : str, optional</span>
</span><span id="Mesh-840"><a href="#Mesh-840"><span class="linenos"> 840</span></a><span class="sd">            Color used for the control polygon mesh. Default is `&#39;green&#39;`.</span>
</span><span id="Mesh-841"><a href="#Mesh-841"><span class="linenos"> 841</span></a><span class="sd">        **pv_add_mesh_kwargs : dict, optional</span>
</span><span id="Mesh-842"><a href="#Mesh-842"><span class="linenos"> 842</span></a><span class="sd">            Additional keyword arguments forwarded to `pv.Plotter.add_mesh`</span>
</span><span id="Mesh-843"><a href="#Mesh-843"><span class="linenos"> 843</span></a><span class="sd">            (e.g. `cmap`, `clim`, `scalar_bar_args`, etc.).</span>
</span><span id="Mesh-844"><a href="#Mesh-844"><span class="linenos"> 844</span></a>
</span><span id="Mesh-845"><a href="#Mesh-845"><span class="linenos"> 845</span></a><span class="sd">        Returns</span>
</span><span id="Mesh-846"><a href="#Mesh-846"><span class="linenos"> 846</span></a><span class="sd">        -------</span>
</span><span id="Mesh-847"><a href="#Mesh-847"><span class="linenos"> 847</span></a><span class="sd">        pv.Plotter</span>
</span><span id="Mesh-848"><a href="#Mesh-848"><span class="linenos"> 848</span></a><span class="sd">            The `PyVista` plotter used for rendering.</span>
</span><span id="Mesh-849"><a href="#Mesh-849"><span class="linenos"> 849</span></a>
</span><span id="Mesh-850"><a href="#Mesh-850"><span class="linenos"> 850</span></a><span class="sd">        Notes</span>
</span><span id="Mesh-851"><a href="#Mesh-851"><span class="linenos"> 851</span></a><span class="sd">        -----</span>
</span><span id="Mesh-852"><a href="#Mesh-852"><span class="linenos"> 852</span></a><span class="sd">        - Exactly one of `unique_field` or `separated_field` may be provided.</span>
</span><span id="Mesh-853"><a href="#Mesh-853"><span class="linenos"> 853</span></a><span class="sd">        - Fields passed as NumPy arrays for plotting must have the same number of</span>
</span><span id="Mesh-854"><a href="#Mesh-854"><span class="linenos"> 854</span></a><span class="sd">          dimensions (`ndim`) as the control points array. Scalar fields must therefore</span>
</span><span id="Mesh-855"><a href="#Mesh-855"><span class="linenos"> 855</span></a><span class="sd">          include a leading dimension of size 1.</span>
</span><span id="Mesh-856"><a href="#Mesh-856"><span class="linenos"> 856</span></a><span class="sd">        - Fields are evaluated on-the-fly at visualization points, not at control points.</span>
</span><span id="Mesh-857"><a href="#Mesh-857"><span class="linenos"> 857</span></a><span class="sd">        - If executed in a Jupyter notebook, a screenshot of the last plot is stored</span>
</span><span id="Mesh-858"><a href="#Mesh-858"><span class="linenos"> 858</span></a><span class="sd">          for display via `_repr_png_`.</span>
</span><span id="Mesh-859"><a href="#Mesh-859"><span class="linenos"> 859</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh-860"><a href="#Mesh-860"><span class="linenos"> 860</span></a>        <span class="k">if</span> <span class="n">unique_field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Mesh-861"><a href="#Mesh-861"><span class="linenos"> 861</span></a>            <span class="n">unique_fields</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Mesh-862"><a href="#Mesh-862"><span class="linenos"> 862</span></a>                <span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="p">(</span>
</span><span id="Mesh-863"><a href="#Mesh-863"><span class="linenos"> 863</span></a>                    <span class="n">unique_field</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="Mesh-864"><a href="#Mesh-864"><span class="linenos"> 864</span></a>                    <span class="k">if</span> <span class="n">unique_field</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="Mesh-865"><a href="#Mesh-865"><span class="linenos"> 865</span></a>                    <span class="k">else</span> <span class="n">unique_field</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span>
</span><span id="Mesh-866"><a href="#Mesh-866"><span class="linenos"> 866</span></a>                <span class="p">)</span>
</span><span id="Mesh-867"><a href="#Mesh-867"><span class="linenos"> 867</span></a>            <span class="p">}</span>
</span><span id="Mesh-868"><a href="#Mesh-868"><span class="linenos"> 868</span></a>            <span class="n">separated_fields</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Mesh-869"><a href="#Mesh-869"><span class="linenos"> 869</span></a>        <span class="k">elif</span> <span class="n">separated_field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Mesh-870"><a href="#Mesh-870"><span class="linenos"> 870</span></a>            <span class="n">unique_fields</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Mesh-871"><a href="#Mesh-871"><span class="linenos"> 871</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">separated_field</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Callable</span><span class="p">):</span>
</span><span id="Mesh-872"><a href="#Mesh-872"><span class="linenos"> 872</span></a>                <span class="n">separated_fields</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Mesh-873"><a href="#Mesh-873"><span class="linenos"> 873</span></a>                    <span class="p">{</span><span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">field</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)[</span><span class="kc">None</span><span class="p">]}</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">separated_field</span>
</span><span id="Mesh-874"><a href="#Mesh-874"><span class="linenos"> 874</span></a>                <span class="p">]</span>
</span><span id="Mesh-875"><a href="#Mesh-875"><span class="linenos"> 875</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Mesh-876"><a href="#Mesh-876"><span class="linenos"> 876</span></a>                <span class="n">separated_fields</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="n">field</span><span class="p">[</span><span class="kc">None</span><span class="p">]}</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">separated_field</span><span class="p">]</span>
</span><span id="Mesh-877"><a href="#Mesh-877"><span class="linenos"> 877</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Mesh-878"><a href="#Mesh-878"><span class="linenos"> 878</span></a>            <span class="n">unique_fields</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Mesh-879"><a href="#Mesh-879"><span class="linenos"> 879</span></a>            <span class="n">separated_fields</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Mesh-880"><a href="#Mesh-880"><span class="linenos"> 880</span></a>
</span><span id="Mesh-881"><a href="#Mesh-881"><span class="linenos"> 881</span></a>        <span class="k">if</span> <span class="n">pv_plotter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Mesh-882"><a href="#Mesh-882"><span class="linenos"> 882</span></a>            <span class="n">pv_plotter</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">()</span>
</span><span id="Mesh-883"><a href="#Mesh-883"><span class="linenos"> 883</span></a>
</span><span id="Mesh-884"><a href="#Mesh-884"><span class="linenos"> 884</span></a>        <span class="p">(</span><span class="n">elem_int_mesh</span><span class="p">,)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">make_elements_interior_meshes</span><span class="p">(</span>
</span><span id="Mesh-885"><a href="#Mesh-885"><span class="linenos"> 885</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">,</span>
</span><span id="Mesh-886"><a href="#Mesh-886"><span class="linenos"> 886</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_separated_ctrl_pts</span><span class="p">(),</span>
</span><span id="Mesh-887"><a href="#Mesh-887"><span class="linenos"> 887</span></a>            <span class="n">n_step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="Mesh-888"><a href="#Mesh-888"><span class="linenos"> 888</span></a>            <span class="n">n_eval_per_elem</span><span class="o">=</span><span class="n">n_eval_per_elem</span><span class="p">,</span>
</span><span id="Mesh-889"><a href="#Mesh-889"><span class="linenos"> 889</span></a>            <span class="n">unique_fields</span><span class="o">=</span><span class="n">unique_fields</span><span class="p">,</span>
</span><span id="Mesh-890"><a href="#Mesh-890"><span class="linenos"> 890</span></a>            <span class="n">separated_fields</span><span class="o">=</span><span class="n">separated_fields</span><span class="p">,</span>
</span><span id="Mesh-891"><a href="#Mesh-891"><span class="linenos"> 891</span></a>            <span class="n">XI_list</span><span class="o">=</span><span class="n">XI_list</span><span class="p">,</span>
</span><span id="Mesh-892"><a href="#Mesh-892"><span class="linenos"> 892</span></a>            <span class="n">disable_parallel</span><span class="o">=</span><span class="n">disable_parallel</span><span class="p">,</span>
</span><span id="Mesh-893"><a href="#Mesh-893"><span class="linenos"> 893</span></a>            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
</span><span id="Mesh-894"><a href="#Mesh-894"><span class="linenos"> 894</span></a>        <span class="p">)</span>
</span><span id="Mesh-895"><a href="#Mesh-895"><span class="linenos"> 895</span></a>        <span class="n">pv_plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">elem_int_mesh</span><span class="p">,</span> <span class="o">**</span><span class="n">pv_add_mesh_kwargs</span><span class="p">)</span>
</span><span id="Mesh-896"><a href="#Mesh-896"><span class="linenos"> 896</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">interior_only</span><span class="p">:</span>
</span><span id="Mesh-897"><a href="#Mesh-897"><span class="linenos"> 897</span></a>            <span class="p">(</span><span class="n">elem_sep_mesh</span><span class="p">,)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">make_elem_separator_meshes</span><span class="p">(</span>
</span><span id="Mesh-898"><a href="#Mesh-898"><span class="linenos"> 898</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">,</span>
</span><span id="Mesh-899"><a href="#Mesh-899"><span class="linenos"> 899</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">get_separated_ctrl_pts</span><span class="p">(),</span>
</span><span id="Mesh-900"><a href="#Mesh-900"><span class="linenos"> 900</span></a>                <span class="n">n_step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="Mesh-901"><a href="#Mesh-901"><span class="linenos"> 901</span></a>                <span class="n">n_eval_per_elem</span><span class="o">=</span><span class="n">n_eval_per_elem</span><span class="p">,</span>
</span><span id="Mesh-902"><a href="#Mesh-902"><span class="linenos"> 902</span></a>                <span class="n">XI_list</span><span class="o">=</span><span class="n">XI_list</span><span class="p">,</span>
</span><span id="Mesh-903"><a href="#Mesh-903"><span class="linenos"> 903</span></a>                <span class="n">disable_parallel</span><span class="o">=</span><span class="n">disable_parallel</span><span class="p">,</span>
</span><span id="Mesh-904"><a href="#Mesh-904"><span class="linenos"> 904</span></a>                <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
</span><span id="Mesh-905"><a href="#Mesh-905"><span class="linenos"> 905</span></a>            <span class="p">)</span>
</span><span id="Mesh-906"><a href="#Mesh-906"><span class="linenos"> 906</span></a>            <span class="k">if</span> <span class="s2">&quot;label&quot;</span> <span class="ow">in</span> <span class="n">pv_add_mesh_kwargs</span><span class="p">:</span>
</span><span id="Mesh-907"><a href="#Mesh-907"><span class="linenos"> 907</span></a>                <span class="k">del</span> <span class="n">pv_add_mesh_kwargs</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span>
</span><span id="Mesh-908"><a href="#Mesh-908"><span class="linenos"> 908</span></a>            <span class="n">pv_add_mesh_kwargs</span><span class="p">[</span><span class="s2">&quot;style&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;wireframe&quot;</span>
</span><span id="Mesh-909"><a href="#Mesh-909"><span class="linenos"> 909</span></a>            <span class="n">pv_add_mesh_kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elem_sep_color</span>
</span><span id="Mesh-910"><a href="#Mesh-910"><span class="linenos"> 910</span></a>            <span class="n">pv_plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">elem_sep_mesh</span><span class="p">,</span> <span class="o">**</span><span class="n">pv_add_mesh_kwargs</span><span class="p">)</span>
</span><span id="Mesh-911"><a href="#Mesh-911"><span class="linenos"> 911</span></a>            <span class="k">if</span> <span class="n">plt_ctrl_mesh</span><span class="p">:</span>
</span><span id="Mesh-912"><a href="#Mesh-912"><span class="linenos"> 912</span></a>                <span class="p">(</span><span class="n">ctrl_poly_mesh</span><span class="p">,)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">make_control_poly_meshes</span><span class="p">(</span>
</span><span id="Mesh-913"><a href="#Mesh-913"><span class="linenos"> 913</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">,</span>
</span><span id="Mesh-914"><a href="#Mesh-914"><span class="linenos"> 914</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">get_separated_ctrl_pts</span><span class="p">(),</span>
</span><span id="Mesh-915"><a href="#Mesh-915"><span class="linenos"> 915</span></a>                    <span class="n">n_step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="Mesh-916"><a href="#Mesh-916"><span class="linenos"> 916</span></a>                    <span class="n">n_eval_per_elem</span><span class="o">=</span><span class="n">n_eval_per_elem</span><span class="p">,</span>
</span><span id="Mesh-917"><a href="#Mesh-917"><span class="linenos"> 917</span></a>                    <span class="n">XI_list</span><span class="o">=</span><span class="n">XI_list</span><span class="p">,</span>
</span><span id="Mesh-918"><a href="#Mesh-918"><span class="linenos"> 918</span></a>                    <span class="n">disable_parallel</span><span class="o">=</span><span class="n">disable_parallel</span><span class="p">,</span>
</span><span id="Mesh-919"><a href="#Mesh-919"><span class="linenos"> 919</span></a>                    <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
</span><span id="Mesh-920"><a href="#Mesh-920"><span class="linenos"> 920</span></a>                <span class="p">)</span>
</span><span id="Mesh-921"><a href="#Mesh-921"><span class="linenos"> 921</span></a>                <span class="n">pv_add_mesh_kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ctrl_poly_color</span>
</span><span id="Mesh-922"><a href="#Mesh-922"><span class="linenos"> 922</span></a>                <span class="n">pv_plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">ctrl_poly_mesh</span><span class="p">,</span> <span class="o">**</span><span class="n">pv_add_mesh_kwargs</span><span class="p">)</span>
</span><span id="Mesh-923"><a href="#Mesh-923"><span class="linenos"> 923</span></a>
</span><span id="Mesh-924"><a href="#Mesh-924"><span class="linenos"> 924</span></a>        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
</span><span id="Mesh-925"><a href="#Mesh-925"><span class="linenos"> 925</span></a>            <span class="n">pv_plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="Mesh-926"><a href="#Mesh-926"><span class="linenos"> 926</span></a>            <span class="k">if</span> <span class="n">in_notebook</span><span class="p">():</span>
</span><span id="Mesh-927"><a href="#Mesh-927"><span class="linenos"> 927</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_screenshot</span> <span class="o">=</span> <span class="n">pv_plotter</span><span class="o">.</span><span class="n">screenshot</span><span class="p">(</span><span class="n">return_img</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Mesh-928"><a href="#Mesh-928"><span class="linenos"> 928</span></a>
</span><span id="Mesh-929"><a href="#Mesh-929"><span class="linenos"> 929</span></a>        <span class="k">return</span> <span class="n">pv_plotter</span>
</span><span id="Mesh-930"><a href="#Mesh-930"><span class="linenos"> 930</span></a>
</span><span id="Mesh-931"><a href="#Mesh-931"><span class="linenos"> 931</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_in_image</span><span class="p">(</span>
</span><span id="Mesh-932"><a href="#Mesh-932"><span class="linenos"> 932</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Mesh-933"><a href="#Mesh-933"><span class="linenos"> 933</span></a>        <span class="n">image</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="Mesh-934"><a href="#Mesh-934"><span class="linenos"> 934</span></a>        <span class="n">threshold</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Mesh-935"><a href="#Mesh-935"><span class="linenos"> 935</span></a>        <span class="n">threshold_method</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;otsu&quot;</span><span class="p">,</span> <span class="s2">&quot;interp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;otsu&quot;</span><span class="p">,</span>
</span><span id="Mesh-936"><a href="#Mesh-936"><span class="linenos"> 936</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;marching cubes&quot;</span><span class="p">,</span> <span class="s2">&quot;voxels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;marching cubes&quot;</span><span class="p">,</span>
</span><span id="Mesh-937"><a href="#Mesh-937"><span class="linenos"> 937</span></a>        <span class="n">n_eval_per_elem</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="Mesh-938"><a href="#Mesh-938"><span class="linenos"> 938</span></a>        <span class="n">XI_list</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Mesh-939"><a href="#Mesh-939"><span class="linenos"> 939</span></a>        <span class="n">interior_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Mesh-940"><a href="#Mesh-940"><span class="linenos"> 940</span></a>        <span class="n">plt_ctrl_mesh</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Mesh-941"><a href="#Mesh-941"><span class="linenos"> 941</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Mesh-942"><a href="#Mesh-942"><span class="linenos"> 942</span></a>        <span class="n">disable_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Mesh-943"><a href="#Mesh-943"><span class="linenos"> 943</span></a>        <span class="n">pv_plotter</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Mesh-944"><a href="#Mesh-944"><span class="linenos"> 944</span></a>        <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Mesh-945"><a href="#Mesh-945"><span class="linenos"> 945</span></a>        <span class="n">image_show_edges</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Mesh-946"><a href="#Mesh-946"><span class="linenos"> 946</span></a>        <span class="n">image_line_width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
</span><span id="Mesh-947"><a href="#Mesh-947"><span class="linenos"> 947</span></a>        <span class="n">image_opacity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.85</span><span class="p">,</span>
</span><span id="Mesh-948"><a href="#Mesh-948"><span class="linenos"> 948</span></a>        <span class="n">image_edge_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span id="Mesh-949"><a href="#Mesh-949"><span class="linenos"> 949</span></a>        <span class="n">image_interior_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span>
</span><span id="Mesh-950"><a href="#Mesh-950"><span class="linenos"> 950</span></a>        <span class="o">**</span><span class="n">pv_add_mesh_kwargs</span><span class="p">,</span>
</span><span id="Mesh-951"><a href="#Mesh-951"><span class="linenos"> 951</span></a>    <span class="p">):</span>
</span><span id="Mesh-952"><a href="#Mesh-952"><span class="linenos"> 952</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh-953"><a href="#Mesh-953"><span class="linenos"> 953</span></a><span class="sd">        Visualize the mesh together with an image-derived surface.</span>
</span><span id="Mesh-954"><a href="#Mesh-954"><span class="linenos"> 954</span></a>
</span><span id="Mesh-955"><a href="#Mesh-955"><span class="linenos"> 955</span></a><span class="sd">        This method overlays the B-spline mesh visualization with a surface extracted</span>
</span><span id="Mesh-956"><a href="#Mesh-956"><span class="linenos"> 956</span></a><span class="sd">        from a volumetric image, using either marching cubes or voxel thresholding.</span>
</span><span id="Mesh-957"><a href="#Mesh-957"><span class="linenos"> 957</span></a><span class="sd">        It is typically used to assess geometric alignment between the mesh and image</span>
</span><span id="Mesh-958"><a href="#Mesh-958"><span class="linenos"> 958</span></a><span class="sd">        features.</span>
</span><span id="Mesh-959"><a href="#Mesh-959"><span class="linenos"> 959</span></a>
</span><span id="Mesh-960"><a href="#Mesh-960"><span class="linenos"> 960</span></a><span class="sd">        Parameters</span>
</span><span id="Mesh-961"><a href="#Mesh-961"><span class="linenos"> 961</span></a><span class="sd">        ----------</span>
</span><span id="Mesh-962"><a href="#Mesh-962"><span class="linenos"> 962</span></a><span class="sd">        image : np.ndarray</span>
</span><span id="Mesh-963"><a href="#Mesh-963"><span class="linenos"> 963</span></a><span class="sd">            Input volumetric image of shape (n1, n2, n3).</span>
</span><span id="Mesh-964"><a href="#Mesh-964"><span class="linenos"> 964</span></a><span class="sd">        threshold : float or None, optional</span>
</span><span id="Mesh-965"><a href="#Mesh-965"><span class="linenos"> 965</span></a><span class="sd">            Threshold value used to extract the image surface. If `None`, it is</span>
</span><span id="Mesh-966"><a href="#Mesh-966"><span class="linenos"> 966</span></a><span class="sd">            automatically estimated using `threshold_method`.</span>
</span><span id="Mesh-967"><a href="#Mesh-967"><span class="linenos"> 967</span></a><span class="sd">        threshold_method : {&quot;otsu&quot;, &quot;interp&quot;}, optional</span>
</span><span id="Mesh-968"><a href="#Mesh-968"><span class="linenos"> 968</span></a><span class="sd">            Method used to estimate the threshold when `threshold` is `None`.</span>
</span><span id="Mesh-969"><a href="#Mesh-969"><span class="linenos"> 969</span></a><span class="sd">            Default is `&quot;otsu&quot;`.</span>
</span><span id="Mesh-970"><a href="#Mesh-970"><span class="linenos"> 970</span></a><span class="sd">        mode : {&quot;marching cubes&quot;, &quot;voxels&quot;}, optional</span>
</span><span id="Mesh-971"><a href="#Mesh-971"><span class="linenos"> 971</span></a><span class="sd">            Method used to extract the image surface. If `&quot;marching cubes&quot;`,</span>
</span><span id="Mesh-972"><a href="#Mesh-972"><span class="linenos"> 972</span></a><span class="sd">            the image must be of dtype `uint16`. Default is `&quot;marching cubes&quot;`.</span>
</span><span id="Mesh-973"><a href="#Mesh-973"><span class="linenos"> 973</span></a><span class="sd">        n_eval_per_elem : int or iterable of int, optional</span>
</span><span id="Mesh-974"><a href="#Mesh-974"><span class="linenos"> 974</span></a><span class="sd">            Number of evaluation points per element along each parametric direction.</span>
</span><span id="Mesh-975"><a href="#Mesh-975"><span class="linenos"> 975</span></a><span class="sd">            Default is `10`.</span>
</span><span id="Mesh-976"><a href="#Mesh-976"><span class="linenos"> 976</span></a><span class="sd">        XI_list : iterable of tuple of np.ndarray, optional</span>
</span><span id="Mesh-977"><a href="#Mesh-977"><span class="linenos"> 977</span></a><span class="sd">            Explicit parametric coordinates for mesh evaluation.</span>
</span><span id="Mesh-978"><a href="#Mesh-978"><span class="linenos"> 978</span></a><span class="sd">        interior_only : bool, optional</span>
</span><span id="Mesh-979"><a href="#Mesh-979"><span class="linenos"> 979</span></a><span class="sd">            If `True`, only interior elements of the mesh are displayed. Default is `True`.</span>
</span><span id="Mesh-980"><a href="#Mesh-980"><span class="linenos"> 980</span></a><span class="sd">        plt_ctrl_mesh : bool, optional</span>
</span><span id="Mesh-981"><a href="#Mesh-981"><span class="linenos"> 981</span></a><span class="sd">            If `True`, overlays the control polygon mesh. Default is `False`.</span>
</span><span id="Mesh-982"><a href="#Mesh-982"><span class="linenos"> 982</span></a><span class="sd">        verbose : bool, optional</span>
</span><span id="Mesh-983"><a href="#Mesh-983"><span class="linenos"> 983</span></a><span class="sd">            If `True`, prints progress messages. Default is `True`.</span>
</span><span id="Mesh-984"><a href="#Mesh-984"><span class="linenos"> 984</span></a><span class="sd">        disable_parallel : bool, optional</span>
</span><span id="Mesh-985"><a href="#Mesh-985"><span class="linenos"> 985</span></a><span class="sd">            If `True`, disables parallel computation. Default is `False`.</span>
</span><span id="Mesh-986"><a href="#Mesh-986"><span class="linenos"> 986</span></a><span class="sd">        pv_plotter : pv.Plotter or None, optional</span>
</span><span id="Mesh-987"><a href="#Mesh-987"><span class="linenos"> 987</span></a><span class="sd">            Existing PyVista plotter to use. If `None`, a new one is created.</span>
</span><span id="Mesh-988"><a href="#Mesh-988"><span class="linenos"> 988</span></a><span class="sd">        show : bool, optional</span>
</span><span id="Mesh-989"><a href="#Mesh-989"><span class="linenos"> 989</span></a><span class="sd">            If `True`, renders the scene immediately. Default is `True`.</span>
</span><span id="Mesh-990"><a href="#Mesh-990"><span class="linenos"> 990</span></a><span class="sd">        image_show_edges : bool, optional</span>
</span><span id="Mesh-991"><a href="#Mesh-991"><span class="linenos"> 991</span></a><span class="sd">            Whether to display edges of the image-derived surface. Default is `False`.</span>
</span><span id="Mesh-992"><a href="#Mesh-992"><span class="linenos"> 992</span></a><span class="sd">        image_line_width : float, optional</span>
</span><span id="Mesh-993"><a href="#Mesh-993"><span class="linenos"> 993</span></a><span class="sd">            Line width used when displaying image edges. Default is `0.05`.</span>
</span><span id="Mesh-994"><a href="#Mesh-994"><span class="linenos"> 994</span></a><span class="sd">        image_opacity : float, optional</span>
</span><span id="Mesh-995"><a href="#Mesh-995"><span class="linenos"> 995</span></a><span class="sd">            Opacity of the image-derived surface. Default is `0.85`.</span>
</span><span id="Mesh-996"><a href="#Mesh-996"><span class="linenos"> 996</span></a><span class="sd">        image_edge_color : str, optional</span>
</span><span id="Mesh-997"><a href="#Mesh-997"><span class="linenos"> 997</span></a><span class="sd">            Color of image surface edges. Default is `&#39;black&#39;`.</span>
</span><span id="Mesh-998"><a href="#Mesh-998"><span class="linenos"> 998</span></a><span class="sd">        image_interior_color : str, optional</span>
</span><span id="Mesh-999"><a href="#Mesh-999"><span class="linenos"> 999</span></a><span class="sd">            Color of the image-derived surface interior. Default is `&#39;white&#39;`.</span>
</span><span id="Mesh-1000"><a href="#Mesh-1000"><span class="linenos">1000</span></a><span class="sd">        **pv_add_mesh_kwargs : dict, optional</span>
</span><span id="Mesh-1001"><a href="#Mesh-1001"><span class="linenos">1001</span></a><span class="sd">            Additional keyword arguments forwarded to :meth:`plot`.</span>
</span><span id="Mesh-1002"><a href="#Mesh-1002"><span class="linenos">1002</span></a>
</span><span id="Mesh-1003"><a href="#Mesh-1003"><span class="linenos">1003</span></a><span class="sd">        Returns</span>
</span><span id="Mesh-1004"><a href="#Mesh-1004"><span class="linenos">1004</span></a><span class="sd">        -------</span>
</span><span id="Mesh-1005"><a href="#Mesh-1005"><span class="linenos">1005</span></a><span class="sd">        pv.Plotter</span>
</span><span id="Mesh-1006"><a href="#Mesh-1006"><span class="linenos">1006</span></a><span class="sd">            The PyVista plotter used for visualization.</span>
</span><span id="Mesh-1007"><a href="#Mesh-1007"><span class="linenos">1007</span></a>
</span><span id="Mesh-1008"><a href="#Mesh-1008"><span class="linenos">1008</span></a><span class="sd">        Notes</span>
</span><span id="Mesh-1009"><a href="#Mesh-1009"><span class="linenos">1009</span></a><span class="sd">        -----</span>
</span><span id="Mesh-1010"><a href="#Mesh-1010"><span class="linenos">1010</span></a><span class="sd">        - The mesh is rendered first, then the image-derived surface is overlaid.</span>
</span><span id="Mesh-1011"><a href="#Mesh-1011"><span class="linenos">1011</span></a><span class="sd">        - This method does not modify the mesh or image data.</span>
</span><span id="Mesh-1012"><a href="#Mesh-1012"><span class="linenos">1012</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh-1013"><a href="#Mesh-1013"><span class="linenos">1013</span></a>        <span class="k">if</span> <span class="n">threshold</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Mesh-1014"><a href="#Mesh-1014"><span class="linenos">1014</span></a>            <span class="n">fg</span><span class="p">,</span> <span class="n">bg</span> <span class="o">=</span> <span class="n">find_fg_bg</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">threshold_method</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="Mesh-1015"><a href="#Mesh-1015"><span class="linenos">1015</span></a>            <span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">fg</span> <span class="o">+</span> <span class="n">bg</span><span class="p">)</span>
</span><span id="Mesh-1016"><a href="#Mesh-1016"><span class="linenos">1016</span></a>
</span><span id="Mesh-1017"><a href="#Mesh-1017"><span class="linenos">1017</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;marching cubes&quot;</span><span class="p">:</span>
</span><span id="Mesh-1018"><a href="#Mesh-1018"><span class="linenos">1018</span></a>            <span class="n">image_mesh</span> <span class="o">=</span> <span class="n">marching_cubes</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">threshold</span><span class="p">)</span>
</span><span id="Mesh-1019"><a href="#Mesh-1019"><span class="linenos">1019</span></a>        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;voxels&quot;</span><span class="p">:</span>
</span><span id="Mesh-1020"><a href="#Mesh-1020"><span class="linenos">1020</span></a>            <span class="n">image_mesh</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">image</span><span class="p">)</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span>
</span><span id="Mesh-1021"><a href="#Mesh-1021"><span class="linenos">1021</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Mesh-1022"><a href="#Mesh-1022"><span class="linenos">1022</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unrecognized mode &#39;</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
</span><span id="Mesh-1023"><a href="#Mesh-1023"><span class="linenos">1023</span></a>
</span><span id="Mesh-1024"><a href="#Mesh-1024"><span class="linenos">1024</span></a>        <span class="n">pv_plotter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="Mesh-1025"><a href="#Mesh-1025"><span class="linenos">1025</span></a>            <span class="n">n_eval_per_elem</span><span class="o">=</span><span class="n">n_eval_per_elem</span><span class="p">,</span>
</span><span id="Mesh-1026"><a href="#Mesh-1026"><span class="linenos">1026</span></a>            <span class="n">XI_list</span><span class="o">=</span><span class="n">XI_list</span><span class="p">,</span>
</span><span id="Mesh-1027"><a href="#Mesh-1027"><span class="linenos">1027</span></a>            <span class="n">interior_only</span><span class="o">=</span><span class="n">interior_only</span><span class="p">,</span>
</span><span id="Mesh-1028"><a href="#Mesh-1028"><span class="linenos">1028</span></a>            <span class="n">plt_ctrl_mesh</span><span class="o">=</span><span class="n">plt_ctrl_mesh</span><span class="p">,</span>
</span><span id="Mesh-1029"><a href="#Mesh-1029"><span class="linenos">1029</span></a>            <span class="n">pv_plotter</span><span class="o">=</span><span class="n">pv_plotter</span><span class="p">,</span>
</span><span id="Mesh-1030"><a href="#Mesh-1030"><span class="linenos">1030</span></a>            <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Mesh-1031"><a href="#Mesh-1031"><span class="linenos">1031</span></a>            <span class="n">disable_parallel</span><span class="o">=</span><span class="n">disable_parallel</span><span class="p">,</span>
</span><span id="Mesh-1032"><a href="#Mesh-1032"><span class="linenos">1032</span></a>            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
</span><span id="Mesh-1033"><a href="#Mesh-1033"><span class="linenos">1033</span></a>            <span class="o">**</span><span class="n">pv_add_mesh_kwargs</span><span class="p">,</span>
</span><span id="Mesh-1034"><a href="#Mesh-1034"><span class="linenos">1034</span></a>        <span class="p">)</span>
</span><span id="Mesh-1035"><a href="#Mesh-1035"><span class="linenos">1035</span></a>
</span><span id="Mesh-1036"><a href="#Mesh-1036"><span class="linenos">1036</span></a>        <span class="n">pv_plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span>
</span><span id="Mesh-1037"><a href="#Mesh-1037"><span class="linenos">1037</span></a>            <span class="n">image_mesh</span><span class="p">,</span>
</span><span id="Mesh-1038"><a href="#Mesh-1038"><span class="linenos">1038</span></a>            <span class="n">show_edges</span><span class="o">=</span><span class="n">image_show_edges</span><span class="p">,</span>
</span><span id="Mesh-1039"><a href="#Mesh-1039"><span class="linenos">1039</span></a>            <span class="n">edge_color</span><span class="o">=</span><span class="n">image_edge_color</span><span class="p">,</span>
</span><span id="Mesh-1040"><a href="#Mesh-1040"><span class="linenos">1040</span></a>            <span class="n">line_width</span><span class="o">=</span><span class="n">image_line_width</span><span class="p">,</span>
</span><span id="Mesh-1041"><a href="#Mesh-1041"><span class="linenos">1041</span></a>            <span class="n">opacity</span><span class="o">=</span><span class="n">image_opacity</span><span class="p">,</span>
</span><span id="Mesh-1042"><a href="#Mesh-1042"><span class="linenos">1042</span></a>            <span class="n">color</span><span class="o">=</span><span class="n">image_interior_color</span><span class="p">,</span>
</span><span id="Mesh-1043"><a href="#Mesh-1043"><span class="linenos">1043</span></a>            <span class="n">specular</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
</span><span id="Mesh-1044"><a href="#Mesh-1044"><span class="linenos">1044</span></a>        <span class="p">)</span>
</span><span id="Mesh-1045"><a href="#Mesh-1045"><span class="linenos">1045</span></a>
</span><span id="Mesh-1046"><a href="#Mesh-1046"><span class="linenos">1046</span></a>        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
</span><span id="Mesh-1047"><a href="#Mesh-1047"><span class="linenos">1047</span></a>            <span class="n">pv_plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="Mesh-1048"><a href="#Mesh-1048"><span class="linenos">1048</span></a>
</span><span id="Mesh-1049"><a href="#Mesh-1049"><span class="linenos">1049</span></a>        <span class="k">return</span> <span class="n">pv_plotter</span>
</span><span id="Mesh-1050"><a href="#Mesh-1050"><span class="linenos">1050</span></a>
</span><span id="Mesh-1051"><a href="#Mesh-1051"><span class="linenos">1051</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ICP_rigid_body_transform</span><span class="p">(</span>
</span><span id="Mesh-1052"><a href="#Mesh-1052"><span class="linenos">1052</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Mesh-1053"><a href="#Mesh-1053"><span class="linenos">1053</span></a>        <span class="n">tgt_meshio</span><span class="p">:</span> <span class="n">io</span><span class="o">.</span><span class="n">Mesh</span><span class="p">,</span>
</span><span id="Mesh-1054"><a href="#Mesh-1054"><span class="linenos">1054</span></a>        <span class="n">n_eval_per_elem</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="Mesh-1055"><a href="#Mesh-1055"><span class="linenos">1055</span></a>        <span class="n">XI_list</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Mesh-1056"><a href="#Mesh-1056"><span class="linenos">1056</span></a>        <span class="n">plot_after</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Mesh-1057"><a href="#Mesh-1057"><span class="linenos">1057</span></a>        <span class="n">disable_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Mesh-1058"><a href="#Mesh-1058"><span class="linenos">1058</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="nb">float</span><span class="p">]:</span>
</span><span id="Mesh-1059"><a href="#Mesh-1059"><span class="linenos">1059</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh-1060"><a href="#Mesh-1060"><span class="linenos">1060</span></a><span class="sd">        Compute and apply a rigid body transformation aligning the mesh to a target mesh.</span>
</span><span id="Mesh-1061"><a href="#Mesh-1061"><span class="linenos">1061</span></a>
</span><span id="Mesh-1062"><a href="#Mesh-1062"><span class="linenos">1062</span></a><span class="sd">        This method computes the rigid body transformation (rotation and translation)</span>
</span><span id="Mesh-1063"><a href="#Mesh-1063"><span class="linenos">1063</span></a><span class="sd">        that best aligns the current mesh to a target mesh using an Iterative Closest</span>
</span><span id="Mesh-1064"><a href="#Mesh-1064"><span class="linenos">1064</span></a><span class="sd">        Point (ICP) algorithm. The transformation is then directly applied to the</span>
</span><span id="Mesh-1065"><a href="#Mesh-1065"><span class="linenos">1065</span></a><span class="sd">        control points of the mesh.</span>
</span><span id="Mesh-1066"><a href="#Mesh-1066"><span class="linenos">1066</span></a>
</span><span id="Mesh-1067"><a href="#Mesh-1067"><span class="linenos">1067</span></a><span class="sd">        Parameters</span>
</span><span id="Mesh-1068"><a href="#Mesh-1068"><span class="linenos">1068</span></a><span class="sd">        ----------</span>
</span><span id="Mesh-1069"><a href="#Mesh-1069"><span class="linenos">1069</span></a><span class="sd">        tgt_meshio : io.Mesh</span>
</span><span id="Mesh-1070"><a href="#Mesh-1070"><span class="linenos">1070</span></a><span class="sd">            Target mesh used as reference for the alignment.</span>
</span><span id="Mesh-1071"><a href="#Mesh-1071"><span class="linenos">1071</span></a><span class="sd">        n_eval_per_elem : int or iterable of int, optional</span>
</span><span id="Mesh-1072"><a href="#Mesh-1072"><span class="linenos">1072</span></a><span class="sd">            Number of evaluation points per element for each parametric dimension.</span>
</span><span id="Mesh-1073"><a href="#Mesh-1073"><span class="linenos">1073</span></a><span class="sd">            If an integer is provided, the same value is used for all dimensions.</span>
</span><span id="Mesh-1074"><a href="#Mesh-1074"><span class="linenos">1074</span></a><span class="sd">            If an iterable is provided, each value corresponds to one parametric</span>
</span><span id="Mesh-1075"><a href="#Mesh-1075"><span class="linenos">1075</span></a><span class="sd">            direction. Default is `5`.</span>
</span><span id="Mesh-1076"><a href="#Mesh-1076"><span class="linenos">1076</span></a><span class="sd">        XI_list : iterable of tuple of ndarray, optional</span>
</span><span id="Mesh-1077"><a href="#Mesh-1077"><span class="linenos">1077</span></a><span class="sd">            Parametric coordinates at which the geometry is evaluated to generate</span>
</span><span id="Mesh-1078"><a href="#Mesh-1078"><span class="linenos">1078</span></a><span class="sd">            the source surface mesh. If provided, this overrides `n_eval_per_elem`.</span>
</span><span id="Mesh-1079"><a href="#Mesh-1079"><span class="linenos">1079</span></a><span class="sd">        plot_after : bool, optional</span>
</span><span id="Mesh-1080"><a href="#Mesh-1080"><span class="linenos">1080</span></a><span class="sd">            If `True`, displays a visualization of the aligned source mesh and</span>
</span><span id="Mesh-1081"><a href="#Mesh-1081"><span class="linenos">1081</span></a><span class="sd">            the target mesh after the ICP procedure. Default is `True`.</span>
</span><span id="Mesh-1082"><a href="#Mesh-1082"><span class="linenos">1082</span></a><span class="sd">        disable_parallel : bool, optional</span>
</span><span id="Mesh-1083"><a href="#Mesh-1083"><span class="linenos">1083</span></a><span class="sd">            If `True`, disables parallel evaluation. Default is `False`.</span>
</span><span id="Mesh-1084"><a href="#Mesh-1084"><span class="linenos">1084</span></a>
</span><span id="Mesh-1085"><a href="#Mesh-1085"><span class="linenos">1085</span></a><span class="sd">        Returns</span>
</span><span id="Mesh-1086"><a href="#Mesh-1086"><span class="linenos">1086</span></a><span class="sd">        -------</span>
</span><span id="Mesh-1087"><a href="#Mesh-1087"><span class="linenos">1087</span></a><span class="sd">        Rmat : np.ndarray of float, shape (3, 3)</span>
</span><span id="Mesh-1088"><a href="#Mesh-1088"><span class="linenos">1088</span></a><span class="sd">            Rotation matrix of the rigid body transformation.</span>
</span><span id="Mesh-1089"><a href="#Mesh-1089"><span class="linenos">1089</span></a><span class="sd">        tvec : np.ndarray of float, shape (3,)</span>
</span><span id="Mesh-1090"><a href="#Mesh-1090"><span class="linenos">1090</span></a><span class="sd">            Translation vector of the rigid body transformation.</span>
</span><span id="Mesh-1091"><a href="#Mesh-1091"><span class="linenos">1091</span></a><span class="sd">        max_dist : float</span>
</span><span id="Mesh-1092"><a href="#Mesh-1092"><span class="linenos">1092</span></a><span class="sd">            Maximum absolute distance between the aligned source mesh and the</span>
</span><span id="Mesh-1093"><a href="#Mesh-1093"><span class="linenos">1093</span></a><span class="sd">            target mesh after transformation.</span>
</span><span id="Mesh-1094"><a href="#Mesh-1094"><span class="linenos">1094</span></a>
</span><span id="Mesh-1095"><a href="#Mesh-1095"><span class="linenos">1095</span></a><span class="sd">        Notes</span>
</span><span id="Mesh-1096"><a href="#Mesh-1096"><span class="linenos">1096</span></a><span class="sd">        -----</span>
</span><span id="Mesh-1097"><a href="#Mesh-1097"><span class="linenos">1097</span></a><span class="sd">        - For 3D meshes, the ICP is performed on the extracted boundary surface.</span>
</span><span id="Mesh-1098"><a href="#Mesh-1098"><span class="linenos">1098</span></a><span class="sd">        - The transformation is applied as `Rmat @ x + tvec`.</span>
</span><span id="Mesh-1099"><a href="#Mesh-1099"><span class="linenos">1099</span></a><span class="sd">        - This method modifies the mesh in place by updating `self.unique_ctrl_pts`.</span>
</span><span id="Mesh-1100"><a href="#Mesh-1100"><span class="linenos">1100</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh-1101"><a href="#Mesh-1101"><span class="linenos">1101</span></a>        <span class="c1"># Create source and target PolyData</span>
</span><span id="Mesh-1102"><a href="#Mesh-1102"><span class="linenos">1102</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">npa</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="Mesh-1103"><a href="#Mesh-1103"><span class="linenos">1103</span></a>            <span class="n">border_mesh</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="Mesh-1104"><a href="#Mesh-1104"><span class="linenos">1104</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">npa</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="Mesh-1105"><a href="#Mesh-1105"><span class="linenos">1105</span></a>            <span class="n">border_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_border</span><span class="p">()</span>
</span><span id="Mesh-1106"><a href="#Mesh-1106"><span class="linenos">1106</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Mesh-1107"><a href="#Mesh-1107"><span class="linenos">1107</span></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
</span><span id="Mesh-1108"><a href="#Mesh-1108"><span class="linenos">1108</span></a>                <span class="sa">f</span><span class="s2">&quot;Making finding ICP rigid body transform not implemented for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">npa</span><span class="si">}</span><span class="s2">-D shapes.&quot;</span>
</span><span id="Mesh-1109"><a href="#Mesh-1109"><span class="linenos">1109</span></a>            <span class="p">)</span>
</span><span id="Mesh-1110"><a href="#Mesh-1110"><span class="linenos">1110</span></a>        <span class="n">src_meshio</span> <span class="o">=</span> <span class="n">border_mesh</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">make_elements_interior_meshes</span><span class="p">(</span>
</span><span id="Mesh-1111"><a href="#Mesh-1111"><span class="linenos">1111</span></a>            <span class="n">border_mesh</span><span class="o">.</span><span class="n">splines</span><span class="p">,</span>
</span><span id="Mesh-1112"><a href="#Mesh-1112"><span class="linenos">1112</span></a>            <span class="n">border_mesh</span><span class="o">.</span><span class="n">get_separated_ctrl_pts</span><span class="p">(),</span>
</span><span id="Mesh-1113"><a href="#Mesh-1113"><span class="linenos">1113</span></a>            <span class="n">n_eval_per_elem</span><span class="o">=</span><span class="n">n_eval_per_elem</span><span class="p">,</span>
</span><span id="Mesh-1114"><a href="#Mesh-1114"><span class="linenos">1114</span></a>            <span class="n">XI_list</span><span class="o">=</span><span class="n">XI_list</span><span class="p">,</span>
</span><span id="Mesh-1115"><a href="#Mesh-1115"><span class="linenos">1115</span></a>            <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Mesh-1116"><a href="#Mesh-1116"><span class="linenos">1116</span></a>            <span class="n">disable_parallel</span><span class="o">=</span><span class="n">disable_parallel</span><span class="p">,</span>
</span><span id="Mesh-1117"><a href="#Mesh-1117"><span class="linenos">1117</span></a>        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Mesh-1118"><a href="#Mesh-1118"><span class="linenos">1118</span></a>        <span class="n">src</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">from_meshio</span><span class="p">(</span><span class="n">src_meshio</span><span class="p">)</span>
</span><span id="Mesh-1119"><a href="#Mesh-1119"><span class="linenos">1119</span></a>        <span class="n">tgt</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">from_meshio</span><span class="p">(</span><span class="n">tgt_meshio</span><span class="p">)</span>
</span><span id="Mesh-1120"><a href="#Mesh-1120"><span class="linenos">1120</span></a>
</span><span id="Mesh-1121"><a href="#Mesh-1121"><span class="linenos">1121</span></a>        <span class="c1"># Perform ICP alignment</span>
</span><span id="Mesh-1122"><a href="#Mesh-1122"><span class="linenos">1122</span></a>        <span class="n">aligned</span><span class="p">,</span> <span class="n">matrix</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">align</span><span class="p">(</span>
</span><span id="Mesh-1123"><a href="#Mesh-1123"><span class="linenos">1123</span></a>            <span class="n">tgt</span><span class="p">,</span>
</span><span id="Mesh-1124"><a href="#Mesh-1124"><span class="linenos">1124</span></a>            <span class="n">max_landmarks</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
</span><span id="Mesh-1125"><a href="#Mesh-1125"><span class="linenos">1125</span></a>            <span class="n">max_mean_distance</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span>
</span><span id="Mesh-1126"><a href="#Mesh-1126"><span class="linenos">1126</span></a>            <span class="n">max_iterations</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
</span><span id="Mesh-1127"><a href="#Mesh-1127"><span class="linenos">1127</span></a>            <span class="n">start_by_matching_centroids</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Mesh-1128"><a href="#Mesh-1128"><span class="linenos">1128</span></a>            <span class="n">return_matrix</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Mesh-1129"><a href="#Mesh-1129"><span class="linenos">1129</span></a>        <span class="p">)</span>
</span><span id="Mesh-1130"><a href="#Mesh-1130"><span class="linenos">1130</span></a>
</span><span id="Mesh-1131"><a href="#Mesh-1131"><span class="linenos">1131</span></a>        <span class="c1"># Decompose transformation matrix</span>
</span><span id="Mesh-1132"><a href="#Mesh-1132"><span class="linenos">1132</span></a>        <span class="n">Rmat</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>
</span><span id="Mesh-1133"><a href="#Mesh-1133"><span class="linenos">1133</span></a>        <span class="n">tvec</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</span><span id="Mesh-1134"><a href="#Mesh-1134"><span class="linenos">1134</span></a>
</span><span id="Mesh-1135"><a href="#Mesh-1135"><span class="linenos">1135</span></a>        <span class="c1"># Apply transformation to self</span>
</span><span id="Mesh-1136"><a href="#Mesh-1136"><span class="linenos">1136</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">unique_ctrl_pts</span> <span class="o">=</span> <span class="n">Rmat</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_ctrl_pts</span> <span class="o">+</span> <span class="n">tvec</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="Mesh-1137"><a href="#Mesh-1137"><span class="linenos">1137</span></a>
</span><span id="Mesh-1138"><a href="#Mesh-1138"><span class="linenos">1138</span></a>        <span class="k">if</span> <span class="n">plot_after</span><span class="p">:</span>
</span><span id="Mesh-1139"><a href="#Mesh-1139"><span class="linenos">1139</span></a>            <span class="n">plotter</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">()</span>
</span><span id="Mesh-1140"><a href="#Mesh-1140"><span class="linenos">1140</span></a>            <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span>
</span><span id="Mesh-1141"><a href="#Mesh-1141"><span class="linenos">1141</span></a>                <span class="n">aligned</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Aligned surface mesh&quot;</span>
</span><span id="Mesh-1142"><a href="#Mesh-1142"><span class="linenos">1142</span></a>            <span class="p">)</span>
</span><span id="Mesh-1143"><a href="#Mesh-1143"><span class="linenos">1143</span></a>            <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">tgt</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;STL Marching Cubes&quot;</span><span class="p">)</span>
</span><span id="Mesh-1144"><a href="#Mesh-1144"><span class="linenos">1144</span></a>            <span class="n">plotter</span><span class="o">.</span><span class="n">add_legend</span><span class="p">()</span>
</span><span id="Mesh-1145"><a href="#Mesh-1145"><span class="linenos">1145</span></a>            <span class="n">plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="Mesh-1146"><a href="#Mesh-1146"><span class="linenos">1146</span></a>
</span><span id="Mesh-1147"><a href="#Mesh-1147"><span class="linenos">1147</span></a>        <span class="c1"># Compute max distance between aligned and target meshes</span>
</span><span id="Mesh-1148"><a href="#Mesh-1148"><span class="linenos">1148</span></a>        <span class="n">aligned</span><span class="o">.</span><span class="n">compute_implicit_distance</span><span class="p">(</span><span class="n">tgt</span><span class="o">.</span><span class="n">extract_surface</span><span class="p">(),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Mesh-1149"><a href="#Mesh-1149"><span class="linenos">1149</span></a>        <span class="n">dist_array</span> <span class="o">=</span> <span class="n">aligned</span><span class="p">[</span><span class="s2">&quot;implicit_distance&quot;</span><span class="p">]</span>
</span><span id="Mesh-1150"><a href="#Mesh-1150"><span class="linenos">1150</span></a>        <span class="n">max_dist</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dist_array</span><span class="p">)))</span>
</span><span id="Mesh-1151"><a href="#Mesh-1151"><span class="linenos">1151</span></a>
</span><span id="Mesh-1152"><a href="#Mesh-1152"><span class="linenos">1152</span></a>        <span class="k">return</span> <span class="n">Rmat</span><span class="p">,</span> <span class="n">tvec</span><span class="p">,</span> <span class="n">max_dist</span>
</span><span id="Mesh-1153"><a href="#Mesh-1153"><span class="linenos">1153</span></a>
</span><span id="Mesh-1154"><a href="#Mesh-1154"><span class="linenos">1154</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">distance_to_meshio</span><span class="p">(</span>
</span><span id="Mesh-1155"><a href="#Mesh-1155"><span class="linenos">1155</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Mesh-1156"><a href="#Mesh-1156"><span class="linenos">1156</span></a>        <span class="n">tgt_meshio</span><span class="p">:</span> <span class="n">io</span><span class="o">.</span><span class="n">Mesh</span><span class="p">,</span>
</span><span id="Mesh-1157"><a href="#Mesh-1157"><span class="linenos">1157</span></a>        <span class="n">n_eval_per_elem</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="Mesh-1158"><a href="#Mesh-1158"><span class="linenos">1158</span></a>        <span class="n">XI_list</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Mesh-1159"><a href="#Mesh-1159"><span class="linenos">1159</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">io</span><span class="o">.</span><span class="n">Mesh</span><span class="p">:</span>
</span><span id="Mesh-1160"><a href="#Mesh-1160"><span class="linenos">1160</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh-1161"><a href="#Mesh-1161"><span class="linenos">1161</span></a><span class="sd">        Compute the signed distance field to a target mesh.</span>
</span><span id="Mesh-1162"><a href="#Mesh-1162"><span class="linenos">1162</span></a>
</span><span id="Mesh-1163"><a href="#Mesh-1163"><span class="linenos">1163</span></a><span class="sd">        This method evaluates the geometry of the mesh (or its boundary in 3D)</span>
</span><span id="Mesh-1164"><a href="#Mesh-1164"><span class="linenos">1164</span></a><span class="sd">        and computes the implicit distance to the surface of a target mesh.</span>
</span><span id="Mesh-1165"><a href="#Mesh-1165"><span class="linenos">1165</span></a><span class="sd">        The resulting distance field is returned as a `MeshIO` mesh.</span>
</span><span id="Mesh-1166"><a href="#Mesh-1166"><span class="linenos">1166</span></a>
</span><span id="Mesh-1167"><a href="#Mesh-1167"><span class="linenos">1167</span></a><span class="sd">        Parameters</span>
</span><span id="Mesh-1168"><a href="#Mesh-1168"><span class="linenos">1168</span></a><span class="sd">        ----------</span>
</span><span id="Mesh-1169"><a href="#Mesh-1169"><span class="linenos">1169</span></a><span class="sd">        tgt_meshio : io.Mesh</span>
</span><span id="Mesh-1170"><a href="#Mesh-1170"><span class="linenos">1170</span></a><span class="sd">            Target mesh defining the reference surface.</span>
</span><span id="Mesh-1171"><a href="#Mesh-1171"><span class="linenos">1171</span></a><span class="sd">        n_eval_per_elem : int or iterable of int, optional</span>
</span><span id="Mesh-1172"><a href="#Mesh-1172"><span class="linenos">1172</span></a><span class="sd">            Number of evaluation points per element for each parametric dimension.</span>
</span><span id="Mesh-1173"><a href="#Mesh-1173"><span class="linenos">1173</span></a><span class="sd">            Default is `5`.</span>
</span><span id="Mesh-1174"><a href="#Mesh-1174"><span class="linenos">1174</span></a><span class="sd">        XI_list : iterable of tuple of ndarray, optional</span>
</span><span id="Mesh-1175"><a href="#Mesh-1175"><span class="linenos">1175</span></a><span class="sd">            Parametric coordinates at which the geometry is evaluated.</span>
</span><span id="Mesh-1176"><a href="#Mesh-1176"><span class="linenos">1176</span></a><span class="sd">            If provided, this overrides `n_eval_per_elem`.</span>
</span><span id="Mesh-1177"><a href="#Mesh-1177"><span class="linenos">1177</span></a>
</span><span id="Mesh-1178"><a href="#Mesh-1178"><span class="linenos">1178</span></a><span class="sd">        Returns</span>
</span><span id="Mesh-1179"><a href="#Mesh-1179"><span class="linenos">1179</span></a><span class="sd">        -------</span>
</span><span id="Mesh-1180"><a href="#Mesh-1180"><span class="linenos">1180</span></a><span class="sd">        io.Mesh</span>
</span><span id="Mesh-1181"><a href="#Mesh-1181"><span class="linenos">1181</span></a><span class="sd">            `MeshIO` mesh containing the evaluated geometry and the associated</span>
</span><span id="Mesh-1182"><a href="#Mesh-1182"><span class="linenos">1182</span></a><span class="sd">            implicit distance field.</span>
</span><span id="Mesh-1183"><a href="#Mesh-1183"><span class="linenos">1183</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh-1184"><a href="#Mesh-1184"><span class="linenos">1184</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">npa</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="Mesh-1185"><a href="#Mesh-1185"><span class="linenos">1185</span></a>            <span class="n">border_mesh</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="Mesh-1186"><a href="#Mesh-1186"><span class="linenos">1186</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">npa</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="Mesh-1187"><a href="#Mesh-1187"><span class="linenos">1187</span></a>            <span class="n">border_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_border</span><span class="p">()</span>
</span><span id="Mesh-1188"><a href="#Mesh-1188"><span class="linenos">1188</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Mesh-1189"><a href="#Mesh-1189"><span class="linenos">1189</span></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
</span><span id="Mesh-1190"><a href="#Mesh-1190"><span class="linenos">1190</span></a>                <span class="sa">f</span><span class="s2">&quot;Distance field not implemented for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">npa</span><span class="si">}</span><span class="s2">-D shapes.&quot;</span>
</span><span id="Mesh-1191"><a href="#Mesh-1191"><span class="linenos">1191</span></a>            <span class="p">)</span>
</span><span id="Mesh-1192"><a href="#Mesh-1192"><span class="linenos">1192</span></a>        <span class="n">src_meshio</span> <span class="o">=</span> <span class="n">border_mesh</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">make_elements_interior_meshes</span><span class="p">(</span>
</span><span id="Mesh-1193"><a href="#Mesh-1193"><span class="linenos">1193</span></a>            <span class="n">border_mesh</span><span class="o">.</span><span class="n">splines</span><span class="p">,</span>
</span><span id="Mesh-1194"><a href="#Mesh-1194"><span class="linenos">1194</span></a>            <span class="n">border_mesh</span><span class="o">.</span><span class="n">get_separated_ctrl_pts</span><span class="p">(),</span>
</span><span id="Mesh-1195"><a href="#Mesh-1195"><span class="linenos">1195</span></a>            <span class="n">n_eval_per_elem</span><span class="o">=</span><span class="n">n_eval_per_elem</span><span class="p">,</span>
</span><span id="Mesh-1196"><a href="#Mesh-1196"><span class="linenos">1196</span></a>            <span class="n">XI_list</span><span class="o">=</span><span class="n">XI_list</span><span class="p">,</span>
</span><span id="Mesh-1197"><a href="#Mesh-1197"><span class="linenos">1197</span></a>            <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Mesh-1198"><a href="#Mesh-1198"><span class="linenos">1198</span></a>        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Mesh-1199"><a href="#Mesh-1199"><span class="linenos">1199</span></a>        <span class="n">src</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">from_meshio</span><span class="p">(</span><span class="n">src_meshio</span><span class="p">)</span>
</span><span id="Mesh-1200"><a href="#Mesh-1200"><span class="linenos">1200</span></a>        <span class="n">tgt</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">from_meshio</span><span class="p">(</span><span class="n">tgt_meshio</span><span class="p">)</span>
</span><span id="Mesh-1201"><a href="#Mesh-1201"><span class="linenos">1201</span></a>        <span class="n">src</span><span class="o">.</span><span class="n">compute_implicit_distance</span><span class="p">(</span><span class="n">tgt</span><span class="o">.</span><span class="n">extract_surface</span><span class="p">(),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Mesh-1202"><a href="#Mesh-1202"><span class="linenos">1202</span></a>        <span class="k">return</span> <span class="n">pv</span><span class="o">.</span><span class="n">to_meshio</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
</span><span id="Mesh-1203"><a href="#Mesh-1203"><span class="linenos">1203</span></a>
</span><span id="Mesh-1204"><a href="#Mesh-1204"><span class="linenos">1204</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_paraview</span><span class="p">(</span>
</span><span id="Mesh-1205"><a href="#Mesh-1205"><span class="linenos">1205</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Mesh-1206"><a href="#Mesh-1206"><span class="linenos">1206</span></a>        <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Mesh-1207"><a href="#Mesh-1207"><span class="linenos">1207</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Mesh-1208"><a href="#Mesh-1208"><span class="linenos">1208</span></a>        <span class="n">n_step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Mesh-1209"><a href="#Mesh-1209"><span class="linenos">1209</span></a>        <span class="n">n_eval_per_elem</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="Mesh-1210"><a href="#Mesh-1210"><span class="linenos">1210</span></a>        <span class="n">unique_fields</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="Mesh-1211"><a href="#Mesh-1211"><span class="linenos">1211</span></a>        <span class="n">separated_fields</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Mesh-1212"><a href="#Mesh-1212"><span class="linenos">1212</span></a>        <span class="n">XI_list</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Mesh-1213"><a href="#Mesh-1213"><span class="linenos">1213</span></a>        <span class="n">groups</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Mesh-1214"><a href="#Mesh-1214"><span class="linenos">1214</span></a>        <span class="n">make_pvd</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Mesh-1215"><a href="#Mesh-1215"><span class="linenos">1215</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Mesh-1216"><a href="#Mesh-1216"><span class="linenos">1216</span></a>        <span class="n">fields_on_interior_only</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;auto&quot;</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
</span><span id="Mesh-1217"><a href="#Mesh-1217"><span class="linenos">1217</span></a>        <span class="n">disable_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Mesh-1218"><a href="#Mesh-1218"><span class="linenos">1218</span></a>    <span class="p">):</span>
</span><span id="Mesh-1219"><a href="#Mesh-1219"><span class="linenos">1219</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh-1220"><a href="#Mesh-1220"><span class="linenos">1220</span></a><span class="sd">        Save the mesh geometry and associated fields as ParaView-compatible files.</span>
</span><span id="Mesh-1221"><a href="#Mesh-1221"><span class="linenos">1221</span></a>
</span><span id="Mesh-1222"><a href="#Mesh-1222"><span class="linenos">1222</span></a><span class="sd">        This method is a convenience wrapper around</span>
</span><span id="Mesh-1223"><a href="#Mesh-1223"><span class="linenos">1223</span></a><span class="sd">        `MultiPatchBSplineConnectivity.save_paraview`.</span>
</span><span id="Mesh-1224"><a href="#Mesh-1224"><span class="linenos">1224</span></a><span class="sd">        It evaluates the multipatch B-spline geometry represented by the current</span>
</span><span id="Mesh-1225"><a href="#Mesh-1225"><span class="linenos">1225</span></a><span class="sd">        mesh and exports several VTU files suitable for visualization in ParaView,</span>
</span><span id="Mesh-1226"><a href="#Mesh-1226"><span class="linenos">1226</span></a><span class="sd">        with an optional PVD file for grouping time steps and mesh components.</span>
</span><span id="Mesh-1227"><a href="#Mesh-1227"><span class="linenos">1227</span></a>
</span><span id="Mesh-1228"><a href="#Mesh-1228"><span class="linenos">1228</span></a><span class="sd">        The following visualization meshes are generated:</span>
</span><span id="Mesh-1229"><a href="#Mesh-1229"><span class="linenos">1229</span></a><span class="sd">        - Interior mesh representing the evaluated B-spline geometry</span>
</span><span id="Mesh-1230"><a href="#Mesh-1230"><span class="linenos">1230</span></a><span class="sd">        - Element borders mesh showing the patch discretization</span>
</span><span id="Mesh-1231"><a href="#Mesh-1231"><span class="linenos">1231</span></a><span class="sd">        - Control points mesh showing the control structure</span>
</span><span id="Mesh-1232"><a href="#Mesh-1232"><span class="linenos">1232</span></a>
</span><span id="Mesh-1233"><a href="#Mesh-1233"><span class="linenos">1233</span></a><span class="sd">        Parameters</span>
</span><span id="Mesh-1234"><a href="#Mesh-1234"><span class="linenos">1234</span></a><span class="sd">        ----------</span>
</span><span id="Mesh-1235"><a href="#Mesh-1235"><span class="linenos">1235</span></a><span class="sd">        path : str</span>
</span><span id="Mesh-1236"><a href="#Mesh-1236"><span class="linenos">1236</span></a><span class="sd">            Directory where the ParaView files will be written.</span>
</span><span id="Mesh-1237"><a href="#Mesh-1237"><span class="linenos">1237</span></a><span class="sd">        name : str</span>
</span><span id="Mesh-1238"><a href="#Mesh-1238"><span class="linenos">1238</span></a><span class="sd">            Base name used for all output files.</span>
</span><span id="Mesh-1239"><a href="#Mesh-1239"><span class="linenos">1239</span></a><span class="sd">        n_step : int, optional</span>
</span><span id="Mesh-1240"><a href="#Mesh-1240"><span class="linenos">1240</span></a><span class="sd">            Number of time steps to export. Default is `1`.</span>
</span><span id="Mesh-1241"><a href="#Mesh-1241"><span class="linenos">1241</span></a><span class="sd">        n_eval_per_elem : int or iterable of int, optional</span>
</span><span id="Mesh-1242"><a href="#Mesh-1242"><span class="linenos">1242</span></a><span class="sd">            Number of evaluation points per element for each parametric dimension.</span>
</span><span id="Mesh-1243"><a href="#Mesh-1243"><span class="linenos">1243</span></a><span class="sd">            If an integer is provided, the same value is used for all dimensions.</span>
</span><span id="Mesh-1244"><a href="#Mesh-1244"><span class="linenos">1244</span></a><span class="sd">            If an iterable is provided, each value corresponds to one parametric</span>
</span><span id="Mesh-1245"><a href="#Mesh-1245"><span class="linenos">1245</span></a><span class="sd">            direction. Default is `10`.</span>
</span><span id="Mesh-1246"><a href="#Mesh-1246"><span class="linenos">1246</span></a><span class="sd">        unique_fields : dict, optional</span>
</span><span id="Mesh-1247"><a href="#Mesh-1247"><span class="linenos">1247</span></a><span class="sd">            Fields defined on unique control points to be exported.</span>
</span><span id="Mesh-1248"><a href="#Mesh-1248"><span class="linenos">1248</span></a><span class="sd">            Keys are field names and values are numpy arrays.</span>
</span><span id="Mesh-1249"><a href="#Mesh-1249"><span class="linenos">1249</span></a><span class="sd">            Callables are not supported here. Default is an empty dictionary.</span>
</span><span id="Mesh-1250"><a href="#Mesh-1250"><span class="linenos">1250</span></a><span class="sd">        separated_fields : list of dict, optional</span>
</span><span id="Mesh-1251"><a href="#Mesh-1251"><span class="linenos">1251</span></a><span class="sd">            Fields defined in separated (per-patch) representation.</span>
</span><span id="Mesh-1252"><a href="#Mesh-1252"><span class="linenos">1252</span></a><span class="sd">            Each list entry corresponds to one patch and contains a dictionary</span>
</span><span id="Mesh-1253"><a href="#Mesh-1253"><span class="linenos">1253</span></a><span class="sd">            mapping field names to field values. See</span>
</span><span id="Mesh-1254"><a href="#Mesh-1254"><span class="linenos">1254</span></a><span class="sd">            `MultiPatchBSplineConnectivity.save_paraview` for supported</span>
</span><span id="Mesh-1255"><a href="#Mesh-1255"><span class="linenos">1255</span></a><span class="sd">            formats.</span>
</span><span id="Mesh-1256"><a href="#Mesh-1256"><span class="linenos">1256</span></a><span class="sd">        XI_list : iterable of tuple of ndarray, optional</span>
</span><span id="Mesh-1257"><a href="#Mesh-1257"><span class="linenos">1257</span></a><span class="sd">            Parametric coordinates at which the geometry and fields are evaluated.</span>
</span><span id="Mesh-1258"><a href="#Mesh-1258"><span class="linenos">1258</span></a><span class="sd">            If provided, this overrides `n_eval_per_elem`.</span>
</span><span id="Mesh-1259"><a href="#Mesh-1259"><span class="linenos">1259</span></a><span class="sd">        groups : dict, optional</span>
</span><span id="Mesh-1260"><a href="#Mesh-1260"><span class="linenos">1260</span></a><span class="sd">            Dictionary describing ParaView file groups for PVD organization.</span>
</span><span id="Mesh-1261"><a href="#Mesh-1261"><span class="linenos">1261</span></a><span class="sd">            If `None`, groups are created automatically.</span>
</span><span id="Mesh-1262"><a href="#Mesh-1262"><span class="linenos">1262</span></a><span class="sd">        make_pvd : bool, optional</span>
</span><span id="Mesh-1263"><a href="#Mesh-1263"><span class="linenos">1263</span></a><span class="sd">            If `True`, generates a PVD file grouping all VTU files.</span>
</span><span id="Mesh-1264"><a href="#Mesh-1264"><span class="linenos">1264</span></a><span class="sd">            Default is `True`.</span>
</span><span id="Mesh-1265"><a href="#Mesh-1265"><span class="linenos">1265</span></a><span class="sd">        verbose : bool, optional</span>
</span><span id="Mesh-1266"><a href="#Mesh-1266"><span class="linenos">1266</span></a><span class="sd">            If `True`, prints progress information. Default is `True`.</span>
</span><span id="Mesh-1267"><a href="#Mesh-1267"><span class="linenos">1267</span></a><span class="sd">        fields_on_interior_only : bool, &quot;auto&quot;, or list of str, optional</span>
</span><span id="Mesh-1268"><a href="#Mesh-1268"><span class="linenos">1268</span></a><span class="sd">            Controls on which meshes fields are written:</span>
</span><span id="Mesh-1269"><a href="#Mesh-1269"><span class="linenos">1269</span></a><span class="sd">            - `True`: interior mesh only</span>
</span><span id="Mesh-1270"><a href="#Mesh-1270"><span class="linenos">1270</span></a><span class="sd">            - `False`: all meshes</span>
</span><span id="Mesh-1271"><a href="#Mesh-1271"><span class="linenos">1271</span></a><span class="sd">            - `&quot;auto&quot;`: displacement-like fields are written on all meshes,</span>
</span><span id="Mesh-1272"><a href="#Mesh-1272"><span class="linenos">1272</span></a><span class="sd">              others only on the interior mesh</span>
</span><span id="Mesh-1273"><a href="#Mesh-1273"><span class="linenos">1273</span></a><span class="sd">            - list of str: names of fields to include on all meshes</span>
</span><span id="Mesh-1274"><a href="#Mesh-1274"><span class="linenos">1274</span></a><span class="sd">              Default is `&quot;auto&quot;`.</span>
</span><span id="Mesh-1275"><a href="#Mesh-1275"><span class="linenos">1275</span></a><span class="sd">        disable_parallel : bool, optional</span>
</span><span id="Mesh-1276"><a href="#Mesh-1276"><span class="linenos">1276</span></a><span class="sd">            If `True`, disables parallel evaluation. Default is `False`.</span>
</span><span id="Mesh-1277"><a href="#Mesh-1277"><span class="linenos">1277</span></a>
</span><span id="Mesh-1278"><a href="#Mesh-1278"><span class="linenos">1278</span></a><span class="sd">        Returns</span>
</span><span id="Mesh-1279"><a href="#Mesh-1279"><span class="linenos">1279</span></a><span class="sd">        -------</span>
</span><span id="Mesh-1280"><a href="#Mesh-1280"><span class="linenos">1280</span></a><span class="sd">        dict[str, dict[str, Union[str, int]]]</span>
</span><span id="Mesh-1281"><a href="#Mesh-1281"><span class="linenos">1281</span></a><span class="sd">            Updated groups dictionary describing the generated ParaView files.</span>
</span><span id="Mesh-1282"><a href="#Mesh-1282"><span class="linenos">1282</span></a>
</span><span id="Mesh-1283"><a href="#Mesh-1283"><span class="linenos">1283</span></a><span class="sd">        Notes</span>
</span><span id="Mesh-1284"><a href="#Mesh-1284"><span class="linenos">1284</span></a><span class="sd">        -----</span>
</span><span id="Mesh-1285"><a href="#Mesh-1285"><span class="linenos">1285</span></a><span class="sd">        - This method don&#39;t modifies the internal state; it only performs evaluation and</span>
</span><span id="Mesh-1286"><a href="#Mesh-1286"><span class="linenos">1286</span></a><span class="sd">          export.</span>
</span><span id="Mesh-1287"><a href="#Mesh-1287"><span class="linenos">1287</span></a><span class="sd">        - Geometry and fields are evaluated using the current control points and splines.</span>
</span><span id="Mesh-1288"><a href="#Mesh-1288"><span class="linenos">1288</span></a><span class="sd">        - For full details on supported field formats and file organization, see</span>
</span><span id="Mesh-1289"><a href="#Mesh-1289"><span class="linenos">1289</span></a><span class="sd">          `MultiPatchBSplineConnectivity.save_paraview`.</span>
</span><span id="Mesh-1290"><a href="#Mesh-1290"><span class="linenos">1290</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh-1291"><a href="#Mesh-1291"><span class="linenos">1291</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">save_paraview</span><span class="p">(</span>
</span><span id="Mesh-1292"><a href="#Mesh-1292"><span class="linenos">1292</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">,</span>
</span><span id="Mesh-1293"><a href="#Mesh-1293"><span class="linenos">1293</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_separated_ctrl_pts</span><span class="p">(),</span>
</span><span id="Mesh-1294"><a href="#Mesh-1294"><span class="linenos">1294</span></a>            <span class="n">path</span><span class="p">,</span>
</span><span id="Mesh-1295"><a href="#Mesh-1295"><span class="linenos">1295</span></a>            <span class="n">name</span><span class="p">,</span>
</span><span id="Mesh-1296"><a href="#Mesh-1296"><span class="linenos">1296</span></a>            <span class="n">n_step</span><span class="p">,</span>
</span><span id="Mesh-1297"><a href="#Mesh-1297"><span class="linenos">1297</span></a>            <span class="n">n_eval_per_elem</span><span class="p">,</span>
</span><span id="Mesh-1298"><a href="#Mesh-1298"><span class="linenos">1298</span></a>            <span class="n">unique_fields</span><span class="p">,</span>
</span><span id="Mesh-1299"><a href="#Mesh-1299"><span class="linenos">1299</span></a>            <span class="n">separated_fields</span><span class="p">,</span>
</span><span id="Mesh-1300"><a href="#Mesh-1300"><span class="linenos">1300</span></a>            <span class="n">XI_list</span><span class="p">,</span>
</span><span id="Mesh-1301"><a href="#Mesh-1301"><span class="linenos">1301</span></a>            <span class="n">groups</span><span class="p">,</span>
</span><span id="Mesh-1302"><a href="#Mesh-1302"><span class="linenos">1302</span></a>            <span class="n">make_pvd</span><span class="p">,</span>
</span><span id="Mesh-1303"><a href="#Mesh-1303"><span class="linenos">1303</span></a>            <span class="n">verbose</span><span class="p">,</span>
</span><span id="Mesh-1304"><a href="#Mesh-1304"><span class="linenos">1304</span></a>            <span class="n">fields_on_interior_only</span><span class="p">,</span>
</span><span id="Mesh-1305"><a href="#Mesh-1305"><span class="linenos">1305</span></a>            <span class="n">disable_parallel</span><span class="p">,</span>
</span><span id="Mesh-1306"><a href="#Mesh-1306"><span class="linenos">1306</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Represents a multi-patch B-spline mesh.</p>

<p>This class manages a multi-patch B-spline mesh, including control points,
connectivity, evaluation, field propagation, and visualization. It supports
both 2D and 3D meshes.</p>

<h6 id="attributes">Attributes</h6>

<ul>
<li><strong>connectivity</strong> (MultiPatchBSplineConnectivity):
Multi-patch connectivity structure.</li>
<li><strong>splines</strong> (list[BSpline]):
List of B-spline objects for each patch.</li>
<li><strong>unique_ctrl_pts</strong> (np.ndarray):
Array of unique control points for the entire mesh.</li>
<li><strong>ref_inds</strong> (np.ndarray):
Reference indices used for linking to submeshes.</li>
</ul>
</div>


                            <div id="Mesh.__init__" class="classattr">
                                        <input id="Mesh.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Mesh</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">splines</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">bsplyne</span><span class="o">.</span><span class="n">b_spline</span><span class="o">.</span><span class="n">BSpline</span><span class="p">]</span>,</span><span class="param">	<span class="n">ctrl_pts</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">]]</span>,</span><span class="param">	<span class="n">connectivity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">bsplyne</span><span class="o">.</span><span class="n">multi_patch_b_spline</span><span class="o">.</span><span class="n">MultiPatchBSplineConnectivity</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">ref_inds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">integer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="Mesh.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Mesh.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Mesh.__init__-56"><a href="#Mesh.__init__-56"><span class="linenos"> 56</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="Mesh.__init__-57"><a href="#Mesh.__init__-57"><span class="linenos"> 57</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Mesh.__init__-58"><a href="#Mesh.__init__-58"><span class="linenos"> 58</span></a>        <span class="n">splines</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">BSpline</span><span class="p">],</span>
</span><span id="Mesh.__init__-59"><a href="#Mesh.__init__-59"><span class="linenos"> 59</span></a>        <span class="n">ctrl_pts</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]],</span>
</span><span id="Mesh.__init__-60"><a href="#Mesh.__init__-60"><span class="linenos"> 60</span></a>        <span class="n">connectivity</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">MultiPatchBSplineConnectivity</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Mesh.__init__-61"><a href="#Mesh.__init__-61"><span class="linenos"> 61</span></a>        <span class="n">ref_inds</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Mesh.__init__-62"><a href="#Mesh.__init__-62"><span class="linenos"> 62</span></a>    <span class="p">):</span>
</span><span id="Mesh.__init__-63"><a href="#Mesh.__init__-63"><span class="linenos"> 63</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh.__init__-64"><a href="#Mesh.__init__-64"><span class="linenos"> 64</span></a><span class="sd">        Initialize a multi-patch B-spline mesh.</span>
</span><span id="Mesh.__init__-65"><a href="#Mesh.__init__-65"><span class="linenos"> 65</span></a>
</span><span id="Mesh.__init__-66"><a href="#Mesh.__init__-66"><span class="linenos"> 66</span></a><span class="sd">        This constructor sets up a multi-patch mesh with B-spline patches,</span>
</span><span id="Mesh.__init__-67"><a href="#Mesh.__init__-67"><span class="linenos"> 67</span></a><span class="sd">        control points, and optional connectivity and reference indices. The mesh</span>
</span><span id="Mesh.__init__-68"><a href="#Mesh.__init__-68"><span class="linenos"> 68</span></a><span class="sd">        can be initialized either with separated control points per patch or with</span>
</span><span id="Mesh.__init__-69"><a href="#Mesh.__init__-69"><span class="linenos"> 69</span></a><span class="sd">        a packed array of unique control points. If connectivity is not provided,</span>
</span><span id="Mesh.__init__-70"><a href="#Mesh.__init__-70"><span class="linenos"> 70</span></a><span class="sd">        it is inferred automatically from separated control points.</span>
</span><span id="Mesh.__init__-71"><a href="#Mesh.__init__-71"><span class="linenos"> 71</span></a>
</span><span id="Mesh.__init__-72"><a href="#Mesh.__init__-72"><span class="linenos"> 72</span></a><span class="sd">        Parameters</span>
</span><span id="Mesh.__init__-73"><a href="#Mesh.__init__-73"><span class="linenos"> 73</span></a><span class="sd">        ----------</span>
</span><span id="Mesh.__init__-74"><a href="#Mesh.__init__-74"><span class="linenos"> 74</span></a><span class="sd">        splines : list[BSpline]</span>
</span><span id="Mesh.__init__-75"><a href="#Mesh.__init__-75"><span class="linenos"> 75</span></a><span class="sd">            List of `BSpline` objects for each patch.</span>
</span><span id="Mesh.__init__-76"><a href="#Mesh.__init__-76"><span class="linenos"> 76</span></a>
</span><span id="Mesh.__init__-77"><a href="#Mesh.__init__-77"><span class="linenos"> 77</span></a><span class="sd">        ctrl_pts : list[np.ndarray] or np.ndarray</span>
</span><span id="Mesh.__init__-78"><a href="#Mesh.__init__-78"><span class="linenos"> 78</span></a><span class="sd">            Control points of the mesh.</span>
</span><span id="Mesh.__init__-79"><a href="#Mesh.__init__-79"><span class="linenos"> 79</span></a><span class="sd">            - If a list of arrays is provided, each array corresponds to a patch</span>
</span><span id="Mesh.__init__-80"><a href="#Mesh.__init__-80"><span class="linenos"> 80</span></a><span class="sd">            (shape: `(dim_phys, n1, ..., nd)`).</span>
</span><span id="Mesh.__init__-81"><a href="#Mesh.__init__-81"><span class="linenos"> 81</span></a><span class="sd">            - If a single array is provided, it should contain either the unique</span>
</span><span id="Mesh.__init__-82"><a href="#Mesh.__init__-82"><span class="linenos"> 82</span></a><span class="sd">            control points or the full concatenated points for all patches.</span>
</span><span id="Mesh.__init__-83"><a href="#Mesh.__init__-83"><span class="linenos"> 83</span></a>
</span><span id="Mesh.__init__-84"><a href="#Mesh.__init__-84"><span class="linenos"> 84</span></a><span class="sd">        connectivity : MultiPatchBSplineConnectivity, optional</span>
</span><span id="Mesh.__init__-85"><a href="#Mesh.__init__-85"><span class="linenos"> 85</span></a><span class="sd">            Multi-patch connectivity object. If `None`, it is automatically inferred</span>
</span><span id="Mesh.__init__-86"><a href="#Mesh.__init__-86"><span class="linenos"> 86</span></a><span class="sd">            from separated control points.</span>
</span><span id="Mesh.__init__-87"><a href="#Mesh.__init__-87"><span class="linenos"> 87</span></a>
</span><span id="Mesh.__init__-88"><a href="#Mesh.__init__-88"><span class="linenos"> 88</span></a><span class="sd">        ref_inds : np.ndarray, optional</span>
</span><span id="Mesh.__init__-89"><a href="#Mesh.__init__-89"><span class="linenos"> 89</span></a><span class="sd">            Reference indices mapping control points to submeshes or external data.</span>
</span><span id="Mesh.__init__-90"><a href="#Mesh.__init__-90"><span class="linenos"> 90</span></a><span class="sd">            If `None`, defaults to `np.arange(nb_unique_nodes)`.</span>
</span><span id="Mesh.__init__-91"><a href="#Mesh.__init__-91"><span class="linenos"> 91</span></a>
</span><span id="Mesh.__init__-92"><a href="#Mesh.__init__-92"><span class="linenos"> 92</span></a><span class="sd">        Notes</span>
</span><span id="Mesh.__init__-93"><a href="#Mesh.__init__-93"><span class="linenos"> 93</span></a><span class="sd">        -----</span>
</span><span id="Mesh.__init__-94"><a href="#Mesh.__init__-94"><span class="linenos"> 94</span></a><span class="sd">        - The mesh stores control points in a &quot;unique&quot; packed format (`self.unique_ctrl_pts`)</span>
</span><span id="Mesh.__init__-95"><a href="#Mesh.__init__-95"><span class="linenos"> 95</span></a><span class="sd">        internally, regardless of input format.</span>
</span><span id="Mesh.__init__-96"><a href="#Mesh.__init__-96"><span class="linenos"> 96</span></a><span class="sd">        - If `ctrl_pts` is a single array but does not match the number of unique nodes,</span>
</span><span id="Mesh.__init__-97"><a href="#Mesh.__init__-97"><span class="linenos"> 97</span></a><span class="sd">        it is automatically packed using the provided or inferred connectivity.</span>
</span><span id="Mesh.__init__-98"><a href="#Mesh.__init__-98"><span class="linenos"> 98</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh.__init__-99"><a href="#Mesh.__init__-99"><span class="linenos"> 99</span></a>        <span class="k">if</span> <span class="n">connectivity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Mesh.__init__-100"><a href="#Mesh.__init__-100"><span class="linenos">100</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ctrl_pts</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="Mesh.__init__-101"><a href="#Mesh.__init__-101"><span class="linenos">101</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="Mesh.__init__-102"><a href="#Mesh.__init__-102"><span class="linenos">102</span></a>                    <span class="s2">&quot;Can only infer connectivity from separated control points list.&quot;</span>
</span><span id="Mesh.__init__-103"><a href="#Mesh.__init__-103"><span class="linenos">103</span></a>                <span class="p">)</span>
</span><span id="Mesh.__init__-104"><a href="#Mesh.__init__-104"><span class="linenos">104</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">=</span> <span class="n">MultiPatchBSplineConnectivity</span><span class="o">.</span><span class="n">from_separated_ctrlPts</span><span class="p">(</span>
</span><span id="Mesh.__init__-105"><a href="#Mesh.__init__-105"><span class="linenos">105</span></a>                <span class="n">ctrl_pts</span>
</span><span id="Mesh.__init__-106"><a href="#Mesh.__init__-106"><span class="linenos">106</span></a>            <span class="p">)</span>
</span><span id="Mesh.__init__-107"><a href="#Mesh.__init__-107"><span class="linenos">107</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Mesh.__init__-108"><a href="#Mesh.__init__-108"><span class="linenos">108</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">=</span> <span class="n">connectivity</span>
</span><span id="Mesh.__init__-109"><a href="#Mesh.__init__-109"><span class="linenos">109</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">splines</span> <span class="o">=</span> <span class="n">splines</span>
</span><span id="Mesh.__init__-110"><a href="#Mesh.__init__-110"><span class="linenos">110</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ctrl_pts</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>  <span class="c1"># unique or unpacked state</span>
</span><span id="Mesh.__init__-111"><a href="#Mesh.__init__-111"><span class="linenos">111</span></a>            <span class="k">if</span> <span class="n">ctrl_pts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_unique_nodes</span><span class="p">:</span>  <span class="c1"># unique state</span>
</span><span id="Mesh.__init__-112"><a href="#Mesh.__init__-112"><span class="linenos">112</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">unique_ctrl_pts</span> <span class="o">=</span> <span class="n">ctrl_pts</span>
</span><span id="Mesh.__init__-113"><a href="#Mesh.__init__-113"><span class="linenos">113</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Mesh.__init__-114"><a href="#Mesh.__init__-114"><span class="linenos">114</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">unique_ctrl_pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">ctrl_pts</span><span class="p">)</span>
</span><span id="Mesh.__init__-115"><a href="#Mesh.__init__-115"><span class="linenos">115</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Mesh.__init__-116"><a href="#Mesh.__init__-116"><span class="linenos">116</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_separated_ctrl_pts</span><span class="p">(</span><span class="n">ctrl_pts</span><span class="p">)</span>
</span><span id="Mesh.__init__-117"><a href="#Mesh.__init__-117"><span class="linenos">117</span></a>        <span class="k">if</span> <span class="n">ref_inds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Mesh.__init__-118"><a href="#Mesh.__init__-118"><span class="linenos">118</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ref_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_unique_nodes</span><span class="p">)</span>
</span><span id="Mesh.__init__-119"><a href="#Mesh.__init__-119"><span class="linenos">119</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Mesh.__init__-120"><a href="#Mesh.__init__-120"><span class="linenos">120</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ref_inds</span> <span class="o">=</span> <span class="n">ref_inds</span>
</span></pre></div>


            <div class="docstring"><p>Initialize a multi-patch B-spline mesh.</p>

<p>This constructor sets up a multi-patch mesh with B-spline patches,
control points, and optional connectivity and reference indices. The mesh
can be initialized either with separated control points per patch or with
a packed array of unique control points. If connectivity is not provided,
it is inferred automatically from separated control points.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>splines</strong> (list[BSpline]):
List of <code>BSpline</code> objects for each patch.</li>
<li><strong>ctrl_pts</strong> (list[np.ndarray] or np.ndarray):
Control points of the mesh.
<ul>
<li>If a list of arrays is provided, each array corresponds to a patch
(shape: <code>(dim_phys, n1, ..., nd)</code>).</li>
<li>If a single array is provided, it should contain either the unique
control points or the full concatenated points for all patches.</li>
</ul></li>
<li><strong>connectivity</strong> (MultiPatchBSplineConnectivity, optional):
Multi-patch connectivity object. If <code>None</code>, it is automatically inferred
from separated control points.</li>
<li><strong>ref_inds</strong> (np.ndarray, optional):
Reference indices mapping control points to submeshes or external data.
If <code>None</code>, defaults to <code>np.arange(nb_unique_nodes)</code>.</li>
</ul>

<h6 id="notes">Notes</h6>

<ul>
<li>The mesh stores control points in a "unique" packed format (<code>self.unique_ctrl_pts</code>)
internally, regardless of input format.</li>
<li>If <code>ctrl_pts</code> is a single array but does not match the number of unique nodes,
it is automatically packed using the provided or inferred connectivity.</li>
</ul>
</div>


                            </div>
                            <div id="Mesh.connectivity" class="classattr">
                                <div class="attr variable">
            <span class="name">connectivity</span><span class="annotation">: bsplyne.multi_patch_b_spline.MultiPatchBSplineConnectivity</span>

        
    </div>
    <a class="headerlink" href="#Mesh.connectivity"></a>
    
    

                            </div>
                            <div id="Mesh.splines" class="classattr">
                                <div class="attr variable">
            <span class="name">splines</span><span class="annotation">: list[bsplyne.b_spline.BSpline]</span>

        
    </div>
    <a class="headerlink" href="#Mesh.splines"></a>
    
    

                            </div>
                            <div id="Mesh.unique_ctrl_pts" class="classattr">
                                <div class="attr variable">
            <span class="name">unique_ctrl_pts</span><span class="annotation">: numpy.ndarray[numpy.floating]</span>

        
    </div>
    <a class="headerlink" href="#Mesh.unique_ctrl_pts"></a>
    
    

                            </div>
                            <div id="Mesh.ref_inds" class="classattr">
                                <div class="attr variable">
            <span class="name">ref_inds</span><span class="annotation">: numpy.ndarray[numpy.integer]</span>

        
    </div>
    <a class="headerlink" href="#Mesh.ref_inds"></a>
    
    

                            </div>
                            <div id="Mesh.show" class="classattr">
                                        <input id="Mesh.show-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">show</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Mesh.show-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Mesh.show"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Mesh.show-131"><a href="#Mesh.show-131"><span class="linenos">131</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Mesh.show-132"><a href="#Mesh.show-132"><span class="linenos">132</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh.show-133"><a href="#Mesh.show-133"><span class="linenos">133</span></a><span class="sd">        Display the mesh or the last plot screenshot.</span>
</span><span id="Mesh.show-134"><a href="#Mesh.show-134"><span class="linenos">134</span></a>
</span><span id="Mesh.show-135"><a href="#Mesh.show-135"><span class="linenos">135</span></a><span class="sd">        - If a screenshot from the last `PyVista` plot exists, it is displayed</span>
</span><span id="Mesh.show-136"><a href="#Mesh.show-136"><span class="linenos">136</span></a><span class="sd">        via `Matplotlib`.</span>
</span><span id="Mesh.show-137"><a href="#Mesh.show-137"><span class="linenos">137</span></a><span class="sd">        - Otherwise, prints a simple textual representation of the mesh.</span>
</span><span id="Mesh.show-138"><a href="#Mesh.show-138"><span class="linenos">138</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh.show-139"><a href="#Mesh.show-139"><span class="linenos">139</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_screenshot&quot;</span><span class="p">):</span>
</span><span id="Mesh.show-140"><a href="#Mesh.show-140"><span class="linenos">140</span></a>            <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</span><span id="Mesh.show-141"><a href="#Mesh.show-141"><span class="linenos">141</span></a>
</span><span id="Mesh.show-142"><a href="#Mesh.show-142"><span class="linenos">142</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_screenshot</span><span class="p">)</span>
</span><span id="Mesh.show-143"><a href="#Mesh.show-143"><span class="linenos">143</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
</span><span id="Mesh.show-144"><a href="#Mesh.show-144"><span class="linenos">144</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Screenshot of last plot&quot;</span><span class="p">)</span>
</span><span id="Mesh.show-145"><a href="#Mesh.show-145"><span class="linenos">145</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="Mesh.show-146"><a href="#Mesh.show-146"><span class="linenos">146</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Mesh.show-147"><a href="#Mesh.show-147"><span class="linenos">147</span></a>            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Display the mesh or the last plot screenshot.</p>

<ul>
<li>If a screenshot from the last <code>PyVista</code> plot exists, it is displayed
via <code>Matplotlib</code>.</li>
<li>Otherwise, prints a simple textual representation of the mesh.</li>
</ul>
</div>


                            </div>
                            <div id="Mesh.save" class="classattr">
                                        <input id="Mesh.save-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Mesh.save-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Mesh.save"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Mesh.save-149"><a href="#Mesh.save-149"><span class="linenos">149</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Mesh.save-150"><a href="#Mesh.save-150"><span class="linenos">150</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh.save-151"><a href="#Mesh.save-151"><span class="linenos">151</span></a><span class="sd">        Serialize and save the mesh object to a file using pickle.</span>
</span><span id="Mesh.save-152"><a href="#Mesh.save-152"><span class="linenos">152</span></a>
</span><span id="Mesh.save-153"><a href="#Mesh.save-153"><span class="linenos">153</span></a><span class="sd">        Parameters</span>
</span><span id="Mesh.save-154"><a href="#Mesh.save-154"><span class="linenos">154</span></a><span class="sd">        ----------</span>
</span><span id="Mesh.save-155"><a href="#Mesh.save-155"><span class="linenos">155</span></a><span class="sd">        filename : str</span>
</span><span id="Mesh.save-156"><a href="#Mesh.save-156"><span class="linenos">156</span></a><span class="sd">            Path to the file where the mesh will be saved.</span>
</span><span id="Mesh.save-157"><a href="#Mesh.save-157"><span class="linenos">157</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh.save-158"><a href="#Mesh.save-158"><span class="linenos">158</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Mesh.save-159"><a href="#Mesh.save-159"><span class="linenos">159</span></a>            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Serialize and save the mesh object to a file using pickle.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>filename</strong> (str):
Path to the file where the mesh will be saved.</li>
</ul>
</div>


                            </div>
                            <div id="Mesh.load" class="classattr">
                                        <input id="Mesh.load-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">load</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n"><a href="#Mesh">Mesh</a></span>:</span></span>

                <label class="view-source-button" for="Mesh.load-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Mesh.load"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Mesh.load-161"><a href="#Mesh.load-161"><span class="linenos">161</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Mesh.load-162"><a href="#Mesh.load-162"><span class="linenos">162</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Mesh&quot;</span><span class="p">:</span>
</span><span id="Mesh.load-163"><a href="#Mesh.load-163"><span class="linenos">163</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh.load-164"><a href="#Mesh.load-164"><span class="linenos">164</span></a><span class="sd">        Load a mesh object previously saved with :meth:`save`.</span>
</span><span id="Mesh.load-165"><a href="#Mesh.load-165"><span class="linenos">165</span></a>
</span><span id="Mesh.load-166"><a href="#Mesh.load-166"><span class="linenos">166</span></a><span class="sd">        Parameters</span>
</span><span id="Mesh.load-167"><a href="#Mesh.load-167"><span class="linenos">167</span></a><span class="sd">        ----------</span>
</span><span id="Mesh.load-168"><a href="#Mesh.load-168"><span class="linenos">168</span></a><span class="sd">        filename : str</span>
</span><span id="Mesh.load-169"><a href="#Mesh.load-169"><span class="linenos">169</span></a><span class="sd">            Path to the file containing the pickled mesh.</span>
</span><span id="Mesh.load-170"><a href="#Mesh.load-170"><span class="linenos">170</span></a>
</span><span id="Mesh.load-171"><a href="#Mesh.load-171"><span class="linenos">171</span></a><span class="sd">        Returns</span>
</span><span id="Mesh.load-172"><a href="#Mesh.load-172"><span class="linenos">172</span></a><span class="sd">        -------</span>
</span><span id="Mesh.load-173"><a href="#Mesh.load-173"><span class="linenos">173</span></a><span class="sd">        Mesh</span>
</span><span id="Mesh.load-174"><a href="#Mesh.load-174"><span class="linenos">174</span></a><span class="sd">            The loaded mesh object.</span>
</span><span id="Mesh.load-175"><a href="#Mesh.load-175"><span class="linenos">175</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh.load-176"><a href="#Mesh.load-176"><span class="linenos">176</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Mesh.load-177"><a href="#Mesh.load-177"><span class="linenos">177</span></a>            <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Load a mesh object previously saved with <code><a href="#Mesh.save">save()</a></code>.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>filename</strong> (str):
Path to the file containing the pickled mesh.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>Mesh</strong>: The loaded mesh object.</li>
</ul>
</div>


                            </div>
                            <div id="Mesh.separated_to_unique" class="classattr">
                                        <input id="Mesh.separated_to_unique-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">separated_to_unique</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">field</span>, </span><span class="param"><span class="n">method</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Mesh.separated_to_unique-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Mesh.separated_to_unique"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Mesh.separated_to_unique-179"><a href="#Mesh.separated_to_unique-179"><span class="linenos">179</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">separated_to_unique</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Mesh.separated_to_unique-180"><a href="#Mesh.separated_to_unique-180"><span class="linenos">180</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh.separated_to_unique-181"><a href="#Mesh.separated_to_unique-181"><span class="linenos">181</span></a><span class="sd">        Convert a field given per patch to the unique/global control points representation.</span>
</span><span id="Mesh.separated_to_unique-182"><a href="#Mesh.separated_to_unique-182"><span class="linenos">182</span></a>
</span><span id="Mesh.separated_to_unique-183"><a href="#Mesh.separated_to_unique-183"><span class="linenos">183</span></a><span class="sd">        Parameters</span>
</span><span id="Mesh.separated_to_unique-184"><a href="#Mesh.separated_to_unique-184"><span class="linenos">184</span></a><span class="sd">        ----------</span>
</span><span id="Mesh.separated_to_unique-185"><a href="#Mesh.separated_to_unique-185"><span class="linenos">185</span></a><span class="sd">        field : list[np.ndarray]</span>
</span><span id="Mesh.separated_to_unique-186"><a href="#Mesh.separated_to_unique-186"><span class="linenos">186</span></a><span class="sd">            Field separated per patch.</span>
</span><span id="Mesh.separated_to_unique-187"><a href="#Mesh.separated_to_unique-187"><span class="linenos">187</span></a><span class="sd">        method : optional</span>
</span><span id="Mesh.separated_to_unique-188"><a href="#Mesh.separated_to_unique-188"><span class="linenos">188</span></a><span class="sd">            Agglomeration method passed to :meth:`MultiPatchBSplineConnectivity.agglomerate`.</span>
</span><span id="Mesh.separated_to_unique-189"><a href="#Mesh.separated_to_unique-189"><span class="linenos">189</span></a>
</span><span id="Mesh.separated_to_unique-190"><a href="#Mesh.separated_to_unique-190"><span class="linenos">190</span></a><span class="sd">        Returns</span>
</span><span id="Mesh.separated_to_unique-191"><a href="#Mesh.separated_to_unique-191"><span class="linenos">191</span></a><span class="sd">        -------</span>
</span><span id="Mesh.separated_to_unique-192"><a href="#Mesh.separated_to_unique-192"><span class="linenos">192</span></a><span class="sd">        np.ndarray</span>
</span><span id="Mesh.separated_to_unique-193"><a href="#Mesh.separated_to_unique-193"><span class="linenos">193</span></a><span class="sd">            Field in the unique/global representation.</span>
</span><span id="Mesh.separated_to_unique-194"><a href="#Mesh.separated_to_unique-194"><span class="linenos">194</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh.separated_to_unique-195"><a href="#Mesh.separated_to_unique-195"><span class="linenos">195</span></a>        <span class="k">if</span> <span class="n">method</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Mesh.separated_to_unique-196"><a href="#Mesh.separated_to_unique-196"><span class="linenos">196</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">agglomerate</span><span class="p">(</span><span class="n">field</span><span class="p">))</span>
</span><span id="Mesh.separated_to_unique-197"><a href="#Mesh.separated_to_unique-197"><span class="linenos">197</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Mesh.separated_to_unique-198"><a href="#Mesh.separated_to_unique-198"><span class="linenos">198</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span>
</span><span id="Mesh.separated_to_unique-199"><a href="#Mesh.separated_to_unique-199"><span class="linenos">199</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">agglomerate</span><span class="p">(</span><span class="n">field</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span>
</span><span id="Mesh.separated_to_unique-200"><a href="#Mesh.separated_to_unique-200"><span class="linenos">200</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Convert a field given per patch to the unique/global control points representation.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>field</strong> (list[np.ndarray]):
Field separated per patch.</li>
<li><strong>method</strong> (optional):
Agglomeration method passed to <code>MultiPatchBSplineConnectivity.agglomerate()</code>.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>np.ndarray</strong>: Field in the unique/global representation.</li>
</ul>
</div>


                            </div>
                            <div id="Mesh.unique_to_separated" class="classattr">
                                        <input id="Mesh.unique_to_separated-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">unique_to_separated</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">field</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Mesh.unique_to_separated-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Mesh.unique_to_separated"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Mesh.unique_to_separated-202"><a href="#Mesh.unique_to_separated-202"><span class="linenos">202</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">unique_to_separated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
</span><span id="Mesh.unique_to_separated-203"><a href="#Mesh.unique_to_separated-203"><span class="linenos">203</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh.unique_to_separated-204"><a href="#Mesh.unique_to_separated-204"><span class="linenos">204</span></a><span class="sd">        Convert a field in the unique/global representation to a per-patch separated form.</span>
</span><span id="Mesh.unique_to_separated-205"><a href="#Mesh.unique_to_separated-205"><span class="linenos">205</span></a>
</span><span id="Mesh.unique_to_separated-206"><a href="#Mesh.unique_to_separated-206"><span class="linenos">206</span></a><span class="sd">        Parameters</span>
</span><span id="Mesh.unique_to_separated-207"><a href="#Mesh.unique_to_separated-207"><span class="linenos">207</span></a><span class="sd">        ----------</span>
</span><span id="Mesh.unique_to_separated-208"><a href="#Mesh.unique_to_separated-208"><span class="linenos">208</span></a><span class="sd">        field : np.ndarray</span>
</span><span id="Mesh.unique_to_separated-209"><a href="#Mesh.unique_to_separated-209"><span class="linenos">209</span></a><span class="sd">            Field in unique/global representation.</span>
</span><span id="Mesh.unique_to_separated-210"><a href="#Mesh.unique_to_separated-210"><span class="linenos">210</span></a>
</span><span id="Mesh.unique_to_separated-211"><a href="#Mesh.unique_to_separated-211"><span class="linenos">211</span></a><span class="sd">        Returns</span>
</span><span id="Mesh.unique_to_separated-212"><a href="#Mesh.unique_to_separated-212"><span class="linenos">212</span></a><span class="sd">        -------</span>
</span><span id="Mesh.unique_to_separated-213"><a href="#Mesh.unique_to_separated-213"><span class="linenos">213</span></a><span class="sd">        list[np.ndarray]</span>
</span><span id="Mesh.unique_to_separated-214"><a href="#Mesh.unique_to_separated-214"><span class="linenos">214</span></a><span class="sd">            Field separated per patch.</span>
</span><span id="Mesh.unique_to_separated-215"><a href="#Mesh.unique_to_separated-215"><span class="linenos">215</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh.unique_to_separated-216"><a href="#Mesh.unique_to_separated-216"><span class="linenos">216</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">separate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">field</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Convert a field in the unique/global representation to a per-patch separated form.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>field</strong> (np.ndarray):
Field in unique/global representation.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>list[np.ndarray]</strong>: Field separated per patch.</li>
</ul>
</div>


                            </div>
                            <div id="Mesh.get_separated_ctrl_pts" class="classattr">
                                        <input id="Mesh.get_separated_ctrl_pts-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_separated_ctrl_pts</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="Mesh.get_separated_ctrl_pts-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Mesh.get_separated_ctrl_pts"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Mesh.get_separated_ctrl_pts-218"><a href="#Mesh.get_separated_ctrl_pts-218"><span class="linenos">218</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_separated_ctrl_pts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]]:</span>
</span><span id="Mesh.get_separated_ctrl_pts-219"><a href="#Mesh.get_separated_ctrl_pts-219"><span class="linenos">219</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh.get_separated_ctrl_pts-220"><a href="#Mesh.get_separated_ctrl_pts-220"><span class="linenos">220</span></a><span class="sd">        Return the control points as a list of arrays, one per patch.</span>
</span><span id="Mesh.get_separated_ctrl_pts-221"><a href="#Mesh.get_separated_ctrl_pts-221"><span class="linenos">221</span></a>
</span><span id="Mesh.get_separated_ctrl_pts-222"><a href="#Mesh.get_separated_ctrl_pts-222"><span class="linenos">222</span></a><span class="sd">        Returns</span>
</span><span id="Mesh.get_separated_ctrl_pts-223"><a href="#Mesh.get_separated_ctrl_pts-223"><span class="linenos">223</span></a><span class="sd">        -------</span>
</span><span id="Mesh.get_separated_ctrl_pts-224"><a href="#Mesh.get_separated_ctrl_pts-224"><span class="linenos">224</span></a><span class="sd">        list[np.ndarray]</span>
</span><span id="Mesh.get_separated_ctrl_pts-225"><a href="#Mesh.get_separated_ctrl_pts-225"><span class="linenos">225</span></a><span class="sd">            Control points separated per patch.</span>
</span><span id="Mesh.get_separated_ctrl_pts-226"><a href="#Mesh.get_separated_ctrl_pts-226"><span class="linenos">226</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh.get_separated_ctrl_pts-227"><a href="#Mesh.get_separated_ctrl_pts-227"><span class="linenos">227</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_to_separated</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unique_ctrl_pts</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return the control points as a list of arrays, one per patch.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>list[np.ndarray]</strong>: Control points separated per patch.</li>
</ul>
</div>


                            </div>
                            <div id="Mesh.set_separated_ctrl_pts" class="classattr">
                                        <input id="Mesh.set_separated_ctrl_pts-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_separated_ctrl_pts</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">separated_ctrl_pts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">]]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Mesh.set_separated_ctrl_pts-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Mesh.set_separated_ctrl_pts"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Mesh.set_separated_ctrl_pts-229"><a href="#Mesh.set_separated_ctrl_pts-229"><span class="linenos">229</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_separated_ctrl_pts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">separated_ctrl_pts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]]):</span>
</span><span id="Mesh.set_separated_ctrl_pts-230"><a href="#Mesh.set_separated_ctrl_pts-230"><span class="linenos">230</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh.set_separated_ctrl_pts-231"><a href="#Mesh.set_separated_ctrl_pts-231"><span class="linenos">231</span></a><span class="sd">        Set the mesh control points from a list of arrays (one per patch).</span>
</span><span id="Mesh.set_separated_ctrl_pts-232"><a href="#Mesh.set_separated_ctrl_pts-232"><span class="linenos">232</span></a>
</span><span id="Mesh.set_separated_ctrl_pts-233"><a href="#Mesh.set_separated_ctrl_pts-233"><span class="linenos">233</span></a><span class="sd">        Parameters</span>
</span><span id="Mesh.set_separated_ctrl_pts-234"><a href="#Mesh.set_separated_ctrl_pts-234"><span class="linenos">234</span></a><span class="sd">        ----------</span>
</span><span id="Mesh.set_separated_ctrl_pts-235"><a href="#Mesh.set_separated_ctrl_pts-235"><span class="linenos">235</span></a><span class="sd">        separated_ctrl_pts : list[np.ndarray]</span>
</span><span id="Mesh.set_separated_ctrl_pts-236"><a href="#Mesh.set_separated_ctrl_pts-236"><span class="linenos">236</span></a><span class="sd">            Control points separated per patch.</span>
</span><span id="Mesh.set_separated_ctrl_pts-237"><a href="#Mesh.set_separated_ctrl_pts-237"><span class="linenos">237</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh.set_separated_ctrl_pts-238"><a href="#Mesh.set_separated_ctrl_pts-238"><span class="linenos">238</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">unique_ctrl_pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">separated_to_unique</span><span class="p">(</span><span class="n">separated_ctrl_pts</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Set the mesh control points from a list of arrays (one per patch).</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>separated_ctrl_pts</strong> (list[np.ndarray]):
Control points separated per patch.</li>
</ul>
</div>


                            </div>
                            <div id="Mesh.assemble_grads" class="classattr">
                                        <input id="Mesh.assemble_grads-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">assemble_grads</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">terms</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>, </span><span class="param"><span class="n">field_size</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="Mesh.assemble_grads-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Mesh.assemble_grads"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Mesh.assemble_grads-302"><a href="#Mesh.assemble_grads-302"><span class="linenos">302</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">assemble_grads</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">terms</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">field_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="Mesh.assemble_grads-303"><a href="#Mesh.assemble_grads-303"><span class="linenos">303</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh.assemble_grads-304"><a href="#Mesh.assemble_grads-304"><span class="linenos">304</span></a><span class="sd">        Assemble patch-wise gradient vectors into a global gradient vector.</span>
</span><span id="Mesh.assemble_grads-305"><a href="#Mesh.assemble_grads-305"><span class="linenos">305</span></a>
</span><span id="Mesh.assemble_grads-306"><a href="#Mesh.assemble_grads-306"><span class="linenos">306</span></a><span class="sd">        Each entry in `terms` corresponds to a gradient vector computed on a single</span>
</span><span id="Mesh.assemble_grads-307"><a href="#Mesh.assemble_grads-307"><span class="linenos">307</span></a><span class="sd">        patch. This method uses the mesh connectivity to map patch-local indices</span>
</span><span id="Mesh.assemble_grads-308"><a href="#Mesh.assemble_grads-308"><span class="linenos">308</span></a><span class="sd">        to global unique node indices and sums contributions from overlapping nodes.</span>
</span><span id="Mesh.assemble_grads-309"><a href="#Mesh.assemble_grads-309"><span class="linenos">309</span></a>
</span><span id="Mesh.assemble_grads-310"><a href="#Mesh.assemble_grads-310"><span class="linenos">310</span></a><span class="sd">        Important: Assumes that the degrees of freedom are arranged per field,</span>
</span><span id="Mesh.assemble_grads-311"><a href="#Mesh.assemble_grads-311"><span class="linenos">311</span></a><span class="sd">        i.e., `[x_0, ..., x_n, y_0, ..., y_n, z_0, ..., z_n]`. It does not</span>
</span><span id="Mesh.assemble_grads-312"><a href="#Mesh.assemble_grads-312"><span class="linenos">312</span></a><span class="sd">        work if the DOFs are interleaved as `[x_0, y_0, z_0, x_1, y_1, z_1, ...]`.</span>
</span><span id="Mesh.assemble_grads-313"><a href="#Mesh.assemble_grads-313"><span class="linenos">313</span></a>
</span><span id="Mesh.assemble_grads-314"><a href="#Mesh.assemble_grads-314"><span class="linenos">314</span></a><span class="sd">        Parameters</span>
</span><span id="Mesh.assemble_grads-315"><a href="#Mesh.assemble_grads-315"><span class="linenos">315</span></a><span class="sd">        ----------</span>
</span><span id="Mesh.assemble_grads-316"><a href="#Mesh.assemble_grads-316"><span class="linenos">316</span></a><span class="sd">        terms : list of np.ndarray</span>
</span><span id="Mesh.assemble_grads-317"><a href="#Mesh.assemble_grads-317"><span class="linenos">317</span></a><span class="sd">            Gradient vectors for each patch, typically computed from patch-local</span>
</span><span id="Mesh.assemble_grads-318"><a href="#Mesh.assemble_grads-318"><span class="linenos">318</span></a><span class="sd">            operations.</span>
</span><span id="Mesh.assemble_grads-319"><a href="#Mesh.assemble_grads-319"><span class="linenos">319</span></a><span class="sd">        field_size : int</span>
</span><span id="Mesh.assemble_grads-320"><a href="#Mesh.assemble_grads-320"><span class="linenos">320</span></a><span class="sd">            Number of degrees of freedom per mesh node (e.g., 3 for 3D displacements).</span>
</span><span id="Mesh.assemble_grads-321"><a href="#Mesh.assemble_grads-321"><span class="linenos">321</span></a>
</span><span id="Mesh.assemble_grads-322"><a href="#Mesh.assemble_grads-322"><span class="linenos">322</span></a><span class="sd">        Returns</span>
</span><span id="Mesh.assemble_grads-323"><a href="#Mesh.assemble_grads-323"><span class="linenos">323</span></a><span class="sd">        -------</span>
</span><span id="Mesh.assemble_grads-324"><a href="#Mesh.assemble_grads-324"><span class="linenos">324</span></a><span class="sd">        np.ndarray</span>
</span><span id="Mesh.assemble_grads-325"><a href="#Mesh.assemble_grads-325"><span class="linenos">325</span></a><span class="sd">            Global gradient vector of size `field_size * nb_unique_nodes`.</span>
</span><span id="Mesh.assemble_grads-326"><a href="#Mesh.assemble_grads-326"><span class="linenos">326</span></a>
</span><span id="Mesh.assemble_grads-327"><a href="#Mesh.assemble_grads-327"><span class="linenos">327</span></a><span class="sd">        Notes</span>
</span><span id="Mesh.assemble_grads-328"><a href="#Mesh.assemble_grads-328"><span class="linenos">328</span></a><span class="sd">        -----</span>
</span><span id="Mesh.assemble_grads-329"><a href="#Mesh.assemble_grads-329"><span class="linenos">329</span></a><span class="sd">        - Uses :meth:`MultiPatchBSplineConnectivity.unique_field_indices` to map</span>
</span><span id="Mesh.assemble_grads-330"><a href="#Mesh.assemble_grads-330"><span class="linenos">330</span></a><span class="sd">        patch-local degrees of freedom to global indices.</span>
</span><span id="Mesh.assemble_grads-331"><a href="#Mesh.assemble_grads-331"><span class="linenos">331</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh.assemble_grads-332"><a href="#Mesh.assemble_grads-332"><span class="linenos">332</span></a>        <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_unique_nodes</span> <span class="o">*</span> <span class="n">field_size</span>
</span><span id="Mesh.assemble_grads-333"><a href="#Mesh.assemble_grads-333"><span class="linenos">333</span></a>        <span class="n">total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">terms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="Mesh.assemble_grads-334"><a href="#Mesh.assemble_grads-334"><span class="linenos">334</span></a>        <span class="n">separated_inds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">unique_field_indices</span><span class="p">(</span>
</span><span id="Mesh.assemble_grads-335"><a href="#Mesh.assemble_grads-335"><span class="linenos">335</span></a>            <span class="p">(</span><span class="n">field_size</span><span class="p">,),</span> <span class="n">representation</span><span class="o">=</span><span class="s2">&quot;separated&quot;</span>
</span><span id="Mesh.assemble_grads-336"><a href="#Mesh.assemble_grads-336"><span class="linenos">336</span></a>        <span class="p">)</span>
</span><span id="Mesh.assemble_grads-337"><a href="#Mesh.assemble_grads-337"><span class="linenos">337</span></a>        <span class="k">for</span> <span class="n">patch</span><span class="p">,</span> <span class="n">term</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">terms</span><span class="p">):</span>
</span><span id="Mesh.assemble_grads-338"><a href="#Mesh.assemble_grads-338"><span class="linenos">338</span></a>            <span class="n">inds</span> <span class="o">=</span> <span class="n">separated_inds</span><span class="p">[</span><span class="n">patch</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</span><span id="Mesh.assemble_grads-339"><a href="#Mesh.assemble_grads-339"><span class="linenos">339</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">total</span><span class="p">,</span> <span class="n">inds</span><span class="p">,</span> <span class="n">term</span><span class="p">)</span>
</span><span id="Mesh.assemble_grads-340"><a href="#Mesh.assemble_grads-340"><span class="linenos">340</span></a>        <span class="k">return</span> <span class="n">total</span>
</span></pre></div>


            <div class="docstring"><p>Assemble patch-wise gradient vectors into a global gradient vector.</p>

<p>Each entry in <code>terms</code> corresponds to a gradient vector computed on a single
patch. This method uses the mesh connectivity to map patch-local indices
to global unique node indices and sums contributions from overlapping nodes.</p>

<p>Important: Assumes that the degrees of freedom are arranged per field,
i.e., <code>[x_0, ..., x_n, y_0, ..., y_n, z_0, ..., z_n]</code>. It does not
work if the DOFs are interleaved as <code>[x_0, y_0, z_0, x_1, y_1, z_1, ...]</code>.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>terms</strong> (list of np.ndarray):
Gradient vectors for each patch, typically computed from patch-local
operations.</li>
<li><strong>field_size</strong> (int):
Number of degrees of freedom per mesh node (e.g., 3 for 3D displacements).</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>np.ndarray</strong>: Global gradient vector of size <code>field_size * nb_unique_nodes</code>.</li>
</ul>

<h6 id="notes">Notes</h6>

<ul>
<li>Uses <code>MultiPatchBSplineConnectivity.unique_field_indices()</code> to map
patch-local degrees of freedom to global indices.</li>
</ul>
</div>


                            </div>
                            <div id="Mesh.assemble_hessians" class="classattr">
                                        <input id="Mesh.assemble_hessians-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">assemble_hessians</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">terms</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">_matrix</span><span class="o">.</span><span class="n">spmatrix</span><span class="p">]</span>,</span><span class="param">	<span class="n">field_size</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">_matrix</span><span class="o">.</span><span class="n">spmatrix</span>:</span></span>

                <label class="view-source-button" for="Mesh.assemble_hessians-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Mesh.assemble_hessians"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Mesh.assemble_hessians-342"><a href="#Mesh.assemble_hessians-342"><span class="linenos">342</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">assemble_hessians</span><span class="p">(</span>
</span><span id="Mesh.assemble_hessians-343"><a href="#Mesh.assemble_hessians-343"><span class="linenos">343</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">terms</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">sps</span><span class="o">.</span><span class="n">spmatrix</span><span class="p">],</span> <span class="n">field_size</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="Mesh.assemble_hessians-344"><a href="#Mesh.assemble_hessians-344"><span class="linenos">344</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sps</span><span class="o">.</span><span class="n">spmatrix</span><span class="p">:</span>
</span><span id="Mesh.assemble_hessians-345"><a href="#Mesh.assemble_hessians-345"><span class="linenos">345</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh.assemble_hessians-346"><a href="#Mesh.assemble_hessians-346"><span class="linenos">346</span></a><span class="sd">        Assemble patch-wise Hessian matrices into a global sparse Hessian.</span>
</span><span id="Mesh.assemble_hessians-347"><a href="#Mesh.assemble_hessians-347"><span class="linenos">347</span></a>
</span><span id="Mesh.assemble_hessians-348"><a href="#Mesh.assemble_hessians-348"><span class="linenos">348</span></a><span class="sd">        Each matrix in `terms` corresponds to the Hessian on a single patch. This</span>
</span><span id="Mesh.assemble_hessians-349"><a href="#Mesh.assemble_hessians-349"><span class="linenos">349</span></a><span class="sd">        method maps the local patch indices to global unique node indices using the</span>
</span><span id="Mesh.assemble_hessians-350"><a href="#Mesh.assemble_hessians-350"><span class="linenos">350</span></a><span class="sd">        mesh connectivity and constructs a global COO sparse matrix by summing</span>
</span><span id="Mesh.assemble_hessians-351"><a href="#Mesh.assemble_hessians-351"><span class="linenos">351</span></a><span class="sd">        overlapping contributions.</span>
</span><span id="Mesh.assemble_hessians-352"><a href="#Mesh.assemble_hessians-352"><span class="linenos">352</span></a>
</span><span id="Mesh.assemble_hessians-353"><a href="#Mesh.assemble_hessians-353"><span class="linenos">353</span></a><span class="sd">        Important: Assumes that the degrees of freedom are arranged per field,</span>
</span><span id="Mesh.assemble_hessians-354"><a href="#Mesh.assemble_hessians-354"><span class="linenos">354</span></a><span class="sd">        i.e., `[x_0, ..., x_n, y_0, ..., y_n, z_0, ..., z_n]`. It does not</span>
</span><span id="Mesh.assemble_hessians-355"><a href="#Mesh.assemble_hessians-355"><span class="linenos">355</span></a><span class="sd">        work if the DOFs are interleaved as `[x_0, y_0, z_0, x_1, y_1, z_1, ...]`.</span>
</span><span id="Mesh.assemble_hessians-356"><a href="#Mesh.assemble_hessians-356"><span class="linenos">356</span></a>
</span><span id="Mesh.assemble_hessians-357"><a href="#Mesh.assemble_hessians-357"><span class="linenos">357</span></a><span class="sd">        Parameters</span>
</span><span id="Mesh.assemble_hessians-358"><a href="#Mesh.assemble_hessians-358"><span class="linenos">358</span></a><span class="sd">        ----------</span>
</span><span id="Mesh.assemble_hessians-359"><a href="#Mesh.assemble_hessians-359"><span class="linenos">359</span></a><span class="sd">        terms : list of scipy.sparse.spmatrix</span>
</span><span id="Mesh.assemble_hessians-360"><a href="#Mesh.assemble_hessians-360"><span class="linenos">360</span></a><span class="sd">            Hessian matrices for each patch, typically in CSR or CSC format.</span>
</span><span id="Mesh.assemble_hessians-361"><a href="#Mesh.assemble_hessians-361"><span class="linenos">361</span></a><span class="sd">        field_size : int</span>
</span><span id="Mesh.assemble_hessians-362"><a href="#Mesh.assemble_hessians-362"><span class="linenos">362</span></a><span class="sd">            Number of degrees of freedom per mesh node (e.g., 3 for 3D displacements).</span>
</span><span id="Mesh.assemble_hessians-363"><a href="#Mesh.assemble_hessians-363"><span class="linenos">363</span></a>
</span><span id="Mesh.assemble_hessians-364"><a href="#Mesh.assemble_hessians-364"><span class="linenos">364</span></a><span class="sd">        Returns</span>
</span><span id="Mesh.assemble_hessians-365"><a href="#Mesh.assemble_hessians-365"><span class="linenos">365</span></a><span class="sd">        -------</span>
</span><span id="Mesh.assemble_hessians-366"><a href="#Mesh.assemble_hessians-366"><span class="linenos">366</span></a><span class="sd">        scipy.sparse.spmatrix</span>
</span><span id="Mesh.assemble_hessians-367"><a href="#Mesh.assemble_hessians-367"><span class="linenos">367</span></a><span class="sd">            Global sparse Hessian matrix of size `(field_size * nb_unique_nodes, field_size * nb_unique_nodes)`.</span>
</span><span id="Mesh.assemble_hessians-368"><a href="#Mesh.assemble_hessians-368"><span class="linenos">368</span></a>
</span><span id="Mesh.assemble_hessians-369"><a href="#Mesh.assemble_hessians-369"><span class="linenos">369</span></a><span class="sd">        Notes</span>
</span><span id="Mesh.assemble_hessians-370"><a href="#Mesh.assemble_hessians-370"><span class="linenos">370</span></a><span class="sd">        -----</span>
</span><span id="Mesh.assemble_hessians-371"><a href="#Mesh.assemble_hessians-371"><span class="linenos">371</span></a><span class="sd">        - Uses :meth:`MultiPatchBSplineConnectivity.unique_field_indices` to map</span>
</span><span id="Mesh.assemble_hessians-372"><a href="#Mesh.assemble_hessians-372"><span class="linenos">372</span></a><span class="sd">        patch-local degrees of freedom to global indices.</span>
</span><span id="Mesh.assemble_hessians-373"><a href="#Mesh.assemble_hessians-373"><span class="linenos">373</span></a><span class="sd">        - The returned matrix is in COO format, suitable for further assembly or</span>
</span><span id="Mesh.assemble_hessians-374"><a href="#Mesh.assemble_hessians-374"><span class="linenos">374</span></a><span class="sd">        conversion to CSR/CSC.</span>
</span><span id="Mesh.assemble_hessians-375"><a href="#Mesh.assemble_hessians-375"><span class="linenos">375</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh.assemble_hessians-376"><a href="#Mesh.assemble_hessians-376"><span class="linenos">376</span></a>        <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Mesh.assemble_hessians-377"><a href="#Mesh.assemble_hessians-377"><span class="linenos">377</span></a>        <span class="n">cols</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Mesh.assemble_hessians-378"><a href="#Mesh.assemble_hessians-378"><span class="linenos">378</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Mesh.assemble_hessians-379"><a href="#Mesh.assemble_hessians-379"><span class="linenos">379</span></a>        <span class="n">separated_inds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">unique_field_indices</span><span class="p">(</span>
</span><span id="Mesh.assemble_hessians-380"><a href="#Mesh.assemble_hessians-380"><span class="linenos">380</span></a>            <span class="p">(</span><span class="n">field_size</span><span class="p">,),</span> <span class="n">representation</span><span class="o">=</span><span class="s2">&quot;separated&quot;</span>
</span><span id="Mesh.assemble_hessians-381"><a href="#Mesh.assemble_hessians-381"><span class="linenos">381</span></a>        <span class="p">)</span>
</span><span id="Mesh.assemble_hessians-382"><a href="#Mesh.assemble_hessians-382"><span class="linenos">382</span></a>        <span class="k">for</span> <span class="n">patch</span><span class="p">,</span> <span class="n">mat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">terms</span><span class="p">):</span>
</span><span id="Mesh.assemble_hessians-383"><a href="#Mesh.assemble_hessians-383"><span class="linenos">383</span></a>            <span class="n">inds</span> <span class="o">=</span> <span class="n">separated_inds</span><span class="p">[</span><span class="n">patch</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</span><span id="Mesh.assemble_hessians-384"><a href="#Mesh.assemble_hessians-384"><span class="linenos">384</span></a>            <span class="n">mat</span> <span class="o">=</span> <span class="n">mat</span><span class="o">.</span><span class="n">tocoo</span><span class="p">()</span>
</span><span id="Mesh.assemble_hessians-385"><a href="#Mesh.assemble_hessians-385"><span class="linenos">385</span></a>            <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="n">mat</span><span class="o">.</span><span class="n">row</span><span class="p">])</span>
</span><span id="Mesh.assemble_hessians-386"><a href="#Mesh.assemble_hessians-386"><span class="linenos">386</span></a>            <span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="n">mat</span><span class="o">.</span><span class="n">col</span><span class="p">])</span>
</span><span id="Mesh.assemble_hessians-387"><a href="#Mesh.assemble_hessians-387"><span class="linenos">387</span></a>            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mat</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span id="Mesh.assemble_hessians-388"><a href="#Mesh.assemble_hessians-388"><span class="linenos">388</span></a>        <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_unique_nodes</span> <span class="o">*</span> <span class="n">field_size</span>
</span><span id="Mesh.assemble_hessians-389"><a href="#Mesh.assemble_hessians-389"><span class="linenos">389</span></a>        <span class="k">return</span> <span class="n">sps</span><span class="o">.</span><span class="n">coo_matrix</span><span class="p">(</span>
</span><span id="Mesh.assemble_hessians-390"><a href="#Mesh.assemble_hessians-390"><span class="linenos">390</span></a>            <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">rows</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">cols</span><span class="p">))),</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
</span><span id="Mesh.assemble_hessians-391"><a href="#Mesh.assemble_hessians-391"><span class="linenos">391</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Assemble patch-wise Hessian matrices into a global sparse Hessian.</p>

<p>Each matrix in <code>terms</code> corresponds to the Hessian on a single patch. This
method maps the local patch indices to global unique node indices using the
mesh connectivity and constructs a global COO sparse matrix by summing
overlapping contributions.</p>

<p>Important: Assumes that the degrees of freedom are arranged per field,
i.e., <code>[x_0, ..., x_n, y_0, ..., y_n, z_0, ..., z_n]</code>. It does not
work if the DOFs are interleaved as <code>[x_0, y_0, z_0, x_1, y_1, z_1, ...]</code>.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>terms</strong> (list of scipy.sparse.spmatrix):
Hessian matrices for each patch, typically in CSR or CSC format.</li>
<li><strong>field_size</strong> (int):
Number of degrees of freedom per mesh node (e.g., 3 for 3D displacements).</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>scipy.sparse.spmatrix</strong>: Global sparse Hessian matrix of size <code>(field_size * nb_unique_nodes, field_size * nb_unique_nodes)</code>.</li>
</ul>

<h6 id="notes">Notes</h6>

<ul>
<li>Uses <code>MultiPatchBSplineConnectivity.unique_field_indices()</code> to map
patch-local degrees of freedom to global indices.</li>
<li>The returned matrix is in COO format, suitable for further assembly or
conversion to CSR/CSC.</li>
</ul>
</div>


                            </div>
                            <div id="Mesh.extract_border" class="classattr">
                                        <input id="Mesh.extract_border-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">extract_border</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#Mesh">Mesh</a></span>:</span></span>

                <label class="view-source-button" for="Mesh.extract_border-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Mesh.extract_border"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Mesh.extract_border-393"><a href="#Mesh.extract_border-393"><span class="linenos">393</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">extract_border</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Mesh&quot;</span><span class="p">:</span>
</span><span id="Mesh.extract_border-394"><a href="#Mesh.extract_border-394"><span class="linenos">394</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh.extract_border-395"><a href="#Mesh.extract_border-395"><span class="linenos">395</span></a><span class="sd">        Extract the exterior boundary mesh from a multi-patch B-spline mesh.</span>
</span><span id="Mesh.extract_border-396"><a href="#Mesh.extract_border-396"><span class="linenos">396</span></a>
</span><span id="Mesh.extract_border-397"><a href="#Mesh.extract_border-397"><span class="linenos">397</span></a><span class="sd">        This method identifies the nodes and patches lying on the exterior of the</span>
</span><span id="Mesh.extract_border-398"><a href="#Mesh.extract_border-398"><span class="linenos">398</span></a><span class="sd">        mesh and constructs a new `Mesh` object representing only these boundary</span>
</span><span id="Mesh.extract_border-399"><a href="#Mesh.extract_border-399"><span class="linenos">399</span></a><span class="sd">        elements. The reference indices are also updated to correspond to the</span>
</span><span id="Mesh.extract_border-400"><a href="#Mesh.extract_border-400"><span class="linenos">400</span></a><span class="sd">        subset of unique nodes retained.</span>
</span><span id="Mesh.extract_border-401"><a href="#Mesh.extract_border-401"><span class="linenos">401</span></a>
</span><span id="Mesh.extract_border-402"><a href="#Mesh.extract_border-402"><span class="linenos">402</span></a><span class="sd">        Returns</span>
</span><span id="Mesh.extract_border-403"><a href="#Mesh.extract_border-403"><span class="linenos">403</span></a><span class="sd">        -------</span>
</span><span id="Mesh.extract_border-404"><a href="#Mesh.extract_border-404"><span class="linenos">404</span></a><span class="sd">        Mesh</span>
</span><span id="Mesh.extract_border-405"><a href="#Mesh.extract_border-405"><span class="linenos">405</span></a><span class="sd">            A new `Mesh` instance representing the exterior boundaries of the mesh.</span>
</span><span id="Mesh.extract_border-406"><a href="#Mesh.extract_border-406"><span class="linenos">406</span></a>
</span><span id="Mesh.extract_border-407"><a href="#Mesh.extract_border-407"><span class="linenos">407</span></a><span class="sd">        Notes</span>
</span><span id="Mesh.extract_border-408"><a href="#Mesh.extract_border-408"><span class="linenos">408</span></a><span class="sd">        -----</span>
</span><span id="Mesh.extract_border-409"><a href="#Mesh.extract_border-409"><span class="linenos">409</span></a><span class="sd">        - The `ref_inds` of the returned mesh correspond to the indices of the</span>
</span><span id="Mesh.extract_border-410"><a href="#Mesh.extract_border-410"><span class="linenos">410</span></a><span class="sd">        original mesh&#39;s unique nodes included in the boundary.</span>
</span><span id="Mesh.extract_border-411"><a href="#Mesh.extract_border-411"><span class="linenos">411</span></a><span class="sd">        - The global layout of degrees of freedom remains the same as the parent</span>
</span><span id="Mesh.extract_border-412"><a href="#Mesh.extract_border-412"><span class="linenos">412</span></a><span class="sd">        mesh.</span>
</span><span id="Mesh.extract_border-413"><a href="#Mesh.extract_border-413"><span class="linenos">413</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh.extract_border-414"><a href="#Mesh.extract_border-414"><span class="linenos">414</span></a>        <span class="n">border_connectivity</span><span class="p">,</span> <span class="n">border_splines</span><span class="p">,</span> <span class="n">full_to_border</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Mesh.extract_border-415"><a href="#Mesh.extract_border-415"><span class="linenos">415</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">extract_exterior_borders</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">)</span>
</span><span id="Mesh.extract_border-416"><a href="#Mesh.extract_border-416"><span class="linenos">416</span></a>        <span class="p">)</span>
</span><span id="Mesh.extract_border-417"><a href="#Mesh.extract_border-417"><span class="linenos">417</span></a>        <span class="n">border_ctrl_pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_ctrl_pts</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">full_to_border</span><span class="p">]</span>
</span><span id="Mesh.extract_border-418"><a href="#Mesh.extract_border-418"><span class="linenos">418</span></a>        <span class="n">border_ref_inds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_inds</span><span class="p">[</span><span class="n">full_to_border</span><span class="p">]</span>
</span><span id="Mesh.extract_border-419"><a href="#Mesh.extract_border-419"><span class="linenos">419</span></a>        <span class="k">return</span> <span class="n">Mesh</span><span class="p">(</span>
</span><span id="Mesh.extract_border-420"><a href="#Mesh.extract_border-420"><span class="linenos">420</span></a>            <span class="nb">list</span><span class="p">(</span><span class="n">border_splines</span><span class="p">),</span> <span class="n">border_ctrl_pts</span><span class="p">,</span> <span class="n">border_connectivity</span><span class="p">,</span> <span class="n">border_ref_inds</span>
</span><span id="Mesh.extract_border-421"><a href="#Mesh.extract_border-421"><span class="linenos">421</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Extract the exterior boundary mesh from a multi-patch B-spline mesh.</p>

<p>This method identifies the nodes and patches lying on the exterior of the
mesh and constructs a new <code><a href="#Mesh">Mesh</a></code> object representing only these boundary
elements. The reference indices are also updated to correspond to the
subset of unique nodes retained.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>Mesh</strong>: A new <code><a href="#Mesh">Mesh</a></code> instance representing the exterior boundaries of the mesh.</li>
</ul>

<h6 id="notes">Notes</h6>

<ul>
<li>The <code><a href="#Mesh.ref_inds">ref_inds</a></code> of the returned mesh correspond to the indices of the
original mesh's unique nodes included in the boundary.</li>
<li>The global layout of degrees of freedom remains the same as the parent
mesh.</li>
</ul>
</div>


                            </div>
                            <div id="Mesh.subset" class="classattr">
                                        <input id="Mesh.subset-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">subset</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">patchs_to_keep</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">integer</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n"><a href="#Mesh">Mesh</a></span>:</span></span>

                <label class="view-source-button" for="Mesh.subset-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Mesh.subset"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Mesh.subset-423"><a href="#Mesh.subset-423"><span class="linenos">423</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">subset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patchs_to_keep</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;Mesh&quot;</span><span class="p">:</span>
</span><span id="Mesh.subset-424"><a href="#Mesh.subset-424"><span class="linenos">424</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh.subset-425"><a href="#Mesh.subset-425"><span class="linenos">425</span></a><span class="sd">        Create a submesh containing only the specified patches.</span>
</span><span id="Mesh.subset-426"><a href="#Mesh.subset-426"><span class="linenos">426</span></a>
</span><span id="Mesh.subset-427"><a href="#Mesh.subset-427"><span class="linenos">427</span></a><span class="sd">        The method constructs a new `Mesh` object consisting of the patches</span>
</span><span id="Mesh.subset-428"><a href="#Mesh.subset-428"><span class="linenos">428</span></a><span class="sd">        indexed by `patchs_to_keep`. The unique control points and reference</span>
</span><span id="Mesh.subset-429"><a href="#Mesh.subset-429"><span class="linenos">429</span></a><span class="sd">        indices are reduced accordingly to match the retained patches.</span>
</span><span id="Mesh.subset-430"><a href="#Mesh.subset-430"><span class="linenos">430</span></a>
</span><span id="Mesh.subset-431"><a href="#Mesh.subset-431"><span class="linenos">431</span></a><span class="sd">        Parameters</span>
</span><span id="Mesh.subset-432"><a href="#Mesh.subset-432"><span class="linenos">432</span></a><span class="sd">        ----------</span>
</span><span id="Mesh.subset-433"><a href="#Mesh.subset-433"><span class="linenos">433</span></a><span class="sd">        patchs_to_keep : np.ndarray of int</span>
</span><span id="Mesh.subset-434"><a href="#Mesh.subset-434"><span class="linenos">434</span></a><span class="sd">            Array of patch indices to retain in the submesh.</span>
</span><span id="Mesh.subset-435"><a href="#Mesh.subset-435"><span class="linenos">435</span></a>
</span><span id="Mesh.subset-436"><a href="#Mesh.subset-436"><span class="linenos">436</span></a><span class="sd">        Returns</span>
</span><span id="Mesh.subset-437"><a href="#Mesh.subset-437"><span class="linenos">437</span></a><span class="sd">        -------</span>
</span><span id="Mesh.subset-438"><a href="#Mesh.subset-438"><span class="linenos">438</span></a><span class="sd">        Mesh</span>
</span><span id="Mesh.subset-439"><a href="#Mesh.subset-439"><span class="linenos">439</span></a><span class="sd">            A new `Mesh` instance containing only the specified patches and the</span>
</span><span id="Mesh.subset-440"><a href="#Mesh.subset-440"><span class="linenos">440</span></a><span class="sd">            associated control points.</span>
</span><span id="Mesh.subset-441"><a href="#Mesh.subset-441"><span class="linenos">441</span></a>
</span><span id="Mesh.subset-442"><a href="#Mesh.subset-442"><span class="linenos">442</span></a><span class="sd">        Notes</span>
</span><span id="Mesh.subset-443"><a href="#Mesh.subset-443"><span class="linenos">443</span></a><span class="sd">        -----</span>
</span><span id="Mesh.subset-444"><a href="#Mesh.subset-444"><span class="linenos">444</span></a><span class="sd">        - The `ref_inds` of the returned submesh correspond to the subset of the</span>
</span><span id="Mesh.subset-445"><a href="#Mesh.subset-445"><span class="linenos">445</span></a><span class="sd">        original mesh&#39;s reference indices included in the retained patches.</span>
</span><span id="Mesh.subset-446"><a href="#Mesh.subset-446"><span class="linenos">446</span></a><span class="sd">        - The global layout of degrees of freedom is preserved.</span>
</span><span id="Mesh.subset-447"><a href="#Mesh.subset-447"><span class="linenos">447</span></a><span class="sd">        - Useful for operations on a specific region or cell of a larger multipatch</span>
</span><span id="Mesh.subset-448"><a href="#Mesh.subset-448"><span class="linenos">448</span></a><span class="sd">        mesh.</span>
</span><span id="Mesh.subset-449"><a href="#Mesh.subset-449"><span class="linenos">449</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh.subset-450"><a href="#Mesh.subset-450"><span class="linenos">450</span></a>        <span class="n">splines</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_patchs</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
</span><span id="Mesh.subset-451"><a href="#Mesh.subset-451"><span class="linenos">451</span></a>        <span class="n">splines</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span>
</span><span id="Mesh.subset-452"><a href="#Mesh.subset-452"><span class="linenos">452</span></a>        <span class="n">subset_connectivity</span><span class="p">,</span> <span class="n">subset_splines</span><span class="p">,</span> <span class="n">full_to_subset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span>
</span><span id="Mesh.subset-453"><a href="#Mesh.subset-453"><span class="linenos">453</span></a>            <span class="n">splines</span><span class="p">,</span> <span class="n">patchs_to_keep</span>
</span><span id="Mesh.subset-454"><a href="#Mesh.subset-454"><span class="linenos">454</span></a>        <span class="p">)</span>
</span><span id="Mesh.subset-455"><a href="#Mesh.subset-455"><span class="linenos">455</span></a>        <span class="n">subset_ctrl_pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_ctrl_pts</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">full_to_subset</span><span class="p">]</span>
</span><span id="Mesh.subset-456"><a href="#Mesh.subset-456"><span class="linenos">456</span></a>        <span class="n">subset_ref_inds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_inds</span><span class="p">[</span><span class="n">full_to_subset</span><span class="p">]</span>
</span><span id="Mesh.subset-457"><a href="#Mesh.subset-457"><span class="linenos">457</span></a>        <span class="k">return</span> <span class="n">Mesh</span><span class="p">(</span>
</span><span id="Mesh.subset-458"><a href="#Mesh.subset-458"><span class="linenos">458</span></a>            <span class="nb">list</span><span class="p">(</span><span class="n">subset_splines</span><span class="p">),</span> <span class="n">subset_ctrl_pts</span><span class="p">,</span> <span class="n">subset_connectivity</span><span class="p">,</span> <span class="n">subset_ref_inds</span>
</span><span id="Mesh.subset-459"><a href="#Mesh.subset-459"><span class="linenos">459</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create a submesh containing only the specified patches.</p>

<p>The method constructs a new <code><a href="#Mesh">Mesh</a></code> object consisting of the patches
indexed by <code>patchs_to_keep</code>. The unique control points and reference
indices are reduced accordingly to match the retained patches.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>patchs_to_keep</strong> (np.ndarray of int):
Array of patch indices to retain in the submesh.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>Mesh</strong>: A new <code><a href="#Mesh">Mesh</a></code> instance containing only the specified patches and the
associated control points.</li>
</ul>

<h6 id="notes">Notes</h6>

<ul>
<li>The <code><a href="#Mesh.ref_inds">ref_inds</a></code> of the returned submesh correspond to the subset of the
original mesh's reference indices included in the retained patches.</li>
<li>The global layout of degrees of freedom is preserved.</li>
<li>Useful for operations on a specific region or cell of a larger multipatch
mesh.</li>
</ul>
</div>


                            </div>
                            <div id="Mesh.propagate_field" class="classattr">
                                        <input id="Mesh.propagate_field-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">propagate_field</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">field_values</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>,</span><span class="param">	<span class="n">indices</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">integer</span><span class="p">]</span>,</span><span class="param">	<span class="n">disable_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Mesh.propagate_field-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Mesh.propagate_field"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Mesh.propagate_field-461"><a href="#Mesh.propagate_field-461"><span class="linenos">461</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">propagate_field</span><span class="p">(</span>
</span><span id="Mesh.propagate_field-462"><a href="#Mesh.propagate_field-462"><span class="linenos">462</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Mesh.propagate_field-463"><a href="#Mesh.propagate_field-463"><span class="linenos">463</span></a>        <span class="n">field_values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span>
</span><span id="Mesh.propagate_field-464"><a href="#Mesh.propagate_field-464"><span class="linenos">464</span></a>        <span class="n">indices</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">],</span>
</span><span id="Mesh.propagate_field-465"><a href="#Mesh.propagate_field-465"><span class="linenos">465</span></a>        <span class="n">disable_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Mesh.propagate_field-466"><a href="#Mesh.propagate_field-466"><span class="linenos">466</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]:</span>
</span><span id="Mesh.propagate_field-467"><a href="#Mesh.propagate_field-467"><span class="linenos">467</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh.propagate_field-468"><a href="#Mesh.propagate_field-468"><span class="linenos">468</span></a><span class="sd">        Propagate a field defined on a subset of nodes to the entire mesh using IDW.</span>
</span><span id="Mesh.propagate_field-469"><a href="#Mesh.propagate_field-469"><span class="linenos">469</span></a>
</span><span id="Mesh.propagate_field-470"><a href="#Mesh.propagate_field-470"><span class="linenos">470</span></a><span class="sd">        This method uses inverse distance weighting (IDW) interpolation to estimate</span>
</span><span id="Mesh.propagate_field-471"><a href="#Mesh.propagate_field-471"><span class="linenos">471</span></a><span class="sd">        the values of a field at unknown nodes from known nodes. The known nodes are</span>
</span><span id="Mesh.propagate_field-472"><a href="#Mesh.propagate_field-472"><span class="linenos">472</span></a><span class="sd">        specified by `indices` and the field values at those nodes are provided</span>
</span><span id="Mesh.propagate_field-473"><a href="#Mesh.propagate_field-473"><span class="linenos">473</span></a><span class="sd">        through `field_values`.</span>
</span><span id="Mesh.propagate_field-474"><a href="#Mesh.propagate_field-474"><span class="linenos">474</span></a>
</span><span id="Mesh.propagate_field-475"><a href="#Mesh.propagate_field-475"><span class="linenos">475</span></a><span class="sd">        Parameters</span>
</span><span id="Mesh.propagate_field-476"><a href="#Mesh.propagate_field-476"><span class="linenos">476</span></a><span class="sd">        ----------</span>
</span><span id="Mesh.propagate_field-477"><a href="#Mesh.propagate_field-477"><span class="linenos">477</span></a><span class="sd">        field_values : np.ndarray of float</span>
</span><span id="Mesh.propagate_field-478"><a href="#Mesh.propagate_field-478"><span class="linenos">478</span></a><span class="sd">            Field values at known nodes, shape `(dof, n_known)` or `(n_known,)`.</span>
</span><span id="Mesh.propagate_field-479"><a href="#Mesh.propagate_field-479"><span class="linenos">479</span></a><span class="sd">            Must be of `float` type for IDW interpolation.</span>
</span><span id="Mesh.propagate_field-480"><a href="#Mesh.propagate_field-480"><span class="linenos">480</span></a><span class="sd">        indices : np.ndarray of int</span>
</span><span id="Mesh.propagate_field-481"><a href="#Mesh.propagate_field-481"><span class="linenos">481</span></a><span class="sd">            Indices of the known nodes in `self.unique_ctrl_pts`.</span>
</span><span id="Mesh.propagate_field-482"><a href="#Mesh.propagate_field-482"><span class="linenos">482</span></a><span class="sd">        disable_parallel : bool, optional</span>
</span><span id="Mesh.propagate_field-483"><a href="#Mesh.propagate_field-483"><span class="linenos">483</span></a><span class="sd">            If `True`, disables parallel computation in the IDW interpolation. Default is `False`.</span>
</span><span id="Mesh.propagate_field-484"><a href="#Mesh.propagate_field-484"><span class="linenos">484</span></a>
</span><span id="Mesh.propagate_field-485"><a href="#Mesh.propagate_field-485"><span class="linenos">485</span></a><span class="sd">        Returns</span>
</span><span id="Mesh.propagate_field-486"><a href="#Mesh.propagate_field-486"><span class="linenos">486</span></a><span class="sd">        -------</span>
</span><span id="Mesh.propagate_field-487"><a href="#Mesh.propagate_field-487"><span class="linenos">487</span></a><span class="sd">        np.ndarray of float</span>
</span><span id="Mesh.propagate_field-488"><a href="#Mesh.propagate_field-488"><span class="linenos">488</span></a><span class="sd">            Field values propagated to all nodes of the mesh, same dtype as input.</span>
</span><span id="Mesh.propagate_field-489"><a href="#Mesh.propagate_field-489"><span class="linenos">489</span></a>
</span><span id="Mesh.propagate_field-490"><a href="#Mesh.propagate_field-490"><span class="linenos">490</span></a><span class="sd">        Notes</span>
</span><span id="Mesh.propagate_field-491"><a href="#Mesh.propagate_field-491"><span class="linenos">491</span></a><span class="sd">        -----</span>
</span><span id="Mesh.propagate_field-492"><a href="#Mesh.propagate_field-492"><span class="linenos">492</span></a><span class="sd">        - `self.unique_ctrl_pts` must be float type for IDW to work correctly.</span>
</span><span id="Mesh.propagate_field-493"><a href="#Mesh.propagate_field-493"><span class="linenos">493</span></a><span class="sd">        - Interpolation is performed only for nodes not in `indices`; known node values are preserved.</span>
</span><span id="Mesh.propagate_field-494"><a href="#Mesh.propagate_field-494"><span class="linenos">494</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh.propagate_field-495"><a href="#Mesh.propagate_field-495"><span class="linenos">495</span></a>        <span class="n">shape</span> <span class="o">=</span> <span class="n">field_values</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Mesh.propagate_field-496"><a href="#Mesh.propagate_field-496"><span class="linenos">496</span></a>        <span class="n">field_values</span> <span class="o">=</span> <span class="n">field_values</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">shape</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="Mesh.propagate_field-497"><a href="#Mesh.propagate_field-497"><span class="linenos">497</span></a>        <span class="n">unknown_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_unique_nodes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;bool&quot;</span><span class="p">)</span>
</span><span id="Mesh.propagate_field-498"><a href="#Mesh.propagate_field-498"><span class="linenos">498</span></a>        <span class="n">unknown_mask</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Mesh.propagate_field-499"><a href="#Mesh.propagate_field-499"><span class="linenos">499</span></a>        <span class="n">known_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_ctrl_pts</span><span class="p">[:,</span> <span class="n">indices</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
</span><span id="Mesh.propagate_field-500"><a href="#Mesh.propagate_field-500"><span class="linenos">500</span></a>        <span class="n">unknown_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_ctrl_pts</span><span class="p">[:,</span> <span class="n">unknown_mask</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
</span><span id="Mesh.propagate_field-501"><a href="#Mesh.propagate_field-501"><span class="linenos">501</span></a>        <span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span>
</span><span id="Mesh.propagate_field-502"><a href="#Mesh.propagate_field-502"><span class="linenos">502</span></a>            <span class="p">(</span><span class="n">field_values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_unique_nodes</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span>
</span><span id="Mesh.propagate_field-503"><a href="#Mesh.propagate_field-503"><span class="linenos">503</span></a>        <span class="p">)</span>
</span><span id="Mesh.propagate_field-504"><a href="#Mesh.propagate_field-504"><span class="linenos">504</span></a>        <span class="n">field</span><span class="p">[:,</span> <span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">field_values</span>
</span><span id="Mesh.propagate_field-505"><a href="#Mesh.propagate_field-505"><span class="linenos">505</span></a>        <span class="n">field</span><span class="p">[:,</span> <span class="n">unknown_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">treeIDW</span><span class="p">(</span>
</span><span id="Mesh.propagate_field-506"><a href="#Mesh.propagate_field-506"><span class="linenos">506</span></a>            <span class="n">known_points</span><span class="p">,</span> <span class="n">field_values</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">unknown_points</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="ow">not</span> <span class="n">disable_parallel</span>
</span><span id="Mesh.propagate_field-507"><a href="#Mesh.propagate_field-507"><span class="linenos">507</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span id="Mesh.propagate_field-508"><a href="#Mesh.propagate_field-508"><span class="linenos">508</span></a>        <span class="k">return</span> <span class="n">field</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">*</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Propagate a field defined on a subset of nodes to the entire mesh using IDW.</p>

<p>This method uses inverse distance weighting (IDW) interpolation to estimate
the values of a field at unknown nodes from known nodes. The known nodes are
specified by <code>indices</code> and the field values at those nodes are provided
through <code>field_values</code>.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>field_values</strong> (np.ndarray of float):
Field values at known nodes, shape <code>(dof, n_known)</code> or <code>(n_known,)</code>.
Must be of <code>float</code> type for IDW interpolation.</li>
<li><strong>indices</strong> (np.ndarray of int):
Indices of the known nodes in <code>self.unique_ctrl_pts</code>.</li>
<li><strong>disable_parallel</strong> (bool, optional):
If <code>True</code>, disables parallel computation in the IDW interpolation. Default is <code>False</code>.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>np.ndarray of float</strong>: Field values propagated to all nodes of the mesh, same dtype as input.</li>
</ul>

<h6 id="notes">Notes</h6>

<ul>
<li><code>self.unique_ctrl_pts</code> must be float type for IDW to work correctly.</li>
<li>Interpolation is performed only for nodes not in <code>indices</code>; known node values are preserved.</li>
</ul>
</div>


                            </div>
                            <div id="Mesh.propagate_field_from_submesh" class="classattr">
                                        <input id="Mesh.propagate_field_from_submesh-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">propagate_field_from_submesh</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">submesh</span><span class="p">:</span> <span class="n"><a href="#Mesh">Mesh</a></span>,</span><span class="param">	<span class="n">field_values</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>,</span><span class="param">	<span class="n">disable_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Mesh.propagate_field_from_submesh-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Mesh.propagate_field_from_submesh"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Mesh.propagate_field_from_submesh-510"><a href="#Mesh.propagate_field_from_submesh-510"><span class="linenos">510</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">propagate_field_from_submesh</span><span class="p">(</span>
</span><span id="Mesh.propagate_field_from_submesh-511"><a href="#Mesh.propagate_field_from_submesh-511"><span class="linenos">511</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Mesh.propagate_field_from_submesh-512"><a href="#Mesh.propagate_field_from_submesh-512"><span class="linenos">512</span></a>        <span class="n">submesh</span><span class="p">:</span> <span class="s2">&quot;Mesh&quot;</span><span class="p">,</span>
</span><span id="Mesh.propagate_field_from_submesh-513"><a href="#Mesh.propagate_field_from_submesh-513"><span class="linenos">513</span></a>        <span class="n">field_values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span>
</span><span id="Mesh.propagate_field_from_submesh-514"><a href="#Mesh.propagate_field_from_submesh-514"><span class="linenos">514</span></a>        <span class="n">disable_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Mesh.propagate_field_from_submesh-515"><a href="#Mesh.propagate_field_from_submesh-515"><span class="linenos">515</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]:</span>
</span><span id="Mesh.propagate_field_from_submesh-516"><a href="#Mesh.propagate_field_from_submesh-516"><span class="linenos">516</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh.propagate_field_from_submesh-517"><a href="#Mesh.propagate_field_from_submesh-517"><span class="linenos">517</span></a><span class="sd">        Propagate a field from a submesh to the full mesh using IDW interpolation.</span>
</span><span id="Mesh.propagate_field_from_submesh-518"><a href="#Mesh.propagate_field_from_submesh-518"><span class="linenos">518</span></a>
</span><span id="Mesh.propagate_field_from_submesh-519"><a href="#Mesh.propagate_field_from_submesh-519"><span class="linenos">519</span></a><span class="sd">        This method first identifies the nodes in the submesh that correspond to the</span>
</span><span id="Mesh.propagate_field_from_submesh-520"><a href="#Mesh.propagate_field_from_submesh-520"><span class="linenos">520</span></a><span class="sd">        full mesh, then propagates the field to all nodes of the full mesh using</span>
</span><span id="Mesh.propagate_field_from_submesh-521"><a href="#Mesh.propagate_field_from_submesh-521"><span class="linenos">521</span></a><span class="sd">        inverse distance weighting (IDW). The values at known nodes are preserved.</span>
</span><span id="Mesh.propagate_field_from_submesh-522"><a href="#Mesh.propagate_field_from_submesh-522"><span class="linenos">522</span></a>
</span><span id="Mesh.propagate_field_from_submesh-523"><a href="#Mesh.propagate_field_from_submesh-523"><span class="linenos">523</span></a><span class="sd">        Parameters</span>
</span><span id="Mesh.propagate_field_from_submesh-524"><a href="#Mesh.propagate_field_from_submesh-524"><span class="linenos">524</span></a><span class="sd">        ----------</span>
</span><span id="Mesh.propagate_field_from_submesh-525"><a href="#Mesh.propagate_field_from_submesh-525"><span class="linenos">525</span></a><span class="sd">        submesh : Mesh</span>
</span><span id="Mesh.propagate_field_from_submesh-526"><a href="#Mesh.propagate_field_from_submesh-526"><span class="linenos">526</span></a><span class="sd">            Submesh containing the nodes where the field is defined.</span>
</span><span id="Mesh.propagate_field_from_submesh-527"><a href="#Mesh.propagate_field_from_submesh-527"><span class="linenos">527</span></a><span class="sd">        field_values : np.ndarray of float</span>
</span><span id="Mesh.propagate_field_from_submesh-528"><a href="#Mesh.propagate_field_from_submesh-528"><span class="linenos">528</span></a><span class="sd">            Field values defined on the submesh nodes. Must be of `float` type for IDW.</span>
</span><span id="Mesh.propagate_field_from_submesh-529"><a href="#Mesh.propagate_field_from_submesh-529"><span class="linenos">529</span></a><span class="sd">        disable_parallel : bool, optional</span>
</span><span id="Mesh.propagate_field_from_submesh-530"><a href="#Mesh.propagate_field_from_submesh-530"><span class="linenos">530</span></a><span class="sd">            If `True`, disables parallel computation in the IDW interpolation. Default is `False`.</span>
</span><span id="Mesh.propagate_field_from_submesh-531"><a href="#Mesh.propagate_field_from_submesh-531"><span class="linenos">531</span></a>
</span><span id="Mesh.propagate_field_from_submesh-532"><a href="#Mesh.propagate_field_from_submesh-532"><span class="linenos">532</span></a><span class="sd">        Returns</span>
</span><span id="Mesh.propagate_field_from_submesh-533"><a href="#Mesh.propagate_field_from_submesh-533"><span class="linenos">533</span></a><span class="sd">        -------</span>
</span><span id="Mesh.propagate_field_from_submesh-534"><a href="#Mesh.propagate_field_from_submesh-534"><span class="linenos">534</span></a><span class="sd">        np.ndarray of float</span>
</span><span id="Mesh.propagate_field_from_submesh-535"><a href="#Mesh.propagate_field_from_submesh-535"><span class="linenos">535</span></a><span class="sd">            Field values propagated to all nodes of the full mesh.</span>
</span><span id="Mesh.propagate_field_from_submesh-536"><a href="#Mesh.propagate_field_from_submesh-536"><span class="linenos">536</span></a>
</span><span id="Mesh.propagate_field_from_submesh-537"><a href="#Mesh.propagate_field_from_submesh-537"><span class="linenos">537</span></a><span class="sd">        Notes</span>
</span><span id="Mesh.propagate_field_from_submesh-538"><a href="#Mesh.propagate_field_from_submesh-538"><span class="linenos">538</span></a><span class="sd">        -----</span>
</span><span id="Mesh.propagate_field_from_submesh-539"><a href="#Mesh.propagate_field_from_submesh-539"><span class="linenos">539</span></a><span class="sd">        - Both `field_values` and `self.unique_ctrl_pts` must be of float type.</span>
</span><span id="Mesh.propagate_field_from_submesh-540"><a href="#Mesh.propagate_field_from_submesh-540"><span class="linenos">540</span></a><span class="sd">        - Interpolation is done only for nodes not in the submesh; known node values are preserved.</span>
</span><span id="Mesh.propagate_field_from_submesh-541"><a href="#Mesh.propagate_field_from_submesh-541"><span class="linenos">541</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh.propagate_field_from_submesh-542"><a href="#Mesh.propagate_field_from_submesh-542"><span class="linenos">542</span></a>        <span class="n">shape</span> <span class="o">=</span> <span class="n">field_values</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Mesh.propagate_field_from_submesh-543"><a href="#Mesh.propagate_field_from_submesh-543"><span class="linenos">543</span></a>        <span class="n">field_values</span> <span class="o">=</span> <span class="n">field_values</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">shape</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="Mesh.propagate_field_from_submesh-544"><a href="#Mesh.propagate_field_from_submesh-544"><span class="linenos">544</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">idx_mesh</span><span class="p">,</span> <span class="n">idx_submesh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span>
</span><span id="Mesh.propagate_field_from_submesh-545"><a href="#Mesh.propagate_field_from_submesh-545"><span class="linenos">545</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ref_inds</span><span class="p">,</span> <span class="n">submesh</span><span class="o">.</span><span class="n">ref_inds</span><span class="p">,</span> <span class="n">return_indices</span><span class="o">=</span><span class="kc">True</span>
</span><span id="Mesh.propagate_field_from_submesh-546"><a href="#Mesh.propagate_field_from_submesh-546"><span class="linenos">546</span></a>        <span class="p">)</span>
</span><span id="Mesh.propagate_field_from_submesh-547"><a href="#Mesh.propagate_field_from_submesh-547"><span class="linenos">547</span></a>        <span class="n">field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">propagate_field</span><span class="p">(</span>
</span><span id="Mesh.propagate_field_from_submesh-548"><a href="#Mesh.propagate_field_from_submesh-548"><span class="linenos">548</span></a>            <span class="n">field_values</span><span class="p">[:,</span> <span class="n">idx_submesh</span><span class="p">],</span> <span class="n">idx_mesh</span><span class="p">,</span> <span class="n">disable_parallel</span><span class="o">=</span><span class="n">disable_parallel</span>
</span><span id="Mesh.propagate_field_from_submesh-549"><a href="#Mesh.propagate_field_from_submesh-549"><span class="linenos">549</span></a>        <span class="p">)</span>
</span><span id="Mesh.propagate_field_from_submesh-550"><a href="#Mesh.propagate_field_from_submesh-550"><span class="linenos">550</span></a>        <span class="k">return</span> <span class="n">field</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">*</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Propagate a field from a submesh to the full mesh using IDW interpolation.</p>

<p>This method first identifies the nodes in the submesh that correspond to the
full mesh, then propagates the field to all nodes of the full mesh using
inverse distance weighting (IDW). The values at known nodes are preserved.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>submesh</strong> (Mesh):
Submesh containing the nodes where the field is defined.</li>
<li><strong>field_values</strong> (np.ndarray of float):
Field values defined on the submesh nodes. Must be of <code>float</code> type for IDW.</li>
<li><strong>disable_parallel</strong> (bool, optional):
If <code>True</code>, disables parallel computation in the IDW interpolation. Default is <code>False</code>.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>np.ndarray of float</strong>: Field values propagated to all nodes of the full mesh.</li>
</ul>

<h6 id="notes">Notes</h6>

<ul>
<li>Both <code>field_values</code> and <code>self.unique_ctrl_pts</code> must be of float type.</li>
<li>Interpolation is done only for nodes not in the submesh; known node values are preserved.</li>
</ul>
</div>


                            </div>
                            <div id="Mesh.get_orientation_field" class="classattr">
                                        <input id="Mesh.get_orientation_field-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_orientation_field</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">n_eval_per_elem</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>,</span><span class="param">	<span class="n">XI_list</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">disable_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="Mesh.get_orientation_field-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Mesh.get_orientation_field"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Mesh.get_orientation_field-552"><a href="#Mesh.get_orientation_field-552"><span class="linenos">552</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_orientation_field</span><span class="p">(</span>
</span><span id="Mesh.get_orientation_field-553"><a href="#Mesh.get_orientation_field-553"><span class="linenos">553</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Mesh.get_orientation_field-554"><a href="#Mesh.get_orientation_field-554"><span class="linenos">554</span></a>        <span class="n">n_eval_per_elem</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="Mesh.get_orientation_field-555"><a href="#Mesh.get_orientation_field-555"><span class="linenos">555</span></a>        <span class="n">XI_list</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Mesh.get_orientation_field-556"><a href="#Mesh.get_orientation_field-556"><span class="linenos">556</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Mesh.get_orientation_field-557"><a href="#Mesh.get_orientation_field-557"><span class="linenos">557</span></a>        <span class="n">disable_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Mesh.get_orientation_field-558"><a href="#Mesh.get_orientation_field-558"><span class="linenos">558</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]]:</span>
</span><span id="Mesh.get_orientation_field-559"><a href="#Mesh.get_orientation_field-559"><span class="linenos">559</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh.get_orientation_field-560"><a href="#Mesh.get_orientation_field-560"><span class="linenos">560</span></a><span class="sd">        Compute the orientation field of a 3D multipatch B-spline mesh.</span>
</span><span id="Mesh.get_orientation_field-561"><a href="#Mesh.get_orientation_field-561"><span class="linenos">561</span></a>
</span><span id="Mesh.get_orientation_field-562"><a href="#Mesh.get_orientation_field-562"><span class="linenos">562</span></a><span class="sd">        The orientation field is calculated as the scalar triple product of the</span>
</span><span id="Mesh.get_orientation_field-563"><a href="#Mesh.get_orientation_field-563"><span class="linenos">563</span></a><span class="sd">        local tangent vectors of each element. It indicates the local handedness</span>
</span><span id="Mesh.get_orientation_field-564"><a href="#Mesh.get_orientation_field-564"><span class="linenos">564</span></a><span class="sd">        of the mesh elements (positive for right-handed orientation, negative for left-handed).</span>
</span><span id="Mesh.get_orientation_field-565"><a href="#Mesh.get_orientation_field-565"><span class="linenos">565</span></a>
</span><span id="Mesh.get_orientation_field-566"><a href="#Mesh.get_orientation_field-566"><span class="linenos">566</span></a><span class="sd">        Parameters</span>
</span><span id="Mesh.get_orientation_field-567"><a href="#Mesh.get_orientation_field-567"><span class="linenos">567</span></a><span class="sd">        ----------</span>
</span><span id="Mesh.get_orientation_field-568"><a href="#Mesh.get_orientation_field-568"><span class="linenos">568</span></a><span class="sd">        n_eval_per_elem : int, optional</span>
</span><span id="Mesh.get_orientation_field-569"><a href="#Mesh.get_orientation_field-569"><span class="linenos">569</span></a><span class="sd">            Number of evaluation points per element along each parametric direction.</span>
</span><span id="Mesh.get_orientation_field-570"><a href="#Mesh.get_orientation_field-570"><span class="linenos">570</span></a><span class="sd">            Default is `5`.</span>
</span><span id="Mesh.get_orientation_field-571"><a href="#Mesh.get_orientation_field-571"><span class="linenos">571</span></a><span class="sd">        XI_list : iterable of tuple of np.ndarray, optional</span>
</span><span id="Mesh.get_orientation_field-572"><a href="#Mesh.get_orientation_field-572"><span class="linenos">572</span></a><span class="sd">            Predefined parametric coordinates for each patch. If `None`, a regular grid</span>
</span><span id="Mesh.get_orientation_field-573"><a href="#Mesh.get_orientation_field-573"><span class="linenos">573</span></a><span class="sd">            is generated using `n_eval_per_elem`.</span>
</span><span id="Mesh.get_orientation_field-574"><a href="#Mesh.get_orientation_field-574"><span class="linenos">574</span></a><span class="sd">        verbose : bool, optional</span>
</span><span id="Mesh.get_orientation_field-575"><a href="#Mesh.get_orientation_field-575"><span class="linenos">575</span></a><span class="sd">            If `True`, prints progress messages. Default is `True`.</span>
</span><span id="Mesh.get_orientation_field-576"><a href="#Mesh.get_orientation_field-576"><span class="linenos">576</span></a><span class="sd">        disable_parallel : bool, optional</span>
</span><span id="Mesh.get_orientation_field-577"><a href="#Mesh.get_orientation_field-577"><span class="linenos">577</span></a><span class="sd">            If `True`, disables parallel computation. Default is `False`.</span>
</span><span id="Mesh.get_orientation_field-578"><a href="#Mesh.get_orientation_field-578"><span class="linenos">578</span></a>
</span><span id="Mesh.get_orientation_field-579"><a href="#Mesh.get_orientation_field-579"><span class="linenos">579</span></a><span class="sd">        Returns</span>
</span><span id="Mesh.get_orientation_field-580"><a href="#Mesh.get_orientation_field-580"><span class="linenos">580</span></a><span class="sd">        -------</span>
</span><span id="Mesh.get_orientation_field-581"><a href="#Mesh.get_orientation_field-581"><span class="linenos">581</span></a><span class="sd">        list of np.ndarray of float</span>
</span><span id="Mesh.get_orientation_field-582"><a href="#Mesh.get_orientation_field-582"><span class="linenos">582</span></a><span class="sd">            A `list` (one entry per patch) containing the orientation scalar field</span>
</span><span id="Mesh.get_orientation_field-583"><a href="#Mesh.get_orientation_field-583"><span class="linenos">583</span></a><span class="sd">            for at each evaluation point.</span>
</span><span id="Mesh.get_orientation_field-584"><a href="#Mesh.get_orientation_field-584"><span class="linenos">584</span></a>
</span><span id="Mesh.get_orientation_field-585"><a href="#Mesh.get_orientation_field-585"><span class="linenos">585</span></a><span class="sd">        Notes</span>
</span><span id="Mesh.get_orientation_field-586"><a href="#Mesh.get_orientation_field-586"><span class="linenos">586</span></a><span class="sd">        -----</span>
</span><span id="Mesh.get_orientation_field-587"><a href="#Mesh.get_orientation_field-587"><span class="linenos">587</span></a><span class="sd">        - Only implemented for 3D meshes (`self.connectivity.npa == 3`).</span>
</span><span id="Mesh.get_orientation_field-588"><a href="#Mesh.get_orientation_field-588"><span class="linenos">588</span></a><span class="sd">        - Uses parallel evaluation via `parallel_blocks`.</span>
</span><span id="Mesh.get_orientation_field-589"><a href="#Mesh.get_orientation_field-589"><span class="linenos">589</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh.get_orientation_field-590"><a href="#Mesh.get_orientation_field-590"><span class="linenos">590</span></a>
</span><span id="Mesh.get_orientation_field-591"><a href="#Mesh.get_orientation_field-591"><span class="linenos">591</span></a>        <span class="k">assert</span> <span class="p">(</span>
</span><span id="Mesh.get_orientation_field-592"><a href="#Mesh.get_orientation_field-592"><span class="linenos">592</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">npa</span> <span class="o">==</span> <span class="mi">3</span>
</span><span id="Mesh.get_orientation_field-593"><a href="#Mesh.get_orientation_field-593"><span class="linenos">593</span></a>        <span class="p">),</span> <span class="s2">&quot;Orientation field is only implemented for 3D meshes.&quot;</span>
</span><span id="Mesh.get_orientation_field-594"><a href="#Mesh.get_orientation_field-594"><span class="linenos">594</span></a>
</span><span id="Mesh.get_orientation_field-595"><a href="#Mesh.get_orientation_field-595"><span class="linenos">595</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">fct_elem</span><span class="p">(</span><span class="n">spline</span><span class="p">,</span> <span class="n">ctrl_pts</span><span class="p">,</span> <span class="n">XI</span><span class="p">):</span>
</span><span id="Mesh.get_orientation_field-596"><a href="#Mesh.get_orientation_field-596"><span class="linenos">596</span></a>            <span class="n">ds_dxi</span><span class="p">,</span> <span class="n">ds_deta</span><span class="p">,</span> <span class="n">ds_dzeta</span> <span class="o">=</span> <span class="n">spline</span><span class="p">(</span><span class="n">ctrl_pts</span><span class="p">,</span> <span class="n">XI</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Mesh.get_orientation_field-597"><a href="#Mesh.get_orientation_field-597"><span class="linenos">597</span></a>            <span class="n">cross_prod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">ds_dxi</span><span class="p">,</span> <span class="n">ds_deta</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Mesh.get_orientation_field-598"><a href="#Mesh.get_orientation_field-598"><span class="linenos">598</span></a>            <span class="n">mixt_prod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cross_prod</span> <span class="o">*</span> <span class="n">ds_dzeta</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Mesh.get_orientation_field-599"><a href="#Mesh.get_orientation_field-599"><span class="linenos">599</span></a>            <span class="k">return</span> <span class="n">mixt_prod</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="Mesh.get_orientation_field-600"><a href="#Mesh.get_orientation_field-600"><span class="linenos">600</span></a>
</span><span id="Mesh.get_orientation_field-601"><a href="#Mesh.get_orientation_field-601"><span class="linenos">601</span></a>        <span class="k">if</span> <span class="n">XI_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Mesh.get_orientation_field-602"><a href="#Mesh.get_orientation_field-602"><span class="linenos">602</span></a>            <span class="n">XI_list</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Mesh.get_orientation_field-603"><a href="#Mesh.get_orientation_field-603"><span class="linenos">603</span></a>                <span class="n">s</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">n_eval_per_elem</span><span class="o">=</span><span class="n">n_eval_per_elem</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span>
</span><span id="Mesh.get_orientation_field-604"><a href="#Mesh.get_orientation_field-604"><span class="linenos">604</span></a>            <span class="p">]</span>
</span><span id="Mesh.get_orientation_field-605"><a href="#Mesh.get_orientation_field-605"><span class="linenos">605</span></a>
</span><span id="Mesh.get_orientation_field-606"><a href="#Mesh.get_orientation_field-606"><span class="linenos">606</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_separated_ctrl_pts</span><span class="p">(),</span> <span class="n">XI_list</span><span class="p">))</span>
</span><span id="Mesh.get_orientation_field-607"><a href="#Mesh.get_orientation_field-607"><span class="linenos">607</span></a>
</span><span id="Mesh.get_orientation_field-608"><a href="#Mesh.get_orientation_field-608"><span class="linenos">608</span></a>        <span class="n">orientation_field</span> <span class="o">=</span> <span class="n">parallel_blocks</span><span class="p">(</span>
</span><span id="Mesh.get_orientation_field-609"><a href="#Mesh.get_orientation_field-609"><span class="linenos">609</span></a>            <span class="n">fct_elem</span><span class="p">,</span>
</span><span id="Mesh.get_orientation_field-610"><a href="#Mesh.get_orientation_field-610"><span class="linenos">610</span></a>            <span class="n">args</span><span class="p">,</span>
</span><span id="Mesh.get_orientation_field-611"><a href="#Mesh.get_orientation_field-611"><span class="linenos">611</span></a>            <span class="n">pbar_title</span><span class="o">=</span><span class="s2">&quot;Computing orientation field&quot;</span><span class="p">,</span>
</span><span id="Mesh.get_orientation_field-612"><a href="#Mesh.get_orientation_field-612"><span class="linenos">612</span></a>            <span class="n">disable_parallel</span><span class="o">=</span><span class="n">disable_parallel</span><span class="p">,</span>
</span><span id="Mesh.get_orientation_field-613"><a href="#Mesh.get_orientation_field-613"><span class="linenos">613</span></a>            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
</span><span id="Mesh.get_orientation_field-614"><a href="#Mesh.get_orientation_field-614"><span class="linenos">614</span></a>        <span class="p">)</span>
</span><span id="Mesh.get_orientation_field-615"><a href="#Mesh.get_orientation_field-615"><span class="linenos">615</span></a>
</span><span id="Mesh.get_orientation_field-616"><a href="#Mesh.get_orientation_field-616"><span class="linenos">616</span></a>        <span class="k">return</span> <span class="n">orientation_field</span>
</span></pre></div>


            <div class="docstring"><p>Compute the orientation field of a 3D multipatch B-spline mesh.</p>

<p>The orientation field is calculated as the scalar triple product of the
local tangent vectors of each element. It indicates the local handedness
of the mesh elements (positive for right-handed orientation, negative for left-handed).</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>n_eval_per_elem</strong> (int, optional):
Number of evaluation points per element along each parametric direction.
Default is <code>5</code>.</li>
<li><strong>XI_list</strong> (iterable of tuple of np.ndarray, optional):
Predefined parametric coordinates for each patch. If <code>None</code>, a regular grid
is generated using <code>n_eval_per_elem</code>.</li>
<li><strong>verbose</strong> (bool, optional):
If <code>True</code>, prints progress messages. Default is <code>True</code>.</li>
<li><strong>disable_parallel</strong> (bool, optional):
If <code>True</code>, disables parallel computation. Default is <code>False</code>.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>list of np.ndarray of float</strong>: A <code>list</code> (one entry per patch) containing the orientation scalar field
for at each evaluation point.</li>
</ul>

<h6 id="notes">Notes</h6>

<ul>
<li>Only implemented for 3D meshes (<code>self.connectivity.npa == 3</code>).</li>
<li>Uses parallel evaluation via <code>parallel_blocks</code>.</li>
</ul>
</div>


                            </div>
                            <div id="Mesh.correct_orientation" class="classattr">
                                        <input id="Mesh.correct_orientation-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">correct_orientation</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">separated_fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>,</span><span class="param">	<span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>,</span><span class="param">	<span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">disable_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Mesh.correct_orientation-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Mesh.correct_orientation"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Mesh.correct_orientation-618"><a href="#Mesh.correct_orientation-618"><span class="linenos">618</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">correct_orientation</span><span class="p">(</span>
</span><span id="Mesh.correct_orientation-619"><a href="#Mesh.correct_orientation-619"><span class="linenos">619</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Mesh.correct_orientation-620"><a href="#Mesh.correct_orientation-620"><span class="linenos">620</span></a>        <span class="n">separated_fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="Mesh.correct_orientation-621"><a href="#Mesh.correct_orientation-621"><span class="linenos">621</span></a>        <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="Mesh.correct_orientation-622"><a href="#Mesh.correct_orientation-622"><span class="linenos">622</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Mesh.correct_orientation-623"><a href="#Mesh.correct_orientation-623"><span class="linenos">623</span></a>        <span class="n">disable_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Mesh.correct_orientation-624"><a href="#Mesh.correct_orientation-624"><span class="linenos">624</span></a>    <span class="p">):</span>
</span><span id="Mesh.correct_orientation-625"><a href="#Mesh.correct_orientation-625"><span class="linenos">625</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh.correct_orientation-626"><a href="#Mesh.correct_orientation-626"><span class="linenos">626</span></a><span class="sd">        Ensure consistent orientation of all patches in a 3D multipatch B-spline mesh.</span>
</span><span id="Mesh.correct_orientation-627"><a href="#Mesh.correct_orientation-627"><span class="linenos">627</span></a>
</span><span id="Mesh.correct_orientation-628"><a href="#Mesh.correct_orientation-628"><span class="linenos">628</span></a><span class="sd">        This method detects and corrects inverted patch orientations by evaluating</span>
</span><span id="Mesh.correct_orientation-629"><a href="#Mesh.correct_orientation-629"><span class="linenos">629</span></a><span class="sd">        the integrated orientation field over each patch. Patches with a negative</span>
</span><span id="Mesh.correct_orientation-630"><a href="#Mesh.correct_orientation-630"><span class="linenos">630</span></a><span class="sd">        signed orientation are flipped along the specified parametric axis.</span>
</span><span id="Mesh.correct_orientation-631"><a href="#Mesh.correct_orientation-631"><span class="linenos">631</span></a>
</span><span id="Mesh.correct_orientation-632"><a href="#Mesh.correct_orientation-632"><span class="linenos">632</span></a><span class="sd">        The orientation of each patch is assessed by integrating the scalar triple</span>
</span><span id="Mesh.correct_orientation-633"><a href="#Mesh.correct_orientation-633"><span class="linenos">633</span></a><span class="sd">        product of the parametric tangent vectors using Gauss-Legendre quadrature.</span>
</span><span id="Mesh.correct_orientation-634"><a href="#Mesh.correct_orientation-634"><span class="linenos">634</span></a><span class="sd">        A negative integral indicates an inverted (left-handed) parametrization.</span>
</span><span id="Mesh.correct_orientation-635"><a href="#Mesh.correct_orientation-635"><span class="linenos">635</span></a>
</span><span id="Mesh.correct_orientation-636"><a href="#Mesh.correct_orientation-636"><span class="linenos">636</span></a><span class="sd">        Parameters</span>
</span><span id="Mesh.correct_orientation-637"><a href="#Mesh.correct_orientation-637"><span class="linenos">637</span></a><span class="sd">        ----------</span>
</span><span id="Mesh.correct_orientation-638"><a href="#Mesh.correct_orientation-638"><span class="linenos">638</span></a><span class="sd">        separated_fields : list, optional</span>
</span><span id="Mesh.correct_orientation-639"><a href="#Mesh.correct_orientation-639"><span class="linenos">639</span></a><span class="sd">            List of fields defined in separated (per-patch) representation that must</span>
</span><span id="Mesh.correct_orientation-640"><a href="#Mesh.correct_orientation-640"><span class="linenos">640</span></a><span class="sd">            be flipped consistently with the control points. Each entry is modified</span>
</span><span id="Mesh.correct_orientation-641"><a href="#Mesh.correct_orientation-641"><span class="linenos">641</span></a><span class="sd">            before returning it. Default is an empty list.</span>
</span><span id="Mesh.correct_orientation-642"><a href="#Mesh.correct_orientation-642"><span class="linenos">642</span></a><span class="sd">        axis : int, optional</span>
</span><span id="Mesh.correct_orientation-643"><a href="#Mesh.correct_orientation-643"><span class="linenos">643</span></a><span class="sd">            Parametric axis along which inverted patches are flipped</span>
</span><span id="Mesh.correct_orientation-644"><a href="#Mesh.correct_orientation-644"><span class="linenos">644</span></a><span class="sd">            (`0 -&gt; xi`, `1 -&gt; eta`, `2 -&gt; zeta`). Default is `2`.</span>
</span><span id="Mesh.correct_orientation-645"><a href="#Mesh.correct_orientation-645"><span class="linenos">645</span></a><span class="sd">        verbose : bool, optional</span>
</span><span id="Mesh.correct_orientation-646"><a href="#Mesh.correct_orientation-646"><span class="linenos">646</span></a><span class="sd">            If `True`, prints diagnostic information, including the number of flipped</span>
</span><span id="Mesh.correct_orientation-647"><a href="#Mesh.correct_orientation-647"><span class="linenos">647</span></a><span class="sd">            patches. Default is `True`.</span>
</span><span id="Mesh.correct_orientation-648"><a href="#Mesh.correct_orientation-648"><span class="linenos">648</span></a><span class="sd">        disable_parallel : bool, optional</span>
</span><span id="Mesh.correct_orientation-649"><a href="#Mesh.correct_orientation-649"><span class="linenos">649</span></a><span class="sd">            If `True`, disables parallel computation. Default is `False`.</span>
</span><span id="Mesh.correct_orientation-650"><a href="#Mesh.correct_orientation-650"><span class="linenos">650</span></a>
</span><span id="Mesh.correct_orientation-651"><a href="#Mesh.correct_orientation-651"><span class="linenos">651</span></a><span class="sd">        Returns</span>
</span><span id="Mesh.correct_orientation-652"><a href="#Mesh.correct_orientation-652"><span class="linenos">652</span></a><span class="sd">        -------</span>
</span><span id="Mesh.correct_orientation-653"><a href="#Mesh.correct_orientation-653"><span class="linenos">653</span></a><span class="sd">        list</span>
</span><span id="Mesh.correct_orientation-654"><a href="#Mesh.correct_orientation-654"><span class="linenos">654</span></a><span class="sd">            Flipped version, consistently with the control points, of `separated_fields`.</span>
</span><span id="Mesh.correct_orientation-655"><a href="#Mesh.correct_orientation-655"><span class="linenos">655</span></a>
</span><span id="Mesh.correct_orientation-656"><a href="#Mesh.correct_orientation-656"><span class="linenos">656</span></a><span class="sd">        Notes</span>
</span><span id="Mesh.correct_orientation-657"><a href="#Mesh.correct_orientation-657"><span class="linenos">657</span></a><span class="sd">        -----</span>
</span><span id="Mesh.correct_orientation-658"><a href="#Mesh.correct_orientation-658"><span class="linenos">658</span></a><span class="sd">        - Only applicable to 3D meshes (`self.connectivity.npa == 3`).</span>
</span><span id="Mesh.correct_orientation-659"><a href="#Mesh.correct_orientation-659"><span class="linenos">659</span></a><span class="sd">        - Patch orientation is determined by integrating the orientation field</span>
</span><span id="Mesh.correct_orientation-660"><a href="#Mesh.correct_orientation-660"><span class="linenos">660</span></a><span class="sd">          returned by :meth:`get_orientation_field`.</span>
</span><span id="Mesh.correct_orientation-661"><a href="#Mesh.correct_orientation-661"><span class="linenos">661</span></a><span class="sd">        - Flipping a patch involves:</span>
</span><span id="Mesh.correct_orientation-662"><a href="#Mesh.correct_orientation-662"><span class="linenos">662</span></a><span class="sd">            * Reversing the knot vector of the selected parametric axis.</span>
</span><span id="Mesh.correct_orientation-663"><a href="#Mesh.correct_orientation-663"><span class="linenos">663</span></a><span class="sd">            * Reversing the corresponding axis of the separated control points.</span>
</span><span id="Mesh.correct_orientation-664"><a href="#Mesh.correct_orientation-664"><span class="linenos">664</span></a><span class="sd">            * Reversing the same axis for all fields listed in `separated_fields`.</span>
</span><span id="Mesh.correct_orientation-665"><a href="#Mesh.correct_orientation-665"><span class="linenos">665</span></a><span class="sd">        - The mesh connectivity (`unique_nodes_inds`) and `unique_ctrl_pts` are</span>
</span><span id="Mesh.correct_orientation-666"><a href="#Mesh.correct_orientation-666"><span class="linenos">666</span></a><span class="sd">          modified to reflect the updated orientation.</span>
</span><span id="Mesh.correct_orientation-667"><a href="#Mesh.correct_orientation-667"><span class="linenos">667</span></a><span class="sd">        - This operation modifies the mesh in place.</span>
</span><span id="Mesh.correct_orientation-668"><a href="#Mesh.correct_orientation-668"><span class="linenos">668</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh.correct_orientation-669"><a href="#Mesh.correct_orientation-669"><span class="linenos">669</span></a>        <span class="n">nb_gauss</span> <span class="o">=</span> <span class="p">[[(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">getDegrees</span><span class="p">()]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">]</span>
</span><span id="Mesh.correct_orientation-670"><a href="#Mesh.correct_orientation-670"><span class="linenos">670</span></a>        <span class="n">XI_dXI_list</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Mesh.correct_orientation-671"><a href="#Mesh.correct_orientation-671"><span class="linenos">671</span></a>            <span class="n">s</span><span class="o">.</span><span class="n">gauss_legendre_for_integration</span><span class="p">(</span><span class="n">n_eval_per_elem</span><span class="o">=</span><span class="n">ng</span><span class="p">)</span>
</span><span id="Mesh.correct_orientation-672"><a href="#Mesh.correct_orientation-672"><span class="linenos">672</span></a>            <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">ng</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">,</span> <span class="n">nb_gauss</span><span class="p">)</span>
</span><span id="Mesh.correct_orientation-673"><a href="#Mesh.correct_orientation-673"><span class="linenos">673</span></a>        <span class="p">]</span>
</span><span id="Mesh.correct_orientation-674"><a href="#Mesh.correct_orientation-674"><span class="linenos">674</span></a>        <span class="n">XI_list</span><span class="p">,</span> <span class="n">dXI_list</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">XI_dXI_list</span><span class="p">)</span>
</span><span id="Mesh.correct_orientation-675"><a href="#Mesh.correct_orientation-675"><span class="linenos">675</span></a>        <span class="n">orientation_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_orientation_field</span><span class="p">(</span>
</span><span id="Mesh.correct_orientation-676"><a href="#Mesh.correct_orientation-676"><span class="linenos">676</span></a>            <span class="n">XI_list</span><span class="o">=</span><span class="n">XI_list</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">disable_parallel</span><span class="o">=</span><span class="n">disable_parallel</span>
</span><span id="Mesh.correct_orientation-677"><a href="#Mesh.correct_orientation-677"><span class="linenos">677</span></a>        <span class="p">)</span>
</span><span id="Mesh.correct_orientation-678"><a href="#Mesh.correct_orientation-678"><span class="linenos">678</span></a>        <span class="n">patchs_orientation</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Mesh.correct_orientation-679"><a href="#Mesh.correct_orientation-679"><span class="linenos">679</span></a>        <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">dxi</span><span class="p">,</span> <span class="n">deta</span><span class="p">,</span> <span class="n">dzeta</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">orientation_field</span><span class="p">,</span> <span class="n">dXI_list</span><span class="p">):</span>
</span><span id="Mesh.correct_orientation-680"><a href="#Mesh.correct_orientation-680"><span class="linenos">680</span></a>            <span class="n">dXI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">dxi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">deta</span><span class="p">,</span> <span class="n">dzeta</span><span class="p">))</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</span><span id="Mesh.correct_orientation-681"><a href="#Mesh.correct_orientation-681"><span class="linenos">681</span></a>            <span class="n">patchs_orientation</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="o">@</span> <span class="n">dXI</span><span class="p">)</span>
</span><span id="Mesh.correct_orientation-682"><a href="#Mesh.correct_orientation-682"><span class="linenos">682</span></a>        <span class="n">patchs_to_flip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">patchs_orientation</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Mesh.correct_orientation-683"><a href="#Mesh.correct_orientation-683"><span class="linenos">683</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Mesh.correct_orientation-684"><a href="#Mesh.correct_orientation-684"><span class="linenos">684</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Mesh.correct_orientation-685"><a href="#Mesh.correct_orientation-685"><span class="linenos">685</span></a>                <span class="sa">f</span><span class="s2">&quot;Flipping </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">patchs_to_flip</span><span class="p">)</span><span class="si">}</span><span class="s2"> out of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_patchs</span><span class="si">}</span><span class="s2"> patchs.&quot;</span>
</span><span id="Mesh.correct_orientation-686"><a href="#Mesh.correct_orientation-686"><span class="linenos">686</span></a>            <span class="p">)</span>
</span><span id="Mesh.correct_orientation-687"><a href="#Mesh.correct_orientation-687"><span class="linenos">687</span></a>        <span class="n">separated_ctrl_pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_separated_ctrl_pts</span><span class="p">()</span>
</span><span id="Mesh.correct_orientation-688"><a href="#Mesh.correct_orientation-688"><span class="linenos">688</span></a>        <span class="n">inds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">unique_field_indices</span><span class="p">(())</span>
</span><span id="Mesh.correct_orientation-689"><a href="#Mesh.correct_orientation-689"><span class="linenos">689</span></a>        <span class="n">flip</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="Mesh.correct_orientation-690"><a href="#Mesh.correct_orientation-690"><span class="linenos">690</span></a>            <span class="p">[</span><span class="o">...</span><span class="p">]</span>
</span><span id="Mesh.correct_orientation-691"><a href="#Mesh.correct_orientation-691"><span class="linenos">691</span></a>            <span class="o">+</span> <span class="p">[</span>
</span><span id="Mesh.correct_orientation-692"><a href="#Mesh.correct_orientation-692"><span class="linenos">692</span></a>                <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="n">axis</span> <span class="k">else</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Mesh.correct_orientation-693"><a href="#Mesh.correct_orientation-693"><span class="linenos">693</span></a>                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">npa</span><span class="p">)</span>
</span><span id="Mesh.correct_orientation-694"><a href="#Mesh.correct_orientation-694"><span class="linenos">694</span></a>            <span class="p">]</span>
</span><span id="Mesh.correct_orientation-695"><a href="#Mesh.correct_orientation-695"><span class="linenos">695</span></a>        <span class="p">)</span>
</span><span id="Mesh.correct_orientation-696"><a href="#Mesh.correct_orientation-696"><span class="linenos">696</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">patchs_to_flip</span><span class="p">:</span>
</span><span id="Mesh.correct_orientation-697"><a href="#Mesh.correct_orientation-697"><span class="linenos">697</span></a>            <span class="n">axis_basis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">bases</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span>
</span><span id="Mesh.correct_orientation-698"><a href="#Mesh.correct_orientation-698"><span class="linenos">698</span></a>            <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">axis_basis</span><span class="o">.</span><span class="n">span</span>
</span><span id="Mesh.correct_orientation-699"><a href="#Mesh.correct_orientation-699"><span class="linenos">699</span></a>            <span class="n">axis_basis</span><span class="o">.</span><span class="n">knot</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="n">axis_basis</span><span class="o">.</span><span class="n">knot</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Mesh.correct_orientation-700"><a href="#Mesh.correct_orientation-700"><span class="linenos">700</span></a>            <span class="n">separated_ctrl_pts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">separated_ctrl_pts</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">flip</span><span class="p">]</span>
</span><span id="Mesh.correct_orientation-701"><a href="#Mesh.correct_orientation-701"><span class="linenos">701</span></a>            <span class="n">inds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">inds</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">flip</span><span class="p">]</span>
</span><span id="Mesh.correct_orientation-702"><a href="#Mesh.correct_orientation-702"><span class="linenos">702</span></a>            <span class="k">for</span> <span class="n">separated_field</span> <span class="ow">in</span> <span class="n">separated_fields</span><span class="p">:</span>
</span><span id="Mesh.correct_orientation-703"><a href="#Mesh.correct_orientation-703"><span class="linenos">703</span></a>                <span class="n">separated_field</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">separated_field</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">flip</span><span class="p">]</span>
</span><span id="Mesh.correct_orientation-704"><a href="#Mesh.correct_orientation-704"><span class="linenos">704</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">unique_nodes_inds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">agglomerate</span><span class="p">(</span><span class="n">inds</span><span class="p">)</span>
</span><span id="Mesh.correct_orientation-705"><a href="#Mesh.correct_orientation-705"><span class="linenos">705</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">unique_ctrl_pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">separated_to_unique</span><span class="p">(</span><span class="n">separated_ctrl_pts</span><span class="p">)</span>
</span><span id="Mesh.correct_orientation-706"><a href="#Mesh.correct_orientation-706"><span class="linenos">706</span></a>
</span><span id="Mesh.correct_orientation-707"><a href="#Mesh.correct_orientation-707"><span class="linenos">707</span></a>        <span class="k">return</span> <span class="n">separated_fields</span>
</span></pre></div>


            <div class="docstring"><p>Ensure consistent orientation of all patches in a 3D multipatch B-spline mesh.</p>

<p>This method detects and corrects inverted patch orientations by evaluating
the integrated orientation field over each patch. Patches with a negative
signed orientation are flipped along the specified parametric axis.</p>

<p>The orientation of each patch is assessed by integrating the scalar triple
product of the parametric tangent vectors using Gauss-Legendre quadrature.
A negative integral indicates an inverted (left-handed) parametrization.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>separated_fields</strong> (list, optional):
List of fields defined in separated (per-patch) representation that must
be flipped consistently with the control points. Each entry is modified
before returning it. Default is an empty list.</li>
<li><strong>axis</strong> (int, optional):
Parametric axis along which inverted patches are flipped
(<code>0 -&gt; xi</code>, <code>1 -&gt; eta</code>, <code>2 -&gt; zeta</code>). Default is <code>2</code>.</li>
<li><strong>verbose</strong> (bool, optional):
If <code>True</code>, prints diagnostic information, including the number of flipped
patches. Default is <code>True</code>.</li>
<li><strong>disable_parallel</strong> (bool, optional):
If <code>True</code>, disables parallel computation. Default is <code>False</code>.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>list</strong>: Flipped version, consistently with the control points, of <code>separated_fields</code>.</li>
</ul>

<h6 id="notes">Notes</h6>

<ul>
<li>Only applicable to 3D meshes (<code>self.connectivity.npa == 3</code>).</li>
<li>Patch orientation is determined by integrating the orientation field
returned by <code><a href="#Mesh.get_orientation_field">get_orientation_field()</a></code>.</li>
<li>Flipping a patch involves:
<ul>
<li>Reversing the knot vector of the selected parametric axis.</li>
<li>Reversing the corresponding axis of the separated control points.</li>
<li>Reversing the same axis for all fields listed in <code>separated_fields</code>.</li>
</ul></li>
<li>The mesh connectivity (<code>unique_nodes_inds</code>) and <code><a href="#Mesh.unique_ctrl_pts">unique_ctrl_pts</a></code> are
modified to reflect the updated orientation.</li>
<li>This operation modifies the mesh in place.</li>
</ul>
</div>


                            </div>
                            <div id="Mesh.plot_orientation" class="classattr">
                                        <input id="Mesh.plot_orientation-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_orientation</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">n_eval_per_elem</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">5</span>,</span><span class="param">	<span class="n">XI_list</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">disable_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">) -> <span class="n">pyvista</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">Plotter</span>:</span></span>

                <label class="view-source-button" for="Mesh.plot_orientation-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Mesh.plot_orientation"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Mesh.plot_orientation-709"><a href="#Mesh.plot_orientation-709"><span class="linenos">709</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_orientation</span><span class="p">(</span>
</span><span id="Mesh.plot_orientation-710"><a href="#Mesh.plot_orientation-710"><span class="linenos">710</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Mesh.plot_orientation-711"><a href="#Mesh.plot_orientation-711"><span class="linenos">711</span></a>        <span class="n">n_eval_per_elem</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="Mesh.plot_orientation-712"><a href="#Mesh.plot_orientation-712"><span class="linenos">712</span></a>        <span class="n">XI_list</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Mesh.plot_orientation-713"><a href="#Mesh.plot_orientation-713"><span class="linenos">713</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Mesh.plot_orientation-714"><a href="#Mesh.plot_orientation-714"><span class="linenos">714</span></a>        <span class="n">disable_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Mesh.plot_orientation-715"><a href="#Mesh.plot_orientation-715"><span class="linenos">715</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="Mesh.plot_orientation-716"><a href="#Mesh.plot_orientation-716"><span class="linenos">716</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">:</span>
</span><span id="Mesh.plot_orientation-717"><a href="#Mesh.plot_orientation-717"><span class="linenos">717</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh.plot_orientation-718"><a href="#Mesh.plot_orientation-718"><span class="linenos">718</span></a><span class="sd">        Visualize the orientation (handedness) of the mesh elements.</span>
</span><span id="Mesh.plot_orientation-719"><a href="#Mesh.plot_orientation-719"><span class="linenos">719</span></a>
</span><span id="Mesh.plot_orientation-720"><a href="#Mesh.plot_orientation-720"><span class="linenos">720</span></a><span class="sd">        This method computes the orientation field of the mesh and visualizes it</span>
</span><span id="Mesh.plot_orientation-721"><a href="#Mesh.plot_orientation-721"><span class="linenos">721</span></a><span class="sd">        as a boolean field indicating whether each evaluation point corresponds</span>
</span><span id="Mesh.plot_orientation-722"><a href="#Mesh.plot_orientation-722"><span class="linenos">722</span></a><span class="sd">        to a right-handed (`True`) or left-handed (`False`) parametrization.</span>
</span><span id="Mesh.plot_orientation-723"><a href="#Mesh.plot_orientation-723"><span class="linenos">723</span></a>
</span><span id="Mesh.plot_orientation-724"><a href="#Mesh.plot_orientation-724"><span class="linenos">724</span></a><span class="sd">        Internally, the orientation field is evaluated using</span>
</span><span id="Mesh.plot_orientation-725"><a href="#Mesh.plot_orientation-725"><span class="linenos">725</span></a><span class="sd">        :meth:`get_orientation_field`, then thresholded as</span>
</span><span id="Mesh.plot_orientation-726"><a href="#Mesh.plot_orientation-726"><span class="linenos">726</span></a><span class="sd">        `orientation &gt; 0` and reshaped to comply with plotting requirements.</span>
</span><span id="Mesh.plot_orientation-727"><a href="#Mesh.plot_orientation-727"><span class="linenos">727</span></a>
</span><span id="Mesh.plot_orientation-728"><a href="#Mesh.plot_orientation-728"><span class="linenos">728</span></a><span class="sd">        Parameters</span>
</span><span id="Mesh.plot_orientation-729"><a href="#Mesh.plot_orientation-729"><span class="linenos">729</span></a><span class="sd">        ----------</span>
</span><span id="Mesh.plot_orientation-730"><a href="#Mesh.plot_orientation-730"><span class="linenos">730</span></a><span class="sd">        n_eval_per_elem : int or iterable of int, optional</span>
</span><span id="Mesh.plot_orientation-731"><a href="#Mesh.plot_orientation-731"><span class="linenos">731</span></a><span class="sd">            Number of evaluation points per element along each parametric direction.</span>
</span><span id="Mesh.plot_orientation-732"><a href="#Mesh.plot_orientation-732"><span class="linenos">732</span></a><span class="sd">            If an iterable is provided, it must match the parametric dimension.</span>
</span><span id="Mesh.plot_orientation-733"><a href="#Mesh.plot_orientation-733"><span class="linenos">733</span></a><span class="sd">            Default is `5`.</span>
</span><span id="Mesh.plot_orientation-734"><a href="#Mesh.plot_orientation-734"><span class="linenos">734</span></a><span class="sd">        XI_list : iterable of tuple of ndarray, optional</span>
</span><span id="Mesh.plot_orientation-735"><a href="#Mesh.plot_orientation-735"><span class="linenos">735</span></a><span class="sd">            Parametric coordinates at which the orientation field is evaluated,</span>
</span><span id="Mesh.plot_orientation-736"><a href="#Mesh.plot_orientation-736"><span class="linenos">736</span></a><span class="sd">            one entry per patch. If `None` (default), a uniform sampling is used</span>
</span><span id="Mesh.plot_orientation-737"><a href="#Mesh.plot_orientation-737"><span class="linenos">737</span></a><span class="sd">            for each patch.</span>
</span><span id="Mesh.plot_orientation-738"><a href="#Mesh.plot_orientation-738"><span class="linenos">738</span></a><span class="sd">        verbose : bool, optional</span>
</span><span id="Mesh.plot_orientation-739"><a href="#Mesh.plot_orientation-739"><span class="linenos">739</span></a><span class="sd">            If `True`, displays progress information. Default is `True`.</span>
</span><span id="Mesh.plot_orientation-740"><a href="#Mesh.plot_orientation-740"><span class="linenos">740</span></a><span class="sd">        disable_parallel : bool, optional</span>
</span><span id="Mesh.plot_orientation-741"><a href="#Mesh.plot_orientation-741"><span class="linenos">741</span></a><span class="sd">            If `True`, disables parallel computation. Default is `False`.</span>
</span><span id="Mesh.plot_orientation-742"><a href="#Mesh.plot_orientation-742"><span class="linenos">742</span></a><span class="sd">        **kwargs : dict, optional</span>
</span><span id="Mesh.plot_orientation-743"><a href="#Mesh.plot_orientation-743"><span class="linenos">743</span></a><span class="sd">            Additional keyword arguments forwarded to :meth:`Mesh.plot`, such as</span>
</span><span id="Mesh.plot_orientation-744"><a href="#Mesh.plot_orientation-744"><span class="linenos">744</span></a><span class="sd">            `cmap`, `scalar_bar_args`, `show_scalar_bar`, etc.</span>
</span><span id="Mesh.plot_orientation-745"><a href="#Mesh.plot_orientation-745"><span class="linenos">745</span></a>
</span><span id="Mesh.plot_orientation-746"><a href="#Mesh.plot_orientation-746"><span class="linenos">746</span></a><span class="sd">        Returns</span>
</span><span id="Mesh.plot_orientation-747"><a href="#Mesh.plot_orientation-747"><span class="linenos">747</span></a><span class="sd">        -------</span>
</span><span id="Mesh.plot_orientation-748"><a href="#Mesh.plot_orientation-748"><span class="linenos">748</span></a><span class="sd">        pv.Plotter</span>
</span><span id="Mesh.plot_orientation-749"><a href="#Mesh.plot_orientation-749"><span class="linenos">749</span></a><span class="sd">            The PyVista plotter object used for visualization.</span>
</span><span id="Mesh.plot_orientation-750"><a href="#Mesh.plot_orientation-750"><span class="linenos">750</span></a>
</span><span id="Mesh.plot_orientation-751"><a href="#Mesh.plot_orientation-751"><span class="linenos">751</span></a><span class="sd">        Notes</span>
</span><span id="Mesh.plot_orientation-752"><a href="#Mesh.plot_orientation-752"><span class="linenos">752</span></a><span class="sd">        -----</span>
</span><span id="Mesh.plot_orientation-753"><a href="#Mesh.plot_orientation-753"><span class="linenos">753</span></a><span class="sd">        - The orientation field is visualized as a boolean scalar field, where</span>
</span><span id="Mesh.plot_orientation-754"><a href="#Mesh.plot_orientation-754"><span class="linenos">754</span></a><span class="sd">          `True` indicates a right-handed parametrization and `False` a</span>
</span><span id="Mesh.plot_orientation-755"><a href="#Mesh.plot_orientation-755"><span class="linenos">755</span></a><span class="sd">          left-handed one.</span>
</span><span id="Mesh.plot_orientation-756"><a href="#Mesh.plot_orientation-756"><span class="linenos">756</span></a><span class="sd">        - The default colormap uses red for left-handed and green for right-handed</span>
</span><span id="Mesh.plot_orientation-757"><a href="#Mesh.plot_orientation-757"><span class="linenos">757</span></a><span class="sd">          orientations.</span>
</span><span id="Mesh.plot_orientation-758"><a href="#Mesh.plot_orientation-758"><span class="linenos">758</span></a><span class="sd">        - This method is intended as a diagnostic tool, typically used before or</span>
</span><span id="Mesh.plot_orientation-759"><a href="#Mesh.plot_orientation-759"><span class="linenos">759</span></a><span class="sd">          after calling :meth:`correct_orientation`.</span>
</span><span id="Mesh.plot_orientation-760"><a href="#Mesh.plot_orientation-760"><span class="linenos">760</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh.plot_orientation-761"><a href="#Mesh.plot_orientation-761"><span class="linenos">761</span></a>        <span class="n">separated_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_orientation_field</span><span class="p">(</span>
</span><span id="Mesh.plot_orientation-762"><a href="#Mesh.plot_orientation-762"><span class="linenos">762</span></a>            <span class="n">n_eval_per_elem</span><span class="o">=</span><span class="n">n_eval_per_elem</span><span class="p">,</span>
</span><span id="Mesh.plot_orientation-763"><a href="#Mesh.plot_orientation-763"><span class="linenos">763</span></a>            <span class="n">XI_list</span><span class="o">=</span><span class="n">XI_list</span><span class="p">,</span>
</span><span id="Mesh.plot_orientation-764"><a href="#Mesh.plot_orientation-764"><span class="linenos">764</span></a>            <span class="n">disable_parallel</span><span class="o">=</span><span class="n">disable_parallel</span><span class="p">,</span>
</span><span id="Mesh.plot_orientation-765"><a href="#Mesh.plot_orientation-765"><span class="linenos">765</span></a>            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
</span><span id="Mesh.plot_orientation-766"><a href="#Mesh.plot_orientation-766"><span class="linenos">766</span></a>        <span class="p">)</span>
</span><span id="Mesh.plot_orientation-767"><a href="#Mesh.plot_orientation-767"><span class="linenos">767</span></a>        <span class="n">separated_field</span> <span class="o">=</span> <span class="p">[</span><span class="n">field</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">separated_field</span><span class="p">]</span>
</span><span id="Mesh.plot_orientation-768"><a href="#Mesh.plot_orientation-768"><span class="linenos">768</span></a>
</span><span id="Mesh.plot_orientation-769"><a href="#Mesh.plot_orientation-769"><span class="linenos">769</span></a>        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;cmap&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;#ff0000&quot;</span><span class="p">,</span> <span class="s2">&quot;#00ff00&quot;</span><span class="p">])</span>
</span><span id="Mesh.plot_orientation-770"><a href="#Mesh.plot_orientation-770"><span class="linenos">770</span></a>        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;show_scalar_bar&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="Mesh.plot_orientation-771"><a href="#Mesh.plot_orientation-771"><span class="linenos">771</span></a>        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;annotations&quot;</span><span class="p">,</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;False&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;True&quot;</span><span class="p">})</span>
</span><span id="Mesh.plot_orientation-772"><a href="#Mesh.plot_orientation-772"><span class="linenos">772</span></a>        <span class="n">scalar_bar_args</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;scalar_bar_args&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="Mesh.plot_orientation-773"><a href="#Mesh.plot_orientation-773"><span class="linenos">773</span></a>        <span class="n">scalar_bar_args</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;Is Right Handed&quot;</span><span class="p">)</span>
</span><span id="Mesh.plot_orientation-774"><a href="#Mesh.plot_orientation-774"><span class="linenos">774</span></a>        <span class="n">scalar_bar_args</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;n_labels&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Mesh.plot_orientation-775"><a href="#Mesh.plot_orientation-775"><span class="linenos">775</span></a>        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;scalar_bar_args&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scalar_bar_args</span>
</span><span id="Mesh.plot_orientation-776"><a href="#Mesh.plot_orientation-776"><span class="linenos">776</span></a>
</span><span id="Mesh.plot_orientation-777"><a href="#Mesh.plot_orientation-777"><span class="linenos">777</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="Mesh.plot_orientation-778"><a href="#Mesh.plot_orientation-778"><span class="linenos">778</span></a>            <span class="n">n_eval_per_elem</span><span class="o">=</span><span class="n">n_eval_per_elem</span><span class="p">,</span>
</span><span id="Mesh.plot_orientation-779"><a href="#Mesh.plot_orientation-779"><span class="linenos">779</span></a>            <span class="n">XI_list</span><span class="o">=</span><span class="n">XI_list</span><span class="p">,</span>
</span><span id="Mesh.plot_orientation-780"><a href="#Mesh.plot_orientation-780"><span class="linenos">780</span></a>            <span class="n">separated_field</span><span class="o">=</span><span class="n">separated_field</span><span class="p">,</span>
</span><span id="Mesh.plot_orientation-781"><a href="#Mesh.plot_orientation-781"><span class="linenos">781</span></a>            <span class="n">disable_parallel</span><span class="o">=</span><span class="n">disable_parallel</span><span class="p">,</span>
</span><span id="Mesh.plot_orientation-782"><a href="#Mesh.plot_orientation-782"><span class="linenos">782</span></a>            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
</span><span id="Mesh.plot_orientation-783"><a href="#Mesh.plot_orientation-783"><span class="linenos">783</span></a>            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="Mesh.plot_orientation-784"><a href="#Mesh.plot_orientation-784"><span class="linenos">784</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Visualize the orientation (handedness) of the mesh elements.</p>

<p>This method computes the orientation field of the mesh and visualizes it
as a boolean field indicating whether each evaluation point corresponds
to a right-handed (<code>True</code>) or left-handed (<code>False</code>) parametrization.</p>

<p>Internally, the orientation field is evaluated using
<code><a href="#Mesh.get_orientation_field">get_orientation_field()</a></code>, then thresholded as
<code>orientation &gt; 0</code> and reshaped to comply with plotting requirements.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>n_eval_per_elem</strong> (int or iterable of int, optional):
Number of evaluation points per element along each parametric direction.
If an iterable is provided, it must match the parametric dimension.
Default is <code>5</code>.</li>
<li><strong>XI_list</strong> (iterable of tuple of ndarray, optional):
Parametric coordinates at which the orientation field is evaluated,
one entry per patch. If <code>None</code> (default), a uniform sampling is used
for each patch.</li>
<li><strong>verbose</strong> (bool, optional):
If <code>True</code>, displays progress information. Default is <code>True</code>.</li>
<li><strong>disable_parallel</strong> (bool, optional):
If <code>True</code>, disables parallel computation. Default is <code>False</code>.</li>
<li><strong>**kwargs</strong> (dict, optional):
Additional keyword arguments forwarded to <code><a href="#Mesh.plot">Mesh.plot()</a></code>, such as
<code>cmap</code>, <code>scalar_bar_args</code>, <code>show_scalar_bar</code>, etc.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>pv.Plotter</strong>: The PyVista plotter object used for visualization.</li>
</ul>

<h6 id="notes">Notes</h6>

<ul>
<li>The orientation field is visualized as a boolean scalar field, where
<code>True</code> indicates a right-handed parametrization and <code>False</code> a
left-handed one.</li>
<li>The default colormap uses red for left-handed and green for right-handed
orientations.</li>
<li>This method is intended as a diagnostic tool, typically used before or
after calling <code><a href="#Mesh.correct_orientation">correct_orientation()</a></code>.</li>
</ul>
</div>


                            </div>
                            <div id="Mesh.plot" class="classattr">
                                        <input id="Mesh.plot-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">n_eval_per_elem</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">10</span>,</span><span class="param">	<span class="n">XI_list</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">unique_field</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">separated_field</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">callable</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">interior_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">plt_ctrl_mesh</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">disable_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">pv_plotter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pyvista</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">Plotter</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">elem_sep_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span>,</span><span class="param">	<span class="n">ctrl_poly_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;green&#39;</span>,</span><span class="param">	<span class="o">**</span><span class="n">pv_add_mesh_kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Mesh.plot-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Mesh.plot"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Mesh.plot-786"><a href="#Mesh.plot-786"><span class="linenos">786</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot</span><span class="p">(</span>
</span><span id="Mesh.plot-787"><a href="#Mesh.plot-787"><span class="linenos">787</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Mesh.plot-788"><a href="#Mesh.plot-788"><span class="linenos">788</span></a>        <span class="n">n_eval_per_elem</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="Mesh.plot-789"><a href="#Mesh.plot-789"><span class="linenos">789</span></a>        <span class="n">XI_list</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Mesh.plot-790"><a href="#Mesh.plot-790"><span class="linenos">790</span></a>        <span class="n">unique_field</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Mesh.plot-791"><a href="#Mesh.plot-791"><span class="linenos">791</span></a>        <span class="n">separated_field</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">callable</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Mesh.plot-792"><a href="#Mesh.plot-792"><span class="linenos">792</span></a>        <span class="n">interior_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Mesh.plot-793"><a href="#Mesh.plot-793"><span class="linenos">793</span></a>        <span class="n">plt_ctrl_mesh</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Mesh.plot-794"><a href="#Mesh.plot-794"><span class="linenos">794</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Mesh.plot-795"><a href="#Mesh.plot-795"><span class="linenos">795</span></a>        <span class="n">disable_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Mesh.plot-796"><a href="#Mesh.plot-796"><span class="linenos">796</span></a>        <span class="n">pv_plotter</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Mesh.plot-797"><a href="#Mesh.plot-797"><span class="linenos">797</span></a>        <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Mesh.plot-798"><a href="#Mesh.plot-798"><span class="linenos">798</span></a>        <span class="n">elem_sep_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span id="Mesh.plot-799"><a href="#Mesh.plot-799"><span class="linenos">799</span></a>        <span class="n">ctrl_poly_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span>
</span><span id="Mesh.plot-800"><a href="#Mesh.plot-800"><span class="linenos">800</span></a>        <span class="o">**</span><span class="n">pv_add_mesh_kwargs</span><span class="p">,</span>
</span><span id="Mesh.plot-801"><a href="#Mesh.plot-801"><span class="linenos">801</span></a>    <span class="p">):</span>
</span><span id="Mesh.plot-802"><a href="#Mesh.plot-802"><span class="linenos">802</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh.plot-803"><a href="#Mesh.plot-803"><span class="linenos">803</span></a><span class="sd">        Visualize the B-spline multipatch mesh using `PyVista`.</span>
</span><span id="Mesh.plot-804"><a href="#Mesh.plot-804"><span class="linenos">804</span></a>
</span><span id="Mesh.plot-805"><a href="#Mesh.plot-805"><span class="linenos">805</span></a><span class="sd">        This method evaluates the mesh geometry and optional scalar fields at</span>
</span><span id="Mesh.plot-806"><a href="#Mesh.plot-806"><span class="linenos">806</span></a><span class="sd">        parametric sampling points and renders them using `PyVista`. Fields can be</span>
</span><span id="Mesh.plot-807"><a href="#Mesh.plot-807"><span class="linenos">807</span></a><span class="sd">        provided either in a unique (global) or separated (per-patch) representation.</span>
</span><span id="Mesh.plot-808"><a href="#Mesh.plot-808"><span class="linenos">808</span></a>
</span><span id="Mesh.plot-809"><a href="#Mesh.plot-809"><span class="linenos">809</span></a><span class="sd">        Parameters</span>
</span><span id="Mesh.plot-810"><a href="#Mesh.plot-810"><span class="linenos">810</span></a><span class="sd">        ----------</span>
</span><span id="Mesh.plot-811"><a href="#Mesh.plot-811"><span class="linenos">811</span></a><span class="sd">        n_eval_per_elem : int or iterable of int, optional</span>
</span><span id="Mesh.plot-812"><a href="#Mesh.plot-812"><span class="linenos">812</span></a><span class="sd">            Number of evaluation points per element along each parametric direction.</span>
</span><span id="Mesh.plot-813"><a href="#Mesh.plot-813"><span class="linenos">813</span></a><span class="sd">            If an iterable is provided, it must match the parametric dimension.</span>
</span><span id="Mesh.plot-814"><a href="#Mesh.plot-814"><span class="linenos">814</span></a><span class="sd">            Default is `10`.</span>
</span><span id="Mesh.plot-815"><a href="#Mesh.plot-815"><span class="linenos">815</span></a><span class="sd">        XI_list : iterable of tuple of np.ndarray, optional</span>
</span><span id="Mesh.plot-816"><a href="#Mesh.plot-816"><span class="linenos">816</span></a><span class="sd">            Explicit parametric coordinates for evaluation, provided per patch.</span>
</span><span id="Mesh.plot-817"><a href="#Mesh.plot-817"><span class="linenos">817</span></a><span class="sd">            If `None`, a regular grid based on `n_eval_per_elem` is used.</span>
</span><span id="Mesh.plot-818"><a href="#Mesh.plot-818"><span class="linenos">818</span></a><span class="sd">        unique_field : np.ndarray, optional</span>
</span><span id="Mesh.plot-819"><a href="#Mesh.plot-819"><span class="linenos">819</span></a><span class="sd">            Field defined on the unique control points of the mesh. Mutually exclusive</span>
</span><span id="Mesh.plot-820"><a href="#Mesh.plot-820"><span class="linenos">820</span></a><span class="sd">            with `separated_field`.</span>
</span><span id="Mesh.plot-821"><a href="#Mesh.plot-821"><span class="linenos">821</span></a><span class="sd">        separated_field : list of np.ndarray or list of callable, optional</span>
</span><span id="Mesh.plot-822"><a href="#Mesh.plot-822"><span class="linenos">822</span></a><span class="sd">            Field defined per patch, either as arrays evaluated on parametric grids</span>
</span><span id="Mesh.plot-823"><a href="#Mesh.plot-823"><span class="linenos">823</span></a><span class="sd">            or as callables evaluated at runtime. Mutually exclusive with `unique_field`.</span>
</span><span id="Mesh.plot-824"><a href="#Mesh.plot-824"><span class="linenos">824</span></a><span class="sd">        interior_only : bool, optional</span>
</span><span id="Mesh.plot-825"><a href="#Mesh.plot-825"><span class="linenos">825</span></a><span class="sd">            If `True`, only interior elements are displayed. Default is `True`.</span>
</span><span id="Mesh.plot-826"><a href="#Mesh.plot-826"><span class="linenos">826</span></a><span class="sd">        plt_ctrl_mesh : bool, optional</span>
</span><span id="Mesh.plot-827"><a href="#Mesh.plot-827"><span class="linenos">827</span></a><span class="sd">            If `True`, overlays the control polygon mesh (only if `interior_only=False`).</span>
</span><span id="Mesh.plot-828"><a href="#Mesh.plot-828"><span class="linenos">828</span></a><span class="sd">            Default is `False`.</span>
</span><span id="Mesh.plot-829"><a href="#Mesh.plot-829"><span class="linenos">829</span></a><span class="sd">        verbose : bool, optional</span>
</span><span id="Mesh.plot-830"><a href="#Mesh.plot-830"><span class="linenos">830</span></a><span class="sd">            If `True`, prints progress messages. Default is `True`.</span>
</span><span id="Mesh.plot-831"><a href="#Mesh.plot-831"><span class="linenos">831</span></a><span class="sd">        disable_parallel : bool, optional</span>
</span><span id="Mesh.plot-832"><a href="#Mesh.plot-832"><span class="linenos">832</span></a><span class="sd">            If `True`, disables parallel computation. Default is `False`.</span>
</span><span id="Mesh.plot-833"><a href="#Mesh.plot-833"><span class="linenos">833</span></a><span class="sd">        pv_plotter : pv.Plotter or None, optional</span>
</span><span id="Mesh.plot-834"><a href="#Mesh.plot-834"><span class="linenos">834</span></a><span class="sd">            Existing `PyVista` plotter to use. If `None`, a new one is created.</span>
</span><span id="Mesh.plot-835"><a href="#Mesh.plot-835"><span class="linenos">835</span></a><span class="sd">        show : bool, optional</span>
</span><span id="Mesh.plot-836"><a href="#Mesh.plot-836"><span class="linenos">836</span></a><span class="sd">            If `True`, renders the scene immediately. Default is `True`.</span>
</span><span id="Mesh.plot-837"><a href="#Mesh.plot-837"><span class="linenos">837</span></a><span class="sd">        elem_sep_color : str, optional</span>
</span><span id="Mesh.plot-838"><a href="#Mesh.plot-838"><span class="linenos">838</span></a><span class="sd">            Color used for element separators. Default is `&#39;black&#39;`.</span>
</span><span id="Mesh.plot-839"><a href="#Mesh.plot-839"><span class="linenos">839</span></a><span class="sd">        ctrl_poly_color : str, optional</span>
</span><span id="Mesh.plot-840"><a href="#Mesh.plot-840"><span class="linenos">840</span></a><span class="sd">            Color used for the control polygon mesh. Default is `&#39;green&#39;`.</span>
</span><span id="Mesh.plot-841"><a href="#Mesh.plot-841"><span class="linenos">841</span></a><span class="sd">        **pv_add_mesh_kwargs : dict, optional</span>
</span><span id="Mesh.plot-842"><a href="#Mesh.plot-842"><span class="linenos">842</span></a><span class="sd">            Additional keyword arguments forwarded to `pv.Plotter.add_mesh`</span>
</span><span id="Mesh.plot-843"><a href="#Mesh.plot-843"><span class="linenos">843</span></a><span class="sd">            (e.g. `cmap`, `clim`, `scalar_bar_args`, etc.).</span>
</span><span id="Mesh.plot-844"><a href="#Mesh.plot-844"><span class="linenos">844</span></a>
</span><span id="Mesh.plot-845"><a href="#Mesh.plot-845"><span class="linenos">845</span></a><span class="sd">        Returns</span>
</span><span id="Mesh.plot-846"><a href="#Mesh.plot-846"><span class="linenos">846</span></a><span class="sd">        -------</span>
</span><span id="Mesh.plot-847"><a href="#Mesh.plot-847"><span class="linenos">847</span></a><span class="sd">        pv.Plotter</span>
</span><span id="Mesh.plot-848"><a href="#Mesh.plot-848"><span class="linenos">848</span></a><span class="sd">            The `PyVista` plotter used for rendering.</span>
</span><span id="Mesh.plot-849"><a href="#Mesh.plot-849"><span class="linenos">849</span></a>
</span><span id="Mesh.plot-850"><a href="#Mesh.plot-850"><span class="linenos">850</span></a><span class="sd">        Notes</span>
</span><span id="Mesh.plot-851"><a href="#Mesh.plot-851"><span class="linenos">851</span></a><span class="sd">        -----</span>
</span><span id="Mesh.plot-852"><a href="#Mesh.plot-852"><span class="linenos">852</span></a><span class="sd">        - Exactly one of `unique_field` or `separated_field` may be provided.</span>
</span><span id="Mesh.plot-853"><a href="#Mesh.plot-853"><span class="linenos">853</span></a><span class="sd">        - Fields passed as NumPy arrays for plotting must have the same number of</span>
</span><span id="Mesh.plot-854"><a href="#Mesh.plot-854"><span class="linenos">854</span></a><span class="sd">          dimensions (`ndim`) as the control points array. Scalar fields must therefore</span>
</span><span id="Mesh.plot-855"><a href="#Mesh.plot-855"><span class="linenos">855</span></a><span class="sd">          include a leading dimension of size 1.</span>
</span><span id="Mesh.plot-856"><a href="#Mesh.plot-856"><span class="linenos">856</span></a><span class="sd">        - Fields are evaluated on-the-fly at visualization points, not at control points.</span>
</span><span id="Mesh.plot-857"><a href="#Mesh.plot-857"><span class="linenos">857</span></a><span class="sd">        - If executed in a Jupyter notebook, a screenshot of the last plot is stored</span>
</span><span id="Mesh.plot-858"><a href="#Mesh.plot-858"><span class="linenos">858</span></a><span class="sd">          for display via `_repr_png_`.</span>
</span><span id="Mesh.plot-859"><a href="#Mesh.plot-859"><span class="linenos">859</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh.plot-860"><a href="#Mesh.plot-860"><span class="linenos">860</span></a>        <span class="k">if</span> <span class="n">unique_field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Mesh.plot-861"><a href="#Mesh.plot-861"><span class="linenos">861</span></a>            <span class="n">unique_fields</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Mesh.plot-862"><a href="#Mesh.plot-862"><span class="linenos">862</span></a>                <span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="p">(</span>
</span><span id="Mesh.plot-863"><a href="#Mesh.plot-863"><span class="linenos">863</span></a>                    <span class="n">unique_field</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="Mesh.plot-864"><a href="#Mesh.plot-864"><span class="linenos">864</span></a>                    <span class="k">if</span> <span class="n">unique_field</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="Mesh.plot-865"><a href="#Mesh.plot-865"><span class="linenos">865</span></a>                    <span class="k">else</span> <span class="n">unique_field</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span>
</span><span id="Mesh.plot-866"><a href="#Mesh.plot-866"><span class="linenos">866</span></a>                <span class="p">)</span>
</span><span id="Mesh.plot-867"><a href="#Mesh.plot-867"><span class="linenos">867</span></a>            <span class="p">}</span>
</span><span id="Mesh.plot-868"><a href="#Mesh.plot-868"><span class="linenos">868</span></a>            <span class="n">separated_fields</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Mesh.plot-869"><a href="#Mesh.plot-869"><span class="linenos">869</span></a>        <span class="k">elif</span> <span class="n">separated_field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Mesh.plot-870"><a href="#Mesh.plot-870"><span class="linenos">870</span></a>            <span class="n">unique_fields</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Mesh.plot-871"><a href="#Mesh.plot-871"><span class="linenos">871</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">separated_field</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Callable</span><span class="p">):</span>
</span><span id="Mesh.plot-872"><a href="#Mesh.plot-872"><span class="linenos">872</span></a>                <span class="n">separated_fields</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Mesh.plot-873"><a href="#Mesh.plot-873"><span class="linenos">873</span></a>                    <span class="p">{</span><span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">field</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)[</span><span class="kc">None</span><span class="p">]}</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">separated_field</span>
</span><span id="Mesh.plot-874"><a href="#Mesh.plot-874"><span class="linenos">874</span></a>                <span class="p">]</span>
</span><span id="Mesh.plot-875"><a href="#Mesh.plot-875"><span class="linenos">875</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Mesh.plot-876"><a href="#Mesh.plot-876"><span class="linenos">876</span></a>                <span class="n">separated_fields</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="n">field</span><span class="p">[</span><span class="kc">None</span><span class="p">]}</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">separated_field</span><span class="p">]</span>
</span><span id="Mesh.plot-877"><a href="#Mesh.plot-877"><span class="linenos">877</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Mesh.plot-878"><a href="#Mesh.plot-878"><span class="linenos">878</span></a>            <span class="n">unique_fields</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Mesh.plot-879"><a href="#Mesh.plot-879"><span class="linenos">879</span></a>            <span class="n">separated_fields</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Mesh.plot-880"><a href="#Mesh.plot-880"><span class="linenos">880</span></a>
</span><span id="Mesh.plot-881"><a href="#Mesh.plot-881"><span class="linenos">881</span></a>        <span class="k">if</span> <span class="n">pv_plotter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Mesh.plot-882"><a href="#Mesh.plot-882"><span class="linenos">882</span></a>            <span class="n">pv_plotter</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">()</span>
</span><span id="Mesh.plot-883"><a href="#Mesh.plot-883"><span class="linenos">883</span></a>
</span><span id="Mesh.plot-884"><a href="#Mesh.plot-884"><span class="linenos">884</span></a>        <span class="p">(</span><span class="n">elem_int_mesh</span><span class="p">,)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">make_elements_interior_meshes</span><span class="p">(</span>
</span><span id="Mesh.plot-885"><a href="#Mesh.plot-885"><span class="linenos">885</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">,</span>
</span><span id="Mesh.plot-886"><a href="#Mesh.plot-886"><span class="linenos">886</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_separated_ctrl_pts</span><span class="p">(),</span>
</span><span id="Mesh.plot-887"><a href="#Mesh.plot-887"><span class="linenos">887</span></a>            <span class="n">n_step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="Mesh.plot-888"><a href="#Mesh.plot-888"><span class="linenos">888</span></a>            <span class="n">n_eval_per_elem</span><span class="o">=</span><span class="n">n_eval_per_elem</span><span class="p">,</span>
</span><span id="Mesh.plot-889"><a href="#Mesh.plot-889"><span class="linenos">889</span></a>            <span class="n">unique_fields</span><span class="o">=</span><span class="n">unique_fields</span><span class="p">,</span>
</span><span id="Mesh.plot-890"><a href="#Mesh.plot-890"><span class="linenos">890</span></a>            <span class="n">separated_fields</span><span class="o">=</span><span class="n">separated_fields</span><span class="p">,</span>
</span><span id="Mesh.plot-891"><a href="#Mesh.plot-891"><span class="linenos">891</span></a>            <span class="n">XI_list</span><span class="o">=</span><span class="n">XI_list</span><span class="p">,</span>
</span><span id="Mesh.plot-892"><a href="#Mesh.plot-892"><span class="linenos">892</span></a>            <span class="n">disable_parallel</span><span class="o">=</span><span class="n">disable_parallel</span><span class="p">,</span>
</span><span id="Mesh.plot-893"><a href="#Mesh.plot-893"><span class="linenos">893</span></a>            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
</span><span id="Mesh.plot-894"><a href="#Mesh.plot-894"><span class="linenos">894</span></a>        <span class="p">)</span>
</span><span id="Mesh.plot-895"><a href="#Mesh.plot-895"><span class="linenos">895</span></a>        <span class="n">pv_plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">elem_int_mesh</span><span class="p">,</span> <span class="o">**</span><span class="n">pv_add_mesh_kwargs</span><span class="p">)</span>
</span><span id="Mesh.plot-896"><a href="#Mesh.plot-896"><span class="linenos">896</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">interior_only</span><span class="p">:</span>
</span><span id="Mesh.plot-897"><a href="#Mesh.plot-897"><span class="linenos">897</span></a>            <span class="p">(</span><span class="n">elem_sep_mesh</span><span class="p">,)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">make_elem_separator_meshes</span><span class="p">(</span>
</span><span id="Mesh.plot-898"><a href="#Mesh.plot-898"><span class="linenos">898</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">,</span>
</span><span id="Mesh.plot-899"><a href="#Mesh.plot-899"><span class="linenos">899</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">get_separated_ctrl_pts</span><span class="p">(),</span>
</span><span id="Mesh.plot-900"><a href="#Mesh.plot-900"><span class="linenos">900</span></a>                <span class="n">n_step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="Mesh.plot-901"><a href="#Mesh.plot-901"><span class="linenos">901</span></a>                <span class="n">n_eval_per_elem</span><span class="o">=</span><span class="n">n_eval_per_elem</span><span class="p">,</span>
</span><span id="Mesh.plot-902"><a href="#Mesh.plot-902"><span class="linenos">902</span></a>                <span class="n">XI_list</span><span class="o">=</span><span class="n">XI_list</span><span class="p">,</span>
</span><span id="Mesh.plot-903"><a href="#Mesh.plot-903"><span class="linenos">903</span></a>                <span class="n">disable_parallel</span><span class="o">=</span><span class="n">disable_parallel</span><span class="p">,</span>
</span><span id="Mesh.plot-904"><a href="#Mesh.plot-904"><span class="linenos">904</span></a>                <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
</span><span id="Mesh.plot-905"><a href="#Mesh.plot-905"><span class="linenos">905</span></a>            <span class="p">)</span>
</span><span id="Mesh.plot-906"><a href="#Mesh.plot-906"><span class="linenos">906</span></a>            <span class="k">if</span> <span class="s2">&quot;label&quot;</span> <span class="ow">in</span> <span class="n">pv_add_mesh_kwargs</span><span class="p">:</span>
</span><span id="Mesh.plot-907"><a href="#Mesh.plot-907"><span class="linenos">907</span></a>                <span class="k">del</span> <span class="n">pv_add_mesh_kwargs</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span>
</span><span id="Mesh.plot-908"><a href="#Mesh.plot-908"><span class="linenos">908</span></a>            <span class="n">pv_add_mesh_kwargs</span><span class="p">[</span><span class="s2">&quot;style&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;wireframe&quot;</span>
</span><span id="Mesh.plot-909"><a href="#Mesh.plot-909"><span class="linenos">909</span></a>            <span class="n">pv_add_mesh_kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elem_sep_color</span>
</span><span id="Mesh.plot-910"><a href="#Mesh.plot-910"><span class="linenos">910</span></a>            <span class="n">pv_plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">elem_sep_mesh</span><span class="p">,</span> <span class="o">**</span><span class="n">pv_add_mesh_kwargs</span><span class="p">)</span>
</span><span id="Mesh.plot-911"><a href="#Mesh.plot-911"><span class="linenos">911</span></a>            <span class="k">if</span> <span class="n">plt_ctrl_mesh</span><span class="p">:</span>
</span><span id="Mesh.plot-912"><a href="#Mesh.plot-912"><span class="linenos">912</span></a>                <span class="p">(</span><span class="n">ctrl_poly_mesh</span><span class="p">,)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">make_control_poly_meshes</span><span class="p">(</span>
</span><span id="Mesh.plot-913"><a href="#Mesh.plot-913"><span class="linenos">913</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">,</span>
</span><span id="Mesh.plot-914"><a href="#Mesh.plot-914"><span class="linenos">914</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">get_separated_ctrl_pts</span><span class="p">(),</span>
</span><span id="Mesh.plot-915"><a href="#Mesh.plot-915"><span class="linenos">915</span></a>                    <span class="n">n_step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="Mesh.plot-916"><a href="#Mesh.plot-916"><span class="linenos">916</span></a>                    <span class="n">n_eval_per_elem</span><span class="o">=</span><span class="n">n_eval_per_elem</span><span class="p">,</span>
</span><span id="Mesh.plot-917"><a href="#Mesh.plot-917"><span class="linenos">917</span></a>                    <span class="n">XI_list</span><span class="o">=</span><span class="n">XI_list</span><span class="p">,</span>
</span><span id="Mesh.plot-918"><a href="#Mesh.plot-918"><span class="linenos">918</span></a>                    <span class="n">disable_parallel</span><span class="o">=</span><span class="n">disable_parallel</span><span class="p">,</span>
</span><span id="Mesh.plot-919"><a href="#Mesh.plot-919"><span class="linenos">919</span></a>                    <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
</span><span id="Mesh.plot-920"><a href="#Mesh.plot-920"><span class="linenos">920</span></a>                <span class="p">)</span>
</span><span id="Mesh.plot-921"><a href="#Mesh.plot-921"><span class="linenos">921</span></a>                <span class="n">pv_add_mesh_kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ctrl_poly_color</span>
</span><span id="Mesh.plot-922"><a href="#Mesh.plot-922"><span class="linenos">922</span></a>                <span class="n">pv_plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">ctrl_poly_mesh</span><span class="p">,</span> <span class="o">**</span><span class="n">pv_add_mesh_kwargs</span><span class="p">)</span>
</span><span id="Mesh.plot-923"><a href="#Mesh.plot-923"><span class="linenos">923</span></a>
</span><span id="Mesh.plot-924"><a href="#Mesh.plot-924"><span class="linenos">924</span></a>        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
</span><span id="Mesh.plot-925"><a href="#Mesh.plot-925"><span class="linenos">925</span></a>            <span class="n">pv_plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="Mesh.plot-926"><a href="#Mesh.plot-926"><span class="linenos">926</span></a>            <span class="k">if</span> <span class="n">in_notebook</span><span class="p">():</span>
</span><span id="Mesh.plot-927"><a href="#Mesh.plot-927"><span class="linenos">927</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_screenshot</span> <span class="o">=</span> <span class="n">pv_plotter</span><span class="o">.</span><span class="n">screenshot</span><span class="p">(</span><span class="n">return_img</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Mesh.plot-928"><a href="#Mesh.plot-928"><span class="linenos">928</span></a>
</span><span id="Mesh.plot-929"><a href="#Mesh.plot-929"><span class="linenos">929</span></a>        <span class="k">return</span> <span class="n">pv_plotter</span>
</span></pre></div>


            <div class="docstring"><p>Visualize the B-spline multipatch mesh using <code>PyVista</code>.</p>

<p>This method evaluates the mesh geometry and optional scalar fields at
parametric sampling points and renders them using <code>PyVista</code>. Fields can be
provided either in a unique (global) or separated (per-patch) representation.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>n_eval_per_elem</strong> (int or iterable of int, optional):
Number of evaluation points per element along each parametric direction.
If an iterable is provided, it must match the parametric dimension.
Default is <code>10</code>.</li>
<li><strong>XI_list</strong> (iterable of tuple of np.ndarray, optional):
Explicit parametric coordinates for evaluation, provided per patch.
If <code>None</code>, a regular grid based on <code>n_eval_per_elem</code> is used.</li>
<li><strong>unique_field</strong> (np.ndarray, optional):
Field defined on the unique control points of the mesh. Mutually exclusive
with <code>separated_field</code>.</li>
<li><strong>separated_field</strong> (list of np.ndarray or list of callable, optional):
Field defined per patch, either as arrays evaluated on parametric grids
or as callables evaluated at runtime. Mutually exclusive with <code>unique_field</code>.</li>
<li><strong>interior_only</strong> (bool, optional):
If <code>True</code>, only interior elements are displayed. Default is <code>True</code>.</li>
<li><strong>plt_ctrl_mesh</strong> (bool, optional):
If <code>True</code>, overlays the control polygon mesh (only if <code>interior_only=False</code>).
Default is <code>False</code>.</li>
<li><strong>verbose</strong> (bool, optional):
If <code>True</code>, prints progress messages. Default is <code>True</code>.</li>
<li><strong>disable_parallel</strong> (bool, optional):
If <code>True</code>, disables parallel computation. Default is <code>False</code>.</li>
<li><strong>pv_plotter</strong> (pv.Plotter or None, optional):
Existing <code>PyVista</code> plotter to use. If <code>None</code>, a new one is created.</li>
<li><strong>show</strong> (bool, optional):
If <code>True</code>, renders the scene immediately. Default is <code>True</code>.</li>
<li><strong>elem_sep_color</strong> (str, optional):
Color used for element separators. Default is <code>'black'</code>.</li>
<li><strong>ctrl_poly_color</strong> (str, optional):
Color used for the control polygon mesh. Default is <code>'green'</code>.</li>
<li><strong>**pv_add_mesh_kwargs</strong> (dict, optional):
Additional keyword arguments forwarded to <code>pv.Plotter.add_mesh</code>
(e.g. <code>cmap</code>, <code>clim</code>, <code>scalar_bar_args</code>, etc.).</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>pv.Plotter</strong>: The <code>PyVista</code> plotter used for rendering.</li>
</ul>

<h6 id="notes">Notes</h6>

<ul>
<li>Exactly one of <code>unique_field</code> or <code>separated_field</code> may be provided.</li>
<li>Fields passed as NumPy arrays for plotting must have the same number of
dimensions (<code>ndim</code>) as the control points array. Scalar fields must therefore
include a leading dimension of size 1.</li>
<li>Fields are evaluated on-the-fly at visualization points, not at control points.</li>
<li>If executed in a Jupyter notebook, a screenshot of the last plot is stored
for display via <code>_repr_png_</code>.</li>
</ul>
</div>


                            </div>
                            <div id="Mesh.plot_in_image" class="classattr">
                                        <input id="Mesh.plot_in_image-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_in_image</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">image</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">threshold</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">threshold_method</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;otsu&#39;</span><span class="p">,</span> <span class="s1">&#39;interp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;otsu&#39;</span>,</span><span class="param">	<span class="n">mode</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;marching cubes&#39;</span><span class="p">,</span> <span class="s1">&#39;voxels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;marching cubes&#39;</span>,</span><span class="param">	<span class="n">n_eval_per_elem</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">10</span>,</span><span class="param">	<span class="n">XI_list</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">interior_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">plt_ctrl_mesh</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">disable_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">pv_plotter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pyvista</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">plotter</span><span class="o">.</span><span class="n">Plotter</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">image_show_edges</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">image_line_width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span>,</span><span class="param">	<span class="n">image_opacity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.85</span>,</span><span class="param">	<span class="n">image_edge_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span>,</span><span class="param">	<span class="n">image_interior_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span>,</span><span class="param">	<span class="o">**</span><span class="n">pv_add_mesh_kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Mesh.plot_in_image-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Mesh.plot_in_image"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Mesh.plot_in_image-931"><a href="#Mesh.plot_in_image-931"><span class="linenos"> 931</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_in_image</span><span class="p">(</span>
</span><span id="Mesh.plot_in_image-932"><a href="#Mesh.plot_in_image-932"><span class="linenos"> 932</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Mesh.plot_in_image-933"><a href="#Mesh.plot_in_image-933"><span class="linenos"> 933</span></a>        <span class="n">image</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="Mesh.plot_in_image-934"><a href="#Mesh.plot_in_image-934"><span class="linenos"> 934</span></a>        <span class="n">threshold</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Mesh.plot_in_image-935"><a href="#Mesh.plot_in_image-935"><span class="linenos"> 935</span></a>        <span class="n">threshold_method</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;otsu&quot;</span><span class="p">,</span> <span class="s2">&quot;interp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;otsu&quot;</span><span class="p">,</span>
</span><span id="Mesh.plot_in_image-936"><a href="#Mesh.plot_in_image-936"><span class="linenos"> 936</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;marching cubes&quot;</span><span class="p">,</span> <span class="s2">&quot;voxels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;marching cubes&quot;</span><span class="p">,</span>
</span><span id="Mesh.plot_in_image-937"><a href="#Mesh.plot_in_image-937"><span class="linenos"> 937</span></a>        <span class="n">n_eval_per_elem</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="Mesh.plot_in_image-938"><a href="#Mesh.plot_in_image-938"><span class="linenos"> 938</span></a>        <span class="n">XI_list</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Mesh.plot_in_image-939"><a href="#Mesh.plot_in_image-939"><span class="linenos"> 939</span></a>        <span class="n">interior_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Mesh.plot_in_image-940"><a href="#Mesh.plot_in_image-940"><span class="linenos"> 940</span></a>        <span class="n">plt_ctrl_mesh</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Mesh.plot_in_image-941"><a href="#Mesh.plot_in_image-941"><span class="linenos"> 941</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Mesh.plot_in_image-942"><a href="#Mesh.plot_in_image-942"><span class="linenos"> 942</span></a>        <span class="n">disable_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Mesh.plot_in_image-943"><a href="#Mesh.plot_in_image-943"><span class="linenos"> 943</span></a>        <span class="n">pv_plotter</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Mesh.plot_in_image-944"><a href="#Mesh.plot_in_image-944"><span class="linenos"> 944</span></a>        <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Mesh.plot_in_image-945"><a href="#Mesh.plot_in_image-945"><span class="linenos"> 945</span></a>        <span class="n">image_show_edges</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Mesh.plot_in_image-946"><a href="#Mesh.plot_in_image-946"><span class="linenos"> 946</span></a>        <span class="n">image_line_width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
</span><span id="Mesh.plot_in_image-947"><a href="#Mesh.plot_in_image-947"><span class="linenos"> 947</span></a>        <span class="n">image_opacity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.85</span><span class="p">,</span>
</span><span id="Mesh.plot_in_image-948"><a href="#Mesh.plot_in_image-948"><span class="linenos"> 948</span></a>        <span class="n">image_edge_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span id="Mesh.plot_in_image-949"><a href="#Mesh.plot_in_image-949"><span class="linenos"> 949</span></a>        <span class="n">image_interior_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span>
</span><span id="Mesh.plot_in_image-950"><a href="#Mesh.plot_in_image-950"><span class="linenos"> 950</span></a>        <span class="o">**</span><span class="n">pv_add_mesh_kwargs</span><span class="p">,</span>
</span><span id="Mesh.plot_in_image-951"><a href="#Mesh.plot_in_image-951"><span class="linenos"> 951</span></a>    <span class="p">):</span>
</span><span id="Mesh.plot_in_image-952"><a href="#Mesh.plot_in_image-952"><span class="linenos"> 952</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh.plot_in_image-953"><a href="#Mesh.plot_in_image-953"><span class="linenos"> 953</span></a><span class="sd">        Visualize the mesh together with an image-derived surface.</span>
</span><span id="Mesh.plot_in_image-954"><a href="#Mesh.plot_in_image-954"><span class="linenos"> 954</span></a>
</span><span id="Mesh.plot_in_image-955"><a href="#Mesh.plot_in_image-955"><span class="linenos"> 955</span></a><span class="sd">        This method overlays the B-spline mesh visualization with a surface extracted</span>
</span><span id="Mesh.plot_in_image-956"><a href="#Mesh.plot_in_image-956"><span class="linenos"> 956</span></a><span class="sd">        from a volumetric image, using either marching cubes or voxel thresholding.</span>
</span><span id="Mesh.plot_in_image-957"><a href="#Mesh.plot_in_image-957"><span class="linenos"> 957</span></a><span class="sd">        It is typically used to assess geometric alignment between the mesh and image</span>
</span><span id="Mesh.plot_in_image-958"><a href="#Mesh.plot_in_image-958"><span class="linenos"> 958</span></a><span class="sd">        features.</span>
</span><span id="Mesh.plot_in_image-959"><a href="#Mesh.plot_in_image-959"><span class="linenos"> 959</span></a>
</span><span id="Mesh.plot_in_image-960"><a href="#Mesh.plot_in_image-960"><span class="linenos"> 960</span></a><span class="sd">        Parameters</span>
</span><span id="Mesh.plot_in_image-961"><a href="#Mesh.plot_in_image-961"><span class="linenos"> 961</span></a><span class="sd">        ----------</span>
</span><span id="Mesh.plot_in_image-962"><a href="#Mesh.plot_in_image-962"><span class="linenos"> 962</span></a><span class="sd">        image : np.ndarray</span>
</span><span id="Mesh.plot_in_image-963"><a href="#Mesh.plot_in_image-963"><span class="linenos"> 963</span></a><span class="sd">            Input volumetric image of shape (n1, n2, n3).</span>
</span><span id="Mesh.plot_in_image-964"><a href="#Mesh.plot_in_image-964"><span class="linenos"> 964</span></a><span class="sd">        threshold : float or None, optional</span>
</span><span id="Mesh.plot_in_image-965"><a href="#Mesh.plot_in_image-965"><span class="linenos"> 965</span></a><span class="sd">            Threshold value used to extract the image surface. If `None`, it is</span>
</span><span id="Mesh.plot_in_image-966"><a href="#Mesh.plot_in_image-966"><span class="linenos"> 966</span></a><span class="sd">            automatically estimated using `threshold_method`.</span>
</span><span id="Mesh.plot_in_image-967"><a href="#Mesh.plot_in_image-967"><span class="linenos"> 967</span></a><span class="sd">        threshold_method : {&quot;otsu&quot;, &quot;interp&quot;}, optional</span>
</span><span id="Mesh.plot_in_image-968"><a href="#Mesh.plot_in_image-968"><span class="linenos"> 968</span></a><span class="sd">            Method used to estimate the threshold when `threshold` is `None`.</span>
</span><span id="Mesh.plot_in_image-969"><a href="#Mesh.plot_in_image-969"><span class="linenos"> 969</span></a><span class="sd">            Default is `&quot;otsu&quot;`.</span>
</span><span id="Mesh.plot_in_image-970"><a href="#Mesh.plot_in_image-970"><span class="linenos"> 970</span></a><span class="sd">        mode : {&quot;marching cubes&quot;, &quot;voxels&quot;}, optional</span>
</span><span id="Mesh.plot_in_image-971"><a href="#Mesh.plot_in_image-971"><span class="linenos"> 971</span></a><span class="sd">            Method used to extract the image surface. If `&quot;marching cubes&quot;`,</span>
</span><span id="Mesh.plot_in_image-972"><a href="#Mesh.plot_in_image-972"><span class="linenos"> 972</span></a><span class="sd">            the image must be of dtype `uint16`. Default is `&quot;marching cubes&quot;`.</span>
</span><span id="Mesh.plot_in_image-973"><a href="#Mesh.plot_in_image-973"><span class="linenos"> 973</span></a><span class="sd">        n_eval_per_elem : int or iterable of int, optional</span>
</span><span id="Mesh.plot_in_image-974"><a href="#Mesh.plot_in_image-974"><span class="linenos"> 974</span></a><span class="sd">            Number of evaluation points per element along each parametric direction.</span>
</span><span id="Mesh.plot_in_image-975"><a href="#Mesh.plot_in_image-975"><span class="linenos"> 975</span></a><span class="sd">            Default is `10`.</span>
</span><span id="Mesh.plot_in_image-976"><a href="#Mesh.plot_in_image-976"><span class="linenos"> 976</span></a><span class="sd">        XI_list : iterable of tuple of np.ndarray, optional</span>
</span><span id="Mesh.plot_in_image-977"><a href="#Mesh.plot_in_image-977"><span class="linenos"> 977</span></a><span class="sd">            Explicit parametric coordinates for mesh evaluation.</span>
</span><span id="Mesh.plot_in_image-978"><a href="#Mesh.plot_in_image-978"><span class="linenos"> 978</span></a><span class="sd">        interior_only : bool, optional</span>
</span><span id="Mesh.plot_in_image-979"><a href="#Mesh.plot_in_image-979"><span class="linenos"> 979</span></a><span class="sd">            If `True`, only interior elements of the mesh are displayed. Default is `True`.</span>
</span><span id="Mesh.plot_in_image-980"><a href="#Mesh.plot_in_image-980"><span class="linenos"> 980</span></a><span class="sd">        plt_ctrl_mesh : bool, optional</span>
</span><span id="Mesh.plot_in_image-981"><a href="#Mesh.plot_in_image-981"><span class="linenos"> 981</span></a><span class="sd">            If `True`, overlays the control polygon mesh. Default is `False`.</span>
</span><span id="Mesh.plot_in_image-982"><a href="#Mesh.plot_in_image-982"><span class="linenos"> 982</span></a><span class="sd">        verbose : bool, optional</span>
</span><span id="Mesh.plot_in_image-983"><a href="#Mesh.plot_in_image-983"><span class="linenos"> 983</span></a><span class="sd">            If `True`, prints progress messages. Default is `True`.</span>
</span><span id="Mesh.plot_in_image-984"><a href="#Mesh.plot_in_image-984"><span class="linenos"> 984</span></a><span class="sd">        disable_parallel : bool, optional</span>
</span><span id="Mesh.plot_in_image-985"><a href="#Mesh.plot_in_image-985"><span class="linenos"> 985</span></a><span class="sd">            If `True`, disables parallel computation. Default is `False`.</span>
</span><span id="Mesh.plot_in_image-986"><a href="#Mesh.plot_in_image-986"><span class="linenos"> 986</span></a><span class="sd">        pv_plotter : pv.Plotter or None, optional</span>
</span><span id="Mesh.plot_in_image-987"><a href="#Mesh.plot_in_image-987"><span class="linenos"> 987</span></a><span class="sd">            Existing PyVista plotter to use. If `None`, a new one is created.</span>
</span><span id="Mesh.plot_in_image-988"><a href="#Mesh.plot_in_image-988"><span class="linenos"> 988</span></a><span class="sd">        show : bool, optional</span>
</span><span id="Mesh.plot_in_image-989"><a href="#Mesh.plot_in_image-989"><span class="linenos"> 989</span></a><span class="sd">            If `True`, renders the scene immediately. Default is `True`.</span>
</span><span id="Mesh.plot_in_image-990"><a href="#Mesh.plot_in_image-990"><span class="linenos"> 990</span></a><span class="sd">        image_show_edges : bool, optional</span>
</span><span id="Mesh.plot_in_image-991"><a href="#Mesh.plot_in_image-991"><span class="linenos"> 991</span></a><span class="sd">            Whether to display edges of the image-derived surface. Default is `False`.</span>
</span><span id="Mesh.plot_in_image-992"><a href="#Mesh.plot_in_image-992"><span class="linenos"> 992</span></a><span class="sd">        image_line_width : float, optional</span>
</span><span id="Mesh.plot_in_image-993"><a href="#Mesh.plot_in_image-993"><span class="linenos"> 993</span></a><span class="sd">            Line width used when displaying image edges. Default is `0.05`.</span>
</span><span id="Mesh.plot_in_image-994"><a href="#Mesh.plot_in_image-994"><span class="linenos"> 994</span></a><span class="sd">        image_opacity : float, optional</span>
</span><span id="Mesh.plot_in_image-995"><a href="#Mesh.plot_in_image-995"><span class="linenos"> 995</span></a><span class="sd">            Opacity of the image-derived surface. Default is `0.85`.</span>
</span><span id="Mesh.plot_in_image-996"><a href="#Mesh.plot_in_image-996"><span class="linenos"> 996</span></a><span class="sd">        image_edge_color : str, optional</span>
</span><span id="Mesh.plot_in_image-997"><a href="#Mesh.plot_in_image-997"><span class="linenos"> 997</span></a><span class="sd">            Color of image surface edges. Default is `&#39;black&#39;`.</span>
</span><span id="Mesh.plot_in_image-998"><a href="#Mesh.plot_in_image-998"><span class="linenos"> 998</span></a><span class="sd">        image_interior_color : str, optional</span>
</span><span id="Mesh.plot_in_image-999"><a href="#Mesh.plot_in_image-999"><span class="linenos"> 999</span></a><span class="sd">            Color of the image-derived surface interior. Default is `&#39;white&#39;`.</span>
</span><span id="Mesh.plot_in_image-1000"><a href="#Mesh.plot_in_image-1000"><span class="linenos">1000</span></a><span class="sd">        **pv_add_mesh_kwargs : dict, optional</span>
</span><span id="Mesh.plot_in_image-1001"><a href="#Mesh.plot_in_image-1001"><span class="linenos">1001</span></a><span class="sd">            Additional keyword arguments forwarded to :meth:`plot`.</span>
</span><span id="Mesh.plot_in_image-1002"><a href="#Mesh.plot_in_image-1002"><span class="linenos">1002</span></a>
</span><span id="Mesh.plot_in_image-1003"><a href="#Mesh.plot_in_image-1003"><span class="linenos">1003</span></a><span class="sd">        Returns</span>
</span><span id="Mesh.plot_in_image-1004"><a href="#Mesh.plot_in_image-1004"><span class="linenos">1004</span></a><span class="sd">        -------</span>
</span><span id="Mesh.plot_in_image-1005"><a href="#Mesh.plot_in_image-1005"><span class="linenos">1005</span></a><span class="sd">        pv.Plotter</span>
</span><span id="Mesh.plot_in_image-1006"><a href="#Mesh.plot_in_image-1006"><span class="linenos">1006</span></a><span class="sd">            The PyVista plotter used for visualization.</span>
</span><span id="Mesh.plot_in_image-1007"><a href="#Mesh.plot_in_image-1007"><span class="linenos">1007</span></a>
</span><span id="Mesh.plot_in_image-1008"><a href="#Mesh.plot_in_image-1008"><span class="linenos">1008</span></a><span class="sd">        Notes</span>
</span><span id="Mesh.plot_in_image-1009"><a href="#Mesh.plot_in_image-1009"><span class="linenos">1009</span></a><span class="sd">        -----</span>
</span><span id="Mesh.plot_in_image-1010"><a href="#Mesh.plot_in_image-1010"><span class="linenos">1010</span></a><span class="sd">        - The mesh is rendered first, then the image-derived surface is overlaid.</span>
</span><span id="Mesh.plot_in_image-1011"><a href="#Mesh.plot_in_image-1011"><span class="linenos">1011</span></a><span class="sd">        - This method does not modify the mesh or image data.</span>
</span><span id="Mesh.plot_in_image-1012"><a href="#Mesh.plot_in_image-1012"><span class="linenos">1012</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh.plot_in_image-1013"><a href="#Mesh.plot_in_image-1013"><span class="linenos">1013</span></a>        <span class="k">if</span> <span class="n">threshold</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Mesh.plot_in_image-1014"><a href="#Mesh.plot_in_image-1014"><span class="linenos">1014</span></a>            <span class="n">fg</span><span class="p">,</span> <span class="n">bg</span> <span class="o">=</span> <span class="n">find_fg_bg</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">threshold_method</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="Mesh.plot_in_image-1015"><a href="#Mesh.plot_in_image-1015"><span class="linenos">1015</span></a>            <span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">fg</span> <span class="o">+</span> <span class="n">bg</span><span class="p">)</span>
</span><span id="Mesh.plot_in_image-1016"><a href="#Mesh.plot_in_image-1016"><span class="linenos">1016</span></a>
</span><span id="Mesh.plot_in_image-1017"><a href="#Mesh.plot_in_image-1017"><span class="linenos">1017</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;marching cubes&quot;</span><span class="p">:</span>
</span><span id="Mesh.plot_in_image-1018"><a href="#Mesh.plot_in_image-1018"><span class="linenos">1018</span></a>            <span class="n">image_mesh</span> <span class="o">=</span> <span class="n">marching_cubes</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">threshold</span><span class="p">)</span>
</span><span id="Mesh.plot_in_image-1019"><a href="#Mesh.plot_in_image-1019"><span class="linenos">1019</span></a>        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;voxels&quot;</span><span class="p">:</span>
</span><span id="Mesh.plot_in_image-1020"><a href="#Mesh.plot_in_image-1020"><span class="linenos">1020</span></a>            <span class="n">image_mesh</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">image</span><span class="p">)</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span>
</span><span id="Mesh.plot_in_image-1021"><a href="#Mesh.plot_in_image-1021"><span class="linenos">1021</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Mesh.plot_in_image-1022"><a href="#Mesh.plot_in_image-1022"><span class="linenos">1022</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unrecognized mode &#39;</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
</span><span id="Mesh.plot_in_image-1023"><a href="#Mesh.plot_in_image-1023"><span class="linenos">1023</span></a>
</span><span id="Mesh.plot_in_image-1024"><a href="#Mesh.plot_in_image-1024"><span class="linenos">1024</span></a>        <span class="n">pv_plotter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="Mesh.plot_in_image-1025"><a href="#Mesh.plot_in_image-1025"><span class="linenos">1025</span></a>            <span class="n">n_eval_per_elem</span><span class="o">=</span><span class="n">n_eval_per_elem</span><span class="p">,</span>
</span><span id="Mesh.plot_in_image-1026"><a href="#Mesh.plot_in_image-1026"><span class="linenos">1026</span></a>            <span class="n">XI_list</span><span class="o">=</span><span class="n">XI_list</span><span class="p">,</span>
</span><span id="Mesh.plot_in_image-1027"><a href="#Mesh.plot_in_image-1027"><span class="linenos">1027</span></a>            <span class="n">interior_only</span><span class="o">=</span><span class="n">interior_only</span><span class="p">,</span>
</span><span id="Mesh.plot_in_image-1028"><a href="#Mesh.plot_in_image-1028"><span class="linenos">1028</span></a>            <span class="n">plt_ctrl_mesh</span><span class="o">=</span><span class="n">plt_ctrl_mesh</span><span class="p">,</span>
</span><span id="Mesh.plot_in_image-1029"><a href="#Mesh.plot_in_image-1029"><span class="linenos">1029</span></a>            <span class="n">pv_plotter</span><span class="o">=</span><span class="n">pv_plotter</span><span class="p">,</span>
</span><span id="Mesh.plot_in_image-1030"><a href="#Mesh.plot_in_image-1030"><span class="linenos">1030</span></a>            <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Mesh.plot_in_image-1031"><a href="#Mesh.plot_in_image-1031"><span class="linenos">1031</span></a>            <span class="n">disable_parallel</span><span class="o">=</span><span class="n">disable_parallel</span><span class="p">,</span>
</span><span id="Mesh.plot_in_image-1032"><a href="#Mesh.plot_in_image-1032"><span class="linenos">1032</span></a>            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
</span><span id="Mesh.plot_in_image-1033"><a href="#Mesh.plot_in_image-1033"><span class="linenos">1033</span></a>            <span class="o">**</span><span class="n">pv_add_mesh_kwargs</span><span class="p">,</span>
</span><span id="Mesh.plot_in_image-1034"><a href="#Mesh.plot_in_image-1034"><span class="linenos">1034</span></a>        <span class="p">)</span>
</span><span id="Mesh.plot_in_image-1035"><a href="#Mesh.plot_in_image-1035"><span class="linenos">1035</span></a>
</span><span id="Mesh.plot_in_image-1036"><a href="#Mesh.plot_in_image-1036"><span class="linenos">1036</span></a>        <span class="n">pv_plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span>
</span><span id="Mesh.plot_in_image-1037"><a href="#Mesh.plot_in_image-1037"><span class="linenos">1037</span></a>            <span class="n">image_mesh</span><span class="p">,</span>
</span><span id="Mesh.plot_in_image-1038"><a href="#Mesh.plot_in_image-1038"><span class="linenos">1038</span></a>            <span class="n">show_edges</span><span class="o">=</span><span class="n">image_show_edges</span><span class="p">,</span>
</span><span id="Mesh.plot_in_image-1039"><a href="#Mesh.plot_in_image-1039"><span class="linenos">1039</span></a>            <span class="n">edge_color</span><span class="o">=</span><span class="n">image_edge_color</span><span class="p">,</span>
</span><span id="Mesh.plot_in_image-1040"><a href="#Mesh.plot_in_image-1040"><span class="linenos">1040</span></a>            <span class="n">line_width</span><span class="o">=</span><span class="n">image_line_width</span><span class="p">,</span>
</span><span id="Mesh.plot_in_image-1041"><a href="#Mesh.plot_in_image-1041"><span class="linenos">1041</span></a>            <span class="n">opacity</span><span class="o">=</span><span class="n">image_opacity</span><span class="p">,</span>
</span><span id="Mesh.plot_in_image-1042"><a href="#Mesh.plot_in_image-1042"><span class="linenos">1042</span></a>            <span class="n">color</span><span class="o">=</span><span class="n">image_interior_color</span><span class="p">,</span>
</span><span id="Mesh.plot_in_image-1043"><a href="#Mesh.plot_in_image-1043"><span class="linenos">1043</span></a>            <span class="n">specular</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
</span><span id="Mesh.plot_in_image-1044"><a href="#Mesh.plot_in_image-1044"><span class="linenos">1044</span></a>        <span class="p">)</span>
</span><span id="Mesh.plot_in_image-1045"><a href="#Mesh.plot_in_image-1045"><span class="linenos">1045</span></a>
</span><span id="Mesh.plot_in_image-1046"><a href="#Mesh.plot_in_image-1046"><span class="linenos">1046</span></a>        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
</span><span id="Mesh.plot_in_image-1047"><a href="#Mesh.plot_in_image-1047"><span class="linenos">1047</span></a>            <span class="n">pv_plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="Mesh.plot_in_image-1048"><a href="#Mesh.plot_in_image-1048"><span class="linenos">1048</span></a>
</span><span id="Mesh.plot_in_image-1049"><a href="#Mesh.plot_in_image-1049"><span class="linenos">1049</span></a>        <span class="k">return</span> <span class="n">pv_plotter</span>
</span></pre></div>


            <div class="docstring"><p>Visualize the mesh together with an image-derived surface.</p>

<p>This method overlays the B-spline mesh visualization with a surface extracted
from a volumetric image, using either marching cubes or voxel thresholding.
It is typically used to assess geometric alignment between the mesh and image
features.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>image</strong> (np.ndarray):
Input volumetric image of shape (n1, n2, n3).</li>
<li><strong>threshold</strong> (float or None, optional):
Threshold value used to extract the image surface. If <code>None</code>, it is
automatically estimated using <code>threshold_method</code>.</li>
<li><strong>threshold_method</strong> ({"otsu", "interp"}, optional):
Method used to estimate the threshold when <code>threshold</code> is <code>None</code>.
Default is <code>"otsu"</code>.</li>
<li><strong>mode</strong> ({"marching cubes", "voxels"}, optional):
Method used to extract the image surface. If <code>"marching cubes"</code>,
the image must be of dtype <code>uint16</code>. Default is <code>"marching cubes"</code>.</li>
<li><strong>n_eval_per_elem</strong> (int or iterable of int, optional):
Number of evaluation points per element along each parametric direction.
Default is <code>10</code>.</li>
<li><strong>XI_list</strong> (iterable of tuple of np.ndarray, optional):
Explicit parametric coordinates for mesh evaluation.</li>
<li><strong>interior_only</strong> (bool, optional):
If <code>True</code>, only interior elements of the mesh are displayed. Default is <code>True</code>.</li>
<li><strong>plt_ctrl_mesh</strong> (bool, optional):
If <code>True</code>, overlays the control polygon mesh. Default is <code>False</code>.</li>
<li><strong>verbose</strong> (bool, optional):
If <code>True</code>, prints progress messages. Default is <code>True</code>.</li>
<li><strong>disable_parallel</strong> (bool, optional):
If <code>True</code>, disables parallel computation. Default is <code>False</code>.</li>
<li><strong>pv_plotter</strong> (pv.Plotter or None, optional):
Existing PyVista plotter to use. If <code>None</code>, a new one is created.</li>
<li><strong>show</strong> (bool, optional):
If <code>True</code>, renders the scene immediately. Default is <code>True</code>.</li>
<li><strong>image_show_edges</strong> (bool, optional):
Whether to display edges of the image-derived surface. Default is <code>False</code>.</li>
<li><strong>image_line_width</strong> (float, optional):
Line width used when displaying image edges. Default is <code>0.05</code>.</li>
<li><strong>image_opacity</strong> (float, optional):
Opacity of the image-derived surface. Default is <code>0.85</code>.</li>
<li><strong>image_edge_color</strong> (str, optional):
Color of image surface edges. Default is <code>'black'</code>.</li>
<li><strong>image_interior_color</strong> (str, optional):
Color of the image-derived surface interior. Default is <code>'white'</code>.</li>
<li><strong>**pv_add_mesh_kwargs</strong> (dict, optional):
Additional keyword arguments forwarded to <code><a href="#Mesh.plot">plot()</a></code>.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>pv.Plotter</strong>: The PyVista plotter used for visualization.</li>
</ul>

<h6 id="notes">Notes</h6>

<ul>
<li>The mesh is rendered first, then the image-derived surface is overlaid.</li>
<li>This method does not modify the mesh or image data.</li>
</ul>
</div>


                            </div>
                            <div id="Mesh.ICP_rigid_body_transform" class="classattr">
                                        <input id="Mesh.ICP_rigid_body_transform-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ICP_rigid_body_transform</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">tgt_meshio</span><span class="p">:</span> <span class="n">meshio</span><span class="o">.</span><span class="n">_mesh</span><span class="o">.</span><span class="n">Mesh</span>,</span><span class="param">	<span class="n">n_eval_per_elem</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">5</span>,</span><span class="param">	<span class="n">XI_list</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">plot_after</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">disable_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="nb">float</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Mesh.ICP_rigid_body_transform-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Mesh.ICP_rigid_body_transform"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Mesh.ICP_rigid_body_transform-1051"><a href="#Mesh.ICP_rigid_body_transform-1051"><span class="linenos">1051</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ICP_rigid_body_transform</span><span class="p">(</span>
</span><span id="Mesh.ICP_rigid_body_transform-1052"><a href="#Mesh.ICP_rigid_body_transform-1052"><span class="linenos">1052</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Mesh.ICP_rigid_body_transform-1053"><a href="#Mesh.ICP_rigid_body_transform-1053"><span class="linenos">1053</span></a>        <span class="n">tgt_meshio</span><span class="p">:</span> <span class="n">io</span><span class="o">.</span><span class="n">Mesh</span><span class="p">,</span>
</span><span id="Mesh.ICP_rigid_body_transform-1054"><a href="#Mesh.ICP_rigid_body_transform-1054"><span class="linenos">1054</span></a>        <span class="n">n_eval_per_elem</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="Mesh.ICP_rigid_body_transform-1055"><a href="#Mesh.ICP_rigid_body_transform-1055"><span class="linenos">1055</span></a>        <span class="n">XI_list</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Mesh.ICP_rigid_body_transform-1056"><a href="#Mesh.ICP_rigid_body_transform-1056"><span class="linenos">1056</span></a>        <span class="n">plot_after</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Mesh.ICP_rigid_body_transform-1057"><a href="#Mesh.ICP_rigid_body_transform-1057"><span class="linenos">1057</span></a>        <span class="n">disable_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Mesh.ICP_rigid_body_transform-1058"><a href="#Mesh.ICP_rigid_body_transform-1058"><span class="linenos">1058</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="nb">float</span><span class="p">]:</span>
</span><span id="Mesh.ICP_rigid_body_transform-1059"><a href="#Mesh.ICP_rigid_body_transform-1059"><span class="linenos">1059</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh.ICP_rigid_body_transform-1060"><a href="#Mesh.ICP_rigid_body_transform-1060"><span class="linenos">1060</span></a><span class="sd">        Compute and apply a rigid body transformation aligning the mesh to a target mesh.</span>
</span><span id="Mesh.ICP_rigid_body_transform-1061"><a href="#Mesh.ICP_rigid_body_transform-1061"><span class="linenos">1061</span></a>
</span><span id="Mesh.ICP_rigid_body_transform-1062"><a href="#Mesh.ICP_rigid_body_transform-1062"><span class="linenos">1062</span></a><span class="sd">        This method computes the rigid body transformation (rotation and translation)</span>
</span><span id="Mesh.ICP_rigid_body_transform-1063"><a href="#Mesh.ICP_rigid_body_transform-1063"><span class="linenos">1063</span></a><span class="sd">        that best aligns the current mesh to a target mesh using an Iterative Closest</span>
</span><span id="Mesh.ICP_rigid_body_transform-1064"><a href="#Mesh.ICP_rigid_body_transform-1064"><span class="linenos">1064</span></a><span class="sd">        Point (ICP) algorithm. The transformation is then directly applied to the</span>
</span><span id="Mesh.ICP_rigid_body_transform-1065"><a href="#Mesh.ICP_rigid_body_transform-1065"><span class="linenos">1065</span></a><span class="sd">        control points of the mesh.</span>
</span><span id="Mesh.ICP_rigid_body_transform-1066"><a href="#Mesh.ICP_rigid_body_transform-1066"><span class="linenos">1066</span></a>
</span><span id="Mesh.ICP_rigid_body_transform-1067"><a href="#Mesh.ICP_rigid_body_transform-1067"><span class="linenos">1067</span></a><span class="sd">        Parameters</span>
</span><span id="Mesh.ICP_rigid_body_transform-1068"><a href="#Mesh.ICP_rigid_body_transform-1068"><span class="linenos">1068</span></a><span class="sd">        ----------</span>
</span><span id="Mesh.ICP_rigid_body_transform-1069"><a href="#Mesh.ICP_rigid_body_transform-1069"><span class="linenos">1069</span></a><span class="sd">        tgt_meshio : io.Mesh</span>
</span><span id="Mesh.ICP_rigid_body_transform-1070"><a href="#Mesh.ICP_rigid_body_transform-1070"><span class="linenos">1070</span></a><span class="sd">            Target mesh used as reference for the alignment.</span>
</span><span id="Mesh.ICP_rigid_body_transform-1071"><a href="#Mesh.ICP_rigid_body_transform-1071"><span class="linenos">1071</span></a><span class="sd">        n_eval_per_elem : int or iterable of int, optional</span>
</span><span id="Mesh.ICP_rigid_body_transform-1072"><a href="#Mesh.ICP_rigid_body_transform-1072"><span class="linenos">1072</span></a><span class="sd">            Number of evaluation points per element for each parametric dimension.</span>
</span><span id="Mesh.ICP_rigid_body_transform-1073"><a href="#Mesh.ICP_rigid_body_transform-1073"><span class="linenos">1073</span></a><span class="sd">            If an integer is provided, the same value is used for all dimensions.</span>
</span><span id="Mesh.ICP_rigid_body_transform-1074"><a href="#Mesh.ICP_rigid_body_transform-1074"><span class="linenos">1074</span></a><span class="sd">            If an iterable is provided, each value corresponds to one parametric</span>
</span><span id="Mesh.ICP_rigid_body_transform-1075"><a href="#Mesh.ICP_rigid_body_transform-1075"><span class="linenos">1075</span></a><span class="sd">            direction. Default is `5`.</span>
</span><span id="Mesh.ICP_rigid_body_transform-1076"><a href="#Mesh.ICP_rigid_body_transform-1076"><span class="linenos">1076</span></a><span class="sd">        XI_list : iterable of tuple of ndarray, optional</span>
</span><span id="Mesh.ICP_rigid_body_transform-1077"><a href="#Mesh.ICP_rigid_body_transform-1077"><span class="linenos">1077</span></a><span class="sd">            Parametric coordinates at which the geometry is evaluated to generate</span>
</span><span id="Mesh.ICP_rigid_body_transform-1078"><a href="#Mesh.ICP_rigid_body_transform-1078"><span class="linenos">1078</span></a><span class="sd">            the source surface mesh. If provided, this overrides `n_eval_per_elem`.</span>
</span><span id="Mesh.ICP_rigid_body_transform-1079"><a href="#Mesh.ICP_rigid_body_transform-1079"><span class="linenos">1079</span></a><span class="sd">        plot_after : bool, optional</span>
</span><span id="Mesh.ICP_rigid_body_transform-1080"><a href="#Mesh.ICP_rigid_body_transform-1080"><span class="linenos">1080</span></a><span class="sd">            If `True`, displays a visualization of the aligned source mesh and</span>
</span><span id="Mesh.ICP_rigid_body_transform-1081"><a href="#Mesh.ICP_rigid_body_transform-1081"><span class="linenos">1081</span></a><span class="sd">            the target mesh after the ICP procedure. Default is `True`.</span>
</span><span id="Mesh.ICP_rigid_body_transform-1082"><a href="#Mesh.ICP_rigid_body_transform-1082"><span class="linenos">1082</span></a><span class="sd">        disable_parallel : bool, optional</span>
</span><span id="Mesh.ICP_rigid_body_transform-1083"><a href="#Mesh.ICP_rigid_body_transform-1083"><span class="linenos">1083</span></a><span class="sd">            If `True`, disables parallel evaluation. Default is `False`.</span>
</span><span id="Mesh.ICP_rigid_body_transform-1084"><a href="#Mesh.ICP_rigid_body_transform-1084"><span class="linenos">1084</span></a>
</span><span id="Mesh.ICP_rigid_body_transform-1085"><a href="#Mesh.ICP_rigid_body_transform-1085"><span class="linenos">1085</span></a><span class="sd">        Returns</span>
</span><span id="Mesh.ICP_rigid_body_transform-1086"><a href="#Mesh.ICP_rigid_body_transform-1086"><span class="linenos">1086</span></a><span class="sd">        -------</span>
</span><span id="Mesh.ICP_rigid_body_transform-1087"><a href="#Mesh.ICP_rigid_body_transform-1087"><span class="linenos">1087</span></a><span class="sd">        Rmat : np.ndarray of float, shape (3, 3)</span>
</span><span id="Mesh.ICP_rigid_body_transform-1088"><a href="#Mesh.ICP_rigid_body_transform-1088"><span class="linenos">1088</span></a><span class="sd">            Rotation matrix of the rigid body transformation.</span>
</span><span id="Mesh.ICP_rigid_body_transform-1089"><a href="#Mesh.ICP_rigid_body_transform-1089"><span class="linenos">1089</span></a><span class="sd">        tvec : np.ndarray of float, shape (3,)</span>
</span><span id="Mesh.ICP_rigid_body_transform-1090"><a href="#Mesh.ICP_rigid_body_transform-1090"><span class="linenos">1090</span></a><span class="sd">            Translation vector of the rigid body transformation.</span>
</span><span id="Mesh.ICP_rigid_body_transform-1091"><a href="#Mesh.ICP_rigid_body_transform-1091"><span class="linenos">1091</span></a><span class="sd">        max_dist : float</span>
</span><span id="Mesh.ICP_rigid_body_transform-1092"><a href="#Mesh.ICP_rigid_body_transform-1092"><span class="linenos">1092</span></a><span class="sd">            Maximum absolute distance between the aligned source mesh and the</span>
</span><span id="Mesh.ICP_rigid_body_transform-1093"><a href="#Mesh.ICP_rigid_body_transform-1093"><span class="linenos">1093</span></a><span class="sd">            target mesh after transformation.</span>
</span><span id="Mesh.ICP_rigid_body_transform-1094"><a href="#Mesh.ICP_rigid_body_transform-1094"><span class="linenos">1094</span></a>
</span><span id="Mesh.ICP_rigid_body_transform-1095"><a href="#Mesh.ICP_rigid_body_transform-1095"><span class="linenos">1095</span></a><span class="sd">        Notes</span>
</span><span id="Mesh.ICP_rigid_body_transform-1096"><a href="#Mesh.ICP_rigid_body_transform-1096"><span class="linenos">1096</span></a><span class="sd">        -----</span>
</span><span id="Mesh.ICP_rigid_body_transform-1097"><a href="#Mesh.ICP_rigid_body_transform-1097"><span class="linenos">1097</span></a><span class="sd">        - For 3D meshes, the ICP is performed on the extracted boundary surface.</span>
</span><span id="Mesh.ICP_rigid_body_transform-1098"><a href="#Mesh.ICP_rigid_body_transform-1098"><span class="linenos">1098</span></a><span class="sd">        - The transformation is applied as `Rmat @ x + tvec`.</span>
</span><span id="Mesh.ICP_rigid_body_transform-1099"><a href="#Mesh.ICP_rigid_body_transform-1099"><span class="linenos">1099</span></a><span class="sd">        - This method modifies the mesh in place by updating `self.unique_ctrl_pts`.</span>
</span><span id="Mesh.ICP_rigid_body_transform-1100"><a href="#Mesh.ICP_rigid_body_transform-1100"><span class="linenos">1100</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh.ICP_rigid_body_transform-1101"><a href="#Mesh.ICP_rigid_body_transform-1101"><span class="linenos">1101</span></a>        <span class="c1"># Create source and target PolyData</span>
</span><span id="Mesh.ICP_rigid_body_transform-1102"><a href="#Mesh.ICP_rigid_body_transform-1102"><span class="linenos">1102</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">npa</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="Mesh.ICP_rigid_body_transform-1103"><a href="#Mesh.ICP_rigid_body_transform-1103"><span class="linenos">1103</span></a>            <span class="n">border_mesh</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="Mesh.ICP_rigid_body_transform-1104"><a href="#Mesh.ICP_rigid_body_transform-1104"><span class="linenos">1104</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">npa</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="Mesh.ICP_rigid_body_transform-1105"><a href="#Mesh.ICP_rigid_body_transform-1105"><span class="linenos">1105</span></a>            <span class="n">border_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_border</span><span class="p">()</span>
</span><span id="Mesh.ICP_rigid_body_transform-1106"><a href="#Mesh.ICP_rigid_body_transform-1106"><span class="linenos">1106</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Mesh.ICP_rigid_body_transform-1107"><a href="#Mesh.ICP_rigid_body_transform-1107"><span class="linenos">1107</span></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
</span><span id="Mesh.ICP_rigid_body_transform-1108"><a href="#Mesh.ICP_rigid_body_transform-1108"><span class="linenos">1108</span></a>                <span class="sa">f</span><span class="s2">&quot;Making finding ICP rigid body transform not implemented for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">npa</span><span class="si">}</span><span class="s2">-D shapes.&quot;</span>
</span><span id="Mesh.ICP_rigid_body_transform-1109"><a href="#Mesh.ICP_rigid_body_transform-1109"><span class="linenos">1109</span></a>            <span class="p">)</span>
</span><span id="Mesh.ICP_rigid_body_transform-1110"><a href="#Mesh.ICP_rigid_body_transform-1110"><span class="linenos">1110</span></a>        <span class="n">src_meshio</span> <span class="o">=</span> <span class="n">border_mesh</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">make_elements_interior_meshes</span><span class="p">(</span>
</span><span id="Mesh.ICP_rigid_body_transform-1111"><a href="#Mesh.ICP_rigid_body_transform-1111"><span class="linenos">1111</span></a>            <span class="n">border_mesh</span><span class="o">.</span><span class="n">splines</span><span class="p">,</span>
</span><span id="Mesh.ICP_rigid_body_transform-1112"><a href="#Mesh.ICP_rigid_body_transform-1112"><span class="linenos">1112</span></a>            <span class="n">border_mesh</span><span class="o">.</span><span class="n">get_separated_ctrl_pts</span><span class="p">(),</span>
</span><span id="Mesh.ICP_rigid_body_transform-1113"><a href="#Mesh.ICP_rigid_body_transform-1113"><span class="linenos">1113</span></a>            <span class="n">n_eval_per_elem</span><span class="o">=</span><span class="n">n_eval_per_elem</span><span class="p">,</span>
</span><span id="Mesh.ICP_rigid_body_transform-1114"><a href="#Mesh.ICP_rigid_body_transform-1114"><span class="linenos">1114</span></a>            <span class="n">XI_list</span><span class="o">=</span><span class="n">XI_list</span><span class="p">,</span>
</span><span id="Mesh.ICP_rigid_body_transform-1115"><a href="#Mesh.ICP_rigid_body_transform-1115"><span class="linenos">1115</span></a>            <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Mesh.ICP_rigid_body_transform-1116"><a href="#Mesh.ICP_rigid_body_transform-1116"><span class="linenos">1116</span></a>            <span class="n">disable_parallel</span><span class="o">=</span><span class="n">disable_parallel</span><span class="p">,</span>
</span><span id="Mesh.ICP_rigid_body_transform-1117"><a href="#Mesh.ICP_rigid_body_transform-1117"><span class="linenos">1117</span></a>        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Mesh.ICP_rigid_body_transform-1118"><a href="#Mesh.ICP_rigid_body_transform-1118"><span class="linenos">1118</span></a>        <span class="n">src</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">from_meshio</span><span class="p">(</span><span class="n">src_meshio</span><span class="p">)</span>
</span><span id="Mesh.ICP_rigid_body_transform-1119"><a href="#Mesh.ICP_rigid_body_transform-1119"><span class="linenos">1119</span></a>        <span class="n">tgt</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">from_meshio</span><span class="p">(</span><span class="n">tgt_meshio</span><span class="p">)</span>
</span><span id="Mesh.ICP_rigid_body_transform-1120"><a href="#Mesh.ICP_rigid_body_transform-1120"><span class="linenos">1120</span></a>
</span><span id="Mesh.ICP_rigid_body_transform-1121"><a href="#Mesh.ICP_rigid_body_transform-1121"><span class="linenos">1121</span></a>        <span class="c1"># Perform ICP alignment</span>
</span><span id="Mesh.ICP_rigid_body_transform-1122"><a href="#Mesh.ICP_rigid_body_transform-1122"><span class="linenos">1122</span></a>        <span class="n">aligned</span><span class="p">,</span> <span class="n">matrix</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">align</span><span class="p">(</span>
</span><span id="Mesh.ICP_rigid_body_transform-1123"><a href="#Mesh.ICP_rigid_body_transform-1123"><span class="linenos">1123</span></a>            <span class="n">tgt</span><span class="p">,</span>
</span><span id="Mesh.ICP_rigid_body_transform-1124"><a href="#Mesh.ICP_rigid_body_transform-1124"><span class="linenos">1124</span></a>            <span class="n">max_landmarks</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
</span><span id="Mesh.ICP_rigid_body_transform-1125"><a href="#Mesh.ICP_rigid_body_transform-1125"><span class="linenos">1125</span></a>            <span class="n">max_mean_distance</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span>
</span><span id="Mesh.ICP_rigid_body_transform-1126"><a href="#Mesh.ICP_rigid_body_transform-1126"><span class="linenos">1126</span></a>            <span class="n">max_iterations</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
</span><span id="Mesh.ICP_rigid_body_transform-1127"><a href="#Mesh.ICP_rigid_body_transform-1127"><span class="linenos">1127</span></a>            <span class="n">start_by_matching_centroids</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Mesh.ICP_rigid_body_transform-1128"><a href="#Mesh.ICP_rigid_body_transform-1128"><span class="linenos">1128</span></a>            <span class="n">return_matrix</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Mesh.ICP_rigid_body_transform-1129"><a href="#Mesh.ICP_rigid_body_transform-1129"><span class="linenos">1129</span></a>        <span class="p">)</span>
</span><span id="Mesh.ICP_rigid_body_transform-1130"><a href="#Mesh.ICP_rigid_body_transform-1130"><span class="linenos">1130</span></a>
</span><span id="Mesh.ICP_rigid_body_transform-1131"><a href="#Mesh.ICP_rigid_body_transform-1131"><span class="linenos">1131</span></a>        <span class="c1"># Decompose transformation matrix</span>
</span><span id="Mesh.ICP_rigid_body_transform-1132"><a href="#Mesh.ICP_rigid_body_transform-1132"><span class="linenos">1132</span></a>        <span class="n">Rmat</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>
</span><span id="Mesh.ICP_rigid_body_transform-1133"><a href="#Mesh.ICP_rigid_body_transform-1133"><span class="linenos">1133</span></a>        <span class="n">tvec</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</span><span id="Mesh.ICP_rigid_body_transform-1134"><a href="#Mesh.ICP_rigid_body_transform-1134"><span class="linenos">1134</span></a>
</span><span id="Mesh.ICP_rigid_body_transform-1135"><a href="#Mesh.ICP_rigid_body_transform-1135"><span class="linenos">1135</span></a>        <span class="c1"># Apply transformation to self</span>
</span><span id="Mesh.ICP_rigid_body_transform-1136"><a href="#Mesh.ICP_rigid_body_transform-1136"><span class="linenos">1136</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">unique_ctrl_pts</span> <span class="o">=</span> <span class="n">Rmat</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_ctrl_pts</span> <span class="o">+</span> <span class="n">tvec</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="Mesh.ICP_rigid_body_transform-1137"><a href="#Mesh.ICP_rigid_body_transform-1137"><span class="linenos">1137</span></a>
</span><span id="Mesh.ICP_rigid_body_transform-1138"><a href="#Mesh.ICP_rigid_body_transform-1138"><span class="linenos">1138</span></a>        <span class="k">if</span> <span class="n">plot_after</span><span class="p">:</span>
</span><span id="Mesh.ICP_rigid_body_transform-1139"><a href="#Mesh.ICP_rigid_body_transform-1139"><span class="linenos">1139</span></a>            <span class="n">plotter</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">()</span>
</span><span id="Mesh.ICP_rigid_body_transform-1140"><a href="#Mesh.ICP_rigid_body_transform-1140"><span class="linenos">1140</span></a>            <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span>
</span><span id="Mesh.ICP_rigid_body_transform-1141"><a href="#Mesh.ICP_rigid_body_transform-1141"><span class="linenos">1141</span></a>                <span class="n">aligned</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Aligned surface mesh&quot;</span>
</span><span id="Mesh.ICP_rigid_body_transform-1142"><a href="#Mesh.ICP_rigid_body_transform-1142"><span class="linenos">1142</span></a>            <span class="p">)</span>
</span><span id="Mesh.ICP_rigid_body_transform-1143"><a href="#Mesh.ICP_rigid_body_transform-1143"><span class="linenos">1143</span></a>            <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">tgt</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;STL Marching Cubes&quot;</span><span class="p">)</span>
</span><span id="Mesh.ICP_rigid_body_transform-1144"><a href="#Mesh.ICP_rigid_body_transform-1144"><span class="linenos">1144</span></a>            <span class="n">plotter</span><span class="o">.</span><span class="n">add_legend</span><span class="p">()</span>
</span><span id="Mesh.ICP_rigid_body_transform-1145"><a href="#Mesh.ICP_rigid_body_transform-1145"><span class="linenos">1145</span></a>            <span class="n">plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="Mesh.ICP_rigid_body_transform-1146"><a href="#Mesh.ICP_rigid_body_transform-1146"><span class="linenos">1146</span></a>
</span><span id="Mesh.ICP_rigid_body_transform-1147"><a href="#Mesh.ICP_rigid_body_transform-1147"><span class="linenos">1147</span></a>        <span class="c1"># Compute max distance between aligned and target meshes</span>
</span><span id="Mesh.ICP_rigid_body_transform-1148"><a href="#Mesh.ICP_rigid_body_transform-1148"><span class="linenos">1148</span></a>        <span class="n">aligned</span><span class="o">.</span><span class="n">compute_implicit_distance</span><span class="p">(</span><span class="n">tgt</span><span class="o">.</span><span class="n">extract_surface</span><span class="p">(),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Mesh.ICP_rigid_body_transform-1149"><a href="#Mesh.ICP_rigid_body_transform-1149"><span class="linenos">1149</span></a>        <span class="n">dist_array</span> <span class="o">=</span> <span class="n">aligned</span><span class="p">[</span><span class="s2">&quot;implicit_distance&quot;</span><span class="p">]</span>
</span><span id="Mesh.ICP_rigid_body_transform-1150"><a href="#Mesh.ICP_rigid_body_transform-1150"><span class="linenos">1150</span></a>        <span class="n">max_dist</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dist_array</span><span class="p">)))</span>
</span><span id="Mesh.ICP_rigid_body_transform-1151"><a href="#Mesh.ICP_rigid_body_transform-1151"><span class="linenos">1151</span></a>
</span><span id="Mesh.ICP_rigid_body_transform-1152"><a href="#Mesh.ICP_rigid_body_transform-1152"><span class="linenos">1152</span></a>        <span class="k">return</span> <span class="n">Rmat</span><span class="p">,</span> <span class="n">tvec</span><span class="p">,</span> <span class="n">max_dist</span>
</span></pre></div>


            <div class="docstring"><p>Compute and apply a rigid body transformation aligning the mesh to a target mesh.</p>

<p>This method computes the rigid body transformation (rotation and translation)
that best aligns the current mesh to a target mesh using an Iterative Closest
Point (ICP) algorithm. The transformation is then directly applied to the
control points of the mesh.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>tgt_meshio</strong> (io.Mesh):
Target mesh used as reference for the alignment.</li>
<li><strong>n_eval_per_elem</strong> (int or iterable of int, optional):
Number of evaluation points per element for each parametric dimension.
If an integer is provided, the same value is used for all dimensions.
If an iterable is provided, each value corresponds to one parametric
direction. Default is <code>5</code>.</li>
<li><strong>XI_list</strong> (iterable of tuple of ndarray, optional):
Parametric coordinates at which the geometry is evaluated to generate
the source surface mesh. If provided, this overrides <code>n_eval_per_elem</code>.</li>
<li><strong>plot_after</strong> (bool, optional):
If <code>True</code>, displays a visualization of the aligned source mesh and
the target mesh after the ICP procedure. Default is <code>True</code>.</li>
<li><strong>disable_parallel</strong> (bool, optional):
If <code>True</code>, disables parallel evaluation. Default is <code>False</code>.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>Rmat</strong> (np.ndarray of float, shape (3, 3)):
Rotation matrix of the rigid body transformation.</li>
<li><strong>tvec</strong> (np.ndarray of float, shape (3,)):
Translation vector of the rigid body transformation.</li>
<li><strong>max_dist</strong> (float):
Maximum absolute distance between the aligned source mesh and the
target mesh after transformation.</li>
</ul>

<h6 id="notes">Notes</h6>

<ul>
<li>For 3D meshes, the ICP is performed on the extracted boundary surface.</li>
<li>The transformation is applied as <code>Rmat @ x + tvec</code>.</li>
<li>This method modifies the mesh in place by updating <code>self.unique_ctrl_pts</code>.</li>
</ul>
</div>


                            </div>
                            <div id="Mesh.distance_to_meshio" class="classattr">
                                        <input id="Mesh.distance_to_meshio-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">distance_to_meshio</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">tgt_meshio</span><span class="p">:</span> <span class="n">meshio</span><span class="o">.</span><span class="n">_mesh</span><span class="o">.</span><span class="n">Mesh</span>,</span><span class="param">	<span class="n">n_eval_per_elem</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">5</span>,</span><span class="param">	<span class="n">XI_list</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">meshio</span><span class="o">.</span><span class="n">_mesh</span><span class="o">.</span><span class="n">Mesh</span>:</span></span>

                <label class="view-source-button" for="Mesh.distance_to_meshio-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Mesh.distance_to_meshio"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Mesh.distance_to_meshio-1154"><a href="#Mesh.distance_to_meshio-1154"><span class="linenos">1154</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">distance_to_meshio</span><span class="p">(</span>
</span><span id="Mesh.distance_to_meshio-1155"><a href="#Mesh.distance_to_meshio-1155"><span class="linenos">1155</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Mesh.distance_to_meshio-1156"><a href="#Mesh.distance_to_meshio-1156"><span class="linenos">1156</span></a>        <span class="n">tgt_meshio</span><span class="p">:</span> <span class="n">io</span><span class="o">.</span><span class="n">Mesh</span><span class="p">,</span>
</span><span id="Mesh.distance_to_meshio-1157"><a href="#Mesh.distance_to_meshio-1157"><span class="linenos">1157</span></a>        <span class="n">n_eval_per_elem</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="Mesh.distance_to_meshio-1158"><a href="#Mesh.distance_to_meshio-1158"><span class="linenos">1158</span></a>        <span class="n">XI_list</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Mesh.distance_to_meshio-1159"><a href="#Mesh.distance_to_meshio-1159"><span class="linenos">1159</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">io</span><span class="o">.</span><span class="n">Mesh</span><span class="p">:</span>
</span><span id="Mesh.distance_to_meshio-1160"><a href="#Mesh.distance_to_meshio-1160"><span class="linenos">1160</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh.distance_to_meshio-1161"><a href="#Mesh.distance_to_meshio-1161"><span class="linenos">1161</span></a><span class="sd">        Compute the signed distance field to a target mesh.</span>
</span><span id="Mesh.distance_to_meshio-1162"><a href="#Mesh.distance_to_meshio-1162"><span class="linenos">1162</span></a>
</span><span id="Mesh.distance_to_meshio-1163"><a href="#Mesh.distance_to_meshio-1163"><span class="linenos">1163</span></a><span class="sd">        This method evaluates the geometry of the mesh (or its boundary in 3D)</span>
</span><span id="Mesh.distance_to_meshio-1164"><a href="#Mesh.distance_to_meshio-1164"><span class="linenos">1164</span></a><span class="sd">        and computes the implicit distance to the surface of a target mesh.</span>
</span><span id="Mesh.distance_to_meshio-1165"><a href="#Mesh.distance_to_meshio-1165"><span class="linenos">1165</span></a><span class="sd">        The resulting distance field is returned as a `MeshIO` mesh.</span>
</span><span id="Mesh.distance_to_meshio-1166"><a href="#Mesh.distance_to_meshio-1166"><span class="linenos">1166</span></a>
</span><span id="Mesh.distance_to_meshio-1167"><a href="#Mesh.distance_to_meshio-1167"><span class="linenos">1167</span></a><span class="sd">        Parameters</span>
</span><span id="Mesh.distance_to_meshio-1168"><a href="#Mesh.distance_to_meshio-1168"><span class="linenos">1168</span></a><span class="sd">        ----------</span>
</span><span id="Mesh.distance_to_meshio-1169"><a href="#Mesh.distance_to_meshio-1169"><span class="linenos">1169</span></a><span class="sd">        tgt_meshio : io.Mesh</span>
</span><span id="Mesh.distance_to_meshio-1170"><a href="#Mesh.distance_to_meshio-1170"><span class="linenos">1170</span></a><span class="sd">            Target mesh defining the reference surface.</span>
</span><span id="Mesh.distance_to_meshio-1171"><a href="#Mesh.distance_to_meshio-1171"><span class="linenos">1171</span></a><span class="sd">        n_eval_per_elem : int or iterable of int, optional</span>
</span><span id="Mesh.distance_to_meshio-1172"><a href="#Mesh.distance_to_meshio-1172"><span class="linenos">1172</span></a><span class="sd">            Number of evaluation points per element for each parametric dimension.</span>
</span><span id="Mesh.distance_to_meshio-1173"><a href="#Mesh.distance_to_meshio-1173"><span class="linenos">1173</span></a><span class="sd">            Default is `5`.</span>
</span><span id="Mesh.distance_to_meshio-1174"><a href="#Mesh.distance_to_meshio-1174"><span class="linenos">1174</span></a><span class="sd">        XI_list : iterable of tuple of ndarray, optional</span>
</span><span id="Mesh.distance_to_meshio-1175"><a href="#Mesh.distance_to_meshio-1175"><span class="linenos">1175</span></a><span class="sd">            Parametric coordinates at which the geometry is evaluated.</span>
</span><span id="Mesh.distance_to_meshio-1176"><a href="#Mesh.distance_to_meshio-1176"><span class="linenos">1176</span></a><span class="sd">            If provided, this overrides `n_eval_per_elem`.</span>
</span><span id="Mesh.distance_to_meshio-1177"><a href="#Mesh.distance_to_meshio-1177"><span class="linenos">1177</span></a>
</span><span id="Mesh.distance_to_meshio-1178"><a href="#Mesh.distance_to_meshio-1178"><span class="linenos">1178</span></a><span class="sd">        Returns</span>
</span><span id="Mesh.distance_to_meshio-1179"><a href="#Mesh.distance_to_meshio-1179"><span class="linenos">1179</span></a><span class="sd">        -------</span>
</span><span id="Mesh.distance_to_meshio-1180"><a href="#Mesh.distance_to_meshio-1180"><span class="linenos">1180</span></a><span class="sd">        io.Mesh</span>
</span><span id="Mesh.distance_to_meshio-1181"><a href="#Mesh.distance_to_meshio-1181"><span class="linenos">1181</span></a><span class="sd">            `MeshIO` mesh containing the evaluated geometry and the associated</span>
</span><span id="Mesh.distance_to_meshio-1182"><a href="#Mesh.distance_to_meshio-1182"><span class="linenos">1182</span></a><span class="sd">            implicit distance field.</span>
</span><span id="Mesh.distance_to_meshio-1183"><a href="#Mesh.distance_to_meshio-1183"><span class="linenos">1183</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh.distance_to_meshio-1184"><a href="#Mesh.distance_to_meshio-1184"><span class="linenos">1184</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">npa</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="Mesh.distance_to_meshio-1185"><a href="#Mesh.distance_to_meshio-1185"><span class="linenos">1185</span></a>            <span class="n">border_mesh</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="Mesh.distance_to_meshio-1186"><a href="#Mesh.distance_to_meshio-1186"><span class="linenos">1186</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">npa</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="Mesh.distance_to_meshio-1187"><a href="#Mesh.distance_to_meshio-1187"><span class="linenos">1187</span></a>            <span class="n">border_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_border</span><span class="p">()</span>
</span><span id="Mesh.distance_to_meshio-1188"><a href="#Mesh.distance_to_meshio-1188"><span class="linenos">1188</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Mesh.distance_to_meshio-1189"><a href="#Mesh.distance_to_meshio-1189"><span class="linenos">1189</span></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
</span><span id="Mesh.distance_to_meshio-1190"><a href="#Mesh.distance_to_meshio-1190"><span class="linenos">1190</span></a>                <span class="sa">f</span><span class="s2">&quot;Distance field not implemented for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">npa</span><span class="si">}</span><span class="s2">-D shapes.&quot;</span>
</span><span id="Mesh.distance_to_meshio-1191"><a href="#Mesh.distance_to_meshio-1191"><span class="linenos">1191</span></a>            <span class="p">)</span>
</span><span id="Mesh.distance_to_meshio-1192"><a href="#Mesh.distance_to_meshio-1192"><span class="linenos">1192</span></a>        <span class="n">src_meshio</span> <span class="o">=</span> <span class="n">border_mesh</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">make_elements_interior_meshes</span><span class="p">(</span>
</span><span id="Mesh.distance_to_meshio-1193"><a href="#Mesh.distance_to_meshio-1193"><span class="linenos">1193</span></a>            <span class="n">border_mesh</span><span class="o">.</span><span class="n">splines</span><span class="p">,</span>
</span><span id="Mesh.distance_to_meshio-1194"><a href="#Mesh.distance_to_meshio-1194"><span class="linenos">1194</span></a>            <span class="n">border_mesh</span><span class="o">.</span><span class="n">get_separated_ctrl_pts</span><span class="p">(),</span>
</span><span id="Mesh.distance_to_meshio-1195"><a href="#Mesh.distance_to_meshio-1195"><span class="linenos">1195</span></a>            <span class="n">n_eval_per_elem</span><span class="o">=</span><span class="n">n_eval_per_elem</span><span class="p">,</span>
</span><span id="Mesh.distance_to_meshio-1196"><a href="#Mesh.distance_to_meshio-1196"><span class="linenos">1196</span></a>            <span class="n">XI_list</span><span class="o">=</span><span class="n">XI_list</span><span class="p">,</span>
</span><span id="Mesh.distance_to_meshio-1197"><a href="#Mesh.distance_to_meshio-1197"><span class="linenos">1197</span></a>            <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Mesh.distance_to_meshio-1198"><a href="#Mesh.distance_to_meshio-1198"><span class="linenos">1198</span></a>        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Mesh.distance_to_meshio-1199"><a href="#Mesh.distance_to_meshio-1199"><span class="linenos">1199</span></a>        <span class="n">src</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">from_meshio</span><span class="p">(</span><span class="n">src_meshio</span><span class="p">)</span>
</span><span id="Mesh.distance_to_meshio-1200"><a href="#Mesh.distance_to_meshio-1200"><span class="linenos">1200</span></a>        <span class="n">tgt</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">from_meshio</span><span class="p">(</span><span class="n">tgt_meshio</span><span class="p">)</span>
</span><span id="Mesh.distance_to_meshio-1201"><a href="#Mesh.distance_to_meshio-1201"><span class="linenos">1201</span></a>        <span class="n">src</span><span class="o">.</span><span class="n">compute_implicit_distance</span><span class="p">(</span><span class="n">tgt</span><span class="o">.</span><span class="n">extract_surface</span><span class="p">(),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Mesh.distance_to_meshio-1202"><a href="#Mesh.distance_to_meshio-1202"><span class="linenos">1202</span></a>        <span class="k">return</span> <span class="n">pv</span><span class="o">.</span><span class="n">to_meshio</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Compute the signed distance field to a target mesh.</p>

<p>This method evaluates the geometry of the mesh (or its boundary in 3D)
and computes the implicit distance to the surface of a target mesh.
The resulting distance field is returned as a <code>MeshIO</code> mesh.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>tgt_meshio</strong> (io.Mesh):
Target mesh defining the reference surface.</li>
<li><strong>n_eval_per_elem</strong> (int or iterable of int, optional):
Number of evaluation points per element for each parametric dimension.
Default is <code>5</code>.</li>
<li><strong>XI_list</strong> (iterable of tuple of ndarray, optional):
Parametric coordinates at which the geometry is evaluated.
If provided, this overrides <code>n_eval_per_elem</code>.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>io.Mesh</strong>: <code>MeshIO</code> mesh containing the evaluated geometry and the associated
implicit distance field.</li>
</ul>
</div>


                            </div>
                            <div id="Mesh.save_paraview" class="classattr">
                                        <input id="Mesh.save_paraview-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save_paraview</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">n_step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">n_eval_per_elem</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">10</span>,</span><span class="param">	<span class="n">unique_fields</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>,</span><span class="param">	<span class="n">separated_fields</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">XI_list</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">groups</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">make_pvd</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">fields_on_interior_only</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;auto&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span>,</span><span class="param">	<span class="n">disable_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Mesh.save_paraview-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Mesh.save_paraview"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Mesh.save_paraview-1204"><a href="#Mesh.save_paraview-1204"><span class="linenos">1204</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_paraview</span><span class="p">(</span>
</span><span id="Mesh.save_paraview-1205"><a href="#Mesh.save_paraview-1205"><span class="linenos">1205</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Mesh.save_paraview-1206"><a href="#Mesh.save_paraview-1206"><span class="linenos">1206</span></a>        <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Mesh.save_paraview-1207"><a href="#Mesh.save_paraview-1207"><span class="linenos">1207</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Mesh.save_paraview-1208"><a href="#Mesh.save_paraview-1208"><span class="linenos">1208</span></a>        <span class="n">n_step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Mesh.save_paraview-1209"><a href="#Mesh.save_paraview-1209"><span class="linenos">1209</span></a>        <span class="n">n_eval_per_elem</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="Mesh.save_paraview-1210"><a href="#Mesh.save_paraview-1210"><span class="linenos">1210</span></a>        <span class="n">unique_fields</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="Mesh.save_paraview-1211"><a href="#Mesh.save_paraview-1211"><span class="linenos">1211</span></a>        <span class="n">separated_fields</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Mesh.save_paraview-1212"><a href="#Mesh.save_paraview-1212"><span class="linenos">1212</span></a>        <span class="n">XI_list</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Mesh.save_paraview-1213"><a href="#Mesh.save_paraview-1213"><span class="linenos">1213</span></a>        <span class="n">groups</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Mesh.save_paraview-1214"><a href="#Mesh.save_paraview-1214"><span class="linenos">1214</span></a>        <span class="n">make_pvd</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Mesh.save_paraview-1215"><a href="#Mesh.save_paraview-1215"><span class="linenos">1215</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Mesh.save_paraview-1216"><a href="#Mesh.save_paraview-1216"><span class="linenos">1216</span></a>        <span class="n">fields_on_interior_only</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;auto&quot;</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
</span><span id="Mesh.save_paraview-1217"><a href="#Mesh.save_paraview-1217"><span class="linenos">1217</span></a>        <span class="n">disable_parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Mesh.save_paraview-1218"><a href="#Mesh.save_paraview-1218"><span class="linenos">1218</span></a>    <span class="p">):</span>
</span><span id="Mesh.save_paraview-1219"><a href="#Mesh.save_paraview-1219"><span class="linenos">1219</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Mesh.save_paraview-1220"><a href="#Mesh.save_paraview-1220"><span class="linenos">1220</span></a><span class="sd">        Save the mesh geometry and associated fields as ParaView-compatible files.</span>
</span><span id="Mesh.save_paraview-1221"><a href="#Mesh.save_paraview-1221"><span class="linenos">1221</span></a>
</span><span id="Mesh.save_paraview-1222"><a href="#Mesh.save_paraview-1222"><span class="linenos">1222</span></a><span class="sd">        This method is a convenience wrapper around</span>
</span><span id="Mesh.save_paraview-1223"><a href="#Mesh.save_paraview-1223"><span class="linenos">1223</span></a><span class="sd">        `MultiPatchBSplineConnectivity.save_paraview`.</span>
</span><span id="Mesh.save_paraview-1224"><a href="#Mesh.save_paraview-1224"><span class="linenos">1224</span></a><span class="sd">        It evaluates the multipatch B-spline geometry represented by the current</span>
</span><span id="Mesh.save_paraview-1225"><a href="#Mesh.save_paraview-1225"><span class="linenos">1225</span></a><span class="sd">        mesh and exports several VTU files suitable for visualization in ParaView,</span>
</span><span id="Mesh.save_paraview-1226"><a href="#Mesh.save_paraview-1226"><span class="linenos">1226</span></a><span class="sd">        with an optional PVD file for grouping time steps and mesh components.</span>
</span><span id="Mesh.save_paraview-1227"><a href="#Mesh.save_paraview-1227"><span class="linenos">1227</span></a>
</span><span id="Mesh.save_paraview-1228"><a href="#Mesh.save_paraview-1228"><span class="linenos">1228</span></a><span class="sd">        The following visualization meshes are generated:</span>
</span><span id="Mesh.save_paraview-1229"><a href="#Mesh.save_paraview-1229"><span class="linenos">1229</span></a><span class="sd">        - Interior mesh representing the evaluated B-spline geometry</span>
</span><span id="Mesh.save_paraview-1230"><a href="#Mesh.save_paraview-1230"><span class="linenos">1230</span></a><span class="sd">        - Element borders mesh showing the patch discretization</span>
</span><span id="Mesh.save_paraview-1231"><a href="#Mesh.save_paraview-1231"><span class="linenos">1231</span></a><span class="sd">        - Control points mesh showing the control structure</span>
</span><span id="Mesh.save_paraview-1232"><a href="#Mesh.save_paraview-1232"><span class="linenos">1232</span></a>
</span><span id="Mesh.save_paraview-1233"><a href="#Mesh.save_paraview-1233"><span class="linenos">1233</span></a><span class="sd">        Parameters</span>
</span><span id="Mesh.save_paraview-1234"><a href="#Mesh.save_paraview-1234"><span class="linenos">1234</span></a><span class="sd">        ----------</span>
</span><span id="Mesh.save_paraview-1235"><a href="#Mesh.save_paraview-1235"><span class="linenos">1235</span></a><span class="sd">        path : str</span>
</span><span id="Mesh.save_paraview-1236"><a href="#Mesh.save_paraview-1236"><span class="linenos">1236</span></a><span class="sd">            Directory where the ParaView files will be written.</span>
</span><span id="Mesh.save_paraview-1237"><a href="#Mesh.save_paraview-1237"><span class="linenos">1237</span></a><span class="sd">        name : str</span>
</span><span id="Mesh.save_paraview-1238"><a href="#Mesh.save_paraview-1238"><span class="linenos">1238</span></a><span class="sd">            Base name used for all output files.</span>
</span><span id="Mesh.save_paraview-1239"><a href="#Mesh.save_paraview-1239"><span class="linenos">1239</span></a><span class="sd">        n_step : int, optional</span>
</span><span id="Mesh.save_paraview-1240"><a href="#Mesh.save_paraview-1240"><span class="linenos">1240</span></a><span class="sd">            Number of time steps to export. Default is `1`.</span>
</span><span id="Mesh.save_paraview-1241"><a href="#Mesh.save_paraview-1241"><span class="linenos">1241</span></a><span class="sd">        n_eval_per_elem : int or iterable of int, optional</span>
</span><span id="Mesh.save_paraview-1242"><a href="#Mesh.save_paraview-1242"><span class="linenos">1242</span></a><span class="sd">            Number of evaluation points per element for each parametric dimension.</span>
</span><span id="Mesh.save_paraview-1243"><a href="#Mesh.save_paraview-1243"><span class="linenos">1243</span></a><span class="sd">            If an integer is provided, the same value is used for all dimensions.</span>
</span><span id="Mesh.save_paraview-1244"><a href="#Mesh.save_paraview-1244"><span class="linenos">1244</span></a><span class="sd">            If an iterable is provided, each value corresponds to one parametric</span>
</span><span id="Mesh.save_paraview-1245"><a href="#Mesh.save_paraview-1245"><span class="linenos">1245</span></a><span class="sd">            direction. Default is `10`.</span>
</span><span id="Mesh.save_paraview-1246"><a href="#Mesh.save_paraview-1246"><span class="linenos">1246</span></a><span class="sd">        unique_fields : dict, optional</span>
</span><span id="Mesh.save_paraview-1247"><a href="#Mesh.save_paraview-1247"><span class="linenos">1247</span></a><span class="sd">            Fields defined on unique control points to be exported.</span>
</span><span id="Mesh.save_paraview-1248"><a href="#Mesh.save_paraview-1248"><span class="linenos">1248</span></a><span class="sd">            Keys are field names and values are numpy arrays.</span>
</span><span id="Mesh.save_paraview-1249"><a href="#Mesh.save_paraview-1249"><span class="linenos">1249</span></a><span class="sd">            Callables are not supported here. Default is an empty dictionary.</span>
</span><span id="Mesh.save_paraview-1250"><a href="#Mesh.save_paraview-1250"><span class="linenos">1250</span></a><span class="sd">        separated_fields : list of dict, optional</span>
</span><span id="Mesh.save_paraview-1251"><a href="#Mesh.save_paraview-1251"><span class="linenos">1251</span></a><span class="sd">            Fields defined in separated (per-patch) representation.</span>
</span><span id="Mesh.save_paraview-1252"><a href="#Mesh.save_paraview-1252"><span class="linenos">1252</span></a><span class="sd">            Each list entry corresponds to one patch and contains a dictionary</span>
</span><span id="Mesh.save_paraview-1253"><a href="#Mesh.save_paraview-1253"><span class="linenos">1253</span></a><span class="sd">            mapping field names to field values. See</span>
</span><span id="Mesh.save_paraview-1254"><a href="#Mesh.save_paraview-1254"><span class="linenos">1254</span></a><span class="sd">            `MultiPatchBSplineConnectivity.save_paraview` for supported</span>
</span><span id="Mesh.save_paraview-1255"><a href="#Mesh.save_paraview-1255"><span class="linenos">1255</span></a><span class="sd">            formats.</span>
</span><span id="Mesh.save_paraview-1256"><a href="#Mesh.save_paraview-1256"><span class="linenos">1256</span></a><span class="sd">        XI_list : iterable of tuple of ndarray, optional</span>
</span><span id="Mesh.save_paraview-1257"><a href="#Mesh.save_paraview-1257"><span class="linenos">1257</span></a><span class="sd">            Parametric coordinates at which the geometry and fields are evaluated.</span>
</span><span id="Mesh.save_paraview-1258"><a href="#Mesh.save_paraview-1258"><span class="linenos">1258</span></a><span class="sd">            If provided, this overrides `n_eval_per_elem`.</span>
</span><span id="Mesh.save_paraview-1259"><a href="#Mesh.save_paraview-1259"><span class="linenos">1259</span></a><span class="sd">        groups : dict, optional</span>
</span><span id="Mesh.save_paraview-1260"><a href="#Mesh.save_paraview-1260"><span class="linenos">1260</span></a><span class="sd">            Dictionary describing ParaView file groups for PVD organization.</span>
</span><span id="Mesh.save_paraview-1261"><a href="#Mesh.save_paraview-1261"><span class="linenos">1261</span></a><span class="sd">            If `None`, groups are created automatically.</span>
</span><span id="Mesh.save_paraview-1262"><a href="#Mesh.save_paraview-1262"><span class="linenos">1262</span></a><span class="sd">        make_pvd : bool, optional</span>
</span><span id="Mesh.save_paraview-1263"><a href="#Mesh.save_paraview-1263"><span class="linenos">1263</span></a><span class="sd">            If `True`, generates a PVD file grouping all VTU files.</span>
</span><span id="Mesh.save_paraview-1264"><a href="#Mesh.save_paraview-1264"><span class="linenos">1264</span></a><span class="sd">            Default is `True`.</span>
</span><span id="Mesh.save_paraview-1265"><a href="#Mesh.save_paraview-1265"><span class="linenos">1265</span></a><span class="sd">        verbose : bool, optional</span>
</span><span id="Mesh.save_paraview-1266"><a href="#Mesh.save_paraview-1266"><span class="linenos">1266</span></a><span class="sd">            If `True`, prints progress information. Default is `True`.</span>
</span><span id="Mesh.save_paraview-1267"><a href="#Mesh.save_paraview-1267"><span class="linenos">1267</span></a><span class="sd">        fields_on_interior_only : bool, &quot;auto&quot;, or list of str, optional</span>
</span><span id="Mesh.save_paraview-1268"><a href="#Mesh.save_paraview-1268"><span class="linenos">1268</span></a><span class="sd">            Controls on which meshes fields are written:</span>
</span><span id="Mesh.save_paraview-1269"><a href="#Mesh.save_paraview-1269"><span class="linenos">1269</span></a><span class="sd">            - `True`: interior mesh only</span>
</span><span id="Mesh.save_paraview-1270"><a href="#Mesh.save_paraview-1270"><span class="linenos">1270</span></a><span class="sd">            - `False`: all meshes</span>
</span><span id="Mesh.save_paraview-1271"><a href="#Mesh.save_paraview-1271"><span class="linenos">1271</span></a><span class="sd">            - `&quot;auto&quot;`: displacement-like fields are written on all meshes,</span>
</span><span id="Mesh.save_paraview-1272"><a href="#Mesh.save_paraview-1272"><span class="linenos">1272</span></a><span class="sd">              others only on the interior mesh</span>
</span><span id="Mesh.save_paraview-1273"><a href="#Mesh.save_paraview-1273"><span class="linenos">1273</span></a><span class="sd">            - list of str: names of fields to include on all meshes</span>
</span><span id="Mesh.save_paraview-1274"><a href="#Mesh.save_paraview-1274"><span class="linenos">1274</span></a><span class="sd">              Default is `&quot;auto&quot;`.</span>
</span><span id="Mesh.save_paraview-1275"><a href="#Mesh.save_paraview-1275"><span class="linenos">1275</span></a><span class="sd">        disable_parallel : bool, optional</span>
</span><span id="Mesh.save_paraview-1276"><a href="#Mesh.save_paraview-1276"><span class="linenos">1276</span></a><span class="sd">            If `True`, disables parallel evaluation. Default is `False`.</span>
</span><span id="Mesh.save_paraview-1277"><a href="#Mesh.save_paraview-1277"><span class="linenos">1277</span></a>
</span><span id="Mesh.save_paraview-1278"><a href="#Mesh.save_paraview-1278"><span class="linenos">1278</span></a><span class="sd">        Returns</span>
</span><span id="Mesh.save_paraview-1279"><a href="#Mesh.save_paraview-1279"><span class="linenos">1279</span></a><span class="sd">        -------</span>
</span><span id="Mesh.save_paraview-1280"><a href="#Mesh.save_paraview-1280"><span class="linenos">1280</span></a><span class="sd">        dict[str, dict[str, Union[str, int]]]</span>
</span><span id="Mesh.save_paraview-1281"><a href="#Mesh.save_paraview-1281"><span class="linenos">1281</span></a><span class="sd">            Updated groups dictionary describing the generated ParaView files.</span>
</span><span id="Mesh.save_paraview-1282"><a href="#Mesh.save_paraview-1282"><span class="linenos">1282</span></a>
</span><span id="Mesh.save_paraview-1283"><a href="#Mesh.save_paraview-1283"><span class="linenos">1283</span></a><span class="sd">        Notes</span>
</span><span id="Mesh.save_paraview-1284"><a href="#Mesh.save_paraview-1284"><span class="linenos">1284</span></a><span class="sd">        -----</span>
</span><span id="Mesh.save_paraview-1285"><a href="#Mesh.save_paraview-1285"><span class="linenos">1285</span></a><span class="sd">        - This method don&#39;t modifies the internal state; it only performs evaluation and</span>
</span><span id="Mesh.save_paraview-1286"><a href="#Mesh.save_paraview-1286"><span class="linenos">1286</span></a><span class="sd">          export.</span>
</span><span id="Mesh.save_paraview-1287"><a href="#Mesh.save_paraview-1287"><span class="linenos">1287</span></a><span class="sd">        - Geometry and fields are evaluated using the current control points and splines.</span>
</span><span id="Mesh.save_paraview-1288"><a href="#Mesh.save_paraview-1288"><span class="linenos">1288</span></a><span class="sd">        - For full details on supported field formats and file organization, see</span>
</span><span id="Mesh.save_paraview-1289"><a href="#Mesh.save_paraview-1289"><span class="linenos">1289</span></a><span class="sd">          `MultiPatchBSplineConnectivity.save_paraview`.</span>
</span><span id="Mesh.save_paraview-1290"><a href="#Mesh.save_paraview-1290"><span class="linenos">1290</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Mesh.save_paraview-1291"><a href="#Mesh.save_paraview-1291"><span class="linenos">1291</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">save_paraview</span><span class="p">(</span>
</span><span id="Mesh.save_paraview-1292"><a href="#Mesh.save_paraview-1292"><span class="linenos">1292</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">,</span>
</span><span id="Mesh.save_paraview-1293"><a href="#Mesh.save_paraview-1293"><span class="linenos">1293</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_separated_ctrl_pts</span><span class="p">(),</span>
</span><span id="Mesh.save_paraview-1294"><a href="#Mesh.save_paraview-1294"><span class="linenos">1294</span></a>            <span class="n">path</span><span class="p">,</span>
</span><span id="Mesh.save_paraview-1295"><a href="#Mesh.save_paraview-1295"><span class="linenos">1295</span></a>            <span class="n">name</span><span class="p">,</span>
</span><span id="Mesh.save_paraview-1296"><a href="#Mesh.save_paraview-1296"><span class="linenos">1296</span></a>            <span class="n">n_step</span><span class="p">,</span>
</span><span id="Mesh.save_paraview-1297"><a href="#Mesh.save_paraview-1297"><span class="linenos">1297</span></a>            <span class="n">n_eval_per_elem</span><span class="p">,</span>
</span><span id="Mesh.save_paraview-1298"><a href="#Mesh.save_paraview-1298"><span class="linenos">1298</span></a>            <span class="n">unique_fields</span><span class="p">,</span>
</span><span id="Mesh.save_paraview-1299"><a href="#Mesh.save_paraview-1299"><span class="linenos">1299</span></a>            <span class="n">separated_fields</span><span class="p">,</span>
</span><span id="Mesh.save_paraview-1300"><a href="#Mesh.save_paraview-1300"><span class="linenos">1300</span></a>            <span class="n">XI_list</span><span class="p">,</span>
</span><span id="Mesh.save_paraview-1301"><a href="#Mesh.save_paraview-1301"><span class="linenos">1301</span></a>            <span class="n">groups</span><span class="p">,</span>
</span><span id="Mesh.save_paraview-1302"><a href="#Mesh.save_paraview-1302"><span class="linenos">1302</span></a>            <span class="n">make_pvd</span><span class="p">,</span>
</span><span id="Mesh.save_paraview-1303"><a href="#Mesh.save_paraview-1303"><span class="linenos">1303</span></a>            <span class="n">verbose</span><span class="p">,</span>
</span><span id="Mesh.save_paraview-1304"><a href="#Mesh.save_paraview-1304"><span class="linenos">1304</span></a>            <span class="n">fields_on_interior_only</span><span class="p">,</span>
</span><span id="Mesh.save_paraview-1305"><a href="#Mesh.save_paraview-1305"><span class="linenos">1305</span></a>            <span class="n">disable_parallel</span><span class="p">,</span>
</span><span id="Mesh.save_paraview-1306"><a href="#Mesh.save_paraview-1306"><span class="linenos">1306</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Save the mesh geometry and associated fields as ParaView-compatible files.</p>

<p>This method is a convenience wrapper around
<code>MultiPatchBSplineConnectivity.save_paraview</code>.
It evaluates the multipatch B-spline geometry represented by the current
mesh and exports several VTU files suitable for visualization in ParaView,
with an optional PVD file for grouping time steps and mesh components.</p>

<p>The following visualization meshes are generated:</p>

<ul>
<li>Interior mesh representing the evaluated B-spline geometry</li>
<li>Element borders mesh showing the patch discretization</li>
<li>Control points mesh showing the control structure</li>
</ul>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>path</strong> (str):
Directory where the ParaView files will be written.</li>
<li><strong>name</strong> (str):
Base name used for all output files.</li>
<li><strong>n_step</strong> (int, optional):
Number of time steps to export. Default is <code>1</code>.</li>
<li><strong>n_eval_per_elem</strong> (int or iterable of int, optional):
Number of evaluation points per element for each parametric dimension.
If an integer is provided, the same value is used for all dimensions.
If an iterable is provided, each value corresponds to one parametric
direction. Default is <code>10</code>.</li>
<li><strong>unique_fields</strong> (dict, optional):
Fields defined on unique control points to be exported.
Keys are field names and values are numpy arrays.
Callables are not supported here. Default is an empty dictionary.</li>
<li><strong>separated_fields</strong> (list of dict, optional):
Fields defined in separated (per-patch) representation.
Each list entry corresponds to one patch and contains a dictionary
mapping field names to field values. See
<code>MultiPatchBSplineConnectivity.save_paraview</code> for supported
formats.</li>
<li><strong>XI_list</strong> (iterable of tuple of ndarray, optional):
Parametric coordinates at which the geometry and fields are evaluated.
If provided, this overrides <code>n_eval_per_elem</code>.</li>
<li><strong>groups</strong> (dict, optional):
Dictionary describing ParaView file groups for PVD organization.
If <code>None</code>, groups are created automatically.</li>
<li><strong>make_pvd</strong> (bool, optional):
If <code>True</code>, generates a PVD file grouping all VTU files.
Default is <code>True</code>.</li>
<li><strong>verbose</strong> (bool, optional):
If <code>True</code>, prints progress information. Default is <code>True</code>.</li>
<li><strong>fields_on_interior_only</strong> (bool, "auto", or list of str, optional):
Controls on which meshes fields are written:
<ul>
<li><code>True</code>: interior mesh only</li>
<li><code>False</code>: all meshes</li>
<li><code>"auto"</code>: displacement-like fields are written on all meshes,
others only on the interior mesh</li>
<li>list of str: names of fields to include on all meshes
Default is <code>"auto"</code>.</li>
</ul></li>
<li><strong>disable_parallel</strong> (bool, optional):
If <code>True</code>, disables parallel evaluation. Default is <code>False</code>.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>dict[str, dict[str, Union[str, int]]]</strong>: Updated groups dictionary describing the generated ParaView files.</li>
</ul>

<h6 id="notes">Notes</h6>

<ul>
<li>This method don't modifies the internal state; it only performs evaluation and
export.</li>
<li>Geometry and fields are evaluated using the current control points and splines.</li>
<li>For full details on supported field formats and file organization, see
<code>MultiPatchBSplineConnectivity.save_paraview</code>.</li>
</ul>
</div>


                            </div>
                </section>
                <section id="MeshLattice">
                            <input id="MeshLattice-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">MeshLattice</span><wbr>(<span class="base"><a href="#Mesh">Mesh</a></span>):

                <label class="view-source-button" for="MeshLattice-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MeshLattice"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MeshLattice-1312"><a href="#MeshLattice-1312"><span class="linenos">1312</span></a><span class="k">class</span><span class="w"> </span><span class="nc">MeshLattice</span><span class="p">(</span><span class="n">Mesh</span><span class="p">):</span>
</span><span id="MeshLattice-1313"><a href="#MeshLattice-1313"><span class="linenos">1313</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MeshLattice-1314"><a href="#MeshLattice-1314"><span class="linenos">1314</span></a><span class="sd">    Structured lattice mesh with an explicit reference B-spline cell.</span>
</span><span id="MeshLattice-1315"><a href="#MeshLattice-1315"><span class="linenos">1315</span></a>
</span><span id="MeshLattice-1316"><a href="#MeshLattice-1316"><span class="linenos">1316</span></a><span class="sd">    This class represents a *fully instantiated* multipatch B-spline mesh that</span>
</span><span id="MeshLattice-1317"><a href="#MeshLattice-1317"><span class="linenos">1317</span></a><span class="sd">    exhibits a regular lattice structure obtained by repeating a reference cell</span>
</span><span id="MeshLattice-1318"><a href="#MeshLattice-1318"><span class="linenos">1318</span></a><span class="sd">    along three directions. The lattice structure is described by the repetition</span>
</span><span id="MeshLattice-1319"><a href="#MeshLattice-1319"><span class="linenos">1319</span></a><span class="sd">    counts `(l, m, n)`.</span>
</span><span id="MeshLattice-1320"><a href="#MeshLattice-1320"><span class="linenos">1320</span></a>
</span><span id="MeshLattice-1321"><a href="#MeshLattice-1321"><span class="linenos">1321</span></a><span class="sd">    The control points and connectivity describe the *entire lattice geometry*,</span>
</span><span id="MeshLattice-1322"><a href="#MeshLattice-1322"><span class="linenos">1322</span></a><span class="sd">    exactly as in a standard :class:`Mesh`. In contrast, the `BSpline` instances</span>
</span><span id="MeshLattice-1323"><a href="#MeshLattice-1323"><span class="linenos">1323</span></a><span class="sd">    correspond to a single reference cell and are reused for all lattice cells.</span>
</span><span id="MeshLattice-1324"><a href="#MeshLattice-1324"><span class="linenos">1324</span></a>
</span><span id="MeshLattice-1325"><a href="#MeshLattice-1325"><span class="linenos">1325</span></a><span class="sd">    `MeshLattice` therefore behaves as a standard :class:`Mesh`, while additionally</span>
</span><span id="MeshLattice-1326"><a href="#MeshLattice-1326"><span class="linenos">1326</span></a><span class="sd">    storing lattice metadata and providing utilities to extract or operate on the</span>
</span><span id="MeshLattice-1327"><a href="#MeshLattice-1327"><span class="linenos">1327</span></a><span class="sd">    reference cell only.</span>
</span><span id="MeshLattice-1328"><a href="#MeshLattice-1328"><span class="linenos">1328</span></a>
</span><span id="MeshLattice-1329"><a href="#MeshLattice-1329"><span class="linenos">1329</span></a><span class="sd">    This is a utility class, notably used to allow</span>
</span><span id="MeshLattice-1330"><a href="#MeshLattice-1330"><span class="linenos">1330</span></a><span class="sd">    :func:`VirtualImageCorrelationEnergyElem.make_image_energies` and</span>
</span><span id="MeshLattice-1331"><a href="#MeshLattice-1331"><span class="linenos">1331</span></a><span class="sd">    :func:`membrane_stiffness.make_membrane_stifness` to assemble</span>
</span><span id="MeshLattice-1332"><a href="#MeshLattice-1332"><span class="linenos">1332</span></a><span class="sd">    operators on a single cell while exploiting lattice periodicity at the algebraic</span>
</span><span id="MeshLattice-1333"><a href="#MeshLattice-1333"><span class="linenos">1333</span></a><span class="sd">    level.</span>
</span><span id="MeshLattice-1334"><a href="#MeshLattice-1334"><span class="linenos">1334</span></a>
</span><span id="MeshLattice-1335"><a href="#MeshLattice-1335"><span class="linenos">1335</span></a><span class="sd">    Attributes</span>
</span><span id="MeshLattice-1336"><a href="#MeshLattice-1336"><span class="linenos">1336</span></a><span class="sd">    ----------</span>
</span><span id="MeshLattice-1337"><a href="#MeshLattice-1337"><span class="linenos">1337</span></a><span class="sd">    l : int</span>
</span><span id="MeshLattice-1338"><a href="#MeshLattice-1338"><span class="linenos">1338</span></a><span class="sd">        Number of repetitions of the reference cell along the first lattice</span>
</span><span id="MeshLattice-1339"><a href="#MeshLattice-1339"><span class="linenos">1339</span></a><span class="sd">        direction.</span>
</span><span id="MeshLattice-1340"><a href="#MeshLattice-1340"><span class="linenos">1340</span></a><span class="sd">    m : int</span>
</span><span id="MeshLattice-1341"><a href="#MeshLattice-1341"><span class="linenos">1341</span></a><span class="sd">        Number of repetitions of the reference cell along the second lattice</span>
</span><span id="MeshLattice-1342"><a href="#MeshLattice-1342"><span class="linenos">1342</span></a><span class="sd">        direction.</span>
</span><span id="MeshLattice-1343"><a href="#MeshLattice-1343"><span class="linenos">1343</span></a><span class="sd">    n : int</span>
</span><span id="MeshLattice-1344"><a href="#MeshLattice-1344"><span class="linenos">1344</span></a><span class="sd">        Number of repetitions of the reference cell along the third lattice</span>
</span><span id="MeshLattice-1345"><a href="#MeshLattice-1345"><span class="linenos">1345</span></a><span class="sd">        direction.</span>
</span><span id="MeshLattice-1346"><a href="#MeshLattice-1346"><span class="linenos">1346</span></a>
</span><span id="MeshLattice-1347"><a href="#MeshLattice-1347"><span class="linenos">1347</span></a><span class="sd">    Notes</span>
</span><span id="MeshLattice-1348"><a href="#MeshLattice-1348"><span class="linenos">1348</span></a><span class="sd">    -----</span>
</span><span id="MeshLattice-1349"><a href="#MeshLattice-1349"><span class="linenos">1349</span></a><span class="sd">    - The lattice geometry is assumed to be fully defined at construction time.</span>
</span><span id="MeshLattice-1350"><a href="#MeshLattice-1350"><span class="linenos">1350</span></a><span class="sd">    - No geometric replication is performed internally.</span>
</span><span id="MeshLattice-1351"><a href="#MeshLattice-1351"><span class="linenos">1351</span></a><span class="sd">    - All lattice cells share identical B-spline definitions.</span>
</span><span id="MeshLattice-1352"><a href="#MeshLattice-1352"><span class="linenos">1352</span></a><span class="sd">    - The total number of patches is `l * m * n * nb_patchs_cell`.</span>
</span><span id="MeshLattice-1353"><a href="#MeshLattice-1353"><span class="linenos">1353</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="MeshLattice-1354"><a href="#MeshLattice-1354"><span class="linenos">1354</span></a>
</span><span id="MeshLattice-1355"><a href="#MeshLattice-1355"><span class="linenos">1355</span></a>    <span class="n">l</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="MeshLattice-1356"><a href="#MeshLattice-1356"><span class="linenos">1356</span></a>    <span class="n">m</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="MeshLattice-1357"><a href="#MeshLattice-1357"><span class="linenos">1357</span></a>    <span class="n">n</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="MeshLattice-1358"><a href="#MeshLattice-1358"><span class="linenos">1358</span></a>
</span><span id="MeshLattice-1359"><a href="#MeshLattice-1359"><span class="linenos">1359</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="MeshLattice-1360"><a href="#MeshLattice-1360"><span class="linenos">1360</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MeshLattice-1361"><a href="#MeshLattice-1361"><span class="linenos">1361</span></a>        <span class="n">l</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="MeshLattice-1362"><a href="#MeshLattice-1362"><span class="linenos">1362</span></a>        <span class="n">m</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="MeshLattice-1363"><a href="#MeshLattice-1363"><span class="linenos">1363</span></a>        <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="MeshLattice-1364"><a href="#MeshLattice-1364"><span class="linenos">1364</span></a>        <span class="n">splines_cell</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">BSpline</span><span class="p">],</span>
</span><span id="MeshLattice-1365"><a href="#MeshLattice-1365"><span class="linenos">1365</span></a>        <span class="n">ctrl_pts</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]],</span>
</span><span id="MeshLattice-1366"><a href="#MeshLattice-1366"><span class="linenos">1366</span></a>        <span class="n">connectivity</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">MultiPatchBSplineConnectivity</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MeshLattice-1367"><a href="#MeshLattice-1367"><span class="linenos">1367</span></a>        <span class="n">ref_inds</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MeshLattice-1368"><a href="#MeshLattice-1368"><span class="linenos">1368</span></a>    <span class="p">):</span>
</span><span id="MeshLattice-1369"><a href="#MeshLattice-1369"><span class="linenos">1369</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MeshLattice-1370"><a href="#MeshLattice-1370"><span class="linenos">1370</span></a><span class="sd">        Initialize a lattice mesh from a reference B-spline cell.</span>
</span><span id="MeshLattice-1371"><a href="#MeshLattice-1371"><span class="linenos">1371</span></a><span class="sd">        See :meth:`Mesh.__init__` for more details.</span>
</span><span id="MeshLattice-1372"><a href="#MeshLattice-1372"><span class="linenos">1372</span></a>
</span><span id="MeshLattice-1373"><a href="#MeshLattice-1373"><span class="linenos">1373</span></a><span class="sd">        Parameters</span>
</span><span id="MeshLattice-1374"><a href="#MeshLattice-1374"><span class="linenos">1374</span></a><span class="sd">        ----------</span>
</span><span id="MeshLattice-1375"><a href="#MeshLattice-1375"><span class="linenos">1375</span></a><span class="sd">        l : int</span>
</span><span id="MeshLattice-1376"><a href="#MeshLattice-1376"><span class="linenos">1376</span></a><span class="sd">            Number of repetitions along the first lattice direction.</span>
</span><span id="MeshLattice-1377"><a href="#MeshLattice-1377"><span class="linenos">1377</span></a><span class="sd">        m : int</span>
</span><span id="MeshLattice-1378"><a href="#MeshLattice-1378"><span class="linenos">1378</span></a><span class="sd">            Number of repetitions along the second lattice direction.</span>
</span><span id="MeshLattice-1379"><a href="#MeshLattice-1379"><span class="linenos">1379</span></a><span class="sd">        n : int</span>
</span><span id="MeshLattice-1380"><a href="#MeshLattice-1380"><span class="linenos">1380</span></a><span class="sd">            Number of repetitions along the third lattice direction.</span>
</span><span id="MeshLattice-1381"><a href="#MeshLattice-1381"><span class="linenos">1381</span></a><span class="sd">        splines_cell : list of BSpline</span>
</span><span id="MeshLattice-1382"><a href="#MeshLattice-1382"><span class="linenos">1382</span></a><span class="sd">            B-spline patches defining a single reference cell.</span>
</span><span id="MeshLattice-1383"><a href="#MeshLattice-1383"><span class="linenos">1383</span></a><span class="sd">        ctrl_pts : list of np.ndarray or np.ndarray</span>
</span><span id="MeshLattice-1384"><a href="#MeshLattice-1384"><span class="linenos">1384</span></a><span class="sd">            Control points of the full lattice structure, in separated or unique</span>
</span><span id="MeshLattice-1385"><a href="#MeshLattice-1385"><span class="linenos">1385</span></a><span class="sd">            representation.</span>
</span><span id="MeshLattice-1386"><a href="#MeshLattice-1386"><span class="linenos">1386</span></a><span class="sd">        connectivity : MultiPatchBSplineConnectivity or None, optional</span>
</span><span id="MeshLattice-1387"><a href="#MeshLattice-1387"><span class="linenos">1387</span></a><span class="sd">            Connectivity describing the multipatch topology of the full lattice</span>
</span><span id="MeshLattice-1388"><a href="#MeshLattice-1388"><span class="linenos">1388</span></a><span class="sd">            structure. If `None` (default), it is inferred automatically.</span>
</span><span id="MeshLattice-1389"><a href="#MeshLattice-1389"><span class="linenos">1389</span></a><span class="sd">        ref_inds : np.ndarray of int or None, optional</span>
</span><span id="MeshLattice-1390"><a href="#MeshLattice-1390"><span class="linenos">1390</span></a><span class="sd">            Optional reference indices associated with the control points.</span>
</span><span id="MeshLattice-1391"><a href="#MeshLattice-1391"><span class="linenos">1391</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MeshLattice-1392"><a href="#MeshLattice-1392"><span class="linenos">1392</span></a>        <span class="n">splines</span> <span class="o">=</span> <span class="n">splines_cell</span> <span class="o">*</span> <span class="p">(</span><span class="n">l</span> <span class="o">*</span> <span class="n">m</span> <span class="o">*</span> <span class="n">n</span><span class="p">)</span>
</span><span id="MeshLattice-1393"><a href="#MeshLattice-1393"><span class="linenos">1393</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="MeshLattice-1394"><a href="#MeshLattice-1394"><span class="linenos">1394</span></a>            <span class="n">splines</span><span class="p">,</span> <span class="n">ctrl_pts</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="n">connectivity</span><span class="p">,</span> <span class="n">ref_inds</span><span class="o">=</span><span class="n">ref_inds</span>
</span><span id="MeshLattice-1395"><a href="#MeshLattice-1395"><span class="linenos">1395</span></a>        <span class="p">)</span>
</span><span id="MeshLattice-1396"><a href="#MeshLattice-1396"><span class="linenos">1396</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">l</span> <span class="o">=</span> <span class="n">l</span>
</span><span id="MeshLattice-1397"><a href="#MeshLattice-1397"><span class="linenos">1397</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">m</span>
</span><span id="MeshLattice-1398"><a href="#MeshLattice-1398"><span class="linenos">1398</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>
</span><span id="MeshLattice-1399"><a href="#MeshLattice-1399"><span class="linenos">1399</span></a>
</span><span id="MeshLattice-1400"><a href="#MeshLattice-1400"><span class="linenos">1400</span></a>    <span class="nd">@classmethod</span>
</span><span id="MeshLattice-1401"><a href="#MeshLattice-1401"><span class="linenos">1401</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_mesh</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">mesh</span><span class="p">:</span> <span class="n">Mesh</span><span class="p">,</span> <span class="n">l</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MeshLattice&quot;</span><span class="p">:</span>
</span><span id="MeshLattice-1402"><a href="#MeshLattice-1402"><span class="linenos">1402</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MeshLattice-1403"><a href="#MeshLattice-1403"><span class="linenos">1403</span></a><span class="sd">        Construct a lattice mesh from an existing mesh.</span>
</span><span id="MeshLattice-1404"><a href="#MeshLattice-1404"><span class="linenos">1404</span></a>
</span><span id="MeshLattice-1405"><a href="#MeshLattice-1405"><span class="linenos">1405</span></a><span class="sd">        This method interprets the input `mesh` as a lattice composed of</span>
</span><span id="MeshLattice-1406"><a href="#MeshLattice-1406"><span class="linenos">1406</span></a><span class="sd">        `l * m * n` identical cells and reconstructs a :class:`MeshLattice`</span>
</span><span id="MeshLattice-1407"><a href="#MeshLattice-1407"><span class="linenos">1407</span></a><span class="sd">        instance using the corresponding reference cell splines.</span>
</span><span id="MeshLattice-1408"><a href="#MeshLattice-1408"><span class="linenos">1408</span></a>
</span><span id="MeshLattice-1409"><a href="#MeshLattice-1409"><span class="linenos">1409</span></a><span class="sd">        Parameters</span>
</span><span id="MeshLattice-1410"><a href="#MeshLattice-1410"><span class="linenos">1410</span></a><span class="sd">        ----------</span>
</span><span id="MeshLattice-1411"><a href="#MeshLattice-1411"><span class="linenos">1411</span></a><span class="sd">        mesh : Mesh</span>
</span><span id="MeshLattice-1412"><a href="#MeshLattice-1412"><span class="linenos">1412</span></a><span class="sd">            Existing mesh representing a lattice geometry.</span>
</span><span id="MeshLattice-1413"><a href="#MeshLattice-1413"><span class="linenos">1413</span></a><span class="sd">        l : int</span>
</span><span id="MeshLattice-1414"><a href="#MeshLattice-1414"><span class="linenos">1414</span></a><span class="sd">            Number of repetitions along the first lattice direction.</span>
</span><span id="MeshLattice-1415"><a href="#MeshLattice-1415"><span class="linenos">1415</span></a><span class="sd">        m : int</span>
</span><span id="MeshLattice-1416"><a href="#MeshLattice-1416"><span class="linenos">1416</span></a><span class="sd">            Number of repetitions along the second lattice direction.</span>
</span><span id="MeshLattice-1417"><a href="#MeshLattice-1417"><span class="linenos">1417</span></a><span class="sd">        n : int</span>
</span><span id="MeshLattice-1418"><a href="#MeshLattice-1418"><span class="linenos">1418</span></a><span class="sd">            Number of repetitions along the third lattice direction.</span>
</span><span id="MeshLattice-1419"><a href="#MeshLattice-1419"><span class="linenos">1419</span></a>
</span><span id="MeshLattice-1420"><a href="#MeshLattice-1420"><span class="linenos">1420</span></a><span class="sd">        Returns</span>
</span><span id="MeshLattice-1421"><a href="#MeshLattice-1421"><span class="linenos">1421</span></a><span class="sd">        -------</span>
</span><span id="MeshLattice-1422"><a href="#MeshLattice-1422"><span class="linenos">1422</span></a><span class="sd">        MeshLattice</span>
</span><span id="MeshLattice-1423"><a href="#MeshLattice-1423"><span class="linenos">1423</span></a><span class="sd">            A lattice mesh sharing the control points, connectivity and</span>
</span><span id="MeshLattice-1424"><a href="#MeshLattice-1424"><span class="linenos">1424</span></a><span class="sd">            reference indices of `mesh`.</span>
</span><span id="MeshLattice-1425"><a href="#MeshLattice-1425"><span class="linenos">1425</span></a>
</span><span id="MeshLattice-1426"><a href="#MeshLattice-1426"><span class="linenos">1426</span></a><span class="sd">        Notes</span>
</span><span id="MeshLattice-1427"><a href="#MeshLattice-1427"><span class="linenos">1427</span></a><span class="sd">        -----</span>
</span><span id="MeshLattice-1428"><a href="#MeshLattice-1428"><span class="linenos">1428</span></a><span class="sd">        - The reference cell is inferred from the first</span>
</span><span id="MeshLattice-1429"><a href="#MeshLattice-1429"><span class="linenos">1429</span></a><span class="sd">          `mesh.connectivity.nb_patchs // (l * m * n)` patches.</span>
</span><span id="MeshLattice-1430"><a href="#MeshLattice-1430"><span class="linenos">1430</span></a><span class="sd">        - No geometry or connectivity modification is performed; the operation</span>
</span><span id="MeshLattice-1431"><a href="#MeshLattice-1431"><span class="linenos">1431</span></a><span class="sd">          is purely structural.</span>
</span><span id="MeshLattice-1432"><a href="#MeshLattice-1432"><span class="linenos">1432</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MeshLattice-1433"><a href="#MeshLattice-1433"><span class="linenos">1433</span></a>        <span class="n">splines_cell</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">splines</span><span class="p">[:</span> <span class="n">mesh</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_patchs</span> <span class="o">//</span> <span class="p">(</span><span class="n">l</span> <span class="o">*</span> <span class="n">m</span> <span class="o">*</span> <span class="n">n</span><span class="p">)]</span>
</span><span id="MeshLattice-1434"><a href="#MeshLattice-1434"><span class="linenos">1434</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
</span><span id="MeshLattice-1435"><a href="#MeshLattice-1435"><span class="linenos">1435</span></a>            <span class="n">l</span><span class="p">,</span>
</span><span id="MeshLattice-1436"><a href="#MeshLattice-1436"><span class="linenos">1436</span></a>            <span class="n">m</span><span class="p">,</span>
</span><span id="MeshLattice-1437"><a href="#MeshLattice-1437"><span class="linenos">1437</span></a>            <span class="n">n</span><span class="p">,</span>
</span><span id="MeshLattice-1438"><a href="#MeshLattice-1438"><span class="linenos">1438</span></a>            <span class="n">splines_cell</span><span class="p">,</span>
</span><span id="MeshLattice-1439"><a href="#MeshLattice-1439"><span class="linenos">1439</span></a>            <span class="n">mesh</span><span class="o">.</span><span class="n">unique_ctrl_pts</span><span class="p">,</span>
</span><span id="MeshLattice-1440"><a href="#MeshLattice-1440"><span class="linenos">1440</span></a>            <span class="n">mesh</span><span class="o">.</span><span class="n">connectivity</span><span class="p">,</span>
</span><span id="MeshLattice-1441"><a href="#MeshLattice-1441"><span class="linenos">1441</span></a>            <span class="n">mesh</span><span class="o">.</span><span class="n">ref_inds</span><span class="p">,</span>
</span><span id="MeshLattice-1442"><a href="#MeshLattice-1442"><span class="linenos">1442</span></a>        <span class="p">)</span>
</span><span id="MeshLattice-1443"><a href="#MeshLattice-1443"><span class="linenos">1443</span></a>
</span><span id="MeshLattice-1444"><a href="#MeshLattice-1444"><span class="linenos">1444</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_mesh_cell_one</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mesh</span><span class="p">:</span>
</span><span id="MeshLattice-1445"><a href="#MeshLattice-1445"><span class="linenos">1445</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MeshLattice-1446"><a href="#MeshLattice-1446"><span class="linenos">1446</span></a><span class="sd">        Extract the reference cell mesh corresponding to a single lattice cell.</span>
</span><span id="MeshLattice-1447"><a href="#MeshLattice-1447"><span class="linenos">1447</span></a>
</span><span id="MeshLattice-1448"><a href="#MeshLattice-1448"><span class="linenos">1448</span></a><span class="sd">        This method returns a :class:`Mesh` representing one reference cell of</span>
</span><span id="MeshLattice-1449"><a href="#MeshLattice-1449"><span class="linenos">1449</span></a><span class="sd">        the lattice, including:</span>
</span><span id="MeshLattice-1450"><a href="#MeshLattice-1450"><span class="linenos">1450</span></a><span class="sd">        - the corresponding subset of splines,</span>
</span><span id="MeshLattice-1451"><a href="#MeshLattice-1451"><span class="linenos">1451</span></a><span class="sd">        - the associated control points,</span>
</span><span id="MeshLattice-1452"><a href="#MeshLattice-1452"><span class="linenos">1452</span></a><span class="sd">        - a reduced connectivity.</span>
</span><span id="MeshLattice-1453"><a href="#MeshLattice-1453"><span class="linenos">1453</span></a>
</span><span id="MeshLattice-1454"><a href="#MeshLattice-1454"><span class="linenos">1454</span></a><span class="sd">        Returns</span>
</span><span id="MeshLattice-1455"><a href="#MeshLattice-1455"><span class="linenos">1455</span></a><span class="sd">        -------</span>
</span><span id="MeshLattice-1456"><a href="#MeshLattice-1456"><span class="linenos">1456</span></a><span class="sd">        Mesh</span>
</span><span id="MeshLattice-1457"><a href="#MeshLattice-1457"><span class="linenos">1457</span></a><span class="sd">            Mesh corresponding to a single lattice cell.</span>
</span><span id="MeshLattice-1458"><a href="#MeshLattice-1458"><span class="linenos">1458</span></a>
</span><span id="MeshLattice-1459"><a href="#MeshLattice-1459"><span class="linenos">1459</span></a><span class="sd">        Notes</span>
</span><span id="MeshLattice-1460"><a href="#MeshLattice-1460"><span class="linenos">1460</span></a><span class="sd">        -----</span>
</span><span id="MeshLattice-1461"><a href="#MeshLattice-1461"><span class="linenos">1461</span></a><span class="sd">        - The returned mesh is independent from the lattice structure but</span>
</span><span id="MeshLattice-1462"><a href="#MeshLattice-1462"><span class="linenos">1462</span></a><span class="sd">          shares the same control point values.</span>
</span><span id="MeshLattice-1463"><a href="#MeshLattice-1463"><span class="linenos">1463</span></a><span class="sd">        - This is typically used for analysis or visualization of the unit cell.</span>
</span><span id="MeshLattice-1464"><a href="#MeshLattice-1464"><span class="linenos">1464</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MeshLattice-1465"><a href="#MeshLattice-1465"><span class="linenos">1465</span></a>        <span class="n">splines</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_patchs</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
</span><span id="MeshLattice-1466"><a href="#MeshLattice-1466"><span class="linenos">1466</span></a>        <span class="n">splines</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span>
</span><span id="MeshLattice-1467"><a href="#MeshLattice-1467"><span class="linenos">1467</span></a>        <span class="n">nb_patchs_cell</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">)</span> <span class="o">//</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
</span><span id="MeshLattice-1468"><a href="#MeshLattice-1468"><span class="linenos">1468</span></a>        <span class="n">connectivity_cell</span><span class="p">,</span> <span class="n">splines_cell</span><span class="p">,</span> <span class="n">full_to_cell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span>
</span><span id="MeshLattice-1469"><a href="#MeshLattice-1469"><span class="linenos">1469</span></a>            <span class="n">splines</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nb_patchs_cell</span><span class="p">)</span>
</span><span id="MeshLattice-1470"><a href="#MeshLattice-1470"><span class="linenos">1470</span></a>        <span class="p">)</span>
</span><span id="MeshLattice-1471"><a href="#MeshLattice-1471"><span class="linenos">1471</span></a>        <span class="n">mesh_cell</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">(</span>
</span><span id="MeshLattice-1472"><a href="#MeshLattice-1472"><span class="linenos">1472</span></a>            <span class="nb">list</span><span class="p">(</span><span class="n">splines_cell</span><span class="p">),</span>
</span><span id="MeshLattice-1473"><a href="#MeshLattice-1473"><span class="linenos">1473</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">unique_ctrl_pts</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">full_to_cell</span><span class="p">],</span>
</span><span id="MeshLattice-1474"><a href="#MeshLattice-1474"><span class="linenos">1474</span></a>            <span class="n">connectivity</span><span class="o">=</span><span class="n">connectivity_cell</span><span class="p">,</span>
</span><span id="MeshLattice-1475"><a href="#MeshLattice-1475"><span class="linenos">1475</span></a>            <span class="n">ref_inds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_inds</span><span class="p">[</span><span class="n">full_to_cell</span><span class="p">],</span>
</span><span id="MeshLattice-1476"><a href="#MeshLattice-1476"><span class="linenos">1476</span></a>        <span class="p">)</span>
</span><span id="MeshLattice-1477"><a href="#MeshLattice-1477"><span class="linenos">1477</span></a>        <span class="k">return</span> <span class="n">mesh_cell</span>
</span><span id="MeshLattice-1478"><a href="#MeshLattice-1478"><span class="linenos">1478</span></a>
</span><span id="MeshLattice-1479"><a href="#MeshLattice-1479"><span class="linenos">1479</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_nb_patchs_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="MeshLattice-1480"><a href="#MeshLattice-1480"><span class="linenos">1480</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MeshLattice-1481"><a href="#MeshLattice-1481"><span class="linenos">1481</span></a><span class="sd">        Return the number of patches in a single lattice cell.</span>
</span><span id="MeshLattice-1482"><a href="#MeshLattice-1482"><span class="linenos">1482</span></a>
</span><span id="MeshLattice-1483"><a href="#MeshLattice-1483"><span class="linenos">1483</span></a><span class="sd">        Returns</span>
</span><span id="MeshLattice-1484"><a href="#MeshLattice-1484"><span class="linenos">1484</span></a><span class="sd">        -------</span>
</span><span id="MeshLattice-1485"><a href="#MeshLattice-1485"><span class="linenos">1485</span></a><span class="sd">        int</span>
</span><span id="MeshLattice-1486"><a href="#MeshLattice-1486"><span class="linenos">1486</span></a><span class="sd">            Number of B-spline patches defining the reference cell.</span>
</span><span id="MeshLattice-1487"><a href="#MeshLattice-1487"><span class="linenos">1487</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MeshLattice-1488"><a href="#MeshLattice-1488"><span class="linenos">1488</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_patchs</span> <span class="o">//</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Structured lattice mesh with an explicit reference B-spline cell.</p>

<p>This class represents a <em>fully instantiated</em> multipatch B-spline mesh that
exhibits a regular lattice structure obtained by repeating a reference cell
along three directions. The lattice structure is described by the repetition
counts <code>(l, m, n)</code>.</p>

<p>The control points and connectivity describe the <em>entire lattice geometry</em>,
exactly as in a standard <code><a href="#Mesh">Mesh</a></code>. In contrast, the <code>BSpline</code> instances
correspond to a single reference cell and are reused for all lattice cells.</p>

<p><code><a href="#MeshLattice">MeshLattice</a></code> therefore behaves as a standard <code><a href="#Mesh">Mesh</a></code>, while additionally
storing lattice metadata and providing utilities to extract or operate on the
reference cell only.</p>

<p>This is a utility class, notably used to allow
<code>VirtualImageCorrelationEnergyElem.make_image_energies()</code> and
<code>membrane_stiffness.make_membrane_stifness()</code> to assemble
operators on a single cell while exploiting lattice periodicity at the algebraic
level.</p>

<h6 id="attributes">Attributes</h6>

<ul>
<li><strong>l</strong> (int):
Number of repetitions of the reference cell along the first lattice
direction.</li>
<li><strong>m</strong> (int):
Number of repetitions of the reference cell along the second lattice
direction.</li>
<li><strong>n</strong> (int):
Number of repetitions of the reference cell along the third lattice
direction.</li>
</ul>

<h6 id="notes">Notes</h6>

<ul>
<li>The lattice geometry is assumed to be fully defined at construction time.</li>
<li>No geometric replication is performed internally.</li>
<li>All lattice cells share identical B-spline definitions.</li>
<li>The total number of patches is <code>l * m * n * nb_patchs_cell</code>.</li>
</ul>
</div>


                            <div id="MeshLattice.__init__" class="classattr">
                                        <input id="MeshLattice.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">MeshLattice</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">l</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">m</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">n</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">splines_cell</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">bsplyne</span><span class="o">.</span><span class="n">b_spline</span><span class="o">.</span><span class="n">BSpline</span><span class="p">]</span>,</span><span class="param">	<span class="n">ctrl_pts</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">]]</span>,</span><span class="param">	<span class="n">connectivity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">bsplyne</span><span class="o">.</span><span class="n">multi_patch_b_spline</span><span class="o">.</span><span class="n">MultiPatchBSplineConnectivity</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">ref_inds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">integer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="MeshLattice.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MeshLattice.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MeshLattice.__init__-1359"><a href="#MeshLattice.__init__-1359"><span class="linenos">1359</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="MeshLattice.__init__-1360"><a href="#MeshLattice.__init__-1360"><span class="linenos">1360</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MeshLattice.__init__-1361"><a href="#MeshLattice.__init__-1361"><span class="linenos">1361</span></a>        <span class="n">l</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="MeshLattice.__init__-1362"><a href="#MeshLattice.__init__-1362"><span class="linenos">1362</span></a>        <span class="n">m</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="MeshLattice.__init__-1363"><a href="#MeshLattice.__init__-1363"><span class="linenos">1363</span></a>        <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="MeshLattice.__init__-1364"><a href="#MeshLattice.__init__-1364"><span class="linenos">1364</span></a>        <span class="n">splines_cell</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">BSpline</span><span class="p">],</span>
</span><span id="MeshLattice.__init__-1365"><a href="#MeshLattice.__init__-1365"><span class="linenos">1365</span></a>        <span class="n">ctrl_pts</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]],</span>
</span><span id="MeshLattice.__init__-1366"><a href="#MeshLattice.__init__-1366"><span class="linenos">1366</span></a>        <span class="n">connectivity</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">MultiPatchBSplineConnectivity</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MeshLattice.__init__-1367"><a href="#MeshLattice.__init__-1367"><span class="linenos">1367</span></a>        <span class="n">ref_inds</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MeshLattice.__init__-1368"><a href="#MeshLattice.__init__-1368"><span class="linenos">1368</span></a>    <span class="p">):</span>
</span><span id="MeshLattice.__init__-1369"><a href="#MeshLattice.__init__-1369"><span class="linenos">1369</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MeshLattice.__init__-1370"><a href="#MeshLattice.__init__-1370"><span class="linenos">1370</span></a><span class="sd">        Initialize a lattice mesh from a reference B-spline cell.</span>
</span><span id="MeshLattice.__init__-1371"><a href="#MeshLattice.__init__-1371"><span class="linenos">1371</span></a><span class="sd">        See :meth:`Mesh.__init__` for more details.</span>
</span><span id="MeshLattice.__init__-1372"><a href="#MeshLattice.__init__-1372"><span class="linenos">1372</span></a>
</span><span id="MeshLattice.__init__-1373"><a href="#MeshLattice.__init__-1373"><span class="linenos">1373</span></a><span class="sd">        Parameters</span>
</span><span id="MeshLattice.__init__-1374"><a href="#MeshLattice.__init__-1374"><span class="linenos">1374</span></a><span class="sd">        ----------</span>
</span><span id="MeshLattice.__init__-1375"><a href="#MeshLattice.__init__-1375"><span class="linenos">1375</span></a><span class="sd">        l : int</span>
</span><span id="MeshLattice.__init__-1376"><a href="#MeshLattice.__init__-1376"><span class="linenos">1376</span></a><span class="sd">            Number of repetitions along the first lattice direction.</span>
</span><span id="MeshLattice.__init__-1377"><a href="#MeshLattice.__init__-1377"><span class="linenos">1377</span></a><span class="sd">        m : int</span>
</span><span id="MeshLattice.__init__-1378"><a href="#MeshLattice.__init__-1378"><span class="linenos">1378</span></a><span class="sd">            Number of repetitions along the second lattice direction.</span>
</span><span id="MeshLattice.__init__-1379"><a href="#MeshLattice.__init__-1379"><span class="linenos">1379</span></a><span class="sd">        n : int</span>
</span><span id="MeshLattice.__init__-1380"><a href="#MeshLattice.__init__-1380"><span class="linenos">1380</span></a><span class="sd">            Number of repetitions along the third lattice direction.</span>
</span><span id="MeshLattice.__init__-1381"><a href="#MeshLattice.__init__-1381"><span class="linenos">1381</span></a><span class="sd">        splines_cell : list of BSpline</span>
</span><span id="MeshLattice.__init__-1382"><a href="#MeshLattice.__init__-1382"><span class="linenos">1382</span></a><span class="sd">            B-spline patches defining a single reference cell.</span>
</span><span id="MeshLattice.__init__-1383"><a href="#MeshLattice.__init__-1383"><span class="linenos">1383</span></a><span class="sd">        ctrl_pts : list of np.ndarray or np.ndarray</span>
</span><span id="MeshLattice.__init__-1384"><a href="#MeshLattice.__init__-1384"><span class="linenos">1384</span></a><span class="sd">            Control points of the full lattice structure, in separated or unique</span>
</span><span id="MeshLattice.__init__-1385"><a href="#MeshLattice.__init__-1385"><span class="linenos">1385</span></a><span class="sd">            representation.</span>
</span><span id="MeshLattice.__init__-1386"><a href="#MeshLattice.__init__-1386"><span class="linenos">1386</span></a><span class="sd">        connectivity : MultiPatchBSplineConnectivity or None, optional</span>
</span><span id="MeshLattice.__init__-1387"><a href="#MeshLattice.__init__-1387"><span class="linenos">1387</span></a><span class="sd">            Connectivity describing the multipatch topology of the full lattice</span>
</span><span id="MeshLattice.__init__-1388"><a href="#MeshLattice.__init__-1388"><span class="linenos">1388</span></a><span class="sd">            structure. If `None` (default), it is inferred automatically.</span>
</span><span id="MeshLattice.__init__-1389"><a href="#MeshLattice.__init__-1389"><span class="linenos">1389</span></a><span class="sd">        ref_inds : np.ndarray of int or None, optional</span>
</span><span id="MeshLattice.__init__-1390"><a href="#MeshLattice.__init__-1390"><span class="linenos">1390</span></a><span class="sd">            Optional reference indices associated with the control points.</span>
</span><span id="MeshLattice.__init__-1391"><a href="#MeshLattice.__init__-1391"><span class="linenos">1391</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MeshLattice.__init__-1392"><a href="#MeshLattice.__init__-1392"><span class="linenos">1392</span></a>        <span class="n">splines</span> <span class="o">=</span> <span class="n">splines_cell</span> <span class="o">*</span> <span class="p">(</span><span class="n">l</span> <span class="o">*</span> <span class="n">m</span> <span class="o">*</span> <span class="n">n</span><span class="p">)</span>
</span><span id="MeshLattice.__init__-1393"><a href="#MeshLattice.__init__-1393"><span class="linenos">1393</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="MeshLattice.__init__-1394"><a href="#MeshLattice.__init__-1394"><span class="linenos">1394</span></a>            <span class="n">splines</span><span class="p">,</span> <span class="n">ctrl_pts</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="n">connectivity</span><span class="p">,</span> <span class="n">ref_inds</span><span class="o">=</span><span class="n">ref_inds</span>
</span><span id="MeshLattice.__init__-1395"><a href="#MeshLattice.__init__-1395"><span class="linenos">1395</span></a>        <span class="p">)</span>
</span><span id="MeshLattice.__init__-1396"><a href="#MeshLattice.__init__-1396"><span class="linenos">1396</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">l</span> <span class="o">=</span> <span class="n">l</span>
</span><span id="MeshLattice.__init__-1397"><a href="#MeshLattice.__init__-1397"><span class="linenos">1397</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">m</span>
</span><span id="MeshLattice.__init__-1398"><a href="#MeshLattice.__init__-1398"><span class="linenos">1398</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>
</span></pre></div>


            <div class="docstring"><p>Initialize a lattice mesh from a reference B-spline cell.
See <code><a href="#Mesh.__init__">Mesh.__init__()</a></code> for more details.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>l</strong> (int):
Number of repetitions along the first lattice direction.</li>
<li><strong>m</strong> (int):
Number of repetitions along the second lattice direction.</li>
<li><strong>n</strong> (int):
Number of repetitions along the third lattice direction.</li>
<li><strong>splines_cell</strong> (list of BSpline):
B-spline patches defining a single reference cell.</li>
<li><strong>ctrl_pts</strong> (list of np.ndarray or np.ndarray):
Control points of the full lattice structure, in separated or unique
representation.</li>
<li><strong>connectivity</strong> (MultiPatchBSplineConnectivity or None, optional):
Connectivity describing the multipatch topology of the full lattice
structure. If <code>None</code> (default), it is inferred automatically.</li>
<li><strong>ref_inds</strong> (np.ndarray of int or None, optional):
Optional reference indices associated with the control points.</li>
</ul>
</div>


                            </div>
                            <div id="MeshLattice.l" class="classattr">
                                <div class="attr variable">
            <span class="name">l</span><span class="annotation">: int</span>

        
    </div>
    <a class="headerlink" href="#MeshLattice.l"></a>
    
    

                            </div>
                            <div id="MeshLattice.m" class="classattr">
                                <div class="attr variable">
            <span class="name">m</span><span class="annotation">: int</span>

        
    </div>
    <a class="headerlink" href="#MeshLattice.m"></a>
    
    

                            </div>
                            <div id="MeshLattice.n" class="classattr">
                                <div class="attr variable">
            <span class="name">n</span><span class="annotation">: int</span>

        
    </div>
    <a class="headerlink" href="#MeshLattice.n"></a>
    
    

                            </div>
                            <div id="MeshLattice.from_mesh" class="classattr">
                                        <input id="MeshLattice.from_mesh-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-classmethod">@classmethod</div>

        <span class="def">def</span>
        <span class="name">from_mesh</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">cls</span>,</span><span class="param">	<span class="n">mesh</span><span class="p">:</span> <span class="n"><a href="#Mesh">Mesh</a></span>,</span><span class="param">	<span class="n">l</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">m</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">n</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="n"><a href="#MeshLattice">MeshLattice</a></span>:</span></span>

                <label class="view-source-button" for="MeshLattice.from_mesh-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MeshLattice.from_mesh"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MeshLattice.from_mesh-1400"><a href="#MeshLattice.from_mesh-1400"><span class="linenos">1400</span></a>    <span class="nd">@classmethod</span>
</span><span id="MeshLattice.from_mesh-1401"><a href="#MeshLattice.from_mesh-1401"><span class="linenos">1401</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_mesh</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">mesh</span><span class="p">:</span> <span class="n">Mesh</span><span class="p">,</span> <span class="n">l</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MeshLattice&quot;</span><span class="p">:</span>
</span><span id="MeshLattice.from_mesh-1402"><a href="#MeshLattice.from_mesh-1402"><span class="linenos">1402</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MeshLattice.from_mesh-1403"><a href="#MeshLattice.from_mesh-1403"><span class="linenos">1403</span></a><span class="sd">        Construct a lattice mesh from an existing mesh.</span>
</span><span id="MeshLattice.from_mesh-1404"><a href="#MeshLattice.from_mesh-1404"><span class="linenos">1404</span></a>
</span><span id="MeshLattice.from_mesh-1405"><a href="#MeshLattice.from_mesh-1405"><span class="linenos">1405</span></a><span class="sd">        This method interprets the input `mesh` as a lattice composed of</span>
</span><span id="MeshLattice.from_mesh-1406"><a href="#MeshLattice.from_mesh-1406"><span class="linenos">1406</span></a><span class="sd">        `l * m * n` identical cells and reconstructs a :class:`MeshLattice`</span>
</span><span id="MeshLattice.from_mesh-1407"><a href="#MeshLattice.from_mesh-1407"><span class="linenos">1407</span></a><span class="sd">        instance using the corresponding reference cell splines.</span>
</span><span id="MeshLattice.from_mesh-1408"><a href="#MeshLattice.from_mesh-1408"><span class="linenos">1408</span></a>
</span><span id="MeshLattice.from_mesh-1409"><a href="#MeshLattice.from_mesh-1409"><span class="linenos">1409</span></a><span class="sd">        Parameters</span>
</span><span id="MeshLattice.from_mesh-1410"><a href="#MeshLattice.from_mesh-1410"><span class="linenos">1410</span></a><span class="sd">        ----------</span>
</span><span id="MeshLattice.from_mesh-1411"><a href="#MeshLattice.from_mesh-1411"><span class="linenos">1411</span></a><span class="sd">        mesh : Mesh</span>
</span><span id="MeshLattice.from_mesh-1412"><a href="#MeshLattice.from_mesh-1412"><span class="linenos">1412</span></a><span class="sd">            Existing mesh representing a lattice geometry.</span>
</span><span id="MeshLattice.from_mesh-1413"><a href="#MeshLattice.from_mesh-1413"><span class="linenos">1413</span></a><span class="sd">        l : int</span>
</span><span id="MeshLattice.from_mesh-1414"><a href="#MeshLattice.from_mesh-1414"><span class="linenos">1414</span></a><span class="sd">            Number of repetitions along the first lattice direction.</span>
</span><span id="MeshLattice.from_mesh-1415"><a href="#MeshLattice.from_mesh-1415"><span class="linenos">1415</span></a><span class="sd">        m : int</span>
</span><span id="MeshLattice.from_mesh-1416"><a href="#MeshLattice.from_mesh-1416"><span class="linenos">1416</span></a><span class="sd">            Number of repetitions along the second lattice direction.</span>
</span><span id="MeshLattice.from_mesh-1417"><a href="#MeshLattice.from_mesh-1417"><span class="linenos">1417</span></a><span class="sd">        n : int</span>
</span><span id="MeshLattice.from_mesh-1418"><a href="#MeshLattice.from_mesh-1418"><span class="linenos">1418</span></a><span class="sd">            Number of repetitions along the third lattice direction.</span>
</span><span id="MeshLattice.from_mesh-1419"><a href="#MeshLattice.from_mesh-1419"><span class="linenos">1419</span></a>
</span><span id="MeshLattice.from_mesh-1420"><a href="#MeshLattice.from_mesh-1420"><span class="linenos">1420</span></a><span class="sd">        Returns</span>
</span><span id="MeshLattice.from_mesh-1421"><a href="#MeshLattice.from_mesh-1421"><span class="linenos">1421</span></a><span class="sd">        -------</span>
</span><span id="MeshLattice.from_mesh-1422"><a href="#MeshLattice.from_mesh-1422"><span class="linenos">1422</span></a><span class="sd">        MeshLattice</span>
</span><span id="MeshLattice.from_mesh-1423"><a href="#MeshLattice.from_mesh-1423"><span class="linenos">1423</span></a><span class="sd">            A lattice mesh sharing the control points, connectivity and</span>
</span><span id="MeshLattice.from_mesh-1424"><a href="#MeshLattice.from_mesh-1424"><span class="linenos">1424</span></a><span class="sd">            reference indices of `mesh`.</span>
</span><span id="MeshLattice.from_mesh-1425"><a href="#MeshLattice.from_mesh-1425"><span class="linenos">1425</span></a>
</span><span id="MeshLattice.from_mesh-1426"><a href="#MeshLattice.from_mesh-1426"><span class="linenos">1426</span></a><span class="sd">        Notes</span>
</span><span id="MeshLattice.from_mesh-1427"><a href="#MeshLattice.from_mesh-1427"><span class="linenos">1427</span></a><span class="sd">        -----</span>
</span><span id="MeshLattice.from_mesh-1428"><a href="#MeshLattice.from_mesh-1428"><span class="linenos">1428</span></a><span class="sd">        - The reference cell is inferred from the first</span>
</span><span id="MeshLattice.from_mesh-1429"><a href="#MeshLattice.from_mesh-1429"><span class="linenos">1429</span></a><span class="sd">          `mesh.connectivity.nb_patchs // (l * m * n)` patches.</span>
</span><span id="MeshLattice.from_mesh-1430"><a href="#MeshLattice.from_mesh-1430"><span class="linenos">1430</span></a><span class="sd">        - No geometry or connectivity modification is performed; the operation</span>
</span><span id="MeshLattice.from_mesh-1431"><a href="#MeshLattice.from_mesh-1431"><span class="linenos">1431</span></a><span class="sd">          is purely structural.</span>
</span><span id="MeshLattice.from_mesh-1432"><a href="#MeshLattice.from_mesh-1432"><span class="linenos">1432</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MeshLattice.from_mesh-1433"><a href="#MeshLattice.from_mesh-1433"><span class="linenos">1433</span></a>        <span class="n">splines_cell</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">splines</span><span class="p">[:</span> <span class="n">mesh</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_patchs</span> <span class="o">//</span> <span class="p">(</span><span class="n">l</span> <span class="o">*</span> <span class="n">m</span> <span class="o">*</span> <span class="n">n</span><span class="p">)]</span>
</span><span id="MeshLattice.from_mesh-1434"><a href="#MeshLattice.from_mesh-1434"><span class="linenos">1434</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
</span><span id="MeshLattice.from_mesh-1435"><a href="#MeshLattice.from_mesh-1435"><span class="linenos">1435</span></a>            <span class="n">l</span><span class="p">,</span>
</span><span id="MeshLattice.from_mesh-1436"><a href="#MeshLattice.from_mesh-1436"><span class="linenos">1436</span></a>            <span class="n">m</span><span class="p">,</span>
</span><span id="MeshLattice.from_mesh-1437"><a href="#MeshLattice.from_mesh-1437"><span class="linenos">1437</span></a>            <span class="n">n</span><span class="p">,</span>
</span><span id="MeshLattice.from_mesh-1438"><a href="#MeshLattice.from_mesh-1438"><span class="linenos">1438</span></a>            <span class="n">splines_cell</span><span class="p">,</span>
</span><span id="MeshLattice.from_mesh-1439"><a href="#MeshLattice.from_mesh-1439"><span class="linenos">1439</span></a>            <span class="n">mesh</span><span class="o">.</span><span class="n">unique_ctrl_pts</span><span class="p">,</span>
</span><span id="MeshLattice.from_mesh-1440"><a href="#MeshLattice.from_mesh-1440"><span class="linenos">1440</span></a>            <span class="n">mesh</span><span class="o">.</span><span class="n">connectivity</span><span class="p">,</span>
</span><span id="MeshLattice.from_mesh-1441"><a href="#MeshLattice.from_mesh-1441"><span class="linenos">1441</span></a>            <span class="n">mesh</span><span class="o">.</span><span class="n">ref_inds</span><span class="p">,</span>
</span><span id="MeshLattice.from_mesh-1442"><a href="#MeshLattice.from_mesh-1442"><span class="linenos">1442</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Construct a lattice mesh from an existing mesh.</p>

<p>This method interprets the input <code>mesh</code> as a lattice composed of
<code>l * m * n</code> identical cells and reconstructs a <code><a href="#MeshLattice">MeshLattice</a></code>
instance using the corresponding reference cell splines.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>mesh</strong> (Mesh):
Existing mesh representing a lattice geometry.</li>
<li><strong>l</strong> (int):
Number of repetitions along the first lattice direction.</li>
<li><strong>m</strong> (int):
Number of repetitions along the second lattice direction.</li>
<li><strong>n</strong> (int):
Number of repetitions along the third lattice direction.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>MeshLattice</strong>: A lattice mesh sharing the control points, connectivity and
reference indices of <code>mesh</code>.</li>
</ul>

<h6 id="notes">Notes</h6>

<ul>
<li>The reference cell is inferred from the first
<code>mesh.connectivity.nb_patchs // (l * m * n)</code> patches.</li>
<li>No geometry or connectivity modification is performed; the operation
is purely structural.</li>
</ul>
</div>


                            </div>
                            <div id="MeshLattice.get_mesh_cell_one" class="classattr">
                                        <input id="MeshLattice.get_mesh_cell_one-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_mesh_cell_one</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#Mesh">Mesh</a></span>:</span></span>

                <label class="view-source-button" for="MeshLattice.get_mesh_cell_one-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MeshLattice.get_mesh_cell_one"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MeshLattice.get_mesh_cell_one-1444"><a href="#MeshLattice.get_mesh_cell_one-1444"><span class="linenos">1444</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_mesh_cell_one</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mesh</span><span class="p">:</span>
</span><span id="MeshLattice.get_mesh_cell_one-1445"><a href="#MeshLattice.get_mesh_cell_one-1445"><span class="linenos">1445</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MeshLattice.get_mesh_cell_one-1446"><a href="#MeshLattice.get_mesh_cell_one-1446"><span class="linenos">1446</span></a><span class="sd">        Extract the reference cell mesh corresponding to a single lattice cell.</span>
</span><span id="MeshLattice.get_mesh_cell_one-1447"><a href="#MeshLattice.get_mesh_cell_one-1447"><span class="linenos">1447</span></a>
</span><span id="MeshLattice.get_mesh_cell_one-1448"><a href="#MeshLattice.get_mesh_cell_one-1448"><span class="linenos">1448</span></a><span class="sd">        This method returns a :class:`Mesh` representing one reference cell of</span>
</span><span id="MeshLattice.get_mesh_cell_one-1449"><a href="#MeshLattice.get_mesh_cell_one-1449"><span class="linenos">1449</span></a><span class="sd">        the lattice, including:</span>
</span><span id="MeshLattice.get_mesh_cell_one-1450"><a href="#MeshLattice.get_mesh_cell_one-1450"><span class="linenos">1450</span></a><span class="sd">        - the corresponding subset of splines,</span>
</span><span id="MeshLattice.get_mesh_cell_one-1451"><a href="#MeshLattice.get_mesh_cell_one-1451"><span class="linenos">1451</span></a><span class="sd">        - the associated control points,</span>
</span><span id="MeshLattice.get_mesh_cell_one-1452"><a href="#MeshLattice.get_mesh_cell_one-1452"><span class="linenos">1452</span></a><span class="sd">        - a reduced connectivity.</span>
</span><span id="MeshLattice.get_mesh_cell_one-1453"><a href="#MeshLattice.get_mesh_cell_one-1453"><span class="linenos">1453</span></a>
</span><span id="MeshLattice.get_mesh_cell_one-1454"><a href="#MeshLattice.get_mesh_cell_one-1454"><span class="linenos">1454</span></a><span class="sd">        Returns</span>
</span><span id="MeshLattice.get_mesh_cell_one-1455"><a href="#MeshLattice.get_mesh_cell_one-1455"><span class="linenos">1455</span></a><span class="sd">        -------</span>
</span><span id="MeshLattice.get_mesh_cell_one-1456"><a href="#MeshLattice.get_mesh_cell_one-1456"><span class="linenos">1456</span></a><span class="sd">        Mesh</span>
</span><span id="MeshLattice.get_mesh_cell_one-1457"><a href="#MeshLattice.get_mesh_cell_one-1457"><span class="linenos">1457</span></a><span class="sd">            Mesh corresponding to a single lattice cell.</span>
</span><span id="MeshLattice.get_mesh_cell_one-1458"><a href="#MeshLattice.get_mesh_cell_one-1458"><span class="linenos">1458</span></a>
</span><span id="MeshLattice.get_mesh_cell_one-1459"><a href="#MeshLattice.get_mesh_cell_one-1459"><span class="linenos">1459</span></a><span class="sd">        Notes</span>
</span><span id="MeshLattice.get_mesh_cell_one-1460"><a href="#MeshLattice.get_mesh_cell_one-1460"><span class="linenos">1460</span></a><span class="sd">        -----</span>
</span><span id="MeshLattice.get_mesh_cell_one-1461"><a href="#MeshLattice.get_mesh_cell_one-1461"><span class="linenos">1461</span></a><span class="sd">        - The returned mesh is independent from the lattice structure but</span>
</span><span id="MeshLattice.get_mesh_cell_one-1462"><a href="#MeshLattice.get_mesh_cell_one-1462"><span class="linenos">1462</span></a><span class="sd">          shares the same control point values.</span>
</span><span id="MeshLattice.get_mesh_cell_one-1463"><a href="#MeshLattice.get_mesh_cell_one-1463"><span class="linenos">1463</span></a><span class="sd">        - This is typically used for analysis or visualization of the unit cell.</span>
</span><span id="MeshLattice.get_mesh_cell_one-1464"><a href="#MeshLattice.get_mesh_cell_one-1464"><span class="linenos">1464</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MeshLattice.get_mesh_cell_one-1465"><a href="#MeshLattice.get_mesh_cell_one-1465"><span class="linenos">1465</span></a>        <span class="n">splines</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_patchs</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
</span><span id="MeshLattice.get_mesh_cell_one-1466"><a href="#MeshLattice.get_mesh_cell_one-1466"><span class="linenos">1466</span></a>        <span class="n">splines</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splines</span>
</span><span id="MeshLattice.get_mesh_cell_one-1467"><a href="#MeshLattice.get_mesh_cell_one-1467"><span class="linenos">1467</span></a>        <span class="n">nb_patchs_cell</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splines</span><span class="p">)</span> <span class="o">//</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
</span><span id="MeshLattice.get_mesh_cell_one-1468"><a href="#MeshLattice.get_mesh_cell_one-1468"><span class="linenos">1468</span></a>        <span class="n">connectivity_cell</span><span class="p">,</span> <span class="n">splines_cell</span><span class="p">,</span> <span class="n">full_to_cell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span>
</span><span id="MeshLattice.get_mesh_cell_one-1469"><a href="#MeshLattice.get_mesh_cell_one-1469"><span class="linenos">1469</span></a>            <span class="n">splines</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nb_patchs_cell</span><span class="p">)</span>
</span><span id="MeshLattice.get_mesh_cell_one-1470"><a href="#MeshLattice.get_mesh_cell_one-1470"><span class="linenos">1470</span></a>        <span class="p">)</span>
</span><span id="MeshLattice.get_mesh_cell_one-1471"><a href="#MeshLattice.get_mesh_cell_one-1471"><span class="linenos">1471</span></a>        <span class="n">mesh_cell</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">(</span>
</span><span id="MeshLattice.get_mesh_cell_one-1472"><a href="#MeshLattice.get_mesh_cell_one-1472"><span class="linenos">1472</span></a>            <span class="nb">list</span><span class="p">(</span><span class="n">splines_cell</span><span class="p">),</span>
</span><span id="MeshLattice.get_mesh_cell_one-1473"><a href="#MeshLattice.get_mesh_cell_one-1473"><span class="linenos">1473</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">unique_ctrl_pts</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">full_to_cell</span><span class="p">],</span>
</span><span id="MeshLattice.get_mesh_cell_one-1474"><a href="#MeshLattice.get_mesh_cell_one-1474"><span class="linenos">1474</span></a>            <span class="n">connectivity</span><span class="o">=</span><span class="n">connectivity_cell</span><span class="p">,</span>
</span><span id="MeshLattice.get_mesh_cell_one-1475"><a href="#MeshLattice.get_mesh_cell_one-1475"><span class="linenos">1475</span></a>            <span class="n">ref_inds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_inds</span><span class="p">[</span><span class="n">full_to_cell</span><span class="p">],</span>
</span><span id="MeshLattice.get_mesh_cell_one-1476"><a href="#MeshLattice.get_mesh_cell_one-1476"><span class="linenos">1476</span></a>        <span class="p">)</span>
</span><span id="MeshLattice.get_mesh_cell_one-1477"><a href="#MeshLattice.get_mesh_cell_one-1477"><span class="linenos">1477</span></a>        <span class="k">return</span> <span class="n">mesh_cell</span>
</span></pre></div>


            <div class="docstring"><p>Extract the reference cell mesh corresponding to a single lattice cell.</p>

<p>This method returns a <code><a href="#Mesh">Mesh</a></code> representing one reference cell of
the lattice, including:</p>

<ul>
<li>the corresponding subset of splines,</li>
<li>the associated control points,</li>
<li>a reduced connectivity.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>Mesh</strong>: Mesh corresponding to a single lattice cell.</li>
</ul>

<h6 id="notes">Notes</h6>

<ul>
<li>The returned mesh is independent from the lattice structure but
shares the same control point values.</li>
<li>This is typically used for analysis or visualization of the unit cell.</li>
</ul>
</div>


                            </div>
                            <div id="MeshLattice.get_nb_patchs_cell" class="classattr">
                                        <input id="MeshLattice.get_nb_patchs_cell-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_nb_patchs_cell</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="MeshLattice.get_nb_patchs_cell-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MeshLattice.get_nb_patchs_cell"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MeshLattice.get_nb_patchs_cell-1479"><a href="#MeshLattice.get_nb_patchs_cell-1479"><span class="linenos">1479</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_nb_patchs_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="MeshLattice.get_nb_patchs_cell-1480"><a href="#MeshLattice.get_nb_patchs_cell-1480"><span class="linenos">1480</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MeshLattice.get_nb_patchs_cell-1481"><a href="#MeshLattice.get_nb_patchs_cell-1481"><span class="linenos">1481</span></a><span class="sd">        Return the number of patches in a single lattice cell.</span>
</span><span id="MeshLattice.get_nb_patchs_cell-1482"><a href="#MeshLattice.get_nb_patchs_cell-1482"><span class="linenos">1482</span></a>
</span><span id="MeshLattice.get_nb_patchs_cell-1483"><a href="#MeshLattice.get_nb_patchs_cell-1483"><span class="linenos">1483</span></a><span class="sd">        Returns</span>
</span><span id="MeshLattice.get_nb_patchs_cell-1484"><a href="#MeshLattice.get_nb_patchs_cell-1484"><span class="linenos">1484</span></a><span class="sd">        -------</span>
</span><span id="MeshLattice.get_nb_patchs_cell-1485"><a href="#MeshLattice.get_nb_patchs_cell-1485"><span class="linenos">1485</span></a><span class="sd">        int</span>
</span><span id="MeshLattice.get_nb_patchs_cell-1486"><a href="#MeshLattice.get_nb_patchs_cell-1486"><span class="linenos">1486</span></a><span class="sd">            Number of B-spline patches defining the reference cell.</span>
</span><span id="MeshLattice.get_nb_patchs_cell-1487"><a href="#MeshLattice.get_nb_patchs_cell-1487"><span class="linenos">1487</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MeshLattice.get_nb_patchs_cell-1488"><a href="#MeshLattice.get_nb_patchs_cell-1488"><span class="linenos">1488</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">nb_patchs</span> <span class="o">//</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return the number of patches in a single lattice cell.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>int</strong>: Number of B-spline patches defining the reference cell.</li>
</ul>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#Mesh">Mesh</a></dt>
                                <dd id="MeshLattice.connectivity" class="variable"><a href="#Mesh.connectivity">connectivity</a></dd>
                <dd id="MeshLattice.splines" class="variable"><a href="#Mesh.splines">splines</a></dd>
                <dd id="MeshLattice.unique_ctrl_pts" class="variable"><a href="#Mesh.unique_ctrl_pts">unique_ctrl_pts</a></dd>
                <dd id="MeshLattice.ref_inds" class="variable"><a href="#Mesh.ref_inds">ref_inds</a></dd>
                <dd id="MeshLattice.show" class="function"><a href="#Mesh.show">show</a></dd>
                <dd id="MeshLattice.save" class="function"><a href="#Mesh.save">save</a></dd>
                <dd id="MeshLattice.load" class="function"><a href="#Mesh.load">load</a></dd>
                <dd id="MeshLattice.separated_to_unique" class="function"><a href="#Mesh.separated_to_unique">separated_to_unique</a></dd>
                <dd id="MeshLattice.unique_to_separated" class="function"><a href="#Mesh.unique_to_separated">unique_to_separated</a></dd>
                <dd id="MeshLattice.get_separated_ctrl_pts" class="function"><a href="#Mesh.get_separated_ctrl_pts">get_separated_ctrl_pts</a></dd>
                <dd id="MeshLattice.set_separated_ctrl_pts" class="function"><a href="#Mesh.set_separated_ctrl_pts">set_separated_ctrl_pts</a></dd>
                <dd id="MeshLattice.assemble_grads" class="function"><a href="#Mesh.assemble_grads">assemble_grads</a></dd>
                <dd id="MeshLattice.assemble_hessians" class="function"><a href="#Mesh.assemble_hessians">assemble_hessians</a></dd>
                <dd id="MeshLattice.extract_border" class="function"><a href="#Mesh.extract_border">extract_border</a></dd>
                <dd id="MeshLattice.subset" class="function"><a href="#Mesh.subset">subset</a></dd>
                <dd id="MeshLattice.propagate_field" class="function"><a href="#Mesh.propagate_field">propagate_field</a></dd>
                <dd id="MeshLattice.propagate_field_from_submesh" class="function"><a href="#Mesh.propagate_field_from_submesh">propagate_field_from_submesh</a></dd>
                <dd id="MeshLattice.get_orientation_field" class="function"><a href="#Mesh.get_orientation_field">get_orientation_field</a></dd>
                <dd id="MeshLattice.correct_orientation" class="function"><a href="#Mesh.correct_orientation">correct_orientation</a></dd>
                <dd id="MeshLattice.plot_orientation" class="function"><a href="#Mesh.plot_orientation">plot_orientation</a></dd>
                <dd id="MeshLattice.plot" class="function"><a href="#Mesh.plot">plot</a></dd>
                <dd id="MeshLattice.plot_in_image" class="function"><a href="#Mesh.plot_in_image">plot_in_image</a></dd>
                <dd id="MeshLattice.ICP_rigid_body_transform" class="function"><a href="#Mesh.ICP_rigid_body_transform">ICP_rigid_body_transform</a></dd>
                <dd id="MeshLattice.distance_to_meshio" class="function"><a href="#Mesh.distance_to_meshio">distance_to_meshio</a></dd>
                <dd id="MeshLattice.save_paraview" class="function"><a href="#Mesh.save_paraview">save_paraview</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>